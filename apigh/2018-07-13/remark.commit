{
  "sha": "4cca80e3c14dba105421af9c741f1815928a0e3f",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjRjY2E4MGUzYzE0ZGJhMTA1NDIxYWY5Yzc0MWYxODE1OTI4YTBlM2Y=",
  "commit": {
    "author": {
      "name": "Efremov Alexey",
      "email": "lexich121@gmail.com",
      "date": "2018-07-13T07:46:22Z"
    },
    "committer": {
      "name": "Aleksei Gurianov",
      "email": "gurianov@gmail.com",
      "date": "2018-07-13T07:46:22Z"
    },
    "message": "restyle close button, add close animation (#152)\n\ncloses #98",
    "tree": {
      "sha": "fe582873ae2313838fa0a06b5df2870c0f348270",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/fe582873ae2313838fa0a06b5df2870c0f348270"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/4cca80e3c14dba105421af9c741f1815928a0e3f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/4cca80e3c14dba105421af9c741f1815928a0e3f",
  "html_url": "https://github.com/umputun/remark/commit/4cca80e3c14dba105421af9c741f1815928a0e3f",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/4cca80e3c14dba105421af9c741f1815928a0e3f/comments",
  "author": {
    "login": "lexich",
    "id": 859946,
    "node_id": "MDQ6VXNlcjg1OTk0Ng==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/859946?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lexich",
    "html_url": "https://github.com/lexich",
    "followers_url": "https://api.github.com/users/lexich/followers",
    "following_url": "https://api.github.com/users/lexich/following{/other_user}",
    "gists_url": "https://api.github.com/users/lexich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lexich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lexich/subscriptions",
    "organizations_url": "https://api.github.com/users/lexich/orgs",
    "repos_url": "https://api.github.com/users/lexich/repos",
    "events_url": "https://api.github.com/users/lexich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lexich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "Guria",
    "id": 36270,
    "node_id": "MDQ6VXNlcjM2Mjcw",
    "avatar_url": "https://avatars1.githubusercontent.com/u/36270?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Guria",
    "html_url": "https://github.com/Guria",
    "followers_url": "https://api.github.com/users/Guria/followers",
    "following_url": "https://api.github.com/users/Guria/following{/other_user}",
    "gists_url": "https://api.github.com/users/Guria/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Guria/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Guria/subscriptions",
    "organizations_url": "https://api.github.com/users/Guria/orgs",
    "repos_url": "https://api.github.com/users/Guria/repos",
    "events_url": "https://api.github.com/users/Guria/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Guria/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "905d41af7ed5b1085f8344253921e17f1de3a374",
      "url": "https://api.github.com/repos/umputun/remark/commits/905d41af7ed5b1085f8344253921e17f1de3a374",
      "html_url": "https://github.com/umputun/remark/commit/905d41af7ed5b1085f8344253921e17f1de3a374"
    }
  ],
  "stats": {
    "total": 147,
    "additions": 107,
    "deletions": 40
  },
  "files": [
    {
      "sha": "fab6f6e4a6e09a3899aa2b1468b85f85271073c0",
      "filename": "web/app/components/user-info/__close/user-info__close.scss",
      "status": "removed",
      "additions": 0,
      "deletions": 13,
      "changes": 13,
      "blob_url": "https://github.com/umputun/remark/blob/905d41af7ed5b1085f8344253921e17f1de3a374/web/app/components/user-info/__close/user-info__close.scss",
      "raw_url": "https://github.com/umputun/remark/raw/905d41af7ed5b1085f8344253921e17f1de3a374/web/app/components/user-info/__close/user-info__close.scss",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/components/user-info/__close/user-info__close.scss?ref=905d41af7ed5b1085f8344253921e17f1de3a374",
      "patch": "@@ -1,13 +0,0 @@\n-.user-info__close {\n-  position: absolute;\n-  top: 10px;\n-  right: 10px;\n-  font-size: 14px;\n-  line-height: 18px;\n-  cursor: pointer;\n-  color: #888;\n-\n-  &:hover {\n-    text-decoration: underline;\n-  }\n-}"
    },
    {
      "sha": "ee5e4016f60ae8ca0eaea186fb8c99271a60ca0e",
      "filename": "web/app/components/user-info/index.js",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark/blob/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/components/user-info/index.js",
      "raw_url": "https://github.com/umputun/remark/raw/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/components/user-info/index.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/components/user-info/index.js?ref=4cca80e3c14dba105421af9c741f1815928a0e3f",
      "patch": "@@ -1,8 +1,6 @@\n export { default } from './user-info';\n \n require('./user-info.scss');\n-\n-require('./__close/user-info__close.scss');\n require('./__id/user-info__id.scss');\n require('./__preloader/user-info__preloader.scss');\n require('./__title/user-info__title.scss');"
    },
    {
      "sha": "0ddfbd6e0557f21ab5fd489adfb21b8ce09a8c61",
      "filename": "web/app/components/user-info/user-info.jsx",
      "status": "modified",
      "additions": 0,
      "deletions": 7,
      "changes": 7,
      "blob_url": "https://github.com/umputun/remark/blob/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/components/user-info/user-info.jsx",
      "raw_url": "https://github.com/umputun/remark/raw/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/components/user-info/user-info.jsx",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/components/user-info/user-info.jsx?ref=4cca80e3c14dba105421af9c741f1815928a0e3f",
      "patch": "@@ -2,8 +2,6 @@\n import { h, Component } from 'preact';\n \n import api from 'common/api';\n-import { getHandleClickProps } from 'common/accessibility';\n-\n import LastCommentsList from './last-comments-list';\n import Avatar from 'components/avatar-icon';\n \n@@ -31,7 +29,6 @@ class UserInfo extends Component {\n   render(props, { comments, isLoading }) {\n     const {\n       user: { name, id, isDefaultPicture, picture },\n-      onClose,\n     } = props;\n \n     return (\n@@ -41,10 +38,6 @@ class UserInfo extends Component {\n         <p className=\"user-info__id\">{id}</p>\n \n         <LastCommentsList isLoading={isLoading} comments={comments} />\n-\n-        <span {...getHandleClickProps(onClose)} className=\"user-info__close\">\n-          Close &#10006;\n-        </span>\n       </div>\n     );\n   }"
    },
    {
      "sha": "17a7eae30e8c77f8c509de81bb6218821d4367a3",
      "filename": "web/app/embed.js",
      "status": "modified",
      "additions": 104,
      "deletions": 10,
      "changes": 114,
      "blob_url": "https://github.com/umputun/remark/blob/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/embed.js",
      "raw_url": "https://github.com/umputun/remark/raw/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/embed.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/embed.js?ref=4cca80e3c14dba105421af9c741f1815928a0e3f",
      "patch": "@@ -56,19 +56,84 @@ function init() {\n \n   setTimeout(postHashToIframe, 1000);\n \n+  const remarkRootId = 'remark-km423lmfdslkm34';\n   const userInfo = {\n     node: null,\n     back: null,\n+    closeEl: null,\n+    style: null,\n     init(user) {\n+      this.animationStop();\n+      if (!this.style) {\n+        this.style = document.createElement('style');\n+        this.style.setAttribute('rel', 'stylesheet');\n+        this.style.setAttribute('type', 'text/css');\n+        this.style.innerHTML = `\n+          #${remarkRootId}-node {\n+            position: fixed;\n+            top: 0;\n+            right: 0;\n+            bottom: 0;\n+            width: 400px;\n+            transition: transform 0.4s ease-out;\n+            max-width: 100%;\n+            transform: translate(400px, 0);\n+          }\n+          #${remarkRootId}-node[data-animation] {\n+            transform: translate(0, 0);\n+          }\n+          #${remarkRootId}-back {\n+            position: fixed;\n+            top: 0;\n+            left: 0;\n+            right: 0;\n+            bottom: 0;\n+            background: rgba(0,0,0,0.7);\n+            opacity: 0;\n+            transition: opacity 0.4s ease-out;\n+          }\n+          #${remarkRootId}-back[data-animation] {\n+            opacity: 1;\n+          }\n+          #${remarkRootId}-close {\n+            top: 0px;\n+            right: 400px;\n+            width: 30px;\n+            height: 30px;\n+            position: absolute;\n+            text-align: center;\n+            font-size: 25px;\n+            cursor: pointer;\n+            color: white;\n+            border-color: transparent;\n+            border-width: 0;\n+            padding: 0;\n+            background-color: transparent;\n+          }\n+          @media all and (max-width: 430px) {\n+            #${remarkRootId}-close {\n+              right: 0px;\n+              font-size: 20px;\n+              color: black;\n+            }\n+          }\n+        `;\n+      }\n       if (!this.node) {\n         this.node = document.createElement('div');\n-        this.node.style = `position: fixed; top: 0; right: 0; bottom: 0;width: 400px; transform: translate(400px, 0); transition: transform 0.4s ease-out; max-width: 100%`;\n+        this.node.id = remarkRootId + '-node';\n       }\n       if (!this.back) {\n         this.back = document.createElement('div');\n-        this.back.style = `position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7);opacity: 0;transition: opacity 0.4s ease-out;`;\n+        this.back.id = remarkRootId + '-back';\n         this.back.onclick = () => this.close();\n       }\n+      if (!this.closeEl) {\n+        this.closeEl = document.createElement('button');\n+        this.closeEl.id = remarkRootId + '-close';\n+        this.closeEl.innerHTML = '&#10006;';\n+        this.closeEl.onclick = () => this.close();\n+      }\n       const queryUserInfo =\n         query +\n         '&page=user-info&' +\n@@ -85,24 +150,53 @@ function init() {\n         title=\"Remark42\"\n         verticalscrolling=\"no\"\n         horizontalscrolling=\"no\"\n-      />\n-      `;\n+      />`;\n+      this.node.appendChild(this.closeEl);\n+      document.body.appendChild(this.style);\n       document.body.appendChild(this.back);\n       document.body.appendChild(this.node);\n       setTimeout(() => {\n-        this.back.style.opacity = 1;\n-        this.node.style.transform = '';\n+        this.back.setAttribute('data-animation', '');\n+        this.node.setAttribute('data-animation', '');\n+        this.closeEl.focus();\n       }, 400);\n     },\n     close() {\n       if (this.node) {\n-        this.node.style.transform = 'translate(400px, 0)';\n-        this.node.remove();\n+        this.onAnimationClose();\n+        this.node.removeAttribute('data-animation');\n       }\n       if (this.back) {\n-        this.back.style.opacity = 0;\n-        this.back.remove();\n+        this.back.removeAttribute('data-animation');\n+      }\n+    },\n+    delay: null,\n+    events: ['', 'webkit', 'moz', 'MS', 'o'].map(prefix => (prefix ? `${prefix}TransitionEnd` : 'transitionend')),\n+    onAnimationClose() {\n+      const el = this.node;\n+      if (!this.node) {\n+        return;\n       }\n+      this.delay = setTimeout(this.animationStop, 1000);\n+      this.events.forEach(event => el.addEventListener(event, this.animationStop, false));\n+    },\n+    animationStop() {\n+      const t = userInfo;\n+      if (!t.node) {\n+        return;\n+      }\n+      if (t.delay) {\n+        clearTimeout(t.delay);\n+        t.delay = null;\n+      }\n+      t.events.forEach(event => t.node.removeEventListener(event, t.animationStop, false));\n+      return t.remove();\n+    },\n+    remove() {\n+      const t = userInfo;\n+      t.node && t.node.remove();\n+      t.back && t.back.remove();\n+      t.style && t.style.remove();\n     },\n   };\n "
    },
    {
      "sha": "a402e81e9725a91de7cd2d7a9acd891c0443758b",
      "filename": "web/app/remark.js",
      "status": "modified",
      "additions": 3,
      "deletions": 8,
      "changes": 11,
      "blob_url": "https://github.com/umputun/remark/blob/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/remark.js",
      "raw_url": "https://github.com/umputun/remark/raw/4cca80e3c14dba105421af9c741f1815928a0e3f/web/app/remark.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/remark.js?ref=4cca80e3c14dba105421af9c741f1815928a0e3f",
      "patch": "@@ -51,20 +51,15 @@ function init() {\n   if (params.page === 'user-info') {\n     const user = {\n       id: params.id,\n-      name: params.name || '',\n-      isDefaultPicture: params.isDefaultPicture,\n+      name: decodeURIComponent(params.name) || '',\n+      isDefaultPicture: params.isDefaultPicture != 0,\n       picture: params.picture,\n     };\n     store.set('user', user);\n-    const onClose = () => {\n-      if (window.parent) {\n-        window.parent.postMessage(JSON.stringify({ isUserInfoShown: false }), '*');\n-      }\n-    };\n     render(\n       <div id={NODE_ID}>\n         <div className=\"root root_user-info\">\n-          <UserInfo user={user} onClose={onClose} />\n+          <UserInfo user={user} />\n         </div>\n       </div>,\n       node.parentElement,"
    }
  ]
}
