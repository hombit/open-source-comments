{
  "sha": "78419f677db862d3527a1896800148de0156e92f",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo3ODQxOWY2NzdkYjg2MmQzNTI3YTE4OTY4MDAxNDhkZTAxNTZlOTJm",
  "commit": {
    "author": {
      "name": "Joffrey JAFFEUX",
      "email": "j.jaffeux@gmail.com",
      "date": "2018-07-23T16:19:40Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2018-07-23T16:19:40Z"
    },
    "message": "FIX: multiple select-kit fixes on mobile",
    "tree": {
      "sha": "0c3c5e2e6eb98ecc18f8237be10a093a5a9ced03",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/0c3c5e2e6eb98ecc18f8237be10a093a5a9ced03"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/78419f677db862d3527a1896800148de0156e92f",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbVgAcCRBK7hj4Ov3rIwAAdHIIAGlYlTTJiRINrUEJWGM9JyOy\njygQ0JS5Ixr7UYOdEycfktjPUAyTtWWTmpjsYkFROq5m9npUSMRrNAddegQaQvek\nxRfXDR7Hk5BS+uu7QZmk7gYnq5D7mPwYEn432WwtbxvUwcbUUsE1uwukRG30OL/x\nFeQhQJdwGhhsPBI3/A+dfLfyhJmQ0tw1+AzQcV/SEDYDs88FB52r7FedzJYmOSIT\n0GBd5uhrlNunvRYImIiqhfGrcXT6/MhYqruGH0WzWEc6ngm5iKGXq8Hjdbq1uPSz\n7F5Tb5UUne/WVW/j6AGA8SSQJZORZMD2xfn8ciPeAie2CH5SpZB5Q9LaXndjAjw=\n=F4qA\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 0c3c5e2e6eb98ecc18f8237be10a093a5a9ced03\nparent eda1462b3b8f57aace0c49b1d64edfcf3d1f45b2\nauthor Joffrey JAFFEUX <j.jaffeux@gmail.com> 1532362780 -0400\ncommitter GitHub <noreply@github.com> 1532362780 -0400\n\nFIX: multiple select-kit fixes on mobile\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/78419f677db862d3527a1896800148de0156e92f",
  "html_url": "https://github.com/discourse/discourse/commit/78419f677db862d3527a1896800148de0156e92f",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/78419f677db862d3527a1896800148de0156e92f/comments",
  "author": {
    "login": "jjaffeux",
    "id": 339945,
    "node_id": "MDQ6VXNlcjMzOTk0NQ==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/339945?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjaffeux",
    "html_url": "https://github.com/jjaffeux",
    "followers_url": "https://api.github.com/users/jjaffeux/followers",
    "following_url": "https://api.github.com/users/jjaffeux/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjaffeux/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjaffeux/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjaffeux/subscriptions",
    "organizations_url": "https://api.github.com/users/jjaffeux/orgs",
    "repos_url": "https://api.github.com/users/jjaffeux/repos",
    "events_url": "https://api.github.com/users/jjaffeux/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjaffeux/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "eda1462b3b8f57aace0c49b1d64edfcf3d1f45b2",
      "url": "https://api.github.com/repos/discourse/discourse/commits/eda1462b3b8f57aace0c49b1d64edfcf3d1f45b2",
      "html_url": "https://github.com/discourse/discourse/commit/eda1462b3b8f57aace0c49b1d64edfcf3d1f45b2"
    }
  ],
  "stats": {
    "total": 93,
    "additions": 57,
    "deletions": 36
  },
  "files": [
    {
      "sha": "3e8edebc1da29d7981f70384bcb6b5586e46684f",
      "filename": "app/assets/javascripts/select-kit/components/mini-tag-chooser.js.es6",
      "status": "modified",
      "additions": 22,
      "deletions": 1,
      "changes": 23,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/components/mini-tag-chooser.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/components/mini-tag-chooser.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/components/mini-tag-chooser.js.es6?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -22,7 +22,7 @@ export default ComboBox.extend(Tags, {\n   fullWidthOnMobile: true,\n \n   init() {\n-    this._super();\n+    this._super(...arguments);\n \n     this.set(\"termMatchesForbidden\", false);\n     this.selectionSelector = \".selected-tag\";\n@@ -45,6 +45,27 @@ export default ComboBox.extend(Tags, {\n     );\n   },\n \n+  willDestroyElement() {\n+    this._super(...arguments);\n+\n+    $(\".selected-name\").off(\"touchend.select-kit pointerup.select-kit\");\n+  },\n+\n+  didInsertElement() {\n+    this._super(...arguments);\n+\n+    $(\".selected-name\").on(\n+      \"touchend.select-kit pointerup.select-kit\",\n+      event => {\n+        if (!this.get(\"isExpanded\")) {\n+          this.expand(event);\n+        }\n+\n+        this.focusFilterOrHeader();\n+      }\n+    );\n+  },\n+\n   @computed(\"hasReachedMaximum\")\n   caretIcon(hasReachedMaximum) {\n     return hasReachedMaximum ? null : \"plus fa-fw\";"
    },
    {
      "sha": "3155e0ce1412378571be529ad9ed3d17a7b603af",
      "filename": "app/assets/javascripts/select-kit/components/select-kit.js.es6",
      "status": "modified",
      "additions": 1,
      "deletions": 12,
      "changes": 13,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/components/select-kit.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/components/select-kit.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/components/select-kit.js.es6?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -92,17 +92,6 @@ export default Ember.Component.extend(\n       this.set(\"computedContent\", []);\n       this.set(\"highlightedSelection\", []);\n \n-      if (this.site && this.site.isMobileDevice) {\n-        this.setProperties({\n-          filterable: isNone(this.get(\"filterable\"))\n-            ? false\n-            : this.get(\"filterable\"),\n-          autoFilterable: isNone(this.get(\"autoFilterable\"))\n-            ? false\n-            : this.get(\"filterable\")\n-        });\n-      }\n-\n       if (this.get(\"nameChanges\")) {\n         this.addObserver(\n           `content.@each.${this.get(\"nameProperty\")}`,\n@@ -458,7 +447,7 @@ export default Ember.Component.extend(\n \n     clearSelection() {\n       this.deselect(this.get(\"selection\"));\n-      this.focus();\n+      this.focusFilterOrHeader();\n     },\n \n     actions: {"
    },
    {
      "sha": "8eae8b38ac1b09422bbcfcbb72aa0eedcb4fe0c7",
      "filename": "app/assets/javascripts/select-kit/mixins/dom-helpers.js.es6",
      "status": "modified",
      "additions": 7,
      "deletions": 9,
      "changes": 16,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/mixins/dom-helpers.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/mixins/dom-helpers.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/mixins/dom-helpers.js.es6?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -82,9 +82,7 @@ export default Ember.Mixin.create({\n   },\n \n   focus() {\n-    Ember.run.schedule(\"afterRender\", () => {\n-      this.$header().focus();\n-    });\n+    this.focusFilterOrHeader();\n   },\n \n   // try to focus filter and fallback to header if not present\n@@ -93,12 +91,12 @@ export default Ember.Mixin.create({\n     // next so we are sure it finised expand/collapse\n     Ember.run.next(() => {\n       Ember.run.schedule(\"afterRender\", () => {\n-        if (\n-          (this.site && this.site.isMobileDevice) ||\n-          !context.$filterInput() ||\n-          !context.$filterInput().is(\":visible\")\n-        ) {\n-          context.$header().focus();\n+        if (!context.$filterInput() || !context.$filterInput().is(\":visible\")) {\n+          if (context.$header()) {\n+            context.$header().focus();\n+          } else {\n+            $(context.element).focus();\n+          }\n         } else {\n           context.$filterInput().focus();\n         }"
    },
    {
      "sha": "3de11e017adf8c4db58c4f3ae002cec14b87ad9a",
      "filename": "app/assets/javascripts/select-kit/mixins/events.js.es6",
      "status": "modified",
      "additions": 11,
      "deletions": 5,
      "changes": 16,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/mixins/events.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/javascripts/select-kit/mixins/events.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/mixins/events.js.es6?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -16,28 +16,29 @@ export default Ember.Mixin.create({\n   },\n \n   willDestroyElement() {\n-    this._super();\n+    this._super(...arguments);\n \n     $(document).off(\"mousedown.select-kit\");\n \n-    if (this.$header()) {\n+    if (this.$header().length) {\n       this.$header()\n         .off(\"blur.select-kit\")\n         .off(\"focus.select-kit\")\n         .off(\"keypress.select-kit\")\n         .off(\"keydown.select-kit\");\n     }\n \n-    if (this.$filterInput()) {\n+    if (this.$filterInput().length) {\n       this.$filterInput()\n         .off(\"change.select-kit\")\n         .off(\"keydown.select-kit\")\n-        .off(\"keypress.select-kit\");\n+        .off(\"keypress.select-kit\")\n+        .off(\"focusout.select-kit\");\n     }\n   },\n \n   didInsertElement() {\n-    this._super();\n+    this._super(...arguments);\n \n     $(document).on(\"mousedown.select-kit\", event => {\n       if (!this.element || this.isDestroying || this.isDestroyed) {\n@@ -120,6 +121,11 @@ export default Ember.Mixin.create({\n       .on(\"keypress.select-kit\", event => {\n         event.stopPropagation();\n       })\n+      .on(\"focusout.select-kit\", event => {\n+        if (!Ember.$.contains(this.element, event.relatedTarget)) {\n+          this.close(event);\n+        }\n+      })\n       .on(\"keydown.select-kit\", event => {\n         const keyCode = event.keyCode || event.which;\n "
    },
    {
      "sha": "a1c187ae8af838c1e644cd4a2243d583744d4a5b",
      "filename": "app/assets/stylesheets/common/select-kit/future-date-input-selector.scss",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/future-date-input-selector.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/future-date-input-selector.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/select-kit/future-date-input-selector.scss?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -11,11 +11,16 @@\n \n       .future-date-input-selector-datetime {\n         color: lighten($primary, 40%);\n-        font-size: $font-down-1;\n+        margin-left: 5px;\n       }\n \n       .future-date-input-selector-icons {\n-        width: 25px;\n+        margin-right: 5px;\n+      }\n+\n+      .btn-clear {\n+        padding: 0;\n+        margin-left: 5px;\n       }\n \n       .future-date-input-selector-row {"
    },
    {
      "sha": "9a4bb6b3b7a9072d020655d426d26b6bf899002b",
      "filename": "app/assets/stylesheets/common/select-kit/mini-tag-chooser.scss",
      "status": "modified",
      "additions": 5,
      "deletions": 3,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/mini-tag-chooser.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/mini-tag-chooser.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/select-kit/mini-tag-chooser.scss?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -58,14 +58,16 @@\n       .select-kit-collection {\n         .collection-header {\n           max-height: 125px;\n-          overflow-y: auto;\n+          overflow: hidden;\n           flex: 1 0 auto;\n+          border-bottom: 1px solid $primary-low;\n \n           .selected-tags {\n             display: flex;\n-            padding: 4px 8px;\n+            padding: 4px;\n             flex-wrap: wrap;\n-            border-bottom: 1px solid $primary-low;\n+            margin: -2px;\n+            overflow: hidden;\n           }\n \n           .selected-tag {"
    },
    {
      "sha": "9b7e158aa91462d894dd4af20db0e713e20b2cec",
      "filename": "app/assets/stylesheets/common/select-kit/multi-select.scss",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/multi-select.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/common/select-kit/multi-select.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/select-kit/multi-select.scss?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -64,9 +64,9 @@\n     }\n \n     .choices {\n-      margin: 0;\n+      margin: 1px;\n       box-sizing: border-box;\n-      display: inline-flex;\n+      display: flex;\n       justify-content: flex-start;\n       flex-wrap: wrap;\n \n@@ -79,7 +79,7 @@\n         justify-content: space-between;\n         flex-wrap: wrap;\n         flex-direction: row;\n-        margin: 2px;\n+        margin: 1px;\n       }\n \n       .filter {"
    },
    {
      "sha": "5d4c46832b5d78c1cca8ee3edd42d1674839d33c",
      "filename": "app/assets/stylesheets/mobile/select-kit/dropdown-select-box.scss",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/mobile/select-kit/dropdown-select-box.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/78419f677db862d3527a1896800148de0156e92f/app/assets/stylesheets/mobile/select-kit/dropdown-select-box.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/mobile/select-kit/dropdown-select-box.scss?ref=78419f677db862d3527a1896800148de0156e92f",
      "patch": "@@ -2,7 +2,7 @@\n   &.dropdown-select-box {\n     .select-kit-collection {\n       max-height: 200px;\n-      overflow-y: scroll;\n+      overflow-y: auto;\n     }\n   }\n }"
    }
  ]
}
