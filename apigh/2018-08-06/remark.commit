{
  "sha": "39e426bd4bb27522b13a82270e5d7f499df09912",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjM5ZTQyNmJkNGJiMjc1MjJiMTNhODIyNzBlNWQ3ZjQ5OWRmMDk5MTI=",
  "commit": {
    "author": {
      "name": "Anton Kosourov",
      "email": "kosourov.anton88@gmail.com",
      "date": "2018-08-03T03:05:53Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2018-08-03T03:05:53Z"
    },
    "message": "Add wordpress importer (#182)\n\n* add wordpress, test\r\n\r\n* add wp migrator to rest\r\n\r\n* add readme, fix test, fix error handling",
    "tree": {
      "sha": "790270e8b71b573ee00287aee4034ddd55f55759",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/790270e8b71b573ee00287aee4034ddd55f55759"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/39e426bd4bb27522b13a82270e5d7f499df09912",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/39e426bd4bb27522b13a82270e5d7f499df09912",
  "html_url": "https://github.com/umputun/remark/commit/39e426bd4bb27522b13a82270e5d7f499df09912",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/39e426bd4bb27522b13a82270e5d7f499df09912/comments",
  "author": {
    "login": "akosourov",
    "id": 17426217,
    "node_id": "MDQ6VXNlcjE3NDI2MjE3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/17426217?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/akosourov",
    "html_url": "https://github.com/akosourov",
    "followers_url": "https://api.github.com/users/akosourov/followers",
    "following_url": "https://api.github.com/users/akosourov/following{/other_user}",
    "gists_url": "https://api.github.com/users/akosourov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/akosourov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/akosourov/subscriptions",
    "organizations_url": "https://api.github.com/users/akosourov/orgs",
    "repos_url": "https://api.github.com/users/akosourov/repos",
    "events_url": "https://api.github.com/users/akosourov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/akosourov/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e79b95de0c9fe03ca6d45ba504b04203f8fe0117",
      "url": "https://api.github.com/repos/umputun/remark/commits/e79b95de0c9fe03ca6d45ba504b04203f8fe0117",
      "html_url": "https://github.com/umputun/remark/commit/e79b95de0c9fe03ca6d45ba504b04203f8fe0117"
    }
  ],
  "stats": {
    "total": 677,
    "additions": 645,
    "deletions": 32
  },
  "files": [
    {
      "sha": "0558e2aaff7571d8befd6fb181f5b12d82b20b4b",
      "filename": "README.md",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/README.md",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/README.md",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/README.md?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -4,7 +4,7 @@ Remark42 is a self-hosted, lightweight, and simple (yet functional) comment engi\n \n * Social login via Google, Facebook, Github and Yandex\n * Multi-level nested comments with both tree and plain presentations\n-* Import from disqus\n+* Import from disqus, wordpress\n * Markdown support\n * Moderator can remove comments and block users\n * Voting, pinning and verification system\n@@ -162,6 +162,12 @@ For more details refer to [Yandex OAuth](https://tech.yandex.com/oauth/doc/dg/co\n 2.  Move this file to your remark42 host within `./var` and unzip, i.e. `gunzip <disqus-export-name>.xml.gz`.\n 3.  Run import command - `docker-compose exec remark42 /srv/import-disqus.sh <disqus-export-name>.xml <your site id>`\n \n+#### Initial import from WordPress\n+\n+1. Install WordPress [plugin](https://wordpress.org/plugins/wp-exporter/) to export comments and follow it instructions. The plugin should produce a xml-based file with site content including comments. \n+2. Move this file to your remark42 host within `./var`\n+3. Run import command - `docker-compose exec remark42 /srv/import-wordpress.sh <wordpress-export-name>.xml <your site id>`\n+\n #### Backup and restore\n \n ##### Automatic backups"
    },
    {
      "sha": "a88b5759ce279fa1ce15bc93f3b53af6ea2fb8af",
      "filename": "backend/app/main.go",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/main.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/main.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/main.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -196,12 +196,13 @@ func New(opts Opts) (*Application, error) {\n \texporter := &migrator.Remark{DataStore: dataService}\n \n \tmigr := &api.Migrator{\n-\t\tVersion:        revision,\n-\t\tCache:          loadingCache,\n-\t\tNativeImporter: &migrator.Remark{DataStore: dataService},\n-\t\tDisqusImporter: &migrator.Disqus{DataStore: dataService},\n-\t\tNativeExported: &migrator.Remark{DataStore: dataService},\n-\t\tSecretKey:      opts.SecretKey,\n+\t\tVersion:           revision,\n+\t\tCache:             loadingCache,\n+\t\tNativeImporter:    &migrator.Remark{DataStore: dataService},\n+\t\tDisqusImporter:    &migrator.Disqus{DataStore: dataService},\n+\t\tWordPressImporter: &migrator.WordPress{DataStore: dataService},\n+\t\tNativeExported:    &migrator.Remark{DataStore: dataService},\n+\t\tSecretKey:         opts.SecretKey,\n \t}\n \n \tauthProviders := makeAuthProviders(jwtService, avatarProxy, dataService, opts)"
    },
    {
      "sha": "e9d657b3880528e0c1b25d48bfaaadfe89e3efa2",
      "filename": "backend/app/migrator/disqus.go",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/disqus.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/disqus.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/disqus.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -68,14 +68,14 @@ func (d *Disqus) Import(r io.Reader, siteID string) (size int, err error) {\n \t}\n \n \tif failed > 0 {\n-\t\treturn passed, errors.Errorf(\"failed to save %d comments\", failed)\n+\t\terr = errors.Errorf(\"failed to save %d comments\", failed)\n+\t\tif passed == 0 {\n+\t\t\terr = errors.New(\"import failed\")\n+\t\t}\n \t}\n \n \tlog.Printf(\"[DEBUG] imported %d comments to site %s\", passed, siteID)\n \n-\tif failed > 0 && passed == 0 {\n-\t\terr = errors.New(\"import failed\")\n-\t}\n \treturn passed, err\n }\n \n@@ -133,7 +133,7 @@ func (d *Disqus) convert(r io.Reader, siteID string) (ch chan store.Comment) {\n \t\t\t\t\t\t\tName: comment.AuthorName,\n \t\t\t\t\t\t\tIP:   comment.IP,\n \t\t\t\t\t\t},\n-\t\t\t\t\t\tText:      d.cleanText(comment.Message),\n+\t\t\t\t\t\tText:      cleanText(comment.Message),\n \t\t\t\t\t\tTimestamp: comment.CreatedAt,\n \t\t\t\t\t\tParentID:  comment.Pid.Val,\n \t\t\t\t\t}\n@@ -158,7 +158,7 @@ func (d *Disqus) convert(r io.Reader, siteID string) (ch chan store.Comment) {\n \treturn commentsCh\n }\n \n-func (d *Disqus) cleanText(text string) string {\n+func cleanText(text string) string {\n \ttext = strings.Replace(text, \"\\n\", \"\", -1)\n \ttext = strings.Replace(text, \"\\t\", \"\", -1)\n \treturn text"
    },
    {
      "sha": "af7a55ba937539e76941f9fe0565c3bbbfa4c035",
      "filename": "backend/app/migrator/disqus_test.go",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/disqus_test.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/disqus_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/disqus_test.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -21,7 +21,7 @@ func TestDisqus_Import(t *testing.T) {\n \trequire.Nil(t, err, \"create store\")\n \tdataStore := service.DataStore{Interface: b}\n \td := Disqus{DataStore: &dataStore}\n-\tsize, err := d.Import(strings.NewReader(xmlTest), \"test\")\n+\tsize, err := d.Import(strings.NewReader(xmlTestDisqus), \"test\")\n \tassert.Nil(t, err)\n \tassert.Equal(t, 3, size)\n \n@@ -49,7 +49,7 @@ func TestDisqus_Import(t *testing.T) {\n \n func TestDisqus_Convert(t *testing.T) {\n \td := Disqus{}\n-\tch := d.convert(strings.NewReader(xmlTest), \"test\")\n+\tch := d.convert(strings.NewReader(xmlTestDisqus), \"test\")\n \n \tres := []store.Comment{}\n \tfor comment := range ch {\n@@ -74,7 +74,7 @@ func TestDisqus_Convert(t *testing.T) {\n \tassert.Equal(t, exp0, res[0])\n }\n \n-var xmlTest = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+var xmlTestDisqus = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <disqus xmlns=\"http://disqus.com\" xmlns:dsq=\"http://disqus.com/disqus-internals\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://disqus.com/api/schemas/1.0/disqus.xsd http://disqus.com/api/schemas/1.0/disqus-internals.xsd\">\n \n \t<category dsq:id=\"707279\">"
    },
    {
      "sha": "422a25abdd89e7887f5654a8ea435dff10bce487",
      "filename": "backend/app/migrator/migrator.go",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/migrator.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/migrator.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/migrator.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -46,6 +46,8 @@ func ImportComments(p ImportParams) (int, error) {\n \tswitch p.Provider {\n \tcase \"disqus\":\n \t\timporter = &Disqus{DataStore: p.DataStore}\n+\tcase \"wordpress\":\n+\t\timporter = &WordPress{DataStore: p.DataStore}\n \tcase \"native\":\n \t\timporter = &Remark{DataStore: p.DataStore}\n \tdefault:"
    },
    {
      "sha": "120b1185f1027f5e261958ea27dfdf4d12f23b38",
      "filename": "backend/app/migrator/migrator_test.go",
      "status": "modified",
      "additions": 28,
      "deletions": 2,
      "changes": 30,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/migrator_test.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/migrator_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/migrator_test.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -19,7 +19,7 @@ func TestMigrator_ImportDisqus(t *testing.T) {\n \t\tos.Remove(\"/tmp/disqus-test.xml\")\n \t}()\n \n-\terr := ioutil.WriteFile(\"/tmp/disqus-test.xml\", []byte(xmlTest), 0600)\n+\terr := ioutil.WriteFile(\"/tmp/disqus-test.xml\", []byte(xmlTestDisqus), 0600)\n \trequire.Nil(t, err)\n \n \tb, err := engine.NewBoltDB(bolt.Options{}, engine.BoltSite{FileName: \"/tmp/remark-test.db\", SiteID: \"test\"})\n@@ -39,6 +39,32 @@ func TestMigrator_ImportDisqus(t *testing.T) {\n \tassert.Equal(t, 3, len(last), \"3 comments imported\")\n }\n \n+func TestMigrator_ImportWordPress(t *testing.T) {\n+\tdefer func() {\n+\t\tos.Remove(\"/tmp/remark-test.db\")\n+\t\tos.Remove(\"/tmp/wordpress-test.xml\")\n+\t}()\n+\n+\terr := ioutil.WriteFile(\"/tmp/wordpress-test.xml\", []byte(xmlTestWP), 0600)\n+\trequire.Nil(t, err)\n+\n+\tb, err := engine.NewBoltDB(bolt.Options{}, engine.BoltSite{FileName: \"/tmp/remark-test.db\", SiteID: \"test\"})\n+\trequire.Nil(t, err, \"create store\")\n+\tdataStore := &service.DataStore{Interface: b}\n+\tsize, err := ImportComments(ImportParams{\n+\t\tDataStore: dataStore,\n+\t\tInputFile: \"/tmp/wordpress-test.xml\",\n+\t\tSiteID:    \"test\",\n+\t\tProvider:  \"wordpress\",\n+\t})\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 3, size)\n+\n+\tlast, err := dataStore.Last(\"test\", 10)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 3, len(last), \"3 comments imported\")\n+}\n+\n func TestMigrator_ImportRemark(t *testing.T) {\n \tdefer func() {\n \t\tos.Remove(\"/tmp/remark-test.db\")\n@@ -70,7 +96,7 @@ func TestMigrator_ImportRemark(t *testing.T) {\n }\n \n func TestMigrator_ImportFailed(t *testing.T) {\n-\n+\tdefer os.Remove(\"/tmp/remark-test.db\")\n \tb, err := engine.NewBoltDB(bolt.Options{}, engine.BoltSite{FileName: \"/tmp/remark-test.db\", SiteID: \"test\"})\n \trequire.Nil(t, err, \"create store\")\n \tdataStore := &service.DataStore{Interface: b}"
    },
    {
      "sha": "362ef881b7995290297d060c939426270651572c",
      "filename": "backend/app/migrator/wordpress.go",
      "status": "added",
      "additions": 154,
      "deletions": 0,
      "changes": 154,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/wordpress.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/wordpress.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/wordpress.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -0,0 +1,154 @@\n+package migrator\n+\n+import (\n+\t\"encoding/xml\"\n+\t\"html\"\n+\t\"io\"\n+\t\"log\"\n+\t\"time\"\n+\n+\t\"github.com/pkg/errors\"\n+\n+\t\"github.com/umputun/remark/backend/app/store\"\n+)\n+\n+const wpTimeLayout = \"2006-01-02 15:04:05\"\n+\n+// WordPress implements Importer from WP xml\n+type WordPress struct {\n+\tDataStore Store\n+}\n+\n+type wpItem struct {\n+\tLink     string      `xml:\"link\"`\n+\tComments []wpComment `xml:\"comment\"`\n+}\n+\n+type wpComment struct {\n+\tID          string `xml:\"comment_id\"`\n+\tAuthor      string `xml:\"comment_author\"`\n+\tAuthorEmail string `xml:\"comment_author_email\"`\n+\tAuthorIP    string `xml:\"comment_author_IP\"`\n+\tDate        wpTime `xml:\"comment_date_gmt\"`\n+\tContent     string `xml:\"comment_content\"`\n+\tApproved    string `xml:\"comment_approved\"`\n+\tPID         string `xml:\"comment_parent\"`\n+}\n+\n+type wpTime struct {\n+\ttime time.Time\n+}\n+\n+func (w *wpTime) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n+\tvar v string\n+\tif err := d.DecodeElement(&v, &start); err != nil {\n+\t\treturn err\n+\t}\n+\tt, err := time.Parse(wpTimeLayout, v)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tw.time = t\n+\treturn err\n+}\n+\n+// Import comments from WP and save to store\n+func (w *WordPress) Import(r io.Reader, siteID string) (size int, err error) {\n+\n+\tif err = w.DataStore.DeleteAll(siteID); err != nil {\n+\t\treturn 0, err\n+\t}\n+\n+\tcommentsCh := w.convert(r, siteID)\n+\tfailed, passed := 0, 0\n+\tfor c := range commentsCh {\n+\t\tif _, err = w.DataStore.Create(c); err != nil {\n+\t\t\tfailed++\n+\t\t\tcontinue\n+\t\t}\n+\t\tpassed++\n+\t}\n+\n+\tif failed > 0 {\n+\t\terr = errors.Errorf(\"failed to save %d comments\", failed)\n+\t\tif passed == 0 {\n+\t\t\terr = errors.New(\"import failed\")\n+\t\t}\n+\t}\n+\n+\tlog.Printf(\"[DEBUG] imported %d comments to site %s\", passed, siteID)\n+\n+\treturn passed, err\n+}\n+\n+func (w *WordPress) convert(r io.Reader, siteID string) chan store.Comment {\n+\n+\tdecoder := xml.NewDecoder(r)\n+\tcommentsCh := make(chan store.Comment)\n+\n+\tstats := struct {\n+\t\tinpItems, failedItems       int\n+\t\tinpComments, failedComments int\n+\t\trejectedComments            int // not approved\n+\t}{}\n+\n+\tgo func() {\n+\t\tfor {\n+\t\t\tt, err := decoder.Token()\n+\t\t\tif t == nil || err != nil {\n+\t\t\t\tbreak\n+\t\t\t}\n+\n+\t\t\tswitch el := t.(type) {\n+\t\t\tcase xml.StartElement:\n+\t\t\t\tif el.Name.Local == \"item\" {\n+\t\t\t\t\tstats.inpItems++\n+\t\t\t\t\titem := wpItem{}\n+\t\t\t\t\tif err := decoder.DecodeElement(&item, &el); err != nil {\n+\t\t\t\t\t\tlog.Printf(\"[WARN] Can't decode item, %s\", err)\n+\t\t\t\t\t\tstats.failedItems++\n+\t\t\t\t\t\tcontinue\n+\t\t\t\t\t}\n+\t\t\t\t\tif item.Comments != nil {\n+\t\t\t\t\t\tfor _, comment := range item.Comments {\n+\t\t\t\t\t\t\tif comment.Approved != \"1\" {\n+\t\t\t\t\t\t\t\tstats.rejectedComments++\n+\t\t\t\t\t\t\t\tcontinue\n+\t\t\t\t\t\t\t}\n+\n+\t\t\t\t\t\t\tif comment.PID == \"0\" {\n+\t\t\t\t\t\t\t\tcomment.PID = \"\"\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tc := store.Comment{\n+\t\t\t\t\t\t\t\tID:      comment.ID,\n+\t\t\t\t\t\t\t\tLocator: store.Locator{URL: item.Link, SiteID: siteID},\n+\t\t\t\t\t\t\t\tUser: store.User{\n+\t\t\t\t\t\t\t\t\tID:   \"wordpress_\" + store.EncodeID(comment.Author),\n+\t\t\t\t\t\t\t\t\tName: comment.Author,\n+\t\t\t\t\t\t\t\t\tIP:   comment.AuthorIP,\n+\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\tText:      w.cleanUnescapeText(comment.Content), // sanitize remains on comment create\n+\t\t\t\t\t\t\t\tTimestamp: comment.Date.time,\n+\t\t\t\t\t\t\t\tParentID:  comment.PID,\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tcommentsCh <- c\n+\t\t\t\t\t\t\tstats.inpComments++\n+\t\t\t\t\t\t\tif stats.inpComments%1000 == 0 {\n+\t\t\t\t\t\t\t\tlog.Printf(\"[DEBUG] proccessed %d comments\", stats.inpComments)\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\tclose(commentsCh)\n+\t\tlog.Printf(\"[INFO] converted %d comments, %+v\", stats.inpComments-stats.failedComments, stats)\n+\t}()\n+\treturn commentsCh\n+}\n+\n+func (w *WordPress) cleanUnescapeText(text string) string {\n+\ttext = cleanText(text)\n+\ttext = html.UnescapeString(text)\n+\treturn text\n+}"
    },
    {
      "sha": "c915956a5daec71c630c9d339ba824677507d544",
      "filename": "backend/app/migrator/wordpress_test.go",
      "status": "added",
      "additions": 235,
      "deletions": 0,
      "changes": 235,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/wordpress_test.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/migrator/wordpress_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/migrator/wordpress_test.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -0,0 +1,235 @@\n+package migrator\n+\n+import (\n+\t\"os\"\n+\t\"strings\"\n+\t\"testing\"\n+\t\"time\"\n+\n+\t\"github.com/coreos/bbolt\"\n+\t\"github.com/stretchr/testify/assert\"\n+\n+\t\"github.com/umputun/remark/backend/app/store\"\n+\t\"github.com/umputun/remark/backend/app/store/engine\"\n+\t\"github.com/umputun/remark/backend/app/store/service\"\n+)\n+\n+func TestWordPress_Import(t *testing.T) {\n+\tsiteID := \"testWP\"\n+\tdefer os.Remove(\"/tmp/remark-test.db\")\n+\tb, err := engine.NewBoltDB(bolt.Options{}, engine.BoltSite{FileName: \"/tmp/remark-test.db\", SiteID: siteID})\n+\tassert.Nil(t, err, \"create store\")\n+\n+\tdataStore := service.DataStore{Interface: b}\n+\twp := WordPress{DataStore: &dataStore}\n+\tsize, err := wp.Import(strings.NewReader(xmlTestWP), siteID)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 3, size)\n+\n+\tlast, err := dataStore.Last(siteID, 10)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 3, len(last), \"3 comments imported\")\n+\n+\tc := last[0]\n+\tassert.Equal(t, \"14\", c.ID)\n+\tassert.Equal(t, store.Locator{URL: \"https://realmenweardress.es/2010/07/do-you-rp/\", SiteID: siteID}, c.Locator)\n+\tassert.Equal(t, \"wordpress_75b2b81081f82495d7af26759e67af6554ffda4a\", c.User.ID)\n+\tassert.Equal(t, \"SuperUser3\", c.User.Name)\n+\tassert.Equal(t, \"b646e160768fbc1414d3b2c8f88a767bfbb00871\", c.User.IP)\n+\tts, _ := time.Parse(wpTimeLayout, \"2010-08-18 15:19:14\")\n+\tassert.Equal(t, ts, c.Timestamp)\n+\tassert.Equal(t, c.Text, \"Mekkatorque was over in that tent up to the right\")\n+\n+\tposts, err := dataStore.List(siteID, 0, 0)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 1, len(posts))\n+\n+\tp := posts[0]\n+\tassert.Equal(t, \"https://realmenweardress.es/2010/07/do-you-rp/\", p.URL)\n+\n+\tcount, err := dataStore.Count(store.Locator{URL: \"https://realmenweardress.es/2010/07/do-you-rp/\", SiteID: siteID})\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, 3, count)\n+}\n+\n+func TestWordPress_Convert(t *testing.T) {\n+\twp := WordPress{}\n+\tch := wp.convert(strings.NewReader(xmlTestWP), \"testWP\")\n+\n+\tcomments := []store.Comment{}\n+\tfor c := range ch {\n+\t\tcomments = append(comments, c)\n+\t}\n+\tassert.Equal(t, 3, len(comments), \"3 comments exported, 1 excluded\")\n+\n+\texp1 := store.Comment{\n+\t\tID: \"13\",\n+\t\tLocator: store.Locator{\n+\t\t\tSiteID: \"testWP\",\n+\t\t\tURL:    \"https://realmenweardress.es/2010/07/do-you-rp/\",\n+\t\t},\n+\t\tText: `[...] I know I’m a bit loony with my attachment to my bankers.  I’m glad I’m not the only one. [...]`,\n+\t\tUser: store.User{\n+\t\t\tName: \"Wednesday Reading &laquo; Cynwise&#039;s Battlefield Manual\",\n+\t\t\tID:   \"wordpress_\" + store.EncodeID(\"Wednesday Reading &laquo; Cynwise&#039;s Battlefield Manual\"),\n+\t\t\tIP:   \"74.200.244.101\",\n+\t\t},\n+\t}\n+\texp1.Timestamp, _ = time.Parse(wpTimeLayout, \"2010-07-21 14:02:08\")\n+\tassert.Equal(t, exp1, comments[1])\n+}\n+\n+var xmlTestWP = `\n+<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n+<rss version=\"2.0\"\n+\txmlns:excerpt=\"http://wordpress.org/export/1.2/excerpt/\"\n+\txmlns:content=\"http://purl.org/rss/1.0/modules/content/\"\n+\txmlns:wfw=\"http://wellformedweb.org/CommentAPI/\"\n+\txmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+\txmlns:wp=\"http://wordpress.org/export/1.2/\"\n+>\n+\n+<channel>\n+\t<title>Real Men Wear Dress.es</title>\n+\t<link>https://realmenweardress.es</link>\n+\t<description>SuperAdmin&#039;s gaming and technological musings</description>\n+\t<pubDate>Mon, 23 Jul 2018 10:21:47 +0000</pubDate>\n+\t<language>en-US</language>\n+\t<wp:wxr_version>1.2</wp:wxr_version>\n+\t<wp:base_site_url>https://realmenweardress.es</wp:base_site_url>\n+\t<wp:base_blog_url>https://realmenweardress.es</wp:base_blog_url>\n+\n+\t<wp:author><wp:author_id>2</wp:author_id><wp:author_login><![CDATA[SuperAdmin]]></wp:author_login><wp:author_email><![CDATA[superadmin@super.eu]]></wp:author_email><wp:author_display_name><![CDATA[SuperAdmin]]></wp:author_display_name><wp:author_first_name><![CDATA[SuperAdmin]]></wp:author_first_name><wp:author_last_name><![CDATA[superadmin]]></wp:author_last_name></wp:author>\n+\t<wp:author><wp:author_id>1</wp:author_id><wp:author_login><![CDATA[admin]]></wp:author_login><wp:author_email><![CDATA[superadmin@superadmin.co.uk]]></wp:author_email><wp:author_display_name><![CDATA[admin]]></wp:author_display_name><wp:author_first_name><![CDATA[]]></wp:author_first_name><wp:author_last_name><![CDATA[]]></wp:author_last_name></wp:author>\n+\n+\t<wp:category>\n+\t\t<wp:term_id>25</wp:term_id>\n+\t\t<wp:category_nicename><![CDATA[cataclysm]]></wp:category_nicename>\n+\t\t<wp:category_parent><![CDATA[]]></wp:category_parent>\n+\t\t<wp:cat_name><![CDATA[Cataclysm]]></wp:cat_name>\n+\t</wp:category>\n+\n+\t<wp:tag>\n+\t\t<wp:term_id>39</wp:term_id>\n+\t\t<wp:tag_slug><![CDATA[addons]]></wp:tag_slug>\n+\t\t<wp:tag_name><![CDATA[addons]]></wp:tag_name>\n+\t</wp:tag>\n+\n+\t<generator>https://wordpress.org/?v=4.8.1</generator>\n+\n+\t<item>\n+\t\t<title>Post without comments</title>\n+\t\t<link>https://realmenweardress.es/2010/06/hello-world/screenshot_013110_200413/</link>\n+\t\t<pubDate>Sat, 19 Jun 2010 08:34:13 +0000</pubDate>\n+\t\t<dc:creator><![CDATA[admin]]></dc:creator>\n+\t\t<guid isPermaLink=\"false\">http://realmenweardress.es/wp-content/uploads/2010/06/ScreenShot_013110_200413.jpeg</guid>\n+\t\t<description></description>\n+\t\t<content:encoded><![CDATA[So you can actually fly into the well it appears and if your lucky you stay mounted. I imagine it terrifies the poor rats.]]></content:encoded>\n+\t\t<excerpt:encoded><![CDATA[]]></excerpt:encoded>\n+\t\t<wp:post_id>6</wp:post_id>\n+\t\t<wp:post_date><![CDATA[2010-06-19 08:34:13]]></wp:post_date>\n+\t\t<wp:post_date_gmt><![CDATA[2010-06-19 08:34:13]]></wp:post_date_gmt>\n+\t\t<wp:comment_status><![CDATA[open]]></wp:comment_status>\n+\t\t<wp:ping_status><![CDATA[open]]></wp:ping_status>\n+\t\t<wp:post_name><![CDATA[screenshot_013110_200413]]></wp:post_name>\n+\t\t<wp:status><![CDATA[inherit]]></wp:status>\n+\t\t<wp:post_parent>1</wp:post_parent>\n+\t\t<wp:menu_order>0</wp:menu_order>\n+\t\t<wp:post_type><![CDATA[attachment]]></wp:post_type>\n+\t\t<wp:post_password><![CDATA[]]></wp:post_password>\n+\t\t<wp:is_sticky>0</wp:is_sticky>\n+\t\t<wp:attachment_url><![CDATA[https://realmenweardress.es/wp-content/uploads/2010/06/ScreenShot_013110_200413-e1277214413194.jpeg]]></wp:attachment_url>\n+\t\t<wp:postmeta>\n+\t\t\t<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>\n+\t\t\t<wp:meta_value><![CDATA[2010/06/ScreenShot_013110_200413-e1277214413194.jpeg]]></wp:meta_value>\n+\t\t</wp:postmeta>\n+\t</item>\n+\t<item>\n+\t\t<title>Post with comments. One is not approved</title>\n+\t\t<link>https://realmenweardress.es/2010/07/do-you-rp/</link>\n+\t\t<pubDate>Mon, 19 Jul 2010 14:24:22 +0000</pubDate>\n+\t\t<dc:creator><![CDATA[SuperAdmin]]></dc:creator>\n+\t\t<guid isPermaLink=\"false\">http://realmenweardress.es/?p=100</guid>\n+\t\t<description></description>\n+\t\t<content:encoded><![CDATA[<a href=\"http://realmenweardress.es/wp-content/uploads/2010/07/ScreenShot_071410_230307-e1279546180886.jpeg\"><img class=\"size-thumbnail wp-image-102 alignleft\" title=\"I need to stand on things else I can't reach\" src=\"http://realmenweardress.es/wp-content/uploads/2010/07/ScreenShot_071410_230307-e1279546270587-120x120.jpg\" alt=\"I need to stand on things else I can't reach\" width=\"120\" height=\"120\" /></a>Meet Grokknomel?]]></content:encoded>\n+\t\t<excerpt:encoded><![CDATA[]]></excerpt:encoded>\n+\t\t<wp:post_id>100</wp:post_id>\n+\t\t<wp:post_date><![CDATA[2010-07-19 14:24:22]]></wp:post_date>\n+\t\t<wp:post_date_gmt><![CDATA[2010-07-19 14:24:22]]></wp:post_date_gmt>\n+\t\t<wp:comment_status><![CDATA[open]]></wp:comment_status>\n+\t\t<wp:ping_status><![CDATA[open]]></wp:ping_status>\n+\t\t<wp:post_name><![CDATA[do-you-rp]]></wp:post_name>\n+\t\t<wp:status><![CDATA[publish]]></wp:status>\n+\t\t<wp:post_parent>0</wp:post_parent>\n+\t\t<wp:menu_order>0</wp:menu_order>\n+\t\t<wp:post_type><![CDATA[post]]></wp:post_type>\n+\t\t<wp:post_password><![CDATA[]]></wp:post_password>\n+\t\t<wp:is_sticky>0</wp:is_sticky>\n+\t\t<category domain=\"post_tag\" nicename=\"alts\"><![CDATA[alts]]></category>\n+\t\t<category domain=\"post_tag\" nicename=\"role-playing\"><![CDATA[role playing]]></category>\n+\t\t<category domain=\"category\" nicename=\"stuff\"><![CDATA[Stuff]]></category>\n+\t\t<category domain=\"post_tag\" nicename=\"wierd-in-a-cant-quite-help-myself-way\"><![CDATA[wierd in a can't quite help myself way]]></category>\n+\t\t<wp:postmeta>\n+\t\t\t<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>\n+\t\t\t<wp:meta_value><![CDATA[2]]></wp:meta_value>\n+\t\t</wp:postmeta>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>8</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser1]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[superuser1@aol.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://superuser1.blogspot.com</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[79.141.141.73]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-20 12:08:08]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-20 12:08:08]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[I do catch myself]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>9</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser2]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[superuser2@gmail.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://thewowstorm.wordpress.com</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[97.36.113.1]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-20 13:09:25]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-20 13:09:25]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[I think it us inherent in the game to start seeing your character as a personality]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[0]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>13</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[Wednesday Reading &laquo; Cynwise&#039;s Battlefield Manual]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://cynwise.wordpress.com/2010/07/21/wednesday-reading-8/</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[74.200.244.101]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-21 14:02:08]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-21 14:02:08]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[[...] I know I&#8217;m a bit loony with my attachment to my bankers.  I&#8217;m glad I&#8217;m not the only one. [...]]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[pingback]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>14</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser3]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[blablah@gmail.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://realmenweardress.es</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[128.243.253.117]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-08-18 15:19:14]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-08-18 15:19:14]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[Mekkatorque was over in that tent up to the right]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>13</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>2</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t</item>\n+\t</channel>\n+</rss>\n+`"
    },
    {
      "sha": "bb891bd22b8f61b48ec7491f53f944d83bd0cc0f",
      "filename": "backend/app/rest/api/migrator.go",
      "status": "modified",
      "additions": 17,
      "deletions": 9,
      "changes": 26,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/rest/api/migrator.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/rest/api/migrator.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/rest/api/migrator.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -23,12 +23,13 @@ import (\n \n // Migrator rest runs on unexposed port and available for local requests only\n type Migrator struct {\n-\tVersion        string\n-\tCache          cache.LoadingCache\n-\tNativeImporter migrator.Importer\n-\tDisqusImporter migrator.Importer\n-\tNativeExported migrator.Exporter\n-\tSecretKey      string\n+\tVersion           string\n+\tCache             cache.LoadingCache\n+\tNativeImporter    migrator.Importer\n+\tDisqusImporter    migrator.Importer\n+\tWordPressImporter migrator.Importer\n+\tNativeExported    migrator.Exporter\n+\tSecretKey         string\n \n \thttpServer *http.Server\n \tlock       sync.Mutex\n@@ -76,7 +77,7 @@ func (m *Migrator) routes() chi.Router {\n \treturn router\n }\n \n-// POST /import?secret=key&site=site-id&provider=disqus|remark\n+// POST /import?secret=key&site=site-id&provider=disqus|remark|wordpress\n // imports comments from post body.\n func (m *Migrator) importCtrl(w http.ResponseWriter, r *http.Request) {\n \n@@ -88,10 +89,17 @@ func (m *Migrator) importCtrl(w http.ResponseWriter, r *http.Request) {\n \t}\n \n \tsiteID := r.URL.Query().Get(\"site\")\n-\timporter := m.NativeImporter\n-\tif r.URL.Query().Get(\"provider\") == \"disqus\" {\n+\n+\tvar importer migrator.Importer\n+\tswitch r.URL.Query().Get(\"provider\") {\n+\tcase \"disqus\":\n \t\timporter = m.DisqusImporter\n+\tcase \"wordpress\":\n+\t\timporter = m.WordPressImporter\n+\tdefault:\n+\t\timporter = m.NativeImporter\n \t}\n+\n \tlog.Printf(\"[DEBUG] import request for site=%s\", siteID)\n \tsize, err := importer.Import(r.Body, siteID)\n \tif err != nil {"
    },
    {
      "sha": "43f6c0e49a3b492c53ac88c07cfe0ea9c6977646",
      "filename": "backend/app/rest/api/migrator_test.go",
      "status": "modified",
      "additions": 181,
      "deletions": 5,
      "changes": 186,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/rest/api/migrator_test.go",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/app/rest/api/migrator_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/app/rest/api/migrator_test.go?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -40,6 +40,26 @@ func TestMigrator_Import(t *testing.T) {\n \tassert.Equal(t, `{\"size\":2,\"status\":\"ok\"}`+\"\\n\", string(b))\n }\n \n+func TestMigrator_ImportFromWP(t *testing.T) {\n+\tsrv, ts := prepImportSrv(t)\n+\tassert.NotNil(t, srv)\n+\tdefer cleanupImportSrv(srv, ts)\n+\n+\tr := strings.NewReader(xmlTestWP)\n+\n+\tclient := &http.Client{Timeout: 1 * time.Second}\n+\treq, err := http.NewRequest(\"POST\", ts.URL+\"/api/v1/admin/import?site=radio-t&provider=wordpress&secret=123456\", r)\n+\tassert.Nil(t, err)\n+\treq.Header.Add(\"Content-Type\", \"application/xml; charset=utf-8\")\n+\tresp, err := client.Do(req)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, http.StatusCreated, resp.StatusCode)\n+\n+\tb, err := ioutil.ReadAll(resp.Body)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, `{\"size\":3,\"status\":\"ok\"}`+\"\\n\", string(b))\n+}\n+\n func TestMigrator_ImportRejected(t *testing.T) {\n \tsrv, ts := prepImportSrv(t)\n \tassert.NotNil(t, srv)\n@@ -109,11 +129,12 @@ func prepImportSrv(t *testing.T) (svc *Migrator, ts *httptest.Server) {\n \trequire.Nil(t, err)\n \tdataStore := &service.DataStore{Interface: b}\n \tsvc = &Migrator{\n-\t\tDisqusImporter: &migrator.Disqus{DataStore: dataStore},\n-\t\tNativeImporter: &migrator.Remark{DataStore: dataStore},\n-\t\tNativeExported: &migrator.Remark{DataStore: dataStore},\n-\t\tCache:          &cache.Nop{},\n-\t\tSecretKey:      \"123456\",\n+\t\tDisqusImporter:    &migrator.Disqus{DataStore: dataStore},\n+\t\tWordPressImporter: &migrator.WordPress{DataStore: dataStore},\n+\t\tNativeImporter:    &migrator.Remark{DataStore: dataStore},\n+\t\tNativeExported:    &migrator.Remark{DataStore: dataStore},\n+\t\tCache:             &cache.Nop{},\n+\t\tSecretKey:         \"123456\",\n \t}\n \n \troutes := svc.routes()\n@@ -125,3 +146,158 @@ func cleanupImportSrv(srv *Migrator, ts *httptest.Server) {\n \tts.Close()\n \tos.Remove(testDb)\n }\n+\n+var xmlTestWP = `\n+<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n+<rss version=\"2.0\"\n+\txmlns:excerpt=\"http://wordpress.org/export/1.2/excerpt/\"\n+\txmlns:content=\"http://purl.org/rss/1.0/modules/content/\"\n+\txmlns:wfw=\"http://wellformedweb.org/CommentAPI/\"\n+\txmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+\txmlns:wp=\"http://wordpress.org/export/1.2/\"\n+>\n+\n+<channel>\n+\t<title>Real Men Wear Dress.es</title>\n+\t<link>https://realmenweardress.es</link>\n+\t<description>SuperAdmin&#039;s gaming and technological musings</description>\n+\t<pubDate>Mon, 23 Jul 2018 10:21:47 +0000</pubDate>\n+\t<language>en-US</language>\n+\t<wp:wxr_version>1.2</wp:wxr_version>\n+\t<wp:base_site_url>https://realmenweardress.es</wp:base_site_url>\n+\t<wp:base_blog_url>https://realmenweardress.es</wp:base_blog_url>\n+\n+\t<wp:author><wp:author_id>2</wp:author_id><wp:author_login><![CDATA[SuperAdmin]]></wp:author_login><wp:author_email><![CDATA[superadmin@super.eu]]></wp:author_email><wp:author_display_name><![CDATA[SuperAdmin]]></wp:author_display_name><wp:author_first_name><![CDATA[SuperAdmin]]></wp:author_first_name><wp:author_last_name><![CDATA[superadmin]]></wp:author_last_name></wp:author>\n+\t<wp:author><wp:author_id>1</wp:author_id><wp:author_login><![CDATA[admin]]></wp:author_login><wp:author_email><![CDATA[superadmin@superadmin.co.uk]]></wp:author_email><wp:author_display_name><![CDATA[admin]]></wp:author_display_name><wp:author_first_name><![CDATA[]]></wp:author_first_name><wp:author_last_name><![CDATA[]]></wp:author_last_name></wp:author>\n+\n+\t<wp:category>\n+\t\t<wp:term_id>25</wp:term_id>\n+\t\t<wp:category_nicename><![CDATA[cataclysm]]></wp:category_nicename>\n+\t\t<wp:category_parent><![CDATA[]]></wp:category_parent>\n+\t\t<wp:cat_name><![CDATA[Cataclysm]]></wp:cat_name>\n+\t</wp:category>\n+\n+\t<wp:tag>\n+\t\t<wp:term_id>39</wp:term_id>\n+\t\t<wp:tag_slug><![CDATA[addons]]></wp:tag_slug>\n+\t\t<wp:tag_name><![CDATA[addons]]></wp:tag_name>\n+\t</wp:tag>\n+\n+\t<generator>https://wordpress.org/?v=4.8.1</generator>\n+\n+\t<item>\n+\t\t<title>Post without comments</title>\n+\t\t<link>https://realmenweardress.es/2010/06/hello-world/screenshot_013110_200413/</link>\n+\t\t<pubDate>Sat, 19 Jun 2010 08:34:13 +0000</pubDate>\n+\t\t<dc:creator><![CDATA[admin]]></dc:creator>\n+\t\t<guid isPermaLink=\"false\">http://realmenweardress.es/wp-content/uploads/2010/06/ScreenShot_013110_200413.jpeg</guid>\n+\t\t<description></description>\n+\t\t<content:encoded><![CDATA[So you can actually fly into the well it appears and if your lucky you stay mounted. I imagine it terrifies the poor rats.]]></content:encoded>\n+\t\t<excerpt:encoded><![CDATA[]]></excerpt:encoded>\n+\t\t<wp:post_id>6</wp:post_id>\n+\t\t<wp:post_date><![CDATA[2010-06-19 08:34:13]]></wp:post_date>\n+\t\t<wp:post_date_gmt><![CDATA[2010-06-19 08:34:13]]></wp:post_date_gmt>\n+\t\t<wp:comment_status><![CDATA[open]]></wp:comment_status>\n+\t\t<wp:ping_status><![CDATA[open]]></wp:ping_status>\n+\t\t<wp:post_name><![CDATA[screenshot_013110_200413]]></wp:post_name>\n+\t\t<wp:status><![CDATA[inherit]]></wp:status>\n+\t\t<wp:post_parent>1</wp:post_parent>\n+\t\t<wp:menu_order>0</wp:menu_order>\n+\t\t<wp:post_type><![CDATA[attachment]]></wp:post_type>\n+\t\t<wp:post_password><![CDATA[]]></wp:post_password>\n+\t\t<wp:is_sticky>0</wp:is_sticky>\n+\t\t<wp:attachment_url><![CDATA[https://realmenweardress.es/wp-content/uploads/2010/06/ScreenShot_013110_200413-e1277214413194.jpeg]]></wp:attachment_url>\n+\t\t<wp:postmeta>\n+\t\t\t<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>\n+\t\t\t<wp:meta_value><![CDATA[2010/06/ScreenShot_013110_200413-e1277214413194.jpeg]]></wp:meta_value>\n+\t\t</wp:postmeta>\n+\t</item>\n+\t<item>\n+\t\t<title>Post with comments. One is not approved</title>\n+\t\t<link>https://realmenweardress.es/2010/07/do-you-rp/</link>\n+\t\t<pubDate>Mon, 19 Jul 2010 14:24:22 +0000</pubDate>\n+\t\t<dc:creator><![CDATA[SuperAdmin]]></dc:creator>\n+\t\t<guid isPermaLink=\"false\">http://realmenweardress.es/?p=100</guid>\n+\t\t<description></description>\n+\t\t<content:encoded><![CDATA[<a href=\"http://realmenweardress.es/wp-content/uploads/2010/07/ScreenShot_071410_230307-e1279546180886.jpeg\"><img class=\"size-thumbnail wp-image-102 alignleft\" title=\"I need to stand on things else I can't reach\" src=\"http://realmenweardress.es/wp-content/uploads/2010/07/ScreenShot_071410_230307-e1279546270587-120x120.jpg\" alt=\"I need to stand on things else I can't reach\" width=\"120\" height=\"120\" /></a>Meet Grokknomel?]]></content:encoded>\n+\t\t<excerpt:encoded><![CDATA[]]></excerpt:encoded>\n+\t\t<wp:post_id>100</wp:post_id>\n+\t\t<wp:post_date><![CDATA[2010-07-19 14:24:22]]></wp:post_date>\n+\t\t<wp:post_date_gmt><![CDATA[2010-07-19 14:24:22]]></wp:post_date_gmt>\n+\t\t<wp:comment_status><![CDATA[open]]></wp:comment_status>\n+\t\t<wp:ping_status><![CDATA[open]]></wp:ping_status>\n+\t\t<wp:post_name><![CDATA[do-you-rp]]></wp:post_name>\n+\t\t<wp:status><![CDATA[publish]]></wp:status>\n+\t\t<wp:post_parent>0</wp:post_parent>\n+\t\t<wp:menu_order>0</wp:menu_order>\n+\t\t<wp:post_type><![CDATA[post]]></wp:post_type>\n+\t\t<wp:post_password><![CDATA[]]></wp:post_password>\n+\t\t<wp:is_sticky>0</wp:is_sticky>\n+\t\t<category domain=\"post_tag\" nicename=\"alts\"><![CDATA[alts]]></category>\n+\t\t<category domain=\"post_tag\" nicename=\"role-playing\"><![CDATA[role playing]]></category>\n+\t\t<category domain=\"category\" nicename=\"stuff\"><![CDATA[Stuff]]></category>\n+\t\t<category domain=\"post_tag\" nicename=\"wierd-in-a-cant-quite-help-myself-way\"><![CDATA[wierd in a can't quite help myself way]]></category>\n+\t\t<wp:postmeta>\n+\t\t\t<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>\n+\t\t\t<wp:meta_value><![CDATA[2]]></wp:meta_value>\n+\t\t</wp:postmeta>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>8</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser1]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[superuser1@aol.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://superuser1.blogspot.com</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[79.141.141.73]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-20 12:08:08]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-20 12:08:08]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[I do catch myself]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>9</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser2]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[superuser2@gmail.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://thewowstorm.wordpress.com</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[97.36.113.1]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-20 13:09:25]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-20 13:09:25]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[I think it us inherent in the game to start seeing your character as a personality]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[0]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>13</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[Wednesday Reading &laquo; Cynwise&#039;s Battlefield Manual]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://cynwise.wordpress.com/2010/07/21/wednesday-reading-8/</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[74.200.244.101]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-07-21 14:02:08]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-07-21 14:02:08]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[[...] I know I&#8217;m a bit loony with my attachment to my bankers.  I&#8217;m glad I&#8217;m not the only one. [...]]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[pingback]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>0</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>0</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t\t<wp:comment>\n+\t\t\t<wp:comment_id>14</wp:comment_id>\n+\t\t\t<wp:comment_author><![CDATA[SuperUser3]]></wp:comment_author>\n+\t\t\t<wp:comment_author_email><![CDATA[blablah@gmail.com]]></wp:comment_author_email>\n+\t\t\t<wp:comment_author_url>http://realmenweardress.es</wp:comment_author_url>\n+\t\t\t<wp:comment_author_IP><![CDATA[128.243.253.117]]></wp:comment_author_IP>\n+\t\t\t<wp:comment_date><![CDATA[2010-08-18 15:19:14]]></wp:comment_date>\n+\t\t\t<wp:comment_date_gmt><![CDATA[2010-08-18 15:19:14]]></wp:comment_date_gmt>\n+\t\t\t<wp:comment_content><![CDATA[Mekkatorque was over in that tent up to the right]]></wp:comment_content>\n+\t\t\t<wp:comment_approved><![CDATA[1]]></wp:comment_approved>\n+\t\t\t<wp:comment_type><![CDATA[]]></wp:comment_type>\n+\t\t\t<wp:comment_parent>13</wp:comment_parent>\n+\t\t\t<wp:comment_user_id>2</wp:comment_user_id>\n+\t\t</wp:comment>\n+\t</item>\n+\t</channel>\n+</rss>\n+`"
    },
    {
      "sha": "1c2243797b408bb77b8e4c66a62343834a7aad29",
      "filename": "backend/scripts/import-wordpress.sh",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/umputun/remark/blob/39e426bd4bb27522b13a82270e5d7f499df09912/backend/scripts/import-wordpress.sh",
      "raw_url": "https://github.com/umputun/remark/raw/39e426bd4bb27522b13a82270e5d7f499df09912/backend/scripts/import-wordpress.sh",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/backend/scripts/import-wordpress.sh?ref=39e426bd4bb27522b13a82270e5d7f499df09912",
      "patch": "@@ -0,0 +1,5 @@\n+#!/bin/sh\n+set -e\n+echo \"import wordpress file $1 to site $2\"\n+curl -X POST -H \"Content-Type: application/xml\" -d @/srv/var/$1 \"http://127.0.0.1:8081/api/v1/admin/import?site=${2}&provider=wordpress&secret=${SECRET}\"\n+echo \"import completed\"\n\\ No newline at end of file"
    }
  ]
}
