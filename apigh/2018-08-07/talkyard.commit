{
  "sha": "38cede0b028e92dd2782e43d937841a87ae470e6",
  "node_id": "MDY6Q29tbWl0MTA1NjMzMjI6MzhjZWRlMGIwMjhlOTJkZDI3ODJlNDNkOTM3ODQxYTg3YWU0NzBlNg==",
  "commit": {
    "author": {
      "name": "Kaj Magnus Lindberg",
      "email": "kajmagnus3@gmail.com",
      "date": "2018-08-06T08:27:39Z"
    },
    "committer": {
      "name": "Kaj Magnus Lindberg",
      "email": "kajmagnus3@gmail.com",
      "date": "2018-08-06T09:15:25Z"
    },
    "message": "Fix rare scroll bug and flappy e2e test.",
    "tree": {
      "sha": "95caa71bc5b93da06834ce3768f15cd9b6b8fd65",
      "url": "https://api.github.com/repos/debiki/talkyard/git/trees/95caa71bc5b93da06834ce3768f15cd9b6b8fd65"
    },
    "url": "https://api.github.com/repos/debiki/talkyard/git/commits/38cede0b028e92dd2782e43d937841a87ae470e6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/debiki/talkyard/commits/38cede0b028e92dd2782e43d937841a87ae470e6",
  "html_url": "https://github.com/debiki/talkyard/commit/38cede0b028e92dd2782e43d937841a87ae470e6",
  "comments_url": "https://api.github.com/repos/debiki/talkyard/commits/38cede0b028e92dd2782e43d937841a87ae470e6/comments",
  "author": {
    "login": "kajmagnus",
    "id": 7477359,
    "node_id": "MDQ6VXNlcjc0NzczNTk=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/7477359?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kajmagnus",
    "html_url": "https://github.com/kajmagnus",
    "followers_url": "https://api.github.com/users/kajmagnus/followers",
    "following_url": "https://api.github.com/users/kajmagnus/following{/other_user}",
    "gists_url": "https://api.github.com/users/kajmagnus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kajmagnus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kajmagnus/subscriptions",
    "organizations_url": "https://api.github.com/users/kajmagnus/orgs",
    "repos_url": "https://api.github.com/users/kajmagnus/repos",
    "events_url": "https://api.github.com/users/kajmagnus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kajmagnus/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "kajmagnus",
    "id": 7477359,
    "node_id": "MDQ6VXNlcjc0NzczNTk=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/7477359?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kajmagnus",
    "html_url": "https://github.com/kajmagnus",
    "followers_url": "https://api.github.com/users/kajmagnus/followers",
    "following_url": "https://api.github.com/users/kajmagnus/following{/other_user}",
    "gists_url": "https://api.github.com/users/kajmagnus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kajmagnus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kajmagnus/subscriptions",
    "organizations_url": "https://api.github.com/users/kajmagnus/orgs",
    "repos_url": "https://api.github.com/users/kajmagnus/repos",
    "events_url": "https://api.github.com/users/kajmagnus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kajmagnus/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "86fab2aab943ac9357eef0ede28362aa628ffb4d",
      "url": "https://api.github.com/repos/debiki/talkyard/commits/86fab2aab943ac9357eef0ede28362aa628ffb4d",
      "html_url": "https://github.com/debiki/talkyard/commit/86fab2aab943ac9357eef0ede28362aa628ffb4d"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 31,
    "deletions": 5
  },
  "files": [
    {
      "sha": "b1e38cc714e6fdfe6149d09350f40520eab51aa2",
      "filename": "client/app/forum/forum.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/debiki/talkyard/blob/38cede0b028e92dd2782e43d937841a87ae470e6/client/app/forum/forum.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/38cede0b028e92dd2782e43d937841a87ae470e6/client/app/forum/forum.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/client/app/forum/forum.ts?ref=38cede0b028e92dd2782e43d937841a87ae470e6",
      "patch": "@@ -68,7 +68,10 @@ function scrollToLastPositionSoon() {\n   setTimeout(function() {\n     $byId('esPageColumn').scrollTop = scrollToWhenCommentsLoaded || 0;\n     scrollToWhenCommentsLoaded = 0;\n-  });\n+  },\n+    // If doesn't wait some millis before resetting scroll, then, maybe 1 in 5 times, the browser\n+    // somehow scrolls to scrollTop = 0 = page top (it does even *before* a 0ms timeout). TyT5WG7AB02\n+    50);\n }\n \n "
    },
    {
      "sha": "d2d5dc8e3ebdac437c3f816053e0bf566ed9f455",
      "filename": "tests/e2e/specs/forum-sort-and-scroll.2browsers.test.ts",
      "status": "modified",
      "additions": 27,
      "deletions": 4,
      "changes": 31,
      "blob_url": "https://github.com/debiki/talkyard/blob/38cede0b028e92dd2782e43d937841a87ae470e6/tests/e2e/specs/forum-sort-and-scroll.2browsers.test.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/38cede0b028e92dd2782e43d937841a87ae470e6/tests/e2e/specs/forum-sort-and-scroll.2browsers.test.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/tests/e2e/specs/forum-sort-and-scroll.2browsers.test.ts?ref=38cede0b028e92dd2782e43d937841a87ae470e6",
      "patch": "@@ -144,11 +144,34 @@ describe(\"forum-sort-and-scroll [TyT5ABK2WL4]\", () => {\n     strangersBrowser.topbar.clickHome();\n   });\n \n-  it(\"... the scroll position didn't change, 2  — FLAKY fails 1 in 7? a race in the browser?\", () => {\n+  function wait5SecondsUntilHasResetScroll() {\n+    let scrollPosAfterBack;\n+    for (let i = 0; i < 4800; i += 400) {\n+      scrollPosAfterBack = strangersBrowser.getPageScrollY();\n+      // Accept small differences.\n+      if (Math.abs(scrollPosAfterBack - scrollPosByActivityTopic1015) < 10) {\n+        return;\n+      }\n+      browser.pause(400);\n+    }\n+    // This'll fail.\n+    assert.equal(scrollPosAfterBack, scrollPosByActivityTopic1015);\n+  }\n+\n+  it(\"... the scroll position didn't change, 2\", () => {\n     strangersBrowser.waitForVisible(page1015LinkSelector);\n-    strangersBrowser.pause(500); // wait until has reset scroll pos\n-    const scrollPosAfterBack = strangersBrowser.getPageScrollY();\n-    assert.equal(scrollPosByActivityTopic1015, scrollPosAfterBack);\n+    wait5SecondsUntilHasResetScroll();\n+  });\n+\n+  it(\"Try mess up the scroll pos a few more times — there was a bug before  TyT5WG7AB02\", () => {\n+    for (let i = 0; i < 3; ++i) {\n+      strangersBrowser.scrollIntoViewInPageColumn(page1015LinkSelector);\n+      scrollPosByActivityTopic1015 = strangersBrowser.getPageScrollY();\n+      strangersBrowser.forumTopicList.goToTopic('1015');\n+      strangersBrowser.topbar.clickHome();\n+      strangersBrowser.waitForVisible(page1015LinkSelector);\n+      wait5SecondsUntilHasResetScroll();\n+    }\n   });\n \n   it(\"Hen views the New topics instead of Active\", () => {"
    }
  ]
}
