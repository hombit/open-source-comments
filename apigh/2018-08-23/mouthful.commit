{
  "sha": "81be47ccc546d49139eacf95faaa274949ee86b3",
  "node_id": "MDY6Q29tbWl0MTIwMTkwOTU3OjgxYmU0N2NjYzU0NmQ0OTEzOWVhY2Y5NWZhYWEyNzQ5NDllZTg2YjM=",
  "commit": {
    "author": {
      "name": "Viktoras",
      "email": "vkuznecovas@users.noreply.github.com",
      "date": "2018-08-23T12:01:53Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2018-08-23T12:01:53Z"
    },
    "message": "Caching improvements (#92)\n\n* we now cache json strings instead of objects\r\n\r\n* removed pprof\r\n\r\n* updated lock",
    "tree": {
      "sha": "ff6265c0b9174cc5c364901e9587c1869def1cfd",
      "url": "https://api.github.com/repos/vkuznecovas/mouthful/git/trees/ff6265c0b9174cc5c364901e9587c1869def1cfd"
    },
    "url": "https://api.github.com/repos/vkuznecovas/mouthful/git/commits/81be47ccc546d49139eacf95faaa274949ee86b3",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbfqIxCRBK7hj4Ov3rIwAAdHIIADKETw0I/avf6Ne8cBREBvzD\nxnRKmVj78OvP7A0b8Tp8aQpCZQI3UjdmtWg7kepq9MYmAVTYUGGj+4BJsNO8dUKc\nyUTDe/JF02e2YLJxYiZVae9iTYmQYMW10/rc3KJM1qfe8KnqIOnvegtfBGDHfjuB\n8mhOQJKAViJP5cXGgLzZbDcEJRJ3hOLtfXO1aEZ1Qy6zquuTy+uZcKEwjjPnG0GM\n9DQZMQhH0sE8WkN2ejRrQS0GKIaaGqsYw6GYrghAt1lxhlHjNUUOdMMmA9BPFZ46\nHFWQchVMX4Fz/twp2PwzjfG4tvmQIEpBWnkFLVNh3TKgxVlUi7TyJkZAbALUGaY=\n=C9Sv\n-----END PGP SIGNATURE-----\n",
      "payload": "tree ff6265c0b9174cc5c364901e9587c1869def1cfd\nparent 1bf10242046f2c6fc034c20e024f8e596f11f360\nauthor Viktoras <vkuznecovas@users.noreply.github.com> 1535025713 +0300\ncommitter GitHub <noreply@github.com> 1535025713 +0300\n\nCaching improvements (#92)\n\n* we now cache json strings instead of objects\r\n\r\n* removed pprof\r\n\r\n* updated lock\r\n"
    }
  },
  "url": "https://api.github.com/repos/vkuznecovas/mouthful/commits/81be47ccc546d49139eacf95faaa274949ee86b3",
  "html_url": "https://github.com/vkuznecovas/mouthful/commit/81be47ccc546d49139eacf95faaa274949ee86b3",
  "comments_url": "https://api.github.com/repos/vkuznecovas/mouthful/commits/81be47ccc546d49139eacf95faaa274949ee86b3/comments",
  "author": {
    "login": "vkuznecovas",
    "id": 18392269,
    "node_id": "MDQ6VXNlcjE4MzkyMjY5",
    "avatar_url": "https://avatars2.githubusercontent.com/u/18392269?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vkuznecovas",
    "html_url": "https://github.com/vkuznecovas",
    "followers_url": "https://api.github.com/users/vkuznecovas/followers",
    "following_url": "https://api.github.com/users/vkuznecovas/following{/other_user}",
    "gists_url": "https://api.github.com/users/vkuznecovas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vkuznecovas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vkuznecovas/subscriptions",
    "organizations_url": "https://api.github.com/users/vkuznecovas/orgs",
    "repos_url": "https://api.github.com/users/vkuznecovas/repos",
    "events_url": "https://api.github.com/users/vkuznecovas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vkuznecovas/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1bf10242046f2c6fc034c20e024f8e596f11f360",
      "url": "https://api.github.com/repos/vkuznecovas/mouthful/commits/1bf10242046f2c6fc034c20e024f8e596f11f360",
      "html_url": "https://github.com/vkuznecovas/mouthful/commit/1bf10242046f2c6fc034c20e024f8e596f11f360"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 10,
    "deletions": 6
  },
  "files": [
    {
      "sha": "84d311086528eed57bf2cd62967e18b7a9f7187e",
      "filename": "api/router.go",
      "status": "modified",
      "additions": 10,
      "deletions": 4,
      "changes": 14,
      "blob_url": "https://github.com/vkuznecovas/mouthful/blob/81be47ccc546d49139eacf95faaa274949ee86b3/api/router.go",
      "raw_url": "https://github.com/vkuznecovas/mouthful/raw/81be47ccc546d49139eacf95faaa274949ee86b3/api/router.go",
      "contents_url": "https://api.github.com/repos/vkuznecovas/mouthful/contents/api/router.go?ref=81be47ccc546d49139eacf95faaa274949ee86b3",
      "patch": "@@ -2,6 +2,7 @@\n package api\n \n import (\n+\t\"encoding/json\"\n \t\"log\"\n \t\"net/http\"\n \n@@ -99,9 +100,9 @@ func (r *Router) GetComments(c *gin.Context) {\n \tpath = NormalizePath(path)\n \tif r.cache != nil {\n \t\tif cacheHit, found := r.cache.Get(path); found {\n-\t\t\tcomments := cacheHit.(*[]dbModel.Comment)\n+\t\t\tjsonString := cacheHit.(*[]byte)\n \t\t\tc.Writer.Header().Set(\"X-Cache\", \"HIT\")\n-\t\t\tc.JSON(200, *comments)\n+\t\t\tc.Data(200, \"application/json; charset=utf-8\", *jsonString)\n \t\t\treturn\n \t\t}\n \t}\n@@ -118,12 +119,17 @@ func (r *Router) GetComments(c *gin.Context) {\n \t\treturn\n \t}\n \tif comments != nil {\n+\t\tjs, err := json.Marshal(comments)\n+\t\tif err != nil {\n+\t\t\tc.JSON(500, global.ErrInternalServerError.Error())\n+\t\t\treturn\n+\t\t}\n \t\tif r.cache != nil {\n-\t\t\tr.cache.Set(path, &comments, cache.DefaultExpiration)\n+\t\t\tr.cache.Set(path, &js, cache.DefaultExpiration)\n \t\t\tc.Writer.Header().Set(\"X-Cache\", \"MISS\")\n \t\t}\n \t\tif len(comments) > 0 {\n-\t\t\tc.JSON(200, comments)\n+\t\t\tc.Data(200, \"application/json; charset=utf-8\", js)\n \t\t} else {\n \t\t\tc.JSON(404, global.ErrThreadNotFound.Error())\n \t\t}"
    },
    {
      "sha": "cd1417fd52e0027024ca4221dc9546be2cdba585",
      "filename": "api/server.go",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/vkuznecovas/mouthful/blob/81be47ccc546d49139eacf95faaa274949ee86b3/api/server.go",
      "raw_url": "https://github.com/vkuznecovas/mouthful/raw/81be47ccc546d49139eacf95faaa274949ee86b3/api/server.go",
      "contents_url": "https://api.github.com/repos/vkuznecovas/mouthful/contents/api/server.go?ref=81be47ccc546d49139eacf95faaa274949ee86b3",
      "patch": "@@ -79,9 +79,7 @@ func GetServer(db *abstraction.Database, config *model.Config) (*gin.Engine, err\n \tif config.API.Logging {\n \t\tr.Use(gin.Logger())\n \t}\n-\n \tr.ForwardedByClientIP = true\n-\n \tif config.API.Cors.Enabled {\n \t\tcorsConfig := cors.DefaultConfig()\n \t\tcorsConfig.AllowOrigins = *config.API.Cors.AllowedOrigins"
    }
  ]
}
