{
  "sha": "d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6ZDBlY2EyNmQ1YjY2NjEyNGRiNGIyZjliNDVlNTE3NGE4YmM2MGM3ZA==",
  "commit": {
    "author": {
      "name": "Wyatt Johnson",
      "email": "wyattjoh@gmail.com",
      "date": "2018-10-05T18:03:02Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2018-10-05T18:03:02Z"
    },
    "message": "Body Count (#1969)\n\n* fix: adjusted beheviour of body count\r\n\r\n* fix: updated translation @okbel",
    "tree": {
      "sha": "b0a27cd29b886c026008da390d2afbb7581c98fd",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/b0a27cd29b886c026008da390d2afbb7581c98fd"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbt6dWCRBK7hj4Ov3rIwAAdHIIABmEZsHUYGBdwchjRU5OVVYp\n5noCSph5396d2YcNUoDuPuLx57p4pC/9rz4/+ZvJrNkh2FxWjobM2T0Idn8+4fSU\nDgysQ9nF+hh4VrPINPUZcDsTGWhhgr/AQE3GvlR3xDovgm5htIMd81kk8dudnlt7\n/zRMOrXH7+OPl3iGmS+plc2WhtIluesgrjocOdZfa9Z5PShnOT1vpeZenGrWS/R+\nKDvyJ+GpVNYQcotjHalr/1qOZiZ7gxclEchU1Y6Vi9qvK2gxtGkLi2Ysn9NLbpZx\n92KluOXRpRqvJRbsrsQtjUFdF9KokUEV9KuaBG8v+Pst5AA2W+0jJp0H8kZMaJQ=\n=OEXb\n-----END PGP SIGNATURE-----\n",
      "payload": "tree b0a27cd29b886c026008da390d2afbb7581c98fd\nparent b742923897fa563629e477d81242a60d6b379c04\nauthor Wyatt Johnson <wyattjoh@gmail.com> 1538762582 +0000\ncommitter GitHub <noreply@github.com> 1538762582 +0000\n\nBody Count (#1969)\n\n* fix: adjusted beheviour of body count\r\n\r\n* fix: updated translation @okbel\r\n"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
  "html_url": "https://github.com/coralproject/talk/commit/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/comments",
  "author": {
    "login": "wyattjoh",
    "id": 633002,
    "node_id": "MDQ6VXNlcjYzMzAwMg==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/633002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wyattjoh",
    "html_url": "https://github.com/wyattjoh",
    "followers_url": "https://api.github.com/users/wyattjoh/followers",
    "following_url": "https://api.github.com/users/wyattjoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/wyattjoh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wyattjoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wyattjoh/subscriptions",
    "organizations_url": "https://api.github.com/users/wyattjoh/orgs",
    "repos_url": "https://api.github.com/users/wyattjoh/repos",
    "events_url": "https://api.github.com/users/wyattjoh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wyattjoh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b742923897fa563629e477d81242a60d6b379c04",
      "url": "https://api.github.com/repos/coralproject/talk/commits/b742923897fa563629e477d81242a60d6b379c04",
      "html_url": "https://github.com/coralproject/talk/commit/b742923897fa563629e477d81242a60d6b379c04"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 27,
    "deletions": 25
  },
  "files": [
    {
      "sha": "a08e64a4b6df45426cd90f9b3252d59d018457a0",
      "filename": "errors.js",
      "status": "modified",
      "additions": 17,
      "deletions": 2,
      "changes": 19,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/errors.js",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/errors.js",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/errors.js?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -343,6 +343,20 @@ class ErrCommentTooShort extends TalkError {\n   }\n }\n \n+// ErrCommentTooLong is returned when the comment is too long.\n+class ErrCommentTooLong extends TalkError {\n+  constructor(length, allowed) {\n+    super(\n+      'Comment was too long',\n+      {\n+        translation_key: 'COMMENT_TOO_LONG',\n+        status: 400,\n+      },\n+      { length, allowed }\n+    );\n+  }\n+}\n+\n // ErrAssetURLAlreadyExists is returned when a rename operation is requested\n // but an asset already exists with the new url.\n class ErrAssetURLAlreadyExists extends TalkError {\n@@ -413,13 +427,15 @@ module.exports = {\n   ErrAssetURLAlreadyExists,\n   ErrAuthentication,\n   ErrCannotIgnoreStaff,\n-  ErrCommentTooShort,\n   ErrCommentingDisabled,\n+  ErrCommentTooLong,\n+  ErrCommentTooShort,\n   ErrContainsProfanity,\n   ErrEditWindowHasEnded,\n   ErrEmailAlreadyVerified,\n   ErrEmailTaken,\n   ErrEmailVerificationToken,\n+  ErrHTTPNotFound,\n   ErrInstallLock,\n   ErrInvalidAssetURL,\n   ErrLoginAttemptMaximumExceeded,\n@@ -441,5 +457,4 @@ module.exports = {\n   ErrSpecialChars,\n   ErrUsernameTaken,\n   ExtendableError,\n-  ErrHTTPNotFound,\n };"
    },
    {
      "sha": "40197aaf77b09acc71b13ad000816c7b6c2e24fe",
      "filename": "locales/ar.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/ar.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/ar.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/ar.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -225,6 +225,7 @@ ar:\n     CANNOT_IGNORE_STAFF: 'لا يمكن تجاهل الموظفين.'\n     COMMENT_PARENT_NOT_VISIBLE: 'التعليق الذي ترد عليه تمت إزالته أو غير موجود.'\n     COMMENT_TOO_SHORT: 'يجب أن تكون التعليقات أكثر من حرف واحد، يرجى مراجعة تعليقك وإعادة المحاولة.'\n+    COMMENT_TOO_LONG: 'يتجاوز النص الحد الأقصى للطول المسموح'\n     COMMENTING_CLOSED: 'تم إغلاق فاعلية التعليق'\n     COMMENTING_DISABLED: 'التعليق معطّل حاليًا على هذا الموقع'\n     confirm_password: 'كلمات المرور غير متطابقة. يرجى التحقق مرة أخرى'\n@@ -281,7 +282,6 @@ ar:\n     reasons:\n       comment:\n         banned_word: 'كلمة محظورة'\n-        body_count: 'يتجاوز النص الحد الأقصى للطول المسموح'\n         comment_noagree: أعارض\n         comment_offensive: مسيء\n         comment_other: آخر"
    },
    {
      "sha": "3804fc9396cd0aa88db9a96c0d43c127536e733e",
      "filename": "locales/da.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/da.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/da.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/da.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -197,6 +197,7 @@ da:\n     CANNOT_IGNORE_STAFF: 'Kan ikke ignorere personale.'\n     COMMENT_PARENT_NOT_VISIBLE: 'Den kommentar, du svarer på er blevet fjernet eller eksisterer ikke.'\n     COMMENT_TOO_SHORT: 'Din kommentar skal indeholde noget'\n+    COMMENT_TOO_LONG: 'Body overstiger max længde'\n     COMMENTING_CLOSED: 'Kommentering er allerede lukket'\n     confirm_password: 'Kodeordene matcher ikke. Tjek venligst igen.'\n     EDIT_USERNAME_NOT_AUTHORIZED: 'Du har ikke tilladelse til at opdatere dit brugernavn.'\n@@ -238,7 +239,6 @@ da:\n     reasons:\n       comment:\n         banned_word: 'Forbudt ord'\n-        body_count: 'Body overstiger max længde'\n         comment_noagree: Uenig\n         comment_offensive: Offensiv\n         comment_other: Andre"
    },
    {
      "sha": "89368bddd40d6512a3149f6b4bae26be55ca44d9",
      "filename": "locales/de.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/de.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/de.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/de.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -224,6 +224,7 @@ de:\n     CANNOT_IGNORE_STAFF: 'Mitarbeiter können nicht ignoriert werden.'\n     COMMENT_PARENT_NOT_VISIBLE: 'Der Kommentar, auf den Sie antworten möchten, wurde entfernt oder existiert nicht.'\n     COMMENT_TOO_SHORT: 'Kommentare sollten mehr als ein Zeichen enthalten, bitte überprüfen Sie Ihren Kommentar und probieren Sie es erneut.'\n+    COMMENT_TOO_LONG: 'Text überschreitet Zeichenlimit'\n     COMMENTING_CLOSED: 'Kommentarbereich ist bereits geschlossen'\n     COMMENTING_DISABLED: 'Die Kommentarfunktion ist derzeit abgeschaltet'\n     confirm_password: 'Passwörter nicht identisch. Bitte erneut überprüfen'\n@@ -273,7 +274,6 @@ de:\n     reasons:\n       comment:\n         banned_word: 'Unzulässiges Wort'\n-        body_count: 'Text überschreitet Zeichenlimit'\n         comment_noagree: 'Andere Meinung'\n         comment_offensive: Unangemessen\n         comment_other: Anderes"
    },
    {
      "sha": "ca2fad5dcdc573526e0a4d077388cea2d878f5dc",
      "filename": "locales/en.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/en.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/en.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/en.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -229,6 +229,7 @@ en:\n     CANNOT_IGNORE_STAFF: 'Cannot ignore Staff members.'\n     COMMENT_PARENT_NOT_VISIBLE: 'The comment that you''re replying to has been removed or doesn''t exist.'\n     COMMENT_TOO_SHORT: 'Comments should be more than one character, please revise your comment and try again.'\n+    COMMENT_TOO_LONG: 'Body exceeds max length'\n     COMMENTING_CLOSED: 'Commenting is already closed'\n     COMMENTING_DISABLED: 'Commenting is currently disabled on this site'\n     confirm_password: 'Passwords don''t match. Please check again'\n@@ -286,7 +287,6 @@ en:\n     reasons:\n       comment:\n         banned_word: 'Banned Word'\n-        body_count: 'Body exceeds max length'\n         comment_noagree: Disagree\n         comment_offensive: Offensive\n         comment_other: Other"
    },
    {
      "sha": "6cc5af65b50b66f9c281c4850ca5c5bebe16cda3",
      "filename": "locales/es.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/es.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/es.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/es.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -215,6 +215,7 @@ es:\n     CANNOT_IGNORE_STAFF: 'No puede ignorar a miembros del Staff.'\n     COMMENT_PARENT_NOT_VISIBLE: 'El comentario a la que estás contestando ha sido eliminado o no existe.'\n     COMMENT_TOO_SHORT: 'Tu comentario debe tener algo escrito'\n+    COMMENT_TOO_LONG: 'El texto excede el límite permitido'\n     COMMENTING_CLOSED: 'Los comentarios ya estan cerrados'\n     confirm_password: 'Las contraseñas no coinciden. Inténtelo nuevamente'\n     EDIT_USERNAME_NOT_AUTHORIZED: 'No tiene permiso para editar el nombre de usuario.'\n@@ -260,7 +261,6 @@ es:\n     reasons:\n       comment:\n         banned_word: 'Palabra prohibida'\n-        body_count: 'El texto exede el límite permitido'\n         comment_noagree: 'No está de acuerdo'\n         comment_offensive: 'Es ofensivo'\n         comment_other: 'Otra razón'"
    },
    {
      "sha": "54ff8f011b055debd9ade885ea511b7aa78f65e7",
      "filename": "locales/fi_FI.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/fi_FI.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/fi_FI.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/fi_FI.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -197,6 +197,7 @@ fi_FI:\n     CANNOT_IGNORE_STAFF: 'Työntekijöitä ei voi jättää huomioimatta'\n     COMMENT_PARENT_NOT_VISIBLE: 'Kommenttia, johon yrität vastata, ei enää ole.'\n     COMMENT_TOO_SHORT: 'Kommentin tulee olla vähintään kaksi merkkiä pitkä. Tarkista kirjoittamasi teksti.'\n+    COMMENT_TOO_LONG: Liian pitkä viesti'\n     COMMENTING_CLOSED: 'Kommentointi on suljettu'\n     confirm_password: 'Salasanat eivät täsmää. Tarkista, ole hyvä.'\n     EDIT_USERNAME_NOT_AUTHORIZED: 'Sinulla ei ole oikeutta päivittää tai muokata käyttäjänimeä.'\n@@ -240,7 +241,6 @@ fi_FI:\n     reasons:\n       comment:\n         banned_word: 'Kielletty sana'\n-        body_count: 'Liian pitkä viesti'\n         comment_noagree: 'Olen eri mieltä'\n         comment_offensive: Loukkaava\n         comment_other: Muu"
    },
    {
      "sha": "f490fce64cd0dfaf2d618edd89c622f2b0a13e32",
      "filename": "locales/fr.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/fr.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/fr.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/fr.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -191,6 +191,7 @@ fr:\n     CANNOT_IGNORE_STAFF: 'Ne peut pas ignorer les membres de l''équipe.'\n     COMMENT_PARENT_NOT_VISIBLE: 'Le commentaire auquel vous répondez a été supprimé ou n’existe plus.'\n     COMMENT_TOO_SHORT: 'Votre commentaire doit contenir quelque chose'\n+    COMMENT_TOO_LONG: 'Le texte dépasse la longueur maximale'\n     COMMENTING_CLOSED: 'Les commentaires sont déjà fermés'\n     confirm_password: 'Les mots de passe ne correspondent pas. Vérifiez à nouveau'\n     EDIT_USERNAME_NOT_AUTHORIZED: 'Vous n''avez pas la permission de mettre à jour votre nom d''utilisateur.'\n@@ -235,7 +236,6 @@ fr:\n     reasons:\n       comment:\n         banned_word: 'Mot banni'\n-        body_count: 'Le texte dépasse la longueur maximale'\n         comment_noagree: 'Pas d’accord'\n         comment_offensive: Offensive\n         comment_other: Autre"
    },
    {
      "sha": "be1904b7898f5b736475d17a4e5a338aad819c89",
      "filename": "locales/nl_NL.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/nl_NL.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/locales/nl_NL.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/nl_NL.yml?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -197,6 +197,7 @@ nl_NL:\n     CANNOT_IGNORE_STAFF: 'Kan geen Staff-leden negeren.'\n     COMMENT_PARENT_NOT_VISIBLE: 'De reactie waarop je probeert te reageren bestaat niet of is inmiddels verwijderd.'\n     COMMENT_TOO_SHORT: 'Reacties moeten meer dan één teken hebben. Herzie je reactie en probeer opnieuw.'\n+    COMMENT_TOO_LONG: 'Tekst is te lang'\n     COMMENTING_CLOSED: 'Reageren is al afgesloten.'\n     confirm_password: 'Wachtwoorden komen niet overeen. Controleer opnieuw.'\n     EDIT_USERNAME_NOT_AUTHORIZED: 'Je bent niet gemachtigd om je gebruikersnaam te wijzigen.'\n@@ -239,7 +240,6 @@ nl_NL:\n     reasons:\n       comment:\n         banned_word: 'Geblokeerd woord'\n-        body_count: 'Tekst is te lang'\n         comment_noagree: 'Niet eens'\n         comment_offensive: Aanstootgevend\n         comment_other: Anders"
    },
    {
      "sha": "0ed5f1a679f1736d9495ab865442f597a73c9855",
      "filename": "services/moderation/phases/commentLength.js",
      "status": "modified",
      "additions": 2,
      "deletions": 15,
      "changes": 17,
      "blob_url": "https://github.com/coralproject/talk/blob/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/services/moderation/phases/commentLength.js",
      "raw_url": "https://github.com/coralproject/talk/raw/d0eca26d5b666124db4b2f9b45e5174a8bc60c7d/services/moderation/phases/commentLength.js",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/services/moderation/phases/commentLength.js?ref=d0eca26d5b666124db4b2f9b45e5174a8bc60c7d",
      "patch": "@@ -1,4 +1,4 @@\n-const { ErrCommentTooShort } = require('../../../errors');\n+const { ErrCommentTooShort, ErrCommentTooLong } = require('../../../errors');\n \n // This phase checks to see if the comment is long enough.\n module.exports = (\n@@ -17,19 +17,6 @@ module.exports = (\n \n   // Reject if the comment is too long\n   if (charCountEnable && comment.body.length > charCount) {\n-    // Add the flag related to Trust to the comment.\n-    return {\n-      status: 'REJECTED',\n-      actions: [\n-        {\n-          action_type: 'FLAG',\n-          user_id: null,\n-          group_id: 'BODY_COUNT',\n-          metadata: {\n-            count: comment.body.length,\n-          },\n-        },\n-      ],\n-    };\n+    throw new ErrCommentTooLong(comment.body.length, charCount);\n   }\n };"
    }
  ]
}
