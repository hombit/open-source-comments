{
  "sha": "b3749b93328c7cf2eb29c3c729c61e4542770d5c",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6YjM3NDliOTMzMjhjN2NmMmViMjljM2M3MjljNjFlNDU0Mjc3MGQ1Yw==",
  "commit": {
    "author": {
      "name": "Kim Gardner",
      "email": "kgardnr@gmail.com",
      "date": "2018-10-12T17:48:55Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2018-10-12T17:48:55Z"
    },
    "message": "Merge pull request #1961 from hovoodd/master\n\nAdded filters to Admin > Community > People",
    "tree": {
      "sha": "ab4eada44e385e332d127be8cd6ffc122b41949b",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/ab4eada44e385e332d127be8cd6ffc122b41949b"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/b3749b93328c7cf2eb29c3c729c61e4542770d5c",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbwN6HCRBK7hj4Ov3rIwAAdHIIAI0NjvaLnD6GfQzQ3HeLSJ4C\ngpgop3ASLtv7XPMSpjHRShH8tXZqZb6kstKSqW58djlzuKg2D5YmNoFVApVTMNcW\nlnjmwQGOrbFOlT2FHWms8VbQoVSksYeMOpW//fM+NMtQiRGwZ3g0Z3YVkCw1ka4v\nenNuYFfli7hZLwelM5pf4gSCVG8FvO11GgU8Kr/FsKxGQoaBbOeCGxnd2UuJ4++U\n5YcwY9/SawXSIb9DoVe3ZWLk5s9HkvV8yQgiHWFIZ/XyxcG65S3VvywYjo59MLt0\nXQO8N9hvaGfI0F1QBY0Tmm6IP9eRA/Y/6GICGXeb5kkOzbVokA2EJJzpxgULLWc=\n=AAmY\n-----END PGP SIGNATURE-----\n",
      "payload": "tree ab4eada44e385e332d127be8cd6ffc122b41949b\nparent f93c4adc97f8ba16f09024c5e3785fd725e37549\nparent aecb7de019989ce6d8a488b575832af3c50a6a08\nauthor Kim Gardner <kgardnr@gmail.com> 1539366535 +0100\ncommitter GitHub <noreply@github.com> 1539366535 +0100\n\nMerge pull request #1961 from hovoodd/master\n\nAdded filters to Admin > Community > People"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/b3749b93328c7cf2eb29c3c729c61e4542770d5c",
  "html_url": "https://github.com/coralproject/talk/commit/b3749b93328c7cf2eb29c3c729c61e4542770d5c",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/b3749b93328c7cf2eb29c3c729c61e4542770d5c/comments",
  "author": {
    "login": "kgardnr",
    "id": 1077300,
    "node_id": "MDQ6VXNlcjEwNzczMDA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1077300?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kgardnr",
    "html_url": "https://github.com/kgardnr",
    "followers_url": "https://api.github.com/users/kgardnr/followers",
    "following_url": "https://api.github.com/users/kgardnr/following{/other_user}",
    "gists_url": "https://api.github.com/users/kgardnr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kgardnr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kgardnr/subscriptions",
    "organizations_url": "https://api.github.com/users/kgardnr/orgs",
    "repos_url": "https://api.github.com/users/kgardnr/repos",
    "events_url": "https://api.github.com/users/kgardnr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kgardnr/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f93c4adc97f8ba16f09024c5e3785fd725e37549",
      "url": "https://api.github.com/repos/coralproject/talk/commits/f93c4adc97f8ba16f09024c5e3785fd725e37549",
      "html_url": "https://github.com/coralproject/talk/commit/f93c4adc97f8ba16f09024c5e3785fd725e37549"
    },
    {
      "sha": "aecb7de019989ce6d8a488b575832af3c50a6a08",
      "url": "https://api.github.com/repos/coralproject/talk/commits/aecb7de019989ce6d8a488b575832af3c50a6a08",
      "html_url": "https://github.com/coralproject/talk/commit/aecb7de019989ce6d8a488b575832af3c50a6a08"
    }
  ],
  "stats": {
    "total": 181,
    "additions": 126,
    "deletions": 55
  },
  "files": [
    {
      "sha": "aea321cd7486511f9be36b5d2725724ea4fdb95d",
      "filename": "client/coral-admin/src/routes/Community/components/People.css",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/components/People.css",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/components/People.css",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/client/coral-admin/src/routes/Community/components/People.css?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -34,6 +34,21 @@\n   }\n }\n \n+.filterHeader {\n+  margin-top: 30px;\n+  font-size: 16px;\n+  font-weight: 900;\n+}\n+\n+.filterDetail {\n+  margin-top: 15px;\n+  font-size: 16px;\n+}\n+\n+.radioGroup {\n+  margin: 5px 0;\n+}\n+\n .mainContent {\n   width: calc(100% - 300px);\n   padding: 34px 14px;"
    },
    {
      "sha": "e40b6cca46292e62da0c63a9526b9c3544150e81",
      "filename": "client/coral-admin/src/routes/Community/components/People.js",
      "status": "modified",
      "additions": 39,
      "deletions": 4,
      "changes": 43,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/components/People.js",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/components/People.js",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/client/coral-admin/src/routes/Community/components/People.js?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -9,6 +9,7 @@ import PropTypes from 'prop-types';\n import ActionsMenu from 'coral-admin/src/components/ActionsMenu';\n import ActionsMenuItem from 'coral-admin/src/components/ActionsMenuItem';\n import { isSuspended, isBanned } from 'coral-framework/utils/user';\n+import { RadioGroup, Radio } from 'react-mdl';\n import moment from 'moment';\n import {\n   ADMIN,\n@@ -64,11 +65,12 @@ class People extends React.Component {\n \n   render() {\n     const {\n-      onSearchChange,\n+      onFilterChange,\n       users = [],\n       setUserRole,\n       viewUserDetail,\n       loadMore,\n+      filters,\n     } = this.props;\n \n     const hasResults = !!users.nodes.length;\n@@ -87,11 +89,43 @@ class People extends React.Component {\n               id=\"commenters-search\"\n               type=\"text\"\n               className={styles.searchBoxInput}\n-              defaultValue=\"\"\n-              onChange={onSearchChange}\n+              value={filters.search}\n+              onChange={onFilterChange('search')}\n               placeholder={t('streams.search')}\n             />\n           </div>\n+          <div className={styles.filterHeader}>\n+            {t('community.filter_users')}\n+          </div>\n+          <div className={styles.filterDetail}>{t('community.status')}</div>\n+          <RadioGroup\n+            name=\"statusFilter\"\n+            value={filters.status}\n+            childContainer=\"div\"\n+            onChange={onFilterChange('status')}\n+            className={styles.radioGroup}\n+          >\n+            <Radio value=\"\">{t('community.all')}</Radio>\n+            <Radio value=\"active\">{t('community.active')}</Radio>\n+            <Radio value=\"suspended\">{t('community.suspended')}</Radio>\n+            <Radio value=\"banned\">{t('community.banned')}</Radio>\n+          </RadioGroup>\n+          <div className={styles.filterDetail}>\n+            {t('community.filter_role')}\n+          </div>\n+          <RadioGroup\n+            name=\"roleFilter\"\n+            value={filters.role}\n+            childContainer=\"div\"\n+            onChange={onFilterChange('role')}\n+            className={styles.radioGroup}\n+          >\n+            <Radio value=\"\">{t('community.all')}</Radio>\n+            <Radio value={ADMIN}>{t('community.admin')}</Radio>\n+            <Radio value={STAFF}>{t('community.staff')}</Radio>\n+            <Radio value={MODERATOR}>{t('community.moderator')}</Radio>\n+            <Radio value={COMMENTER}>{t('community.commenter')}</Radio>\n+          </RadioGroup>\n         </div>\n         <div className={styles.mainContent}>\n           {hasResults ? (\n@@ -254,7 +288,8 @@ class People extends React.Component {\n \n People.propTypes = {\n   users: PropTypes.object.isRequired,\n-  onSearchChange: PropTypes.func.isRequired,\n+  filters: PropTypes.object.isRequired,\n+  onFilterChange: PropTypes.func.isRequired,\n   setUserRole: PropTypes.func.isRequired,\n   viewUserDetail: PropTypes.func.isRequired,\n   unbanUser: PropTypes.func.isRequired,"
    },
    {
      "sha": "7f47795b4142786d51c2ec405fc98c419e2fc1be",
      "filename": "client/coral-admin/src/routes/Community/containers/People.js",
      "status": "modified",
      "additions": 58,
      "deletions": 50,
      "changes": 108,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/containers/People.js",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/client/coral-admin/src/routes/Community/containers/People.js",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/client/coral-admin/src/routes/Community/containers/People.js?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -17,71 +17,74 @@ import update from 'immutability-helper';\n import { Spinner } from 'coral-ui';\n import withQuery from 'coral-framework/hocs/withQuery';\n \n-class PeopleContainer extends React.Component {\n+class PeopleContainer extends React.PureComponent {\n   timer = null;\n \n   state = {\n-    searchValue: '',\n+    search: '',\n+    role: '',\n+    status: '',\n   };\n \n-  onSearchChange = e => {\n-    const { value } = e.target;\n-    this.setState({ searchValue: value }, () => {\n+  statusToQuery = {\n+    active: { suspended: false, banned: false },\n+    suspended: { suspended: true },\n+    banned: { banned: true },\n+  };\n+\n+  onFilterChange = filter => e =>\n+    this.setState({ [filter]: e.target.value }, () => {\n       clearTimeout(this.timer);\n-      this.timer = setTimeout(() => {\n-        this.search(value);\n-      }, 350);\n+      this.timer = setTimeout(this.filter, 350);\n     });\n+\n+  getFilterState = () => {\n+    const { role, status } = this.state;\n+\n+    return {\n+      status: this.statusToQuery[status] || null,\n+      role: role || null,\n+    };\n   };\n \n-  search = async value => {\n-    return this.props.data.fetchMore({\n-      query: SEARCH_QUERY,\n+  filter = () =>\n+    this.props.data.fetchMore({\n+      query: FILTER_QUERY,\n       variables: {\n-        value,\n+        state: this.getFilterState(),\n+        value: this.state.search,\n         limit: 10,\n       },\n-      updateQuery: (previous, { fetchMoreResult: { users } }) => {\n-        const updated = update(previous, {\n+      updateQuery: (previous, { fetchMoreResult: { users } }) =>\n+        update(previous, {\n           users: {\n-            nodes: {\n-              $set: users.nodes,\n-            },\n+            nodes: { $set: users.nodes },\n             hasNextPage: { $set: users.hasNextPage },\n             endCursor: { $set: users.endCursor },\n           },\n-        });\n-        return updated;\n-      },\n+        }),\n     });\n-  };\n-\n-  setUserRole = async (id, role) => {\n-    await this.props.setUserRole(id, role);\n-  };\n \n-  loadMore = () => {\n-    return this.props.data.fetchMore({\n+  loadMore = () =>\n+    this.props.data.fetchMore({\n       query: LOAD_MORE_QUERY,\n       variables: {\n-        value: this.state.searchValue,\n-        limit: 5,\n         cursor: this.props.root.users.endCursor,\n+        state: this.getFilterState(),\n+        value: this.state.search,\n+        limit: 5,\n       },\n-      updateQuery: (previous, { fetchMoreResult: { users } }) => {\n-        const updated = update(previous, {\n+      updateQuery: (previous, { fetchMoreResult: { users } }) =>\n+        update(previous, {\n           users: {\n             nodes: {\n               $apply: nodes => appendNewNodes(nodes, users.nodes),\n             },\n             hasNextPage: { $set: users.hasNextPage },\n             endCursor: { $set: users.endCursor },\n           },\n-        });\n-        return updated;\n-      },\n+        }),\n     });\n-  };\n \n   render() {\n     if (this.props.data.error) {\n@@ -98,9 +101,9 @@ class PeopleContainer extends React.Component {\n \n     return (\n       <People\n-        onSearchChange={this.onSearchChange}\n+        onFilterChange={this.onFilterChange}\n         viewUserDetail={this.props.viewUserDetail}\n-        setUserRole={this.setUserRole}\n+        setUserRole={this.props.setUserRole}\n         showSuspendUserDialog={this.props.showSuspendUserDialog}\n         showBanUserDialog={this.props.showBanUserDialog}\n         unbanUser={this.props.unbanUser}\n@@ -109,6 +112,7 @@ class PeopleContainer extends React.Component {\n         root={this.props.root}\n         users={this.props.root.users}\n         loadMore={this.loadMore}\n+        filters={this.state}\n       />\n     );\n   }\n@@ -125,16 +129,6 @@ PeopleContainer.propTypes = {\n   root: PropTypes.object,\n };\n \n-const mapDispatchToProps = dispatch =>\n-  bindActionCreators(\n-    {\n-      viewUserDetail,\n-      showSuspendUserDialog,\n-      showBanUserDialog,\n-    },\n-    dispatch\n-  );\n-\n const LOAD_MORE_QUERY = gql`\n   query TalkAdmin_Community_People_LoadMoreUsers(\n     $limit: Int\n@@ -169,9 +163,13 @@ const LOAD_MORE_QUERY = gql`\n   }\n `;\n \n-const SEARCH_QUERY = gql`\n-  query TalkAdmin_Community_People_SearchUsers($value: String, $limit: Int) {\n-    users(query: { value: $value, limit: $limit }) {\n+const FILTER_QUERY = gql`\n+  query TalkAdmin_Community_People_FilterUsers(\n+    $state: UserStateInput\n+    $value: String\n+    $limit: Int\n+  ) {\n+    users(query: { state: $state, value: $value, limit: $limit }) {\n       hasNextPage\n       endCursor\n       nodes {\n@@ -199,6 +197,16 @@ const SEARCH_QUERY = gql`\n   }\n `;\n \n+const mapDispatchToProps = dispatch =>\n+  bindActionCreators(\n+    {\n+      viewUserDetail,\n+      showSuspendUserDialog,\n+      showBanUserDialog,\n+    },\n+    dispatch\n+  );\n+\n export default compose(\n   connect(\n     null,"
    },
    {
      "sha": "11d35ac952c0025dd5085346685e5a1aedc34a9c",
      "filename": "graph/loaders/users.js",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/graph/loaders/users.js",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/graph/loaders/users.js",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/graph/loaders/users.js?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -4,7 +4,11 @@ const { SEARCH_OTHER_USERS } = require('../../perms/constants');\n const { escapeRegExp } = require('../../services/regex');\n \n const mergeState = (query, state) => {\n-  const { status } = state;\n+  const { role, status } = state;\n+\n+  if (role) {\n+    query.merge({ role });\n+  }\n \n   if (status) {\n     const { username, banned, suspended } = status;"
    },
    {
      "sha": "ebbf8203d3038037b45fb2302d1f39a942c4694f",
      "filename": "graph/typeDefs.graphql",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/graph/typeDefs.graphql",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/graph/typeDefs.graphql",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/graph/typeDefs.graphql?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -189,6 +189,7 @@ type UserStatus {\n }\n \n input UserStateInput {\n+  role: USER_ROLES\n   status: UserStatusInput\n }\n "
    },
    {
      "sha": "2e8d0066aec6bf6874617c1628d2e55bc1dd5d26",
      "filename": "locales/en.yml",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/locales/en.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/locales/en.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/en.yml?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -62,13 +62,16 @@ en:\n     active: Active\n     admin: Administrator\n     ads_marketing: 'This looks like an ad/marketing'\n+    all: 'All'\n     are_you_sure: 'Are you sure you would like to ban {0}?'\n     ban_user: 'Ban User?'\n     banned: Banned\n     banned_user: 'Banned User'\n     cancel: Cancel\n     commenter: Commenter\n     dont_like_username: 'Dislike username'\n+    filter_users: 'Filter users'\n+    filter_role: Role\n     flaggedaccounts: 'Reported Usernames'\n     flags: Flags\n     impersonating: Impersonation\n@@ -85,6 +88,7 @@ en:\n     spam_ads: Spam/Ads\n     staff: Staff\n     status: Status\n+    suspended: Suspended\n     username_and_email: 'Username and Email'\n     yes_ban_user: 'Yes Ban User'\n   configure:"
    },
    {
      "sha": "be01e0fce76a1d4838213578a2639157070743cf",
      "filename": "locales/es.yml",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/coralproject/talk/blob/b3749b93328c7cf2eb29c3c729c61e4542770d5c/locales/es.yml",
      "raw_url": "https://github.com/coralproject/talk/raw/b3749b93328c7cf2eb29c3c729c61e4542770d5c/locales/es.yml",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/locales/es.yml?ref=b3749b93328c7cf2eb29c3c729c61e4542770d5c",
      "patch": "@@ -57,13 +57,16 @@ es:\n     active: Activa\n     admin: Administrator\n     ads_marketing: 'Esto parece ser un ad/marketing'\n+    all: 'Todos'\n     are_you_sure: '¿Estás segura que quieres suspender a {0}?'\n     ban_user: '¿Quieres suspender al Usuario?'\n     banned: Suspendido\n     banned_user: 'Usuario Suspendido'\n     cancel: Cancelar\n     commenter: Comentarista\n     dont_like_username: 'No me gusta este nombre de usuario'\n+    filter_users: 'Filter users'\n+    filter_role: Rol\n     flaggedaccounts: 'Nombres de Usuario Reportados'\n     flags: Reportes\n     impersonating: Impersonando\n@@ -80,6 +83,7 @@ es:\n     spam_ads: Spam/Publicidad\n     staff: Personal\n     status: Estado\n+    suspended: Suspendido\n     username_and_email: 'Usuario y Correo'\n     yes_ban_user: 'Si, Suspendan el usuario'\n   configure:"
    }
  ]
}
