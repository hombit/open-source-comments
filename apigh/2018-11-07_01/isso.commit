{
  "sha": "1d16db53daf323354551b77ee53ad7dd96f82fab",
  "node_id": "MDY6Q29tbWl0NjI2ODQxOToxZDE2ZGI1M2RhZjMyMzM1NDU1MWI3N2VlNTNhZDdkZDk2ZjgyZmFi",
  "commit": {
    "author": {
      "name": "Jelmer Vernooĳ",
      "email": "jelmer@jelmer.uk",
      "date": "2018-11-06T21:00:33Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2018-11-06T21:00:33Z"
    },
    "message": "Merge pull request #495 from flortsch/master\n\nProperly handle to field in mail notifications when using uWSGI spooler.",
    "tree": {
      "sha": "ccc14eec8cf37a1e98c19fe5f74228042213293d",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/ccc14eec8cf37a1e98c19fe5f74228042213293d"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/1d16db53daf323354551b77ee53ad7dd96f82fab",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb4gDyCRBK7hj4Ov3rIwAAdHIIALFGmBaitTXPVNlRe2DkPnI3\nsv6nmpB4j29CUqDJ0Ab3JV3bADopv+stbVyLCJfSw6AFVcg3SbtFcfkiLuqYnu+o\nBB8cp0HMYLEQPBuTKMuH22MhNNhhyHfCu7wf2WuNTlqfUqyYw5MBHPqSFZLaLvlZ\nH+ZVSxiT6fH47GSMB5nqDCnPyx3Ar39fGCOUruDA6XEQ68Vh7f6gJxTCyr8/4l1f\nMlCKjMLoB03liDIwEo56b0obJajWpq6gfN5UiwnpjXJ4KNZ9VRpZDrre6tNduDhH\nyHxJkRj2qPK2XB80GPAgAILIyHQ6/1K3wWnbsrdrZB/+/4dZOAP94i0GT7/0Wlc=\n=up1H\n-----END PGP SIGNATURE-----\n",
      "payload": "tree ccc14eec8cf37a1e98c19fe5f74228042213293d\nparent b88e6e870d8951866be158bfc376613fa4027c9c\nparent c5311e1d7dd253d252ffe634cd98b2fd616bd374\nauthor Jelmer Vernooĳ <jelmer@jelmer.uk> 1541538033 +0000\ncommitter GitHub <noreply@github.com> 1541538033 +0000\n\nMerge pull request #495 from flortsch/master\n\nProperly handle to field in mail notifications when using uWSGI spooler."
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/1d16db53daf323354551b77ee53ad7dd96f82fab",
  "html_url": "https://github.com/posativ/isso/commit/1d16db53daf323354551b77ee53ad7dd96f82fab",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/1d16db53daf323354551b77ee53ad7dd96f82fab/comments",
  "author": {
    "login": "jelmer",
    "id": 49032,
    "node_id": "MDQ6VXNlcjQ5MDMy",
    "avatar_url": "https://avatars3.githubusercontent.com/u/49032?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jelmer",
    "html_url": "https://github.com/jelmer",
    "followers_url": "https://api.github.com/users/jelmer/followers",
    "following_url": "https://api.github.com/users/jelmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/jelmer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jelmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jelmer/subscriptions",
    "organizations_url": "https://api.github.com/users/jelmer/orgs",
    "repos_url": "https://api.github.com/users/jelmer/repos",
    "events_url": "https://api.github.com/users/jelmer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jelmer/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b88e6e870d8951866be158bfc376613fa4027c9c",
      "url": "https://api.github.com/repos/posativ/isso/commits/b88e6e870d8951866be158bfc376613fa4027c9c",
      "html_url": "https://github.com/posativ/isso/commit/b88e6e870d8951866be158bfc376613fa4027c9c"
    },
    {
      "sha": "c5311e1d7dd253d252ffe634cd98b2fd616bd374",
      "url": "https://api.github.com/repos/posativ/isso/commits/c5311e1d7dd253d252ffe634cd98b2fd616bd374",
      "html_url": "https://github.com/posativ/isso/commit/c5311e1d7dd253d252ffe634cd98b2fd616bd374"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 5,
    "deletions": 4
  },
  "files": [
    {
      "sha": "4ff4671ef7ff6d402f4c0dcf834c666e0c0d16da",
      "filename": "isso/ext/notifications.py",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/posativ/isso/blob/1d16db53daf323354551b77ee53ad7dd96f82fab/isso/ext/notifications.py",
      "raw_url": "https://github.com/posativ/isso/raw/1d16db53daf323354551b77ee53ad7dd96f82fab/isso/ext/notifications.py",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/ext/notifications.py?ref=1d16db53daf323354551b77ee53ad7dd96f82fab",
      "patch": "@@ -91,7 +91,8 @@ def __init__(self, isso):\n             def spooler(args):\n                 try:\n                     self._sendmail(args[b\"subject\"].decode(\"utf-8\"),\n-                                   args[\"body\"].decode(\"utf-8\"))\n+                                   args[\"body\"].decode(\"utf-8\"),\n+                                   args[b\"to\"].decode(\"utf-8\"))\n                 except smtplib.SMTPConnectError:\n                     return uwsgi.SPOOL_RETRY\n                 else:\n@@ -173,17 +174,17 @@ def notify_users(self, thread, comment):\n                     notified.append(email)\n \n     def sendmail(self, subject, body, thread, comment, to=None):\n+        to = to or self.conf.get(\"to\")\n         if uwsgi:\n             uwsgi.spool({b\"subject\": subject.encode(\"utf-8\"),\n                          b\"body\": body.encode(\"utf-8\"),\n-                         b\"to\": to})\n+                         b\"to\": to.encode(\"utf-8\")})\n         else:\n             start_new_thread(self._retry, (subject, body, to))\n \n-    def _sendmail(self, subject, body, to=None):\n+    def _sendmail(self, subject, body, to_addr):\n \n         from_addr = self.conf.get(\"from\")\n-        to_addr = to or self.conf.get(\"to\")\n \n         msg = MIMEText(body, 'plain', 'utf-8')\n         msg['From'] = from_addr"
    }
  ]
}
