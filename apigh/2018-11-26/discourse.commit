{
  "sha": "afcf149c341d765260b14dd0ff76c43223181334",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODphZmNmMTQ5YzM0MWQ3NjUyNjBiMTRkZDBmZjc2YzQzMjIzMTgxMzM0",
  "commit": {
    "author": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2018-11-26T15:34:56Z"
    },
    "committer": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2018-11-26T15:34:56Z"
    },
    "message": "FIX: Fix mentions for mixed case group names",
    "tree": {
      "sha": "f289bfb343a9202e77b95833c495ac6dea5c4179",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/f289bfb343a9202e77b95833c495ac6dea5c4179"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/afcf149c341d765260b14dd0ff76c43223181334",
    "comment_count": 1,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/afcf149c341d765260b14dd0ff76c43223181334",
  "html_url": "https://github.com/discourse/discourse/commit/afcf149c341d765260b14dd0ff76c43223181334",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/afcf149c341d765260b14dd0ff76c43223181334/comments",
  "author": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2e4706b7871066df1240b4e36197170a6345b687",
      "url": "https://api.github.com/repos/discourse/discourse/commits/2e4706b7871066df1240b4e36197170a6345b687",
      "html_url": "https://github.com/discourse/discourse/commit/2e4706b7871066df1240b4e36197170a6345b687"
    }
  ],
  "stats": {
    "total": 17,
    "additions": 10,
    "deletions": 7
  },
  "files": [
    {
      "sha": "249196fcd1333feb3e015fd504a0a57f66d5f8e4",
      "filename": "lib/pretty_text.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/afcf149c341d765260b14dd0ff76c43223181334/lib/pretty_text.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/afcf149c341d765260b14dd0ff76c43223181334/lib/pretty_text.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/pretty_text.rb?ref=afcf149c341d765260b14dd0ff76c43223181334",
      "patch": "@@ -464,9 +464,9 @@ def self.lookup_mentions(names, user_id: nil)\n     (\n       SELECT\n         :group_type AS type,\n-        name\n+        lower(name) AS name\n       FROM groups\n-      WHERE name IN (:names) AND (#{Group.mentionable_sql_clause})\n+      WHERE lower(name) IN (:names) AND (#{Group.mentionable_sql_clause})\n     )\n     SQL\n "
    },
    {
      "sha": "32c32206f739106dacfa6337356cbcad8d384b70",
      "filename": "spec/components/pretty_text_spec.rb",
      "status": "modified",
      "additions": 8,
      "deletions": 5,
      "changes": 13,
      "blob_url": "https://github.com/discourse/discourse/blob/afcf149c341d765260b14dd0ff76c43223181334/spec/components/pretty_text_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/afcf149c341d765260b14dd0ff76c43223181334/spec/components/pretty_text_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/pretty_text_spec.rb?ref=afcf149c341d765260b14dd0ff76c43223181334",
      "patch": "@@ -225,18 +225,21 @@ def cook(*args)\n         Fabricate(:user, username: username)\n       end\n \n-      group = Fabricate(:group,\n-        mentionable_level: Group::ALIAS_LEVELS[:everyone]\n-      )\n+      ['Group', 'group2'].each do |name|\n+        Fabricate(:group,\n+          name: name,\n+          mentionable_level: Group::ALIAS_LEVELS[:everyone]\n+        )\n+      end\n \n       [\n         [\n           'hi @uSer! @user2 hi',\n           '<p>hi <a class=\"mention\" href=\"/u/user\">@uSer</a>! <a class=\"mention\" href=\"/u/user2\">@user2</a> hi</p>'\n         ],\n         [\n-          \"hi\\n@user. @#{group.name.capitalize} @somemention\",\n-          %Q|<p>hi<br>\\n<a class=\"mention\" href=\"/u/user\">@user</a>. <a class=\"mention-group\" href=\"/groups/#{group.name}\">@#{group.name.capitalize}</a> <span class=\"mention\">@somemention</span></p>|\n+          \"hi\\n@user. @GROUP @somemention @group2\",\n+          %Q|<p>hi<br>\\n<a class=\"mention\" href=\"/u/user\">@user</a>. <a class=\"mention-group\" href=\"/groups/group\">@GROUP</a> <span class=\"mention\">@somemention</span> <a class=\"mention-group\" href=\"/groups/group2\">@group2</a></p>|\n         ]\n       ].each do |input, expected|\n         expect(PrettyText.cook(input)).to eq(expected)"
    }
  ]
}
