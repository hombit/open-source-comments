{
  "sha": "bd3142313748c4c367d428b28bad56119146347a",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpiZDMxNDIzMTM3NDhjNGMzNjdkNDI4YjI4YmFkNTYxMTkxNDYzNDdh",
  "commit": {
    "author": {
      "name": "Joffrey JAFFEUX",
      "email": "j.jaffeux@gmail.com",
      "date": "2019-01-23T16:40:37Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-01-23T16:40:37Z"
    },
    "message": "DEV: refactoring admin-logs-screened-ip-addresses (#6932)",
    "tree": {
      "sha": "923190326fddb93656d0e4e6caedd4ae814c6c81",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/923190326fddb93656d0e4e6caedd4ae814c6c81"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/bd3142313748c4c367d428b28bad56119146347a",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcSJkFCRBK7hj4Ov3rIwAAdHIIAINx7vXX9IqClgZzkJZG0Ki1\nyaSMTG5Lj+jp22i/r9tRRq0gLHhUd51m9CNtvqS39sQbEfT/wcBaq6wj+uLIrVHx\nGKOGm2KpOecrbOXqTN1VVvE/vtpNXVo0DtiLIvUc0QgCmvcrIYYai9vS9WzCYnO+\nDkjfDcSqqPxYyYXcK/zp8f5ieJCBUxrvcuevst/dETccn5rfblpUtEbfHTe2CBq9\ntDvsRElEfVVUCuwG0Wr21JZE9ziwDB4i2iWLc6QF8r6YXcXB1H8d1O1ZyrSxlu1Z\n0ianFfq2KcFvgsr8FLDqgEmxj35fuyIKukHLVqcUluPDCRDiK7mco0deCxLUhA0=\n=QbSw\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 923190326fddb93656d0e4e6caedd4ae814c6c81\nparent 0aa049791e116f98ef152f91f0e285d136ed4049\nauthor Joffrey JAFFEUX <j.jaffeux@gmail.com> 1548261637 +0100\ncommitter GitHub <noreply@github.com> 1548261637 +0100\n\nDEV: refactoring admin-logs-screened-ip-addresses (#6932)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/bd3142313748c4c367d428b28bad56119146347a",
  "html_url": "https://github.com/discourse/discourse/commit/bd3142313748c4c367d428b28bad56119146347a",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/bd3142313748c4c367d428b28bad56119146347a/comments",
  "author": {
    "login": "jjaffeux",
    "id": 339945,
    "node_id": "MDQ6VXNlcjMzOTk0NQ==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/339945?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjaffeux",
    "html_url": "https://github.com/jjaffeux",
    "followers_url": "https://api.github.com/users/jjaffeux/followers",
    "following_url": "https://api.github.com/users/jjaffeux/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjaffeux/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjaffeux/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjaffeux/subscriptions",
    "organizations_url": "https://api.github.com/users/jjaffeux/orgs",
    "repos_url": "https://api.github.com/users/jjaffeux/repos",
    "events_url": "https://api.github.com/users/jjaffeux/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjaffeux/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0aa049791e116f98ef152f91f0e285d136ed4049",
      "url": "https://api.github.com/repos/discourse/discourse/commits/0aa049791e116f98ef152f91f0e285d136ed4049",
      "html_url": "https://github.com/discourse/discourse/commit/0aa049791e116f98ef152f91f0e285d136ed4049"
    }
  ],
  "stats": {
    "total": 119,
    "additions": 79,
    "deletions": 40
  },
  "files": [
    {
      "sha": "595a628572032cdae95498bd85dc49a869f1aafa",
      "filename": "app/assets/javascripts/admin/controllers/admin-logs-screened-ip-addresses.js.es6",
      "status": "modified",
      "additions": 11,
      "deletions": 14,
      "changes": 25,
      "blob_url": "https://github.com/discourse/discourse/blob/bd3142313748c4c367d428b28bad56119146347a/app/assets/javascripts/admin/controllers/admin-logs-screened-ip-addresses.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/bd3142313748c4c367d428b28bad56119146347a/app/assets/javascripts/admin/controllers/admin-logs-screened-ip-addresses.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/admin/controllers/admin-logs-screened-ip-addresses.js.es6?ref=bd3142313748c4c367d428b28bad56119146347a",
      "patch": "@@ -11,8 +11,7 @@ export default Ember.Controller.extend({\n   show: debounce(function() {\n     this.set(\"loading\", true);\n     ScreenedIpAddress.findAll(this.get(\"filter\")).then(result => {\n-      this.set(\"model\", result);\n-      this.set(\"loading\", false);\n+      this.setProperties({ model: result, loading: false });\n     });\n   }, 250).observes(\"filter\"),\n \n@@ -35,8 +34,9 @@ export default Ember.Controller.extend({\n     },\n \n     cancel(record) {\n-      if (this.get(\"savedIpAddress\") && record.get(\"editing\")) {\n-        record.set(\"ip_address\", this.get(\"savedIpAddress\"));\n+      const savedIpAddress = this.get(\"savedIpAddress\");\n+      if (savedIpAddress && record.get(\"editing\")) {\n+        record.set(\"ip_address\", savedIpAddress);\n       }\n       record.set(\"editing\", false);\n     },\n@@ -46,9 +46,7 @@ export default Ember.Controller.extend({\n       record.set(\"editing\", false);\n       record\n         .save()\n-        .then(() => {\n-          this.set(\"savedIpAddress\", null);\n-        })\n+        .then(() => this.set(\"savedIpAddress\", null))\n         .catch(e => {\n           if (e.jqXHR.responseJSON && e.jqXHR.responseJSON.errors) {\n             bootbox.alert(\n@@ -84,7 +82,7 @@ export default Ember.Controller.extend({\n               .catch(e => {\n                 bootbox.alert(\n                   I18n.t(\"generic_error_with_reason\", {\n-                    error: \"http: \" + e.status + \" - \" + e.body\n+                    error: `http: ${e.status} - ${e.body}`\n                   })\n                 );\n               });\n@@ -98,25 +96,24 @@ export default Ember.Controller.extend({\n     },\n \n     rollUp() {\n-      const self = this;\n       return bootbox.confirm(\n         I18n.t(\"admin.logs.screened_ips.roll_up_confirm\"),\n         I18n.t(\"no_value\"),\n         I18n.t(\"yes_value\"),\n-        function(confirmed) {\n+        confirmed => {\n           if (confirmed) {\n-            self.set(\"loading\", true);\n-            return ScreenedIpAddress.rollUp().then(function(results) {\n+            this.set(\"loading\", true);\n+            return ScreenedIpAddress.rollUp().then(results => {\n               if (results && results.subnets) {\n                 if (results.subnets.length > 0) {\n-                  self.send(\"show\");\n+                  this.send(\"show\");\n                   bootbox.alert(\n                     I18n.t(\"admin.logs.screened_ips.rolled_up_some_subnets\", {\n                       subnets: results.subnets.join(\", \")\n                     })\n                   );\n                 } else {\n-                  self.set(\"loading\", false);\n+                  this.set(\"loading\", false);\n                   bootbox.alert(\n                     I18n.t(\"admin.logs.screened_ips.rolled_up_no_subnet\")\n                   );"
    },
    {
      "sha": "c5819da79120c15f4607522dcc5a900be5e3fd5c",
      "filename": "app/assets/javascripts/admin/templates/logs/screened-ip-addresses.hbs",
      "status": "modified",
      "additions": 68,
      "deletions": 26,
      "changes": 94,
      "blob_url": "https://github.com/discourse/discourse/blob/bd3142313748c4c367d428b28bad56119146347a/app/assets/javascripts/admin/templates/logs/screened-ip-addresses.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/bd3142313748c4c367d428b28bad56119146347a/app/assets/javascripts/admin/templates/logs/screened-ip-addresses.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/admin/templates/logs/screened-ip-addresses.hbs?ref=bd3142313748c4c367d428b28bad56119146347a",
      "patch": "@@ -1,26 +1,38 @@\n-<p>{{i18n 'admin.logs.screened_ips.description'}}</p>\n+<p>{{i18n \"admin.logs.screened_ips.description\"}}</p>\n \n <div class=\"screened-ip-controls\">\n   <div class=\"filter-screened-ip-address\">\n-    {{text-field value=filter class=\"ip-address-input\" placeholderKey=\"admin.logs.screened_ips.form.filter\" autocorrect=\"off\" autocapitalize=\"off\"}}\n-    {{d-button class=\"btn-default\" action=(action \"rollUp\") title=\"admin.logs.screened_ips.roll_up.title\" label=\"admin.logs.screened_ips.roll_up.text\"}}\n-    {{d-button class=\"btn-default\" action=(action \"exportScreenedIpList\") icon=\"download\" title=\"admin.export_csv.button_title.screened_ip\" label=\"admin.export_csv.button_text\"}}\n+    {{text-field\n+      value=filter\n+      class=\"ip-address-input\"\n+      placeholderKey=\"admin.logs.screened_ips.form.filter\"\n+      autocorrect=\"off\"\n+      autocapitalize=\"off\"}}\n+    {{d-button\n+      class=\"btn-default\"\n+      action=(action \"rollUp\")\n+      title=\"admin.logs.screened_ips.roll_up.title\"\n+      label=\"admin.logs.screened_ips.roll_up.text\"}}\n+    {{d-button\n+      class=\"btn-default\"\n+      action=(action \"exportScreenedIpList\")\n+      icon=\"download\"\n+      title=\"admin.export_csv.button_title.screened_ip\"\n+      label=\"admin.export_csv.button_text\"}}\n   </div>\n-    {{screened-ip-address-form action=(action \"recordAdded\")}}\n-</div>\n-\n \n+  {{screened-ip-address-form action=(action \"recordAdded\")}}\n+</div>\n \n {{#conditional-loading-spinner condition=loading}}\n   {{#if model.length}}\n-\n-    <table class='admin-logs-table screened-ip-addresses grid'>\n+    <table class=\"admin-logs-table screened-ip-addresses grid\">\n       <thead class=\"heading-container\">\n-        <th class=\"col heading first ip_address\">{{i18n 'admin.logs.ip_address'}}</th>\n-        <th class=\"col heading action\">{{i18n 'admin.logs.action'}}</th>\n-        <th class=\"col heading match_count\">{{i18n 'admin.logs.match_count'}}</th>\n-        <th class=\"col heading created_at\">{{i18n 'admin.logs.created_at'}}</th>\n-        <th class=\"col heading last_match_at\">{{i18n 'admin.logs.last_match_at'}}</th>\n+        <th class=\"col heading first ip_address\">{{i18n \"admin.logs.ip_address\"}}</th>\n+        <th class=\"col heading action\">{{i18n \"admin.logs.action\"}}</th>\n+        <th class=\"col heading match_count\">{{i18n \"admin.logs.match_count\"}}</th>\n+        <th class=\"col heading created_at\">{{i18n \"admin.logs.created_at\"}}</th>\n+        <th class=\"col heading last_match_at\">{{i18n \"admin.logs.last_match_at\"}}</th>\n         <th class=\"col heading actions\"></th>\n       </thead>\n       <tbody>\n@@ -47,34 +59,64 @@\n             {{/if}}\n             {{item.actionName}}\n           </td>\n-          <td class=\"col match_count\"><div class=\"label\">{{i18n 'admin.logs.match_count'}}</div> {{item.match_count}}</td>\n-          <td class=\"col created_at\"><div class=\"label\">{{i18n 'admin.logs.created_at'}}</div> {{age-with-tooltip item.created_at}}</td>\n-\n+          <td class=\"col match_count\">\n+            <div class=\"label\">{{i18n \"admin.logs.match_count\"}}</div>\n+            {{item.match_count}}\n+          </td>\n+          <td class=\"col created_at\">\n+            <div class=\"label\">{{i18n \"admin.logs.created_at\"}}</div>\n+            {{age-with-tooltip item.created_at}}\n+          </td>\n           <td class=\"col last_match_at\">\n             {{#if item.last_match_at}}\n-               <div class=\"label\">{{i18n 'admin.logs.last_match_at'}} {{age-with-tooltip item.last_match_at}}</div>\n+              <div class=\"label\">\n+                {{i18n \"admin.logs.last_match_at\"}}\n+                {{age-with-tooltip item.last_match_at}}\n+              </div>\n             {{/if}}\n           </td>\n           <td class=\"col actions\">\n             {{#unless item.editing}}\n-              {{d-button class=\"btn-default\" action=(action \"destroy\") actionParam=item icon=\"far-trash-alt\" class=\"btn-danger\"}}\n-              {{d-button class=\"btn-default\"action=(action \"edit\") actionParam=item icon=\"pencil-alt\"}}\n+              {{d-button\n+                class=\"btn-default\"\n+                action=(action \"destroy\")\n+                actionParam=item\n+                icon=\"far-trash-alt\"\n+                class=\"btn-danger\"}}\n+              {{d-button\n+                class=\"btn-default\"\n+                action=(action \"edit\")\n+                actionParam=item\n+                icon=\"pencil-alt\"}}\n               {{#if item.isBlocked}}\n-                {{d-button class=\"btn-default\" action=(action \"allow\") actionParam=item icon=\"check\" label=\"admin.logs.screened_ips.actions.do_nothing\"}}\n+                {{d-button\n+                  class=\"btn-default\"\n+                  action=(action \"allow\")\n+                  actionParam=item\n+                  icon=\"check\"\n+                  label=\"admin.logs.screened_ips.actions.do_nothing\"}}\n               {{else}}\n-                {{d-button class=\"btn-default\" action=(action \"block\") actionParam=item icon=\"ban\" label=\"admin.logs.screened_ips.actions.block\"}}\n+                {{d-button\n+                  class=\"btn-default\"\n+                  action=(action \"block\")\n+                  actionParam=item\n+                  icon=\"ban\"\n+                  label=\"admin.logs.screened_ips.actions.block\"}}\n               {{/if}}\n             {{else}}\n-              {{d-button class=\"btn-default\" action=(action \"save\") actionParam=item label=\"admin.logs.save\"}}\n-              <a {{action \"cancel\" item}}>{{i18n 'cancel'}}</a>\n+              {{d-button\n+                class=\"btn-default\"\n+                action=(action \"save\")\n+                actionParam=item\n+                label=\"admin.logs.save\"}}\n+              <a {{action \"cancel\" item}}>{{i18n \"cancel\"}}</a>\n             {{/unless}}\n           </td>\n         </tr>\n       {{/each}}\n       </tbody>\n     </table>\n-\n   {{else}}\n-    {{i18n 'search.no_results'}}\n+    {{i18n \"search.no_results\"}}\n   {{/if}}\n {{/conditional-loading-spinner}}"
    }
  ]
}
