{
  "sha": "2e48c43546cc5b988770170927dfebe07ce5b320",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODoyZTQ4YzQzNTQ2Y2M1Yjk4ODc3MDE3MDkyN2RmZWJlMDdjZTViMzIw",
  "commit": {
    "author": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2019-01-25T17:00:19Z"
    },
    "committer": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2019-01-25T17:00:30Z"
    },
    "message": "FIX: Fix safe mode regression\n\nFollow up from a48731e",
    "tree": {
      "sha": "23597651d52c7f9e709136a09a1c3b1588e06835",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/23597651d52c7f9e709136a09a1c3b1588e06835"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/2e48c43546cc5b988770170927dfebe07ce5b320",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/2e48c43546cc5b988770170927dfebe07ce5b320",
  "html_url": "https://github.com/discourse/discourse/commit/2e48c43546cc5b988770170927dfebe07ce5b320",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/2e48c43546cc5b988770170927dfebe07ce5b320/comments",
  "author": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "78ddc82952d8766f516100abd09580f79a5b9c59",
      "url": "https://api.github.com/repos/discourse/discourse/commits/78ddc82952d8766f516100abd09580f79a5b9c59",
      "html_url": "https://github.com/discourse/discourse/commit/78ddc82952d8766f516100abd09580f79a5b9c59"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 13,
    "deletions": 3
  },
  "files": [
    {
      "sha": "39c2b9a44fc32fb27115472d327a6e7e149fa9b5",
      "filename": "app/models/theme.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/2e48c43546cc5b988770170927dfebe07ce5b320/app/models/theme.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/2e48c43546cc5b988770170927dfebe07ce5b320/app/models/theme.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/theme.rb?ref=2e48c43546cc5b988770170927dfebe07ce5b320",
      "patch": "@@ -134,10 +134,10 @@ def self.transform_ids(ids, extend: true)\n \n       all_ids = [parent, *components]\n \n-      enabled_ids = Theme.where(id: all_ids).includes(:remote_theme)\n-        .select(&:enabled?).pluck(:id)\n+      disabled_ids = Theme.where(id: all_ids).includes(:remote_theme)\n+        .reject(&:enabled?).pluck(:id)\n \n-      all_ids & enabled_ids # Maintain ordering using intersection\n+      all_ids - disabled_ids\n     end\n   end\n "
    },
    {
      "sha": "00df90f8695adaa54caf7547654dc42b8aedfb8c",
      "filename": "spec/components/stylesheet/manager_spec.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/2e48c43546cc5b988770170927dfebe07ce5b320/spec/components/stylesheet/manager_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/2e48c43546cc5b988770170927dfebe07ce5b320/spec/components/stylesheet/manager_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/stylesheet/manager_spec.rb?ref=2e48c43546cc5b988770170927dfebe07ce5b320",
      "patch": "@@ -15,6 +15,11 @@\n     expect(link).not_to eq(\"\")\n   end\n \n+  it \"still returns something for no themes\" do\n+    link = Stylesheet::Manager.stylesheet_link_tag(:desktop, 'all', [])\n+    expect(link).not_to eq(\"\")\n+  end\n+\n   it 'can correctly compile theme css' do\n     theme = Fabricate(:theme)\n "
    },
    {
      "sha": "17ba4f91271eda975b73f2f28432bd7e7400431c",
      "filename": "spec/models/theme_spec.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/2e48c43546cc5b988770170927dfebe07ce5b320/spec/models/theme_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/2e48c43546cc5b988770170927dfebe07ce5b320/spec/models/theme_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/models/theme_spec.rb?ref=2e48c43546cc5b988770170927dfebe07ce5b320",
      "patch": "@@ -65,6 +65,11 @@\n     expect(Theme.transform_ids([theme.id])).to be_empty\n   end\n \n+  it \"#transform_ids works with nil values\" do\n+    # Used in safe mode\n+    expect(Theme.transform_ids([nil])).to eq([nil])\n+  end\n+\n   it \"doesn't allow multi-level theme components\" do\n     grandchild = Fabricate(:theme, user: user)\n     grandparent = Fabricate(:theme, user: user)"
    }
  ]
}
