{
  "sha": "fb0d8167eb6d50534b10b10c117067c94e867bee",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOmZiMGQ4MTY3ZWI2ZDUwNTM0YjEwYjEwYzExNzA2N2M5NGU4NjdiZWU=",
  "commit": {
    "author": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2019-02-06T21:02:11Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-02-06T21:02:11Z"
    },
    "message": "Merge pull request #272 from AnyRoad/issue_148_strange_block_user_select_behavior\n\nFix block users select behavior",
    "tree": {
      "sha": "19ef6949f1b93ff7684ba65c768ce943d26eba6a",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/19ef6949f1b93ff7684ba65c768ce943d26eba6a"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/fb0d8167eb6d50534b10b10c117067c94e867bee",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcW0tTCRBK7hj4Ov3rIwAAdHIIAEppRfBioDMKyP6oLJVj5oqG\njek1a3Tf6Q+S0s8yAUpG/fS6M28AAITtGD3HlNj7p8/kjjLnX7SV7srw764vjBS5\nmr0k1FLhJSnjWu0FvbPUyFF7Tg9q8TaSCRUWSVnTTxlAu5VIVCQcuJEzVd4ouJ3y\nEb/rUGpA0JlvgtlBx9FDgKnjugfNJh4hqMD4oOQbeigxQxwfdsh7sz4S467OZb9a\ncGH0O7jmPzBUGfwvpCp9sJZKgxk4x766kycKMmA/6iZxGEnJpAXC5Itgzf0XmufJ\nl/eD6s5DcxCAKJBCcZJfORsbhAdwkVWWTz8QFpgLEtC4PnsgELIaO9IJmaQG8LE=\n=35Jy\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 19ef6949f1b93ff7684ba65c768ce943d26eba6a\nparent 4917ba01ec7c84c6fa84143d47e98b0b0a579cea\nparent 3e72ec379abbebca1b76772fe740dbd34cb76c23\nauthor Umputun <umputun@gmail.com> 1549486931 -0600\ncommitter GitHub <noreply@github.com> 1549486931 -0600\n\nMerge pull request #272 from AnyRoad/issue_148_strange_block_user_select_behavior\n\nFix block users select behavior"
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/fb0d8167eb6d50534b10b10c117067c94e867bee",
  "html_url": "https://github.com/umputun/remark/commit/fb0d8167eb6d50534b10b10c117067c94e867bee",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/fb0d8167eb6d50534b10b10c117067c94e867bee/comments",
  "author": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4917ba01ec7c84c6fa84143d47e98b0b0a579cea",
      "url": "https://api.github.com/repos/umputun/remark/commits/4917ba01ec7c84c6fa84143d47e98b0b0a579cea",
      "html_url": "https://github.com/umputun/remark/commit/4917ba01ec7c84c6fa84143d47e98b0b0a579cea"
    },
    {
      "sha": "3e72ec379abbebca1b76772fe740dbd34cb76c23",
      "url": "https://api.github.com/repos/umputun/remark/commits/3e72ec379abbebca1b76772fe740dbd34cb76c23",
      "html_url": "https://github.com/umputun/remark/commit/3e72ec379abbebca1b76772fe740dbd34cb76c23"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 30,
    "deletions": 6
  },
  "files": [
    {
      "sha": "5d30816aa95a90788b192dea87365b60568b289b",
      "filename": "web/app/components/comment/comment.jsx",
      "status": "modified",
      "additions": 22,
      "deletions": 6,
      "changes": 28,
      "blob_url": "https://github.com/umputun/remark/blob/fb0d8167eb6d50534b10b10c117067c94e867bee/web/app/components/comment/comment.jsx",
      "raw_url": "https://github.com/umputun/remark/raw/fb0d8167eb6d50534b10b10c117067c94e867bee/web/app/components/comment/comment.jsx",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/components/comment/comment.jsx?ref=fb0d8167eb6d50534b10b10c117067c94e867bee",
      "patch": "@@ -7,6 +7,7 @@ import { API_BASE, BASE_URL, COMMENT_NODE_CLASSNAME_PREFIX, BLOCKING_DURATIONS }\n import { url } from 'common/settings';\n import store from 'common/store';\n import copy from 'common/copy';\n+import debounce from 'utils/debounce';\n \n import Input from 'components/input';\n \n@@ -41,6 +42,7 @@ export default class Comment extends Component {\n     this.onDeleteClick = this.onDeleteClick.bind(this);\n     this.onOwnCommentDeleteClick = this.onOwnCommentDeleteClick.bind(this);\n     this.onBlockUserClick = this.onBlockUserClick.bind(this);\n+    this.blockUser = debounce(this.blockUser, 100).bind(this);\n     this.onUnblockUserClick = this.onUnblockUserClick.bind(this);\n     this.isAdmin = this.isAdmin.bind(this);\n     this.isCurrentUser = this.isCurrentUser.bind(this);\n@@ -180,17 +182,28 @@ export default class Comment extends Component {\n   }\n \n   onBlockUserClick(e) {\n+    // blur event will be triggered by the confirm pop-up which will start\n+    // infinite loop of blur -> confirm -> blur -> ...\n+    // so we trigger the blur event manually and have debounce mechanism to prevent it\n+    if (e.type === 'change') {\n+      e.target.blur();\n+    }\n+    // we have to debounce the blockUser function calls otherwise it will be\n+    // called 2 times (by change event and by blur event)\n+    this.blockUser(e.target.value);\n+  }\n+\n+  blockUser(ttl) {\n     const {\n       id,\n-      user: { id: userId },\n+      user: { id: userId, name: userName },\n     } = this.props.data;\n \n-    const ttl = e.target.value;\n     const duration = BLOCKING_DURATIONS.find(el => el.value === ttl).label;\n     const promptMessage =\n       ttl === 'permanently'\n-        ? 'Do you want to permanently block this user?'\n-        : `Do you want to block this user (${duration.toLowerCase()})?`;\n+        ? `Do you want to permanently block user \"${userName}\"?`\n+        : `Do you want to block user \"${userName}\" (${duration.toLowerCase()})?`;\n     if (confirm(promptMessage)) {\n       this.setState({ userBlocked: true });\n \n@@ -663,8 +676,11 @@ export default class Comment extends Component {\n                   {!userBlocked && (\n                     <span className=\"comment__control comment__control_select-label\">\n                       Block\n-                      {/* eslint-disable jsx-a11y/no-onchange */}\n-                      <select className=\"comment__control_select\" onChange={this.onBlockUserClick}>\n+                      <select\n+                        className=\"comment__control_select\"\n+                        onBlur={this.onBlockUserClick}\n+                        onChange={this.onBlockUserClick}\n+                      >\n                         <option disabled selected value>\n                           {' '}\n                           Blocking period{' '}"
    },
    {
      "sha": "06f5b9f01f4f26585be8a02ad251a36eb8f6575e",
      "filename": "web/app/utils/debounce.js",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/umputun/remark/blob/fb0d8167eb6d50534b10b10c117067c94e867bee/web/app/utils/debounce.js",
      "raw_url": "https://github.com/umputun/remark/raw/fb0d8167eb6d50534b10b10c117067c94e867bee/web/app/utils/debounce.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/web/app/utils/debounce.js?ref=fb0d8167eb6d50534b10b10c117067c94e867bee",
      "patch": "@@ -0,0 +1,8 @@\n+export default function debounce(func, wait) {\n+  let timeout;\n+  return function() {\n+    const laterCall = () => func.apply(this, arguments);\n+    clearTimeout(timeout);\n+    timeout = setTimeout(laterCall, wait);\n+  };\n+}"
    }
  ]
}
