{
  "sha": "76bdf6085e88ad94691df60a38787abe8f4f3e1b",
  "node_id": "MDY6Q29tbWl0MTA1NjMzMjI6NzZiZGY2MDg1ZTg4YWQ5NDY5MWRmNjBhMzg3ODdhYmU4ZjRmM2UxYg==",
  "commit": {
    "author": {
      "name": "Kaj Magnus Lindberg",
      "email": "kajmagnus3@gmail.com",
      "date": "2019-03-01T12:18:54Z"
    },
    "committer": {
      "name": "Kaj Magnus Lindberg",
      "email": "kajmagnus3@gmail.com",
      "date": "2019-03-01T12:18:54Z"
    },
    "message": "Fix e2e tests and Nginx location bugs. Specify Chromedriver version.",
    "tree": {
      "sha": "29a792d837d24293202986a0c869876d42c136e8",
      "url": "https://api.github.com/repos/debiki/talkyard/git/trees/29a792d837d24293202986a0c869876d42c136e8"
    },
    "url": "https://api.github.com/repos/debiki/talkyard/git/commits/76bdf6085e88ad94691df60a38787abe8f4f3e1b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/debiki/talkyard/commits/76bdf6085e88ad94691df60a38787abe8f4f3e1b",
  "html_url": "https://github.com/debiki/talkyard/commit/76bdf6085e88ad94691df60a38787abe8f4f3e1b",
  "comments_url": "https://api.github.com/repos/debiki/talkyard/commits/76bdf6085e88ad94691df60a38787abe8f4f3e1b/comments",
  "author": {
    "login": "kajmagnus",
    "id": 7477359,
    "node_id": "MDQ6VXNlcjc0NzczNTk=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/7477359?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kajmagnus",
    "html_url": "https://github.com/kajmagnus",
    "followers_url": "https://api.github.com/users/kajmagnus/followers",
    "following_url": "https://api.github.com/users/kajmagnus/following{/other_user}",
    "gists_url": "https://api.github.com/users/kajmagnus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kajmagnus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kajmagnus/subscriptions",
    "organizations_url": "https://api.github.com/users/kajmagnus/orgs",
    "repos_url": "https://api.github.com/users/kajmagnus/repos",
    "events_url": "https://api.github.com/users/kajmagnus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kajmagnus/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "kajmagnus",
    "id": 7477359,
    "node_id": "MDQ6VXNlcjc0NzczNTk=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/7477359?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kajmagnus",
    "html_url": "https://github.com/kajmagnus",
    "followers_url": "https://api.github.com/users/kajmagnus/followers",
    "following_url": "https://api.github.com/users/kajmagnus/following{/other_user}",
    "gists_url": "https://api.github.com/users/kajmagnus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kajmagnus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kajmagnus/subscriptions",
    "organizations_url": "https://api.github.com/users/kajmagnus/orgs",
    "repos_url": "https://api.github.com/users/kajmagnus/repos",
    "events_url": "https://api.github.com/users/kajmagnus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kajmagnus/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3e22b0b9080971309fbde6f7c0d79c3e0ed80f60",
      "url": "https://api.github.com/repos/debiki/talkyard/commits/3e22b0b9080971309fbde6f7c0d79c3e0ed80f60",
      "html_url": "https://github.com/debiki/talkyard/commit/3e22b0b9080971309fbde6f7c0d79c3e0ed80f60"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 35,
    "deletions": 17
  },
  "files": [
    {
      "sha": "cbf36e3333123c0c4911159716bfb609064ee583",
      "filename": "app/debiki/dao/ForumDao.scala",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/app/debiki/dao/ForumDao.scala",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/app/debiki/dao/ForumDao.scala",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/app/debiki/dao/ForumDao.scala?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -571,7 +571,7 @@ object ForumDao {\n       the <span class=\"icon-ok-circled-empty\"></span> icon).\"\"\"\n     val para2 = o\"\"\"In the topic list: To see all unanswered questions, click \"All topic\"\n       and then choose \"Only waiting\", look:\"\"\"\n-    // (You'll find /-/media/ in the Nginx config [NGXMEDIA].)\n+    // (You'll find /-/media/ in the Nginx config [NGXMEDIA] and submodule ty-media.)\n     val para3 = \"\"\"<img class=\"no-lightbox\" src=\"/-/media/tips/how-click-show-waiting-680px.jpg\">\"\"\"\n     CommonMarkSourceAndHtml(\n       source = i\"\"\""
    },
    {
      "sha": "df3564566494c53d8e38a5da5d16b3e60db0bc4a",
      "filename": "docs/e2e-tests-readme.md",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/docs/e2e-tests-readme.md",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/docs/e2e-tests-readme.md",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/docs/e2e-tests-readme.md?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -6,8 +6,8 @@ We use Webdriver.io and write the tests in Typescript. API for v4 (haven't upgra\n To run the e2e tests, you currently need Java 8 and Node.js, not just Docker-Compose:\n \n     java -version  # the Java version should be >= 1.8, I have never tested Java 1.9\n-    node -v   # v4.2.6 works for me, and more recent versions too I would think\n-    npm -v    #  3.5.2 works for me, and more recent versions too I would think\n+    node -v   # v8.15.0 works for me, and more recent versions too I would think\n+    npm -v    #  6.4.1 works for me, and more recent versions too I would think\n \n And you need Yarn: https://yarnpkg.com/en/docs/install\n And a compiler so you can build Fibers:\n@@ -18,11 +18,12 @@ Run tests like so:\n \n 1. In one shell, start the server and database and everything:\n \n-        docker-compose start\n+        make up\n \n 1. In another shell, build a certain Fibers Node.js module, and start Selenium: (on the host,\n    not in any Docker container)\n    \n+   [Old problems, gone now?]\n    Problems! Whenver Yarn gets the chance, it deletes all Selenium binaries, and\n    any Fibers module you've compiled. So whenever you've done any Yarn stuff, like\n    adding a new lib, you need to build Fibers again. But Yarn will try to build the"
    },
    {
      "sha": "8d875afcc94215278a599be783cd7b3ff2f75cb9",
      "filename": "images/web/server-locations.conf",
      "status": "modified",
      "additions": 8,
      "deletions": 3,
      "changes": 11,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/images/web/server-locations.conf",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/images/web/server-locations.conf",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/images/web/server-locations.conf?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -89,7 +89,7 @@ location /-/assets/ {\n # the comments â€” one spends maybe a minute reading the embedding article anyway.\n # Use a descriptive name that includes \"Talkyard\", because people see the name when\n # they copy-paste embedded comments html tags. 'ed-comments(.v0)?' = old names. [2EBG05]\n-location ~ ^/-/(talkyard-comments|ed-comments(.v0)?).(?<suffix>min.js|.js)$ {\n+location ~ ^/-/(talkyard-comments|ed-comments(.v0)?).(?<suffix>min.js|js)$ {\n   alias /opt/talkyard/assets/talkyard-comments.$suffix;\n   add_header Cache-Control \"${TY_MAX_AGE_DAY}\";  # because no assets versioning, test: [2WBKP46]\n   gzip_static on;\n@@ -105,11 +105,16 @@ location ~ ^/talkyard-service-worker.(js|min.js)$ {\n   gzip_static on;\n }\n \n-# Here's static images and videos and Talkyard's favicon. [NGXMEDIA]\n+# Here're static images and videos and Talkyard's favicon. [NGXMEDIA]\n location /-/media/ {\n   alias /opt/talkyard/ty-media/;\n   add_header Cache-Control \"${TY_MAX_AGE_MONTH}\";\n-  gzip_static on;\n+}\n+\n+# This also needed, in case somehow the wrong favicon path is used.\n+location = /favicon.ico {\n+  root /opt/talkyard/ty-media/favicon/;\n+  add_header Cache-Control \"${TY_MAX_AGE_WEEK}\"; # cannot do assets versioning\n }\n \n location = /robots.txt {"
    },
    {
      "sha": "31b114d6227fcd939ff3710e60d200c9a5580458",
      "filename": "s/impl/build-prod-images.sh",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/impl/build-prod-images.sh",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/impl/build-prod-images.sh",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/s/impl/build-prod-images.sh?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -70,7 +70,8 @@ fi\n # Build minified script bundles; will be included in the web and app images.\n s/d-gulp release\n \n-# Build images, except for the app server prod image.\n+# Build images (except for the app server prod image). This will Dockerfile COPY\n+# js and css generated by 'gulp release' above.\n s/d build\n \n # Build the app server prod image."
    },
    {
      "sha": "a5cca6e0b659fd248936e9e6077501db0d171359",
      "filename": "s/selenium-config.js",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-config.js",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-config.js",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/s/selenium-config.js?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -0,0 +1,8 @@\n+module.exports = {\n+  drivers: {\n+    chrome: {\n+      // Should match the Chrome version you use.\n+      version: '72.0.3626.69',\n+    },\n+  },\n+}"
    },
    {
      "sha": "a853e4fa50bef03cd305a018802eb3aca043dd53",
      "filename": "s/selenium-install",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-install",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-install",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/s/selenium-install?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -3,5 +3,5 @@\n # To download a specific Chromedriver version: (e.g. v 2.38)\n #   s/selenium-install --drivers.chrome.version=2.38\n \n-node_modules/selenium-standalone/bin/selenium-standalone install $@\n+node_modules/selenium-standalone/bin/selenium-standalone install --config=s/selenium-config.js $@\n "
    },
    {
      "sha": "bdd9f1d137b6d1d9ca0aa83cdfac85232fb02194",
      "filename": "s/selenium-start",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-start",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-start",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/s/selenium-start?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -9,5 +9,5 @@\n # for example:\n #   s/wdio target/e2e/wdio.conf.js --only some-test --logLevel=verbose\n \n-node_modules/selenium-standalone/bin/selenium-standalone start $@\n+node_modules/selenium-standalone/bin/selenium-standalone start --config=s/selenium-config.js $@\n "
    },
    {
      "sha": "08c35561eebfa8410faef32cfd8f90a6fe919949",
      "filename": "s/selenium-start-invisible",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-start-invisible",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/s/selenium-start-invisible",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/s/selenium-start-invisible?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -3,5 +3,5 @@\n # Prefix the selenium-standalone command with: DEBUG=selenium-standalone:*\n # to tell Selenium to debug log more.\n \n-xvfb-run -s '-screen 0 1280x1024x8' node_modules/selenium-standalone/bin/selenium-standalone start $@\n+xvfb-run -s '-screen 0 1280x1024x8' node_modules/selenium-standalone/bin/selenium-standalone start --config=s/selenium-config.js $@\n "
    },
    {
      "sha": "0b3552e48b491ebc47db32e3f411b13892c272e2",
      "filename": "tests/e2e/specs/navigation-as-impl.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/specs/navigation-as-impl.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/specs/navigation-as-impl.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/tests/e2e/specs/navigation-as-impl.ts?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -121,7 +121,7 @@ function makeWholeSpec(initFn) {\n           usersBrowser.adminArea.goToLoginSettings();\n           usersBrowser.adminArea.waitAssertVisible();\n           usersBrowser.watchbar.openIfNeeded();\n-          usersBrowser.watchbar.goToTopic(forumTitle);\n+          usersBrowser.watchbar.goToTopic(forumTitle, { isHome: true });\n         });\n         addForumTests(\"5: \");\n       }"
    },
    {
      "sha": "4e1d4d799906798f0605b66c993ab2633627bb5f",
      "filename": "tests/e2e/specs/private-chat.3browsers.test.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/specs/private-chat.3browsers.test.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/specs/private-chat.3browsers.test.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/tests/e2e/specs/private-chat.3browsers.test.ts?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -8,6 +8,7 @@ import pagesFor = require('../utils/pages-for');\n import settings = require('../utils/settings');\n import make = require('../utils/make');\n import logAndDie = require('../utils/log-and-die');\n+import c = require('../test-constants');\n \n declare var browser: any;\n declare var browserA: any;\n@@ -142,7 +143,7 @@ describe(\"private chat  TyT2ABKR045\", function() {\n     maria.go(idAddress.origin);\n     maria.forumTopicList.waitUntilKnowsIsEmpty();\n     maria.watchbar.assertTopicAbsent(chatNameEdited);\n-    maria.watchbar.assertTopicVisible(forumTitle);\n+    maria.watchbar.assertTopicVisible(c.WatchbarHomeLinkTitle);\n     maria.watchbar.asserExactlyNumTopics(1); // the forum\n   });\n \n@@ -182,7 +183,7 @@ describe(\"private chat  TyT2ABKR045\", function() {\n \n   it(\"... and doesn't see it in the watchbar\", function() {\n     michael.watchbar.assertTopicAbsent(chatNameEdited);\n-    michael.watchbar.assertTopicVisible(forumTitle);\n+    michael.watchbar.assertTopicVisible(c.WatchbarHomeLinkTitle);\n     michael.watchbar.asserExactlyNumTopics(1); // the forum\n   });\n \n@@ -204,7 +205,7 @@ describe(\"private chat  TyT2ABKR045\", function() {\n \n   it(\"... and it won't appear in the watchbar\", function() {\n     guest.watchbar.assertTopicAbsent(chatNameEdited);\n-    guest.watchbar.assertTopicVisible(forumTitle);\n+    guest.watchbar.assertTopicVisible(c.WatchbarHomeLinkTitle);\n     guest.watchbar.asserExactlyNumTopics(1); // the forum\n   });\n "
    },
    {
      "sha": "9b1fc65fe5ffcbeeb214752e7bb9961424c0023b",
      "filename": "tests/e2e/test-constants.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/test-constants.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/test-constants.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/tests/e2e/test-constants.ts?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -98,6 +98,7 @@ export = {\n   JanitorThreadIntervalMs: 100,  // [2YPBJ6L]\n   MagicTimeoutPollMs: 500,  // [4GKB93RA]\n   SsoTestPath: '/-/sso-test',\n+  WatchbarHomeLinkTitle: 'Home',\n \n };\n "
    },
    {
      "sha": "0231ddb16fe81111caf81c2a9db50ce2a62c68c7",
      "filename": "tests/e2e/utils/pages-for.ts",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/debiki/talkyard/blob/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/utils/pages-for.ts",
      "raw_url": "https://github.com/debiki/talkyard/raw/76bdf6085e88ad94691df60a38787abe8f4f3e1b/tests/e2e/utils/pages-for.ts",
      "contents_url": "https://api.github.com/repos/debiki/talkyard/contents/tests/e2e/utils/pages-for.ts?ref=76bdf6085e88ad94691df60a38787abe8f4f3e1b",
      "patch": "@@ -1538,9 +1538,10 @@ function pagesFor(browser) {\n         api.assertExactly(num, api.watchbar.titleSelector);\n       },\n \n-      goToTopic: function(title: string) {\n+      goToTopic: function(title: string, opts: { isHome?: true } = {}) {\n         api.rememberCurrentUrl();\n-        api.waitForThenClickText(api.watchbar.titleSelector, title);\n+        api.waitForThenClickText(\n+            api.watchbar.titleSelector, opts.isHome ? c.WatchbarHomeLinkTitle : title);\n         api.waitForNewUrl();\n         api.assertPageTitleMatches(title);\n       },"
    }
  ]
}
