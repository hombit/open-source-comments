{
  "sha": "12c37ada2e37bc51b5f503479d7da5377d5319ab",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODoxMmMzN2FkYTJlMzdiYzUxYjVmNTAzNDc5ZDdkYTUzNzdkNTMxOWFi",
  "commit": {
    "author": {
      "name": "Maja Komel",
      "email": "maja.komel@gmail.com",
      "date": "2019-03-13T16:48:40Z"
    },
    "committer": {
      "name": "RÃ©gis Hanol",
      "email": "regis@hanol.fr",
      "date": "2019-03-13T16:48:40Z"
    },
    "message": "UX: focus on search box when emoji picker is opened (#7098)",
    "tree": {
      "sha": "7d6e66f04dbfded7d71fcff236cd368b80cd85c2",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/7d6e66f04dbfded7d71fcff236cd368b80cd85c2"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/12c37ada2e37bc51b5f503479d7da5377d5319ab",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/12c37ada2e37bc51b5f503479d7da5377d5319ab",
  "html_url": "https://github.com/discourse/discourse/commit/12c37ada2e37bc51b5f503479d7da5377d5319ab",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/12c37ada2e37bc51b5f503479d7da5377d5319ab/comments",
  "author": {
    "login": "majakomel",
    "id": 3431279,
    "node_id": "MDQ6VXNlcjM0MzEyNzk=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/3431279?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/majakomel",
    "html_url": "https://github.com/majakomel",
    "followers_url": "https://api.github.com/users/majakomel/followers",
    "following_url": "https://api.github.com/users/majakomel/following{/other_user}",
    "gists_url": "https://api.github.com/users/majakomel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/majakomel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/majakomel/subscriptions",
    "organizations_url": "https://api.github.com/users/majakomel/orgs",
    "repos_url": "https://api.github.com/users/majakomel/repos",
    "events_url": "https://api.github.com/users/majakomel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/majakomel/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ZogStriP",
    "id": 362783,
    "node_id": "MDQ6VXNlcjM2Mjc4Mw==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/362783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZogStriP",
    "html_url": "https://github.com/ZogStriP",
    "followers_url": "https://api.github.com/users/ZogStriP/followers",
    "following_url": "https://api.github.com/users/ZogStriP/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZogStriP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZogStriP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZogStriP/subscriptions",
    "organizations_url": "https://api.github.com/users/ZogStriP/orgs",
    "repos_url": "https://api.github.com/users/ZogStriP/repos",
    "events_url": "https://api.github.com/users/ZogStriP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZogStriP/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "420c6f81028302b0a538f234988c8a630e7cdc82",
      "url": "https://api.github.com/repos/discourse/discourse/commits/420c6f81028302b0a538f234988c8a630e7cdc82",
      "html_url": "https://github.com/discourse/discourse/commit/420c6f81028302b0a538f234988c8a630e7cdc82"
    }
  ],
  "stats": {
    "total": 43,
    "additions": 25,
    "deletions": 18
  },
  "files": [
    {
      "sha": "2b82d2ea17efb0a8da2240ae33acfb36699bd419",
      "filename": "app/assets/javascripts/discourse/components/d-editor.js.es6",
      "status": "modified",
      "additions": 17,
      "deletions": 17,
      "changes": 34,
      "blob_url": "https://github.com/discourse/discourse/blob/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/components/d-editor.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/components/d-editor.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/components/d-editor.js.es6?ref=12c37ada2e37bc51b5f503479d7da5377d5319ab",
      "patch": "@@ -378,24 +378,21 @@ export default Ember.Component.extend({\n \n   _applyCategoryHashtagAutocomplete() {\n     const siteSettings = this.siteSettings;\n-    const self = this;\n \n     this.$(\".d-editor-input\").autocomplete({\n       template: findRawTemplate(\"category-tag-autocomplete\"),\n       key: \"#\",\n-      afterComplete() {\n-        self._focusTextArea();\n-      },\n-      transformComplete(obj) {\n+      afterComplete: () => this._focusTextArea(),\n+      transformComplete: obj => {\n         return obj.text;\n       },\n-      dataSource(term) {\n+      dataSource: term => {\n         if (term.match(/\\s/)) {\n           return null;\n         }\n         return searchCategoryTag(term, siteSettings);\n       },\n-      triggerRule(textarea, opts) {\n+      triggerRule: (textarea, opts) => {\n         return categoryHashtagTriggerRule(textarea, opts);\n       }\n     });\n@@ -406,17 +403,15 @@ export default Ember.Component.extend({\n       return;\n     }\n \n-    const self = this;\n-\n     $editorInput.autocomplete({\n       template: findRawTemplate(\"emoji-selector-autocomplete\"),\n       key: \":\",\n-      afterComplete(text) {\n-        self.set(\"value\", text);\n-        self._focusTextArea();\n+      afterComplete: text => {\n+        this.set(\"value\", text);\n+        this._focusTextArea();\n       },\n \n-      onKeyUp(text, cp) {\n+      onKeyUp: (text, cp) => {\n         const matches = /(?:^|[^a-z])(:(?!:).?[\\w-]*:?(?!:)(?:t\\d?)?:?) ?$/gi.exec(\n           text.substring(0, cp)\n         );\n@@ -426,22 +421,26 @@ export default Ember.Component.extend({\n         }\n       },\n \n-      transformComplete(v) {\n+      transformComplete: v => {\n         if (v.code) {\n           return `${v.code}:`;\n         } else {\n           $editorInput.autocomplete({ cancel: true });\n-          self.set(\"emojiPickerIsActive\", true);\n+          this.set(\n+            \"isEditorFocused\",\n+            $(\"textarea.d-editor-input\").is(\":focus\")\n+          );\n+          this.set(\"emojiPickerIsActive\", true);\n           return \"\";\n         }\n       },\n \n-      dataSource(term) {\n+      dataSource: term => {\n         return new Ember.RSVP.Promise(resolve => {\n           const full = `:${term}`;\n           term = term.toLowerCase();\n \n-          if (term.length < self.siteSettings.emoji_autocomplete_min_chars) {\n+          if (term.length < this.siteSettings.emoji_autocomplete_min_chars) {\n             return resolve([]);\n           }\n \n@@ -858,6 +857,7 @@ export default Ember.Component.extend({\n         return;\n       }\n \n+      this.set(\"isEditorFocused\", $(\"textarea.d-editor-input\").is(\":focus\"));\n       this.set(\"emojiPickerIsActive\", !this.get(\"emojiPickerIsActive\"));\n     },\n "
    },
    {
      "sha": "e8bdc4fb433d5c0caa7182ec7c1c8ee34afa19c8",
      "filename": "app/assets/javascripts/discourse/components/emoji-picker.js.es6",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/components/emoji-picker.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/components/emoji-picker.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/components/emoji-picker.js.es6?ref=12c37ada2e37bc51b5f503479d7da5377d5319ab",
      "patch": "@@ -7,6 +7,7 @@ import {\n   isSkinTonableEmoji,\n   emojiSearch\n } from \"pretty-text/emoji\";\n+import { safariHacksDisabled } from \"discourse/lib/utilities\";\n const { run } = Ember;\n \n const keyValueStore = new KeyValueStore(\"discourse_emojis_\");\n@@ -58,6 +59,12 @@ export default Ember.Component.extend({\n       this._scrollTo();\n       this._updateSelectedDiversity();\n       this._checkVisibleSection(true);\n+\n+      if (\n+        (!this.site.isMobileDevice || this.get(\"isEditorFocused\")) &&\n+        !safariHacksDisabled()\n+      )\n+        this.$filter.find(\"input[name='filter']\").focus();\n     });\n   },\n "
    },
    {
      "sha": "11b783648ad2b74736ef332ff634a4a40948b87e",
      "filename": "app/assets/javascripts/discourse/templates/components/d-editor.hbs",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/templates/components/d-editor.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/12c37ada2e37bc51b5f503479d7da5377d5319ab/app/assets/javascripts/discourse/templates/components/d-editor.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/templates/components/d-editor.hbs?ref=12c37ada2e37bc51b5f503479d7da5377d5319ab",
      "patch": "@@ -50,4 +50,4 @@\n   </div>\n </div>\n \n-{{emoji-picker active=emojiPickerIsActive emojiSelected=(action 'emojiSelected')}}\n+{{emoji-picker active=emojiPickerIsActive isEditorFocused=isEditorFocused emojiSelected=(action 'emojiSelected')}}"
    }
  ]
}
