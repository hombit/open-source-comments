{
  "sha": "5114ef958a68b529d3eaa7fe5dc5d4b209034517",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo1MTE0ZWY5NThhNjhiNTI5ZDNlYWE3ZmU1ZGM1ZDRiMjA5MDM0NTE3",
  "commit": {
    "author": {
      "name": "Bianca Nenciu",
      "email": "nbianca@users.noreply.github.com",
      "date": "2019-03-15T16:58:43Z"
    },
    "committer": {
      "name": "RÃ©gis Hanol",
      "email": "regis@hanol.fr",
      "date": "2019-03-15T16:58:43Z"
    },
    "message": "FIX: Do not trigger post alerts for empty posts. (#7138)",
    "tree": {
      "sha": "8acea9d15f99fb0f5633b31cff51feec36c1dd32",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/8acea9d15f99fb0f5633b31cff51feec36c1dd32"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/5114ef958a68b529d3eaa7fe5dc5d4b209034517",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/5114ef958a68b529d3eaa7fe5dc5d4b209034517",
  "html_url": "https://github.com/discourse/discourse/commit/5114ef958a68b529d3eaa7fe5dc5d4b209034517",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/5114ef958a68b529d3eaa7fe5dc5d4b209034517/comments",
  "author": {
    "login": "nbianca",
    "id": 23153890,
    "node_id": "MDQ6VXNlcjIzMTUzODkw",
    "avatar_url": "https://avatars3.githubusercontent.com/u/23153890?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbianca",
    "html_url": "https://github.com/nbianca",
    "followers_url": "https://api.github.com/users/nbianca/followers",
    "following_url": "https://api.github.com/users/nbianca/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbianca/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbianca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbianca/subscriptions",
    "organizations_url": "https://api.github.com/users/nbianca/orgs",
    "repos_url": "https://api.github.com/users/nbianca/repos",
    "events_url": "https://api.github.com/users/nbianca/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbianca/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ZogStriP",
    "id": 362783,
    "node_id": "MDQ6VXNlcjM2Mjc4Mw==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/362783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZogStriP",
    "html_url": "https://github.com/ZogStriP",
    "followers_url": "https://api.github.com/users/ZogStriP/followers",
    "following_url": "https://api.github.com/users/ZogStriP/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZogStriP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZogStriP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZogStriP/subscriptions",
    "organizations_url": "https://api.github.com/users/ZogStriP/orgs",
    "repos_url": "https://api.github.com/users/ZogStriP/repos",
    "events_url": "https://api.github.com/users/ZogStriP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZogStriP/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e57138354dc2c23435315b73ca5e6c2857e47a48",
      "url": "https://api.github.com/repos/discourse/discourse/commits/e57138354dc2c23435315b73ca5e6c2857e47a48",
      "html_url": "https://github.com/discourse/discourse/commit/e57138354dc2c23435315b73ca5e6c2857e47a48"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 26,
    "deletions": 1
  },
  "files": [
    {
      "sha": "4b09bb3152ed8b56c7ca586c3fb23358a3d410a1",
      "filename": "app/jobs/regular/post_alert.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/5114ef958a68b529d3eaa7fe5dc5d4b209034517/app/jobs/regular/post_alert.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/5114ef958a68b529d3eaa7fe5dc5d4b209034517/app/jobs/regular/post_alert.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/jobs/regular/post_alert.rb?ref=5114ef958a68b529d3eaa7fe5dc5d4b209034517",
      "patch": "@@ -5,7 +5,7 @@ class PostAlert < Jobs::Base\n \n     def execute(args)\n       post = Post.find_by(id: args[:post_id])\n-      if post&.topic\n+      if post&.topic && post.raw.present?\n         opts = args[:options] || {}\n         new_record = true == args[:new_record]\n         PostAlerter.new(opts).after_save_post(post, new_record)"
    },
    {
      "sha": "df2ace3ef1c728d9ac6554c579bcc3b301b10449",
      "filename": "spec/components/post_creator_spec.rb",
      "status": "modified",
      "additions": 25,
      "deletions": 0,
      "changes": 25,
      "blob_url": "https://github.com/discourse/discourse/blob/5114ef958a68b529d3eaa7fe5dc5d4b209034517/spec/components/post_creator_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/5114ef958a68b529d3eaa7fe5dc5d4b209034517/spec/components/post_creator_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/post_creator_spec.rb?ref=5114ef958a68b529d3eaa7fe5dc5d4b209034517",
      "patch": "@@ -1141,6 +1141,31 @@\n       post_creator = PostCreator.new(user, title: '', raw: '')\n       expect { post_creator.create! }.to raise_error(ActiveRecord::RecordNotSaved)\n     end\n+\n+    it \"does not generate an alert for empty posts\" do\n+      Jobs.run_immediately!\n+\n+      user2 = Fabricate(:user)\n+      topic = Fabricate(:private_message_topic,\n+        topic_allowed_users: [\n+          Fabricate.build(:topic_allowed_user, user: user),\n+          Fabricate.build(:topic_allowed_user, user: user2)\n+        ],\n+      )\n+      Fabricate(:topic_user,\n+        topic: topic,\n+        user: user2,\n+        notification_level: TopicUser.notification_levels[:watching]\n+      )\n+\n+      expect {\n+        PostCreator.create!(user, raw: \"\", topic_id: topic.id, skip_validations: true)\n+      }.to change { user2.notifications.count }.by(0)\n+\n+      expect {\n+        PostCreator.create!(user, raw: \"hello world\", topic_id: topic.id, skip_validations: true)\n+      }.to change { user2.notifications.count }.by(1)\n+    end\n   end\n \n   context 'private message to a user that has disabled private messages' do"
    }
  ]
}
