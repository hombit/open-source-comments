{
  "sha": "d59abff2d824e88431364b88701d39076b2a5dca",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpkNTlhYmZmMmQ4MjRlODg0MzEzNjRiODg3MDFkMzkwNzZiMmE1ZGNh",
  "commit": {
    "author": {
      "name": "Dan Ungureanu",
      "email": "dan@ungureanu.me",
      "date": "2019-03-31T14:49:36Z"
    },
    "committer": {
      "name": "Dan Ungureanu",
      "email": "dan@ungureanu.me",
      "date": "2019-03-31T15:07:05Z"
    },
    "message": "UX: Always use relative age for post notices.",
    "tree": {
      "sha": "d5d37240230fb0e38ae085af6d7c71e89f617ab2",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/d5d37240230fb0e38ae085af6d7c71e89f617ab2"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/d59abff2d824e88431364b88701d39076b2a5dca",
    "comment_count": 1,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJFBAABCAAvFiEEZFlnr23WAUkE+3y4CqKgDWrMi4QFAlyg15oRHGRhbkB1bmd1\ncmVhbnUubWUACgkQCqKgDWrMi4TCfRAApnHQVDlNHTALP1jYLKfDt451vKPmx8fq\n6y7RlLCY/SqEv/5W2XoqRUGg27+ZA2DzoxtGmFHPd0/WDo+yoW7VzgIad1vby5eY\nNEumZ5V5d47V53oRYVOI/fKk5d0vwc9wogeSor2Xzoup7LGNnxufk+9xXxfhdT8P\nqxzCaJt1PyGjc721QCoeQ1xOdTEwOSGkrYSDniL7dLPzFkt0niWcuTGHxarpLWQQ\ngRIYyie/5TR+WS1mb4JcdaAGnyy24SiafctZW5lsjfq9PX37u3hP1hd5aNSCN/Bi\ngF3Ux7BXhlV0QVSS9CiOyaA3tUbp7KcKzklVew9lKhObxsrbxoBHyqwjflCPJ30E\nAg98rXj8Zxx+Zr8LhwykAYqL0hsF0yhk9pk2vzBcBKU6ZtbbXOJVKqUIXGBb4Rsi\njUBRpGk2YGqKiK/tX0wndHSnFIQnfXkoyv+kTPaFnianELwDP055sps77GQW0c6D\nKbAkoWyNzecjm7lG8Hy65SgvH88UNxuNip1JuKSAnE9CX10ilp7WkFLT0yYFtp9B\njR9GHJj4vyMWBSVr/GDCT0nWBoVb4QDxPj8z3n1zgRTtKP+weXjzS9bLVJHwpGv7\nauunMPMAVORML8sXg//JEXwRxW70trRelIaQIauNLAJdyaC/aW1+9w+fsF+4SY0L\nWTiW+YhevM8=\n=Xo5h\n-----END PGP SIGNATURE-----",
      "payload": "tree d5d37240230fb0e38ae085af6d7c71e89f617ab2\nparent e32af7fb0fdcf04e36a74b4aa49c079c7d1a42df\nauthor Dan Ungureanu <dan@ungureanu.me> 1554043776 +0300\ncommitter Dan Ungureanu <dan@ungureanu.me> 1554044825 +0300\n\nUX: Always use relative age for post notices.\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/d59abff2d824e88431364b88701d39076b2a5dca",
  "html_url": "https://github.com/discourse/discourse/commit/d59abff2d824e88431364b88701d39076b2a5dca",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/d59abff2d824e88431364b88701d39076b2a5dca/comments",
  "author": {
    "login": "udan11",
    "id": 4147664,
    "node_id": "MDQ6VXNlcjQxNDc2NjQ=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/4147664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/udan11",
    "html_url": "https://github.com/udan11",
    "followers_url": "https://api.github.com/users/udan11/followers",
    "following_url": "https://api.github.com/users/udan11/following{/other_user}",
    "gists_url": "https://api.github.com/users/udan11/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/udan11/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/udan11/subscriptions",
    "organizations_url": "https://api.github.com/users/udan11/orgs",
    "repos_url": "https://api.github.com/users/udan11/repos",
    "events_url": "https://api.github.com/users/udan11/events{/privacy}",
    "received_events_url": "https://api.github.com/users/udan11/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "udan11",
    "id": 4147664,
    "node_id": "MDQ6VXNlcjQxNDc2NjQ=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/4147664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/udan11",
    "html_url": "https://github.com/udan11",
    "followers_url": "https://api.github.com/users/udan11/followers",
    "following_url": "https://api.github.com/users/udan11/following{/other_user}",
    "gists_url": "https://api.github.com/users/udan11/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/udan11/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/udan11/subscriptions",
    "organizations_url": "https://api.github.com/users/udan11/orgs",
    "repos_url": "https://api.github.com/users/udan11/repos",
    "events_url": "https://api.github.com/users/udan11/events{/privacy}",
    "received_events_url": "https://api.github.com/users/udan11/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e32af7fb0fdcf04e36a74b4aa49c079c7d1a42df",
      "url": "https://api.github.com/repos/discourse/discourse/commits/e32af7fb0fdcf04e36a74b4aa49c079c7d1a42df",
      "html_url": "https://github.com/discourse/discourse/commit/e32af7fb0fdcf04e36a74b4aa49c079c7d1a42df"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 7,
    "deletions": 7
  },
  "files": [
    {
      "sha": "77f3f31abe97d839bae5d05b436ec6c955198134",
      "filename": "app/assets/javascripts/discourse/widgets/post.js.es6",
      "status": "modified",
      "additions": 3,
      "deletions": 5,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/d59abff2d824e88431364b88701d39076b2a5dca/app/assets/javascripts/discourse/widgets/post.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/d59abff2d824e88431364b88701d39076b2a5dca/app/assets/javascripts/discourse/widgets/post.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/widgets/post.js.es6?ref=d59abff2d824e88431364b88701d39076b2a5dca",
      "patch": "@@ -13,7 +13,7 @@ import {\n   formatUsername\n } from \"discourse/lib/utilities\";\n import hbs from \"discourse/widgets/hbs-compiler\";\n-import { relativeAge } from \"discourse/lib/formatter\";\n+import { durationTiny } from \"discourse/lib/formatter\";\n \n function transformWithCallbacks(post) {\n   let transformed = transformBasicPost(post);\n@@ -461,12 +461,10 @@ createWidget(\"post-notice\", {\n       text = I18n.t(\"post.notice.first\", { user });\n     } else if (attrs.postNoticeType === \"returning\") {\n       icon = \"far-smile\";\n+      const distance = (new Date() - new Date(attrs.postNoticeTime)) / 1000;\n       text = I18n.t(\"post.notice.return\", {\n         user,\n-        time: relativeAge(attrs.postNoticeTime, {\n-          format: \"tiny\",\n-          addAgo: true\n-        })\n+        time: durationTiny(distance, { addAgo: true })\n       });\n     }\n "
    },
    {
      "sha": "4a722cdc1ed53b390e02b95ad03b6464d0602322",
      "filename": "test/javascripts/widgets/post-test.js.es6",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/d59abff2d824e88431364b88701d39076b2a5dca/test/javascripts/widgets/post-test.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/d59abff2d824e88431364b88701d39076b2a5dca/test/javascripts/widgets/post-test.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/test/javascripts/widgets/post-test.js.es6?ref=d59abff2d824e88431364b88701d39076b2a5dca",
      "patch": "@@ -874,11 +874,13 @@ widgetTest(\"pm map\", {\n widgetTest(\"post notice - with username\", {\n   template: '{{mount-widget widget=\"post\" args=args}}',\n   beforeEach() {\n+    const date_2d_ago = new Date();\n+    date_2d_ago.setDate(date_2d_ago.getDate() - 2);\n     this.siteSettings.prioritize_username_in_ux = true;\n     this.siteSettings.old_post_notice_days = 14;\n     this.set(\"args\", {\n       postNoticeType: \"returning\",\n-      postNoticeTime: new Date(2010, 0, 1),\n+      postNoticeTime: date_2d_ago,\n       username: \"codinghorror\",\n       name: \"Jeff\",\n       created_at: new Date()\n@@ -889,7 +891,7 @@ widgetTest(\"post notice - with username\", {\n       find(\".post-notice.returning-user:not(.old)\")\n         .text()\n         .trim(),\n-      I18n.t(\"post.notice.return\", { user: \"codinghorror\", time: \"Jan '10\" })\n+      I18n.t(\"post.notice.return\", { user: \"codinghorror\", time: \"2d ago\" })\n     );\n   }\n });"
    }
  ]
}
