{
  "sha": "7b7c86461f630835ccefd808063613fcdc1eceaa",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo3YjdjODY0NjFmNjMwODM1Y2NlZmQ4MDgwNjM2MTNmY2RjMWVjZWFh",
  "commit": {
    "author": {
      "name": "Bianca Nenciu",
      "email": "nenciu.bianca@gmail.com",
      "date": "2019-04-21T08:40:29Z"
    },
    "committer": {
      "name": "Bianca Nenciu",
      "email": "nenciu.bianca@gmail.com",
      "date": "2019-04-21T08:40:29Z"
    },
    "message": "DEV: Improve tests.\n\nFollow-up to 034b8a7ecc406d83b0134940e81e83848b4b3279.",
    "tree": {
      "sha": "81a14ebab038a9a4f03aa7f38ac54f73fa2c41bd",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/81a14ebab038a9a4f03aa7f38ac54f73fa2c41bd"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/7b7c86461f630835ccefd808063613fcdc1eceaa",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/7b7c86461f630835ccefd808063613fcdc1eceaa",
  "html_url": "https://github.com/discourse/discourse/commit/7b7c86461f630835ccefd808063613fcdc1eceaa",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/7b7c86461f630835ccefd808063613fcdc1eceaa/comments",
  "author": {
    "login": "nbianca",
    "id": 23153890,
    "node_id": "MDQ6VXNlcjIzMTUzODkw",
    "avatar_url": "https://avatars3.githubusercontent.com/u/23153890?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbianca",
    "html_url": "https://github.com/nbianca",
    "followers_url": "https://api.github.com/users/nbianca/followers",
    "following_url": "https://api.github.com/users/nbianca/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbianca/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbianca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbianca/subscriptions",
    "organizations_url": "https://api.github.com/users/nbianca/orgs",
    "repos_url": "https://api.github.com/users/nbianca/repos",
    "events_url": "https://api.github.com/users/nbianca/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbianca/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nbianca",
    "id": 23153890,
    "node_id": "MDQ6VXNlcjIzMTUzODkw",
    "avatar_url": "https://avatars3.githubusercontent.com/u/23153890?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbianca",
    "html_url": "https://github.com/nbianca",
    "followers_url": "https://api.github.com/users/nbianca/followers",
    "following_url": "https://api.github.com/users/nbianca/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbianca/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbianca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbianca/subscriptions",
    "organizations_url": "https://api.github.com/users/nbianca/orgs",
    "repos_url": "https://api.github.com/users/nbianca/repos",
    "events_url": "https://api.github.com/users/nbianca/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbianca/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b3dcaacdf43f0e57a1ffd65eda4071de96dbe8f0",
      "url": "https://api.github.com/repos/discourse/discourse/commits/b3dcaacdf43f0e57a1ffd65eda4071de96dbe8f0",
      "html_url": "https://github.com/discourse/discourse/commit/b3dcaacdf43f0e57a1ffd65eda4071de96dbe8f0"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 5,
    "deletions": 7
  },
  "files": [
    {
      "sha": "afe260661b32ab5df4feb05f0cb7133da065f539",
      "filename": "spec/components/guardian_spec.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 7,
      "changes": 12,
      "blob_url": "https://github.com/discourse/discourse/blob/7b7c86461f630835ccefd808063613fcdc1eceaa/spec/components/guardian_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/7b7c86461f630835ccefd808063613fcdc1eceaa/spec/components/guardian_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/guardian_spec.rb?ref=7b7c86461f630835ccefd808063613fcdc1eceaa",
      "patch": "@@ -1755,15 +1755,13 @@\n         expect(Guardian.new(topic.user).can_delete?(topic)).to be_truthy\n       end\n \n-      it \"returns false if delete their own topics\" do\n-        topic.update_attribute(:posts_count, 2)\n-        topic.update_attribute(:created_at, Time.zone.now)\n+      it \"returns false if topic has replies\" do\n+        topic.update!(posts_count: 2, created_at: Time.zone.now)\n         expect(Guardian.new(topic.user).can_delete?(topic)).to be_falsey\n       end\n \n-      it \"returns false if delete their own topics\" do\n-        topic.update_attribute(:posts_count, 1)\n-        topic.update_attribute(:created_at, 48.hours.ago)\n+      it \"returns false if topic was created > 24h ago\" do\n+        topic.update!(posts_count: 1, created_at: 48.hours.ago)\n         expect(Guardian.new(topic.user).can_delete?(topic)).to be_falsey\n       end\n     end\n@@ -1794,7 +1792,7 @@\n       end\n \n       it \"returns false when it's the OP, even as a moderator if there are at least two posts\" do\n-        post.update_attribute(:post_number, 1)\n+        post = Fabricate(:post)\n         Fabricate(:post, topic: post.topic)\n         expect(Guardian.new(moderator).can_delete?(post)).to be_falsey\n       end"
    }
  ]
}
