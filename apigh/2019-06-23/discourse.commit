{
  "sha": "ee8669d778ad46cb65265042eac4c58e9af0bf16",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODplZTg2NjlkNzc4YWQ0NmNiNjUyNjUwNDJlYWM0YzU4ZTlhZjBiZjE2",
  "commit": {
    "author": {
      "name": "Dan Ungureanu",
      "email": "dan@ungureanu.me",
      "date": "2019-06-21T18:57:49Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-06-21T18:57:49Z"
    },
    "message": "FIX: Ensure :after_auth event is triggered. (#7791)",
    "tree": {
      "sha": "041945e5faa2b091066147cf1e8303b4825a74ff",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/041945e5faa2b091066147cf1e8303b4825a74ff"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/ee8669d778ad46cb65265042eac4c58e9af0bf16",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdDSitCRBK7hj4Ov3rIwAAdHIIAGLOUn7Isza6vcVUvVYUzg1P\nzsqYl4rRfOnNnAx1JUFGlrcjp6H94vLtA+fgrdWteAeUvyKRtA9g0RJJ+6QNIrLX\nF5YR0NKz72ErctcWzwfyjyoGsQsNBIDznK/2n5IZlJvTXUIIs+yYwNMUAfaiwkmi\nqxBZj9x42M7lgONrFGT6fIzJd5Xmi5zpwSX1XecTzGllmMUUoYL793E2xyAsoFm0\nPaNd/YZ/TRVxpskDGoSLD1j9juiwFRRNhv/+JkraqTgiV4fhGX5BULHZo2B4OT5P\n3llm3dQwrLPossYvhcHOw7WbTRfKOuJRDkURUMVDYL1WrThofsqqRGi+6ulKB3A=\n=Jeo2\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 041945e5faa2b091066147cf1e8303b4825a74ff\nparent 02f6db4e59e03f49739be7e228641613dab0ae26\nauthor Dan Ungureanu <dan@ungureanu.me> 1561143469 +0300\ncommitter GitHub <noreply@github.com> 1561143469 +0300\n\nFIX: Ensure :after_auth event is triggered. (#7791)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/ee8669d778ad46cb65265042eac4c58e9af0bf16",
  "html_url": "https://github.com/discourse/discourse/commit/ee8669d778ad46cb65265042eac4c58e9af0bf16",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/ee8669d778ad46cb65265042eac4c58e9af0bf16/comments",
  "author": {
    "login": "udan11",
    "id": 4147664,
    "node_id": "MDQ6VXNlcjQxNDc2NjQ=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/4147664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/udan11",
    "html_url": "https://github.com/udan11",
    "followers_url": "https://api.github.com/users/udan11/followers",
    "following_url": "https://api.github.com/users/udan11/following{/other_user}",
    "gists_url": "https://api.github.com/users/udan11/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/udan11/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/udan11/subscriptions",
    "organizations_url": "https://api.github.com/users/udan11/orgs",
    "repos_url": "https://api.github.com/users/udan11/repos",
    "events_url": "https://api.github.com/users/udan11/events{/privacy}",
    "received_events_url": "https://api.github.com/users/udan11/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "02f6db4e59e03f49739be7e228641613dab0ae26",
      "url": "https://api.github.com/repos/discourse/discourse/commits/02f6db4e59e03f49739be7e228641613dab0ae26",
      "html_url": "https://github.com/discourse/discourse/commit/02f6db4e59e03f49739be7e228641613dab0ae26"
    }
  ],
  "stats": {
    "total": 4,
    "additions": 3,
    "deletions": 1
  },
  "files": [
    {
      "sha": "4a9b0916e2f5ee4ae9e5905a2db9135e2cb40e39",
      "filename": "app/controllers/users/omniauth_callbacks_controller.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/ee8669d778ad46cb65265042eac4c58e9af0bf16/app/controllers/users/omniauth_callbacks_controller.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/ee8669d778ad46cb65265042eac4c58e9af0bf16/app/controllers/users/omniauth_callbacks_controller.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/controllers/users/omniauth_callbacks_controller.rb?ref=ee8669d778ad46cb65265042eac4c58e9af0bf16",
      "patch": "@@ -32,18 +32,20 @@ def complete\n       @auth_result = authenticator.after_authenticate(auth, existing_account: current_user)\n       if provider&.full_screen_login || cookies['fsl']\n         cookies.delete('fsl')\n+        DiscourseEvent.trigger(:after_auth, authenticator, @auth_result)\n         return redirect_to Discourse.base_uri(\"/my/preferences/account\")\n       else\n         @auth_result.authenticated = true\n+        DiscourseEvent.trigger(:after_auth, authenticator, @auth_result)\n         return respond_to do |format|\n           format.html\n           format.json { render json: @auth_result.to_client_hash }\n         end\n       end\n     else\n       @auth_result = authenticator.after_authenticate(auth)\n+      DiscourseEvent.trigger(:after_auth, authenticator, @auth_result)\n     end\n-    DiscourseEvent.trigger(:after_auth, authenticator, @auth_result)\n \n     preferred_origin = request.env['omniauth.origin']\n "
    }
  ]
}
