{
  "sha": "5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjU0MzFmODBlODRiZDQwYTM4Yzg0OWEzZjdjZTRjYjU1MjJkM2Q3MmQ=",
  "commit": {
    "author": {
      "name": "Misha Vyrtsev",
      "email": "reeywhaar@gmail.com",
      "date": "2019-07-23T21:45:52Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2019-07-23T21:45:52Z"
    },
    "message": "fix unblocking after page refresh stalled (#384)",
    "tree": {
      "sha": "2a3cc4ff072d2f15a86b12186861365c5cad865e",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/2a3cc4ff072d2f15a86b12186861365c5cad865e"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
  "html_url": "https://github.com/umputun/remark/commit/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d/comments",
  "author": {
    "login": "Reeywhaar",
    "id": 884649,
    "node_id": "MDQ6VXNlcjg4NDY0OQ==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/884649?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Reeywhaar",
    "html_url": "https://github.com/Reeywhaar",
    "followers_url": "https://api.github.com/users/Reeywhaar/followers",
    "following_url": "https://api.github.com/users/Reeywhaar/following{/other_user}",
    "gists_url": "https://api.github.com/users/Reeywhaar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Reeywhaar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Reeywhaar/subscriptions",
    "organizations_url": "https://api.github.com/users/Reeywhaar/orgs",
    "repos_url": "https://api.github.com/users/Reeywhaar/repos",
    "events_url": "https://api.github.com/users/Reeywhaar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Reeywhaar/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4d7699ec5e330d6618ee805711ffd3cb6c71e4c7",
      "url": "https://api.github.com/repos/umputun/remark/commits/4d7699ec5e330d6618ee805711ffd3cb6c71e4c7",
      "html_url": "https://github.com/umputun/remark/commit/4d7699ec5e330d6618ee805711ffd3cb6c71e4c7"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 9,
    "deletions": 3
  },
  "files": [
    {
      "sha": "590f04b1e216dd7028eb85b27e033d16bd748038",
      "filename": "frontend/app/store/comments/utils.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark/blob/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d/frontend/app/store/comments/utils.ts",
      "raw_url": "https://github.com/umputun/remark/raw/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d/frontend/app/store/comments/utils.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/store/comments/utils.ts?ref=5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
      "patch": "@@ -62,7 +62,7 @@ export function filterTree(tree: Node[], fn: (node: Node) => boolean): Node[] {\n  * Traverses through tree and applies function to comment on which function passed.\n  * Note that function must not mutate comment\n  */\n-function mapTree(tree: Node[], fn: (c: Comment) => Comment): Node[] {\n+export function mapTree(tree: Node[], fn: (c: Comment) => Comment): Node[] {\n   return tree.map(node => {\n     const clone: Node = {\n       comment: fn(node.comment),"
    },
    {
      "sha": "834b968c361d63c8cef478dd4e6e77e4d5a6ff6c",
      "filename": "frontend/app/store/user/actions.ts",
      "status": "modified",
      "additions": 8,
      "deletions": 2,
      "changes": 10,
      "blob_url": "https://github.com/umputun/remark/blob/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d/frontend/app/store/user/actions.ts",
      "raw_url": "https://github.com/umputun/remark/raw/5431f80e84bd40a38c849a3f7ce4cb5522d3d72d/frontend/app/store/user/actions.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/store/user/actions.ts?ref=5431f80e84bd40a38c849a3f7ce4cb5522d3d72d",
      "patch": "@@ -17,7 +17,7 @@ import {\n   SETTINGS_VISIBLE_SET,\n } from './types';\n import { setComments, unsetCommentMode } from '../comments/actions';\n-import { setUserVerified as uSetUserVerified, filterTree } from '../comments/utils';\n+import { setUserVerified as uSetUserVerified, filterTree, mapTree } from '../comments/utils';\n import { IS_STORAGE_AVAILABLE, LS_HIDDEN_USERS_KEY } from '@app/common/constants';\n import { getItem } from '@app/common/local-storage';\n import { Dispatch } from 'redux';\n@@ -74,12 +74,18 @@ export const blockUser = (\n   });\n };\n \n-export const unblockUser = (id: User['id']): StoreAction<Promise<void>> => async dispatch => {\n+export const unblockUser = (id: User['id']): StoreAction<Promise<void>> => async (dispatch, getState) => {\n   await api.unblockUser(id);\n+  const comments = mapTree(getState().comments, c => {\n+    if (c.user.id !== id) return c;\n+    if (!c.user.block) return c;\n+    return { ...c, user: { ...c.user, block: false } };\n+  });\n   dispatch({\n     type: USER_UNBAN,\n     id,\n   });\n+  dispatch(setComments(comments));\n };\n \n export const fetchHiddenUsers = (): StoreAction<void> => dispatch => {"
    }
  ]
}
