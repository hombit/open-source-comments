{
  "sha": "d6d0109e8048d08cb65d949496e07ef3c9180fcd",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOmQ2ZDAxMDllODA0OGQwOGNiNjVkOTQ5NDk2ZTA3ZWYzYzkxODBmY2Q=",
  "commit": {
    "author": {
      "name": "Vyrtsev Mikhail",
      "email": "reeywhaar@gmail.com",
      "date": "2019-08-16T21:05:51Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2019-08-16T21:33:04Z"
    },
    "message": "change default post url from window.location.href to window.location.origin + window.location.pathname",
    "tree": {
      "sha": "b17c6e98420498a840656e6f20869d2a548d1a40",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/b17c6e98420498a840656e6f20869d2a548d1a40"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/d6d0109e8048d08cb65d949496e07ef3c9180fcd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/d6d0109e8048d08cb65d949496e07ef3c9180fcd",
  "html_url": "https://github.com/umputun/remark/commit/d6d0109e8048d08cb65d949496e07ef3c9180fcd",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/d6d0109e8048d08cb65d949496e07ef3c9180fcd/comments",
  "author": {
    "login": "Reeywhaar",
    "id": 884649,
    "node_id": "MDQ6VXNlcjg4NDY0OQ==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/884649?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Reeywhaar",
    "html_url": "https://github.com/Reeywhaar",
    "followers_url": "https://api.github.com/users/Reeywhaar/followers",
    "following_url": "https://api.github.com/users/Reeywhaar/following{/other_user}",
    "gists_url": "https://api.github.com/users/Reeywhaar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Reeywhaar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Reeywhaar/subscriptions",
    "organizations_url": "https://api.github.com/users/Reeywhaar/orgs",
    "repos_url": "https://api.github.com/users/Reeywhaar/repos",
    "events_url": "https://api.github.com/users/Reeywhaar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Reeywhaar/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f77ad01fbfefa466282eb1f606fe39471a0171fc",
      "url": "https://api.github.com/repos/umputun/remark/commits/f77ad01fbfefa466282eb1f606fe39471a0171fc",
      "html_url": "https://github.com/umputun/remark/commit/f77ad01fbfefa466282eb1f606fe39471a0171fc"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 24,
    "deletions": 6
  },
  "files": [
    {
      "sha": "3e4ef145cbe15b8e95ba59e79d4f83b57af29baf",
      "filename": "README.md",
      "status": "modified",
      "additions": 22,
      "deletions": 4,
      "changes": 26,
      "blob_url": "https://github.com/umputun/remark/blob/d6d0109e8048d08cb65d949496e07ef3c9180fcd/README.md",
      "raw_url": "https://github.com/umputun/remark/raw/d6d0109e8048d08cb65d949496e07ef3c9180fcd/README.md",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/README.md?ref=d6d0109e8048d08cb65d949496e07ef3c9180fcd",
      "patch": "@@ -3,7 +3,7 @@\n Remark42 is a self-hosted, lightweight, and simple (yet functional) comment engine, which doesn't spy on users. It can be embedded into blogs, articles or any other place where readers add comments.\n \n * Social login via Google, Facebook, GitHub and Yandex\n-* Login via email \n+* Login via email\n * Optional anonymous access\n * Multi-level nested comments with both tree and plain presentations\n * Import from Disqus and WordPress\n@@ -339,7 +339,25 @@ Add this snippet to the bottom of web page:\n                           //     - 'embed': basic comments widget\n                           //     - 'last-comments': last comments widget, see `Last Comments` section below\n                           //     - 'counter': counter widget, see `Counter` section below\n-    url: 'PAGE_URL', // optional param; if it isn't defined window.location.href will be used\n+    url: 'PAGE_URL', // optional param; if it isn't defined\n+                     // `window.location.origin + window.location.pathname` will be used,\n+                     //\n+                     // Note that if you use query parameters as significant part of url\n+                     // (the one that actually changes content on page)\n+                     // you will have to configure url manually to keep query params, as\n+                     // `window.location.origin + window.location.pathname` doesn't contain query params and\n+                     // hash. For example default url for `https://example/com/example-post?id=1#hash`\n+                     // would be `https://example/com/example-post`.\n+                     //\n+                     // The problem with query params is that they often contain useless params added by\n+                     // various trackers (utm params) and doesn't have defined order, so Remark treats differently\n+                     // all this examples:\n+                     // https://example.com/?postid=1&date=2007-02-11\n+                     // https://example.com/?date=2007-02-11&postid=1\n+                     // https://example.com/?date=2007-02-11&postid=1&utm_source=google\n+                     //\n+                     // If you deal with query parameters make sure you pass only significant part of it\n+                     // in well defined order\n     max_shown_comments: 10, // optional param; if it isn't defined default value (15) will be used\n     theme: 'dark', // optional param; if it isn't defined default value ('light') will be used\n     page_title: 'Moving to Remark42' // optional param; if it isn't defined `document.title` will be used\n@@ -445,7 +463,7 @@ You can use as many nodes like this as you need to.\n The script will found all them by the class `remark__counter`,\n and it will use `data-url` attribute to define the page with comments.\n \n-Also script can uses `url` property from `remark_config` object, or `window.location.href` if nothing else is defined.\n+Also script can use `url` property from `remark_config` object, or `window.location.origin + window.location.pathname` if nothing else is defined.\n \n ## Build from the source\n \n@@ -681,7 +699,7 @@ event: info\n data: {\"url\":\"https://radio-t.com/blah1\",\"count\":8,\"first_time\":\"2019-06-18T12:53:48.125686-05:00\",\"last_time\":\"2019-06-18T12:53:48.23817-05:00\"}\n \n event: info\n-data: {\"url\":\"https://radio-t.com/blah1\",\"count\":9,\"first_time\":\"2019-06-18T12:53:48.125686-05:00\",\"last_time\":\"2019-06-18T12:53:48.254669-05:00\"}         \n+data: {\"url\":\"https://radio-t.com/blah1\",\"count\":9,\"first_time\":\"2019-06-18T12:53:48.125686-05:00\",\"last_time\":\"2019-06-18T12:53:48.254669-05:00\"}\n ```\n \n </details>"
    },
    {
      "sha": "73cead20a68213758f08d2fbf06f9186fcdb084f",
      "filename": "frontend/app/counter.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark/blob/d6d0109e8048d08cb65d949496e07ef3c9180fcd/frontend/app/counter.ts",
      "raw_url": "https://github.com/umputun/remark/raw/d6d0109e8048d08cb65d949496e07ef3c9180fcd/frontend/app/counter.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/counter.ts?ref=d6d0109e8048d08cb65d949496e07ef3c9180fcd",
      "patch": "@@ -37,7 +37,7 @@ async function init(): Promise<void> {\n   }\n \n   const map = nodes.reduce<{ [key: string]: HTMLElement[] }>((acc, node) => {\n-    const id = node.dataset.url || remark_config.url || window.location.href;\n+    const id = node.dataset.url || remark_config.url || window.location.origin + window.location.pathname;\n     if (!acc[id]) acc[id] = [];\n     acc[id].push(node);\n     return acc;"
    },
    {
      "sha": "2942d494c2e6d3d6c73ece0011cadd011fa32682",
      "filename": "frontend/app/embed.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark/blob/d6d0109e8048d08cb65d949496e07ef3c9180fcd/frontend/app/embed.ts",
      "raw_url": "https://github.com/umputun/remark/raw/d6d0109e8048d08cb65d949496e07ef3c9180fcd/frontend/app/embed.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/embed.ts?ref=d6d0109e8048d08cb65d949496e07ef3c9180fcd",
      "patch": "@@ -38,7 +38,7 @@ async function init(): Promise<void> {\n     return;\n   }\n \n-  remark_config.url = (remark_config.url || window.location.href).split('#')[0];\n+  remark_config.url = (remark_config.url || window.location.origin + window.location.pathname).split('#')[0];\n \n   (window as any).REMARK42 = (window as any).REMARK42 || {};\n   (window as any).REMARK42.changeTheme = changeTheme;"
    }
  ]
}
