{
  "sha": "6f70138f4a63f836931c2fc05a8af726b62a7be9",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo2ZjcwMTM4ZjRhNjNmODM2OTMxYzJmYzA1YThhZjcyNmI2MmE3YmU5",
  "commit": {
    "author": {
      "name": "Joffrey JAFFEUX",
      "email": "j.jaffeux@gmail.com",
      "date": "2019-08-19T16:33:12Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-08-19T16:33:12Z"
    },
    "message": "DEV: injects router in customHref/customFilter of addNavigationBarItem (#8018)",
    "tree": {
      "sha": "dea424ee22ada3fe8e42ee0c3be16948f47fda44",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/dea424ee22ada3fe8e42ee0c3be16948f47fda44"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/6f70138f4a63f836931c2fc05a8af726b62a7be9",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdWs9ICRBK7hj4Ov3rIwAAdHIIAELtmDHpOfFQmEcQ91kpEH5F\nThf9hqEAClBHk5luFzUVowKEtPFwCmd3xq6pGx1J4l5m4RDd7XNhh/6kefFng5TY\niAxuTX7vUGTrr3P+eYXfkabedJ5ySt6PoU6cm+hNsrnHx15AYL2RR0Ws0/KTeklE\na6uuaFZMud+WPhTM55o07XRq6+9kd6LgAhtiKXaBTK2eH6xaRSBq/MDKfZgwC54p\nLS0jOlCTG3PiL/nmO7648SLbtQkwQFkzO2rZ4O+TOrtBjKcXcQfLBhUqbZ2y6NKU\nrChT6OGf9XRdLGD7Gmb8imw1PKs/rODuz82Ys7TCEVT2pri+9Rq0c3TF8ROiraE=\n=MAce\n-----END PGP SIGNATURE-----\n",
      "payload": "tree dea424ee22ada3fe8e42ee0c3be16948f47fda44\nparent f27564a0a09f49f08c48b77eb3de1c6d7268f4dc\nauthor Joffrey JAFFEUX <j.jaffeux@gmail.com> 1566232392 +0200\ncommitter GitHub <noreply@github.com> 1566232392 +0200\n\nDEV: injects router in customHref/customFilter of addNavigationBarItem (#8018)\n\n\r\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/6f70138f4a63f836931c2fc05a8af726b62a7be9",
  "html_url": "https://github.com/discourse/discourse/commit/6f70138f4a63f836931c2fc05a8af726b62a7be9",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/6f70138f4a63f836931c2fc05a8af726b62a7be9/comments",
  "author": {
    "login": "jjaffeux",
    "id": 339945,
    "node_id": "MDQ6VXNlcjMzOTk0NQ==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/339945?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjaffeux",
    "html_url": "https://github.com/jjaffeux",
    "followers_url": "https://api.github.com/users/jjaffeux/followers",
    "following_url": "https://api.github.com/users/jjaffeux/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjaffeux/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjaffeux/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjaffeux/subscriptions",
    "organizations_url": "https://api.github.com/users/jjaffeux/orgs",
    "repos_url": "https://api.github.com/users/jjaffeux/repos",
    "events_url": "https://api.github.com/users/jjaffeux/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjaffeux/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f27564a0a09f49f08c48b77eb3de1c6d7268f4dc",
      "url": "https://api.github.com/repos/discourse/discourse/commits/f27564a0a09f49f08c48b77eb3de1c6d7268f4dc",
      "html_url": "https://github.com/discourse/discourse/commit/f27564a0a09f49f08c48b77eb3de1c6d7268f4dc"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 18,
    "deletions": 1
  },
  "files": [
    {
      "sha": "4ecac877f865198571e4987242267c9660e5e9dc",
      "filename": "app/assets/javascripts/discourse/lib/plugin-api.js.es6",
      "status": "modified",
      "additions": 18,
      "deletions": 1,
      "changes": 19,
      "blob_url": "https://github.com/discourse/discourse/blob/6f70138f4a63f836931c2fc05a8af726b62a7be9/app/assets/javascripts/discourse/lib/plugin-api.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/6f70138f4a63f836931c2fc05a8af726b62a7be9/app/assets/javascripts/discourse/lib/plugin-api.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/lib/plugin-api.js.es6?ref=6f70138f4a63f836931c2fc05a8af726b62a7be9",
      "patch": "@@ -734,7 +734,8 @@ class PluginApi {\n    *   name: \"link-to-bugs-category\",\n    *   displayName: \"bugs\"\n    *   href: \"/c/bugs\",\n-   *   customFilter: (category, args) => { category && category.get('name') !== 'bug' }\n+   *   customFilter: (category, args, router) => { category && category.name !== 'bug' }\n+   *   customHref: (category, args, router) => {  if (category && category.name) === 'not-a-bug') \"/a-feature\"; }\n    * })\n    */\n   addNavigationBarItem(item) {\n@@ -745,6 +746,22 @@ class PluginApi {\n         item\n       );\n     } else {\n+      const customHref = item.customHref;\n+      if (customHref) {\n+        const router = this.container.lookup(\"service:router\");\n+        item.customHref = function(category, args) {\n+          return customHref(category, args, router);\n+        };\n+      }\n+\n+      const customFilter = item.customFilter;\n+      if (customFilter) {\n+        const router = this.container.lookup(\"service:router\");\n+        item.customFilter = function(category, args) {\n+          return customFilter(category, args, router);\n+        };\n+      }\n+\n       addNavItem(item);\n     }\n   }"
    }
  ]
}
