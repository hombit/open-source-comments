{
  "sha": "bf05a8da9650cec85e6e77091e76907abd7b5862",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpiZjA1YThkYTk2NTBjZWM4NWU2ZTc3MDkxZTc2OTA3YWJkN2I1ODYy",
  "commit": {
    "author": {
      "name": "Joffrey JAFFEUX",
      "email": "j.jaffeux@gmail.com",
      "date": "2019-08-24T16:39:20Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-08-24T16:39:20Z"
    },
    "message": "FEATURE: adds countdown attribute to [date] (#8037)\n\nWhen used, dates will be displayed as a countdown in a human friendly way.",
    "tree": {
      "sha": "b99a61c95cf848eb06afa0acdbbea285feb347d7",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/b99a61c95cf848eb06afa0acdbbea285feb347d7"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/bf05a8da9650cec85e6e77091e76907abd7b5862",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdYWg4CRBK7hj4Ov3rIwAAdHIIACnrNoKY6sxDOhGqw2dhwQ90\n4D8SoqTlRTS9F4KfN0ejnzFUHCsSh39Bgo58FFtY917o0hB4EcE/4dYaDZ8dbtTc\njJrqv+H3CMHyCcc6FTRofAOBQELhZim0dYK2EYa3+q0OA94wmIeWiPQhz1oOxPJd\nYstLqD6qlQKSxy2D2zM4RIKXlRqN+sODllSEAf2/ofjDshjmU9oAIS8BxD1OAA+s\n26cKiD50lsFm8oen31pXsf0CjDoFlrUCAsWET+1yFCQG7FXbu3pqzr1XaB2IwiT6\n9hxC//O+W7yyD02zf5qasTE9p5wWWprm0sd8CphDzhkxuuQ/UTkNv2kPzHCPbxs=\n=Nqwz\n-----END PGP SIGNATURE-----\n",
      "payload": "tree b99a61c95cf848eb06afa0acdbbea285feb347d7\nparent 39c31a3d7693fae488461079c6f0c2bc7305c02e\nauthor Joffrey JAFFEUX <j.jaffeux@gmail.com> 1566664760 -0500\ncommitter GitHub <noreply@github.com> 1566664760 -0500\n\nFEATURE: adds countdown attribute to [date] (#8037)\n\nWhen used, dates will be displayed as a countdown in a human friendly way."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/bf05a8da9650cec85e6e77091e76907abd7b5862",
  "html_url": "https://github.com/discourse/discourse/commit/bf05a8da9650cec85e6e77091e76907abd7b5862",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/bf05a8da9650cec85e6e77091e76907abd7b5862/comments",
  "author": {
    "login": "jjaffeux",
    "id": 339945,
    "node_id": "MDQ6VXNlcjMzOTk0NQ==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/339945?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjaffeux",
    "html_url": "https://github.com/jjaffeux",
    "followers_url": "https://api.github.com/users/jjaffeux/followers",
    "following_url": "https://api.github.com/users/jjaffeux/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjaffeux/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjaffeux/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjaffeux/subscriptions",
    "organizations_url": "https://api.github.com/users/jjaffeux/orgs",
    "repos_url": "https://api.github.com/users/jjaffeux/repos",
    "events_url": "https://api.github.com/users/jjaffeux/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjaffeux/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "39c31a3d7693fae488461079c6f0c2bc7305c02e",
      "url": "https://api.github.com/repos/discourse/discourse/commits/39c31a3d7693fae488461079c6f0c2bc7305c02e",
      "html_url": "https://github.com/discourse/discourse/commit/39c31a3d7693fae488461079c6f0c2bc7305c02e"
    }
  ],
  "stats": {
    "total": 34,
    "additions": 33,
    "deletions": 1
  },
  "files": [
    {
      "sha": "8e87d8868195e7cb51a0adfe681ef57242303e01",
      "filename": "plugins/discourse-local-dates/assets/javascripts/discourse-local-dates.js.no-module.es6",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/discourse/discourse/blob/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/javascripts/discourse-local-dates.js.no-module.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/javascripts/discourse-local-dates.js.no-module.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/discourse-local-dates/assets/javascripts/discourse-local-dates.js.no-module.es6?ref=bf05a8da9650cec85e6e77091e76907abd7b5862",
      "patch": "@@ -128,6 +128,15 @@\n   }\n \n   function _applyFormatting(dateTime, displayedTimezone, options) {\n+    if (options.countdown) {\n+      const diffTime = dateTime.diff(moment());\n+      if (diffTime < 0) {\n+        return I18n.t(\"discourse_local_dates.relative_dates.countdown.passed\");\n+      } else {\n+        return moment.duration(diffTime).humanize();\n+      }\n+    }\n+\n     const sameTimezone = _isEqualZones(displayedTimezone, moment.tz.guess());\n     const inCalendarRange = dateTime.isBetween(\n       moment().subtract(2, \"days\"),\n@@ -313,6 +322,7 @@\n       options.displayedTimezone = $element.attr(\"data-displayed-timezone\");\n       options.format =\n         $element.attr(\"data-format\") || (options.time ? \"LLL\" : \"LL\");\n+      options.countdown = $element.attr(\"data-countdown\");\n \n       processElement($element, options);\n     });"
    },
    {
      "sha": "083794bd9c8927ee480248b3f6b69885c41fb152",
      "filename": "plugins/discourse-local-dates/assets/javascripts/lib/discourse-markdown/discourse-local-dates.js.es6",
      "status": "modified",
      "additions": 10,
      "deletions": 1,
      "changes": 11,
      "blob_url": "https://github.com/discourse/discourse/blob/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/javascripts/lib/discourse-markdown/discourse-local-dates.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/javascripts/lib/discourse-markdown/discourse-local-dates.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/discourse-local-dates/assets/javascripts/lib/discourse-markdown/discourse-local-dates.js.es6?ref=bf05a8da9650cec85e6e77091e76907abd7b5862",
      "patch": "@@ -9,7 +9,8 @@ function addLocalDate(buffer, matches, state) {\n     timezone: null,\n     format: null,\n     timezones: null,\n-    displayedTimezone: null\n+    displayedTimezone: null,\n+    countdown: null\n   };\n \n   let parsed = parseBBCodeTag(\n@@ -26,6 +27,7 @@ function addLocalDate(buffer, matches, state) {\n   config.recurring = parsed.attrs.recurring;\n   config.timezones = parsed.attrs.timezones;\n   config.displayedTimezone = parsed.attrs.displayedTimezone;\n+  config.countdown = parsed.attrs.countdown;\n \n   token = new state.Token(\"span_open\", \"span\", 1);\n   token.attrs = [[\"data-date\", state.md.utils.escapeHtml(config.date)]];\n@@ -57,6 +59,13 @@ function addLocalDate(buffer, matches, state) {\n     token.attrs.push([\"data-format\", state.md.utils.escapeHtml(config.format)]);\n   }\n \n+  if (config.countdown) {\n+    token.attrs.push([\n+      \"data-countdown\",\n+      state.md.utils.escapeHtml(config.countdown)\n+    ]);\n+  }\n+\n   if (config.calendar) {\n     token.attrs.push([\n       \"data-calendar\","
    },
    {
      "sha": "c4edbf91a9072805dc36319f7a6cc7c0c8b0413a",
      "filename": "plugins/discourse-local-dates/assets/stylesheets/common/discourse-local-dates.scss",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/stylesheets/common/discourse-local-dates.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/assets/stylesheets/common/discourse-local-dates.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/discourse-local-dates/assets/stylesheets/common/discourse-local-dates.scss?ref=bf05a8da9650cec85e6e77091e76907abd7b5862",
      "patch": "@@ -12,6 +12,10 @@\n     &.past {\n       border-bottom-color: $primary-low-mid;\n     }\n+\n+    &.past[data-countdown] {\n+      color: $primary-medium;\n+    }\n   }\n }\n "
    },
    {
      "sha": "35d277299458b8b3e1663c83d517aee41bf70002",
      "filename": "plugins/discourse-local-dates/config/locales/client.en.yml",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/config/locales/client.en.yml",
      "raw_url": "https://github.com/discourse/discourse/raw/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/config/locales/client.en.yml",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/discourse-local-dates/config/locales/client.en.yml?ref=bf05a8da9650cec85e6e77091e76907abd7b5862",
      "patch": "@@ -5,6 +5,8 @@ en:\n         today: Today %{time}\n         tomorrow: Tomorrow %{time}\n         yesterday: Yesterday %{time}\n+        countdown:\n+          passed: date has passed\n       title: Insert date / time\n       create:\n         form:"
    },
    {
      "sha": "e59b695d235ec28a88572d28d5f7968b60fd7d8f",
      "filename": "plugins/discourse-local-dates/spec/integration/local_dates_spec.rb",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/spec/integration/local_dates_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/bf05a8da9650cec85e6e77091e76907abd7b5862/plugins/discourse-local-dates/spec/integration/local_dates_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/discourse-local-dates/spec/integration/local_dates_spec.rb?ref=bf05a8da9650cec85e6e77091e76907abd7b5862",
      "patch": "@@ -79,4 +79,11 @@\n \n     expect(cooked).not_to include(\"data-timezone=\")\n   end\n+\n+  it 'supports countdowns' do\n+    raw = \"[date=2018-11-01 time=12:00 countdown=true]\"\n+    cooked = Fabricate(:post, raw: raw).cooked\n+\n+    expect(cooked).to include(\"data-countdown=\")\n+  end\n end"
    }
  ]
}
