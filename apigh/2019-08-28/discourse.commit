{
  "sha": "e3eb49729c2ae872741152376530794c7986d9e6",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODplM2ViNDk3MjljMmFlODcyNzQxMTUyMzc2NTMwNzk0Yzc5ODZkOWU2",
  "commit": {
    "author": {
      "name": "Régis Hanol",
      "email": "regis@hanol.fr",
      "date": "2019-08-28T16:07:56Z"
    },
    "committer": {
      "name": "Régis Hanol",
      "email": "regis@hanol.fr",
      "date": "2019-08-28T16:07:56Z"
    },
    "message": "FIX: don't blow up if the topic does not exists anymore\n\nPERF: only select the only field we use\n\nintroduced in 7c741fa0d673f3c808cf3f77127e44e823ea40f8 (cc @romanrizzi)",
    "tree": {
      "sha": "0cdc89783b1f45530f54ed805e994ec33e6ccea4",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/0cdc89783b1f45530f54ed805e994ec33e6ccea4"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/e3eb49729c2ae872741152376530794c7986d9e6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/e3eb49729c2ae872741152376530794c7986d9e6",
  "html_url": "https://github.com/discourse/discourse/commit/e3eb49729c2ae872741152376530794c7986d9e6",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/e3eb49729c2ae872741152376530794c7986d9e6/comments",
  "author": {
    "login": "ZogStriP",
    "id": 362783,
    "node_id": "MDQ6VXNlcjM2Mjc4Mw==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/362783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZogStriP",
    "html_url": "https://github.com/ZogStriP",
    "followers_url": "https://api.github.com/users/ZogStriP/followers",
    "following_url": "https://api.github.com/users/ZogStriP/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZogStriP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZogStriP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZogStriP/subscriptions",
    "organizations_url": "https://api.github.com/users/ZogStriP/orgs",
    "repos_url": "https://api.github.com/users/ZogStriP/repos",
    "events_url": "https://api.github.com/users/ZogStriP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZogStriP/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ZogStriP",
    "id": 362783,
    "node_id": "MDQ6VXNlcjM2Mjc4Mw==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/362783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZogStriP",
    "html_url": "https://github.com/ZogStriP",
    "followers_url": "https://api.github.com/users/ZogStriP/followers",
    "following_url": "https://api.github.com/users/ZogStriP/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZogStriP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZogStriP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZogStriP/subscriptions",
    "organizations_url": "https://api.github.com/users/ZogStriP/orgs",
    "repos_url": "https://api.github.com/users/ZogStriP/repos",
    "events_url": "https://api.github.com/users/ZogStriP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZogStriP/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "48ee8f2abcfd7d86fe4859192f6c88dcf1f67773",
      "url": "https://api.github.com/repos/discourse/discourse/commits/48ee8f2abcfd7d86fe4859192f6c88dcf1f67773",
      "html_url": "https://github.com/discourse/discourse/commit/48ee8f2abcfd7d86fe4859192f6c88dcf1f67773"
    }
  ],
  "stats": {
    "total": 4,
    "additions": 2,
    "deletions": 2
  },
  "files": [
    {
      "sha": "7f46f2c78c97b0727b0ee8718dde10633e9aa0e7",
      "filename": "app/models/topic_tracking_state.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/e3eb49729c2ae872741152376530794c7986d9e6/app/models/topic_tracking_state.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/e3eb49729c2ae872741152376530794c7986d9e6/app/models/topic_tracking_state.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/topic_tracking_state.rb?ref=e3eb49729c2ae872741152376530794c7986d9e6",
      "patch": "@@ -128,14 +128,14 @@ def self.publish_delete(topic)\n   end\n \n   def self.publish_read(topic_id, last_read_post_number, user_id, notification_level = nil)\n-    topic = Topic.select(:highest_post_number, :archetype, :id).find_by(id: topic_id)\n+    highest_post_number = DB.query_single(\"SELECT highest_post_number FROM topics WHERE id = ?\", topic_id).first\n \n     message = {\n       topic_id: topic_id,\n       message_type: \"read\",\n       payload: {\n         last_read_post_number: last_read_post_number,\n-        highest_post_number: topic.highest_post_number,\n+        highest_post_number: highest_post_number,\n         topic_id: topic_id,\n         notification_level: notification_level\n       }"
    }
  ]
}
