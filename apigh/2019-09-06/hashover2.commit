{
  "sha": "b79d524fc28af911ebaf588d30132d68b5f6ab79",
  "node_id": "MDY6Q29tbWl0MTgwOTYzMjI6Yjc5ZDUyNGZjMjhhZjkxMWViYWY1ODhkMzAxMzJkNjhiNWY2YWI3OQ==",
  "commit": {
    "author": {
      "name": "Jacob Barkdull",
      "email": "jacobbarkdull@gmail.com",
      "date": "2019-09-06T16:40:23Z"
    },
    "committer": {
      "name": "Jacob Barkdull",
      "email": "jacobbarkdull@gmail.com",
      "date": "2019-09-06T16:40:23Z"
    },
    "message": "Store language setting in processed form (en-us, de-de, etc)\n\nThis change allows the language setting to be set to just the first part of a locale code, the `de` in `de_DE` or the `eo` in `eo_EO`. To use a region-specific locale you will still need to set the language setting to the full locale code.",
    "tree": {
      "sha": "a773855d146a6a2d89270030cae6af4f941e661e",
      "url": "https://api.github.com/repos/jacobwb/hashover-next/git/trees/a773855d146a6a2d89270030cae6af4f941e661e"
    },
    "url": "https://api.github.com/repos/jacobwb/hashover-next/git/commits/b79d524fc28af911ebaf588d30132d68b5f6ab79",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEofOubkBFMHW68fO7nCRq6Ma+3AkFAl1yjNwACgkQnCRq6Ma+\n3AmIUg/6AxOQxk7cIKcupTPMTtKYeEQuue41HW59b+vhDHpjO2/eP/DbNvk37pEr\nXi0uiJ3DCib0nkH2EUFSAUPoxcz6XLD5/6wkUUxBCc46zbARegnpfU7NoTVwbVH7\n5B5HZL78ItwZYNvh/Yx0dMYWUTOImNTrxHw/obHiAAuVXqT7wnO16a9fPif+/UJ7\n1NZNI4YS/IeUFXF01bhE2j1NUM3tWHsLH/hsdnyIzwHAasZRIguvz8msNFDnUxSx\n7F6HZzNNNObRkTANCqHZ3anglPW7YOce5Bmnfdyh5+qIb31KPjm7rol7yom6aGP5\n6/hAuiPZTnlWTQm/rt4q+fO/g9Y6Zb/d3BF/pJMQxauQrqVxZAu3oOOmj4w0Va+n\nW74uY7Y4UHmYC7/lYN62VfC1ZXhtqCxT4ItvhF5e2DoXEJ4JQTtBpxkLzoOtH7Xn\n1gECIL8hl8GRL7qswCYMAVPf98C69FQSZpBHjj3joRZYBLBuo8ZtIQJfwwkNvOFl\n8uBONCyiN86sa0ROQg71FcXtVgZ9HdoQLKwTTOVKaHET858odSrBE0hHK1B4N1XW\nMiq8pSVS4otu+7jjOj28z0kSBnUFEG0F8n7bbOtO+CkQbQm8Ygc2egvviBUZtNgZ\nbxcO+WnP2pywaGewzu7R+XgGVQdu02SyL5ScgI18nyBvHpBxqhI=\n=4co5\n-----END PGP SIGNATURE-----",
      "payload": "tree a773855d146a6a2d89270030cae6af4f941e661e\nparent 0c7629d846691723e66043aad12d92b9187544d7\nauthor Jacob Barkdull <jacobbarkdull@gmail.com> 1567788023 -0700\ncommitter Jacob Barkdull <jacobbarkdull@gmail.com> 1567788023 -0700\n\nStore language setting in processed form (en-us, de-de, etc)\n\nThis change allows the language setting to be set to just the first part of a locale code, the `de` in `de_DE` or the `eo` in `eo_EO`. To use a region-specific locale you will still need to set the language setting to the full locale code.\n"
    }
  },
  "url": "https://api.github.com/repos/jacobwb/hashover-next/commits/b79d524fc28af911ebaf588d30132d68b5f6ab79",
  "html_url": "https://github.com/jacobwb/hashover-next/commit/b79d524fc28af911ebaf588d30132d68b5f6ab79",
  "comments_url": "https://api.github.com/repos/jacobwb/hashover-next/commits/b79d524fc28af911ebaf588d30132d68b5f6ab79/comments",
  "author": {
    "login": "jacobwb",
    "id": 4677622,
    "node_id": "MDQ6VXNlcjQ2Nzc2MjI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/4677622?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacobwb",
    "html_url": "https://github.com/jacobwb",
    "followers_url": "https://api.github.com/users/jacobwb/followers",
    "following_url": "https://api.github.com/users/jacobwb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacobwb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacobwb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacobwb/subscriptions",
    "organizations_url": "https://api.github.com/users/jacobwb/orgs",
    "repos_url": "https://api.github.com/users/jacobwb/repos",
    "events_url": "https://api.github.com/users/jacobwb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacobwb/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jacobwb",
    "id": 4677622,
    "node_id": "MDQ6VXNlcjQ2Nzc2MjI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/4677622?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacobwb",
    "html_url": "https://github.com/jacobwb",
    "followers_url": "https://api.github.com/users/jacobwb/followers",
    "following_url": "https://api.github.com/users/jacobwb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacobwb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacobwb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacobwb/subscriptions",
    "organizations_url": "https://api.github.com/users/jacobwb/orgs",
    "repos_url": "https://api.github.com/users/jacobwb/repos",
    "events_url": "https://api.github.com/users/jacobwb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacobwb/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0c7629d846691723e66043aad12d92b9187544d7",
      "url": "https://api.github.com/repos/jacobwb/hashover-next/commits/0c7629d846691723e66043aad12d92b9187544d7",
      "html_url": "https://github.com/jacobwb/hashover-next/commit/0c7629d846691723e66043aad12d92b9187544d7"
    }
  ],
  "stats": {
    "total": 53,
    "additions": 31,
    "deletions": 22
  },
  "files": [
    {
      "sha": "39e56e9e564630961d9ca074089cf3e1ccadf1dd",
      "filename": "admin/settings/index.php",
      "status": "modified",
      "additions": 16,
      "deletions": 17,
      "changes": 33,
      "blob_url": "https://github.com/jacobwb/hashover-next/blob/b79d524fc28af911ebaf588d30132d68b5f6ab79/admin/settings/index.php",
      "raw_url": "https://github.com/jacobwb/hashover-next/raw/b79d524fc28af911ebaf588d30132d68b5f6ab79/admin/settings/index.php",
      "contents_url": "https://api.github.com/repos/jacobwb/hashover-next/contents/admin/settings/index.php?ref=b79d524fc28af911ebaf588d30132d68b5f6ab79",
      "patch": "@@ -47,23 +47,22 @@ function ui_array (Setup $setup, Locale $locale)\n \t\t\t\t'value' => $setup->language,\n \n \t\t\t\t'options' => array (\n-\t\t\t\t\t'en_US' => 'English',\n-\t\t\t\t\t'pt_BR' => 'Brazilian Portuguese',\n-\t\t\t\t\t'da_DK' => 'Danish',\n-\t\t\t\t\t'nl_NL' => 'Dutch',\n-\t\t\t\t\t'eo_EO' => 'Esperanto',\n-\t\t\t\t\t'fr_FR' => 'French',\n-\t\t\t\t\t'de_DE' => 'German',\n-\t\t\t\t\t'el_EL' => 'Greek',\n-\t\t\t\t\t'ja_JP' => 'Japanese',\n-\t\t\t\t\t'ko_KR' => 'Korean',\n-\t\t\t\t\t'lt_LT' => 'Lithuanian',\n-\t\t\t\t\t'fa_IR' => 'Persian',\n-\t\t\t\t\t'pl_PL' => 'Polish',\n-\t\t\t\t\t'ro_RO' => 'Romanian',\n-\t\t\t\t\t'zh_CN' => 'Simplified Chinese',\n-\t\t\t\t\t'es_ES' => 'Spanish',\n-\t\t\t\t\t'tr_TR' => 'Turkish'\n+\t\t\t\t\t'en-us' => 'English',\n+\t\t\t\t\t'pt-br' => 'Brazilian Portuguese',\n+\t\t\t\t\t'da-dk' => 'Danish',\n+\t\t\t\t\t'nl-nl' => 'Dutch',\n+\t\t\t\t\t'fr-fr' => 'French',\n+\t\t\t\t\t'de-de' => 'German',\n+\t\t\t\t\t'el-el' => 'Greek',\n+\t\t\t\t\t'ja-jp' => 'Japanese',\n+\t\t\t\t\t'ko-kr' => 'Korean',\n+\t\t\t\t\t'lt-lt' => 'Lithuanian',\n+\t\t\t\t\t'fa-ir' => 'Persian',\n+\t\t\t\t\t'pl-pl' => 'Polish',\n+\t\t\t\t\t'ro-ro' => 'Romanian',\n+\t\t\t\t\t'zh-cn' => 'Simplified Chinese',\n+\t\t\t\t\t'es-es' => 'Spanish',\n+\t\t\t\t\t'tr-tr' => 'Turkish'\n \t\t\t\t)\n \t\t\t),\n "
    },
    {
      "sha": "611dacdb0db91a163b3bb5f3618d2b6f41966285",
      "filename": "backend/classes/locale.php",
      "status": "modified",
      "additions": 15,
      "deletions": 5,
      "changes": 20,
      "blob_url": "https://github.com/jacobwb/hashover-next/blob/b79d524fc28af911ebaf588d30132d68b5f6ab79/backend/classes/locale.php",
      "raw_url": "https://github.com/jacobwb/hashover-next/raw/b79d524fc28af911ebaf588d30132d68b5f6ab79/backend/classes/locale.php",
      "contents_url": "https://api.github.com/repos/jacobwb/hashover-next/contents/backend/classes/locale.php?ref=b79d524fc28af911ebaf588d30132d68b5f6ab79",
      "patch": "@@ -44,7 +44,7 @@ protected function getLocaleFile ()\n \t\t// Check if we are automatically selecting the locale\n \t\tif ($this->setup->language === 'auto') {\n \t\t\t// If so, get system locale\n-\t\t\t$ctype = mb_strtolower (setlocale (LC_CTYPE, 0));\n+\t\t\t$ctype = setlocale (LC_CTYPE, 0);\n \n \t\t\t// Split locale by encoding\n \t\t\t$ctype_parts = explode ('.', $ctype);\n@@ -56,14 +56,24 @@ protected function getLocaleFile ()\n \t\t\t$locale = $this->setup->language;\n \t\t}\n \n+\t\t// Convert current locale code to lowercase\n+\t\t$locale = mb_strtolower ($locale);\n+\n \t\t// Get path to locales directory\n \t\t$locales_path = $this->setup->getAbsolutePath ('backend/locales');\n \n-\t\t// Get dashed locale code (en-us, de-de, etc.)\n-\t\t$name = str_replace ('_', '-', mb_strtolower ($locale));\n+\t\t// Convert locale code to dashed format (en-us, de-de, etc.)\n+\t\tif (strpos ($locale, '_') !== false) {\n+\t\t\t$locale = str_replace ('_', '-', $locale);\n+\t\t}\n+\n+\t\t// Convert locale code to dashed format if it isn't hyphenated\n+\t\tif (strpos ($locale, '-') === false) {\n+\t\t\t$locale .= '-' . $locale;\n+\t\t}\n \n \t\t// Locale file path to try\n-\t\t$locale_file = $locales_path . '/' . $name . '.php';\n+\t\t$locale_file = $locales_path . '/' . $locale . '.php';\n \n \t\t// Try to use locale file for current locale\n \t\tif (file_exists ($locale_file)) {\n@@ -75,7 +85,7 @@ protected function getLocaleFile ()\n \t\t}\n \n \t\t// Otherwise, set language setting to English\n-\t\t$this->setup->language = 'en_US';\n+\t\t$this->setup->language = 'en-us';\n \n \t\t// And return path to English locale\n \t\treturn $locales_path . '/en-us.php';"
    }
  ]
}
