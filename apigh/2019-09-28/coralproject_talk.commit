{
  "sha": "e61e62a23883b3308751541a8c662e4c8c5ec25d",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6ZTYxZTYyYTIzODgzYjMzMDg3NTE1NDFhOGM2NjJlNGM4YzVlYzI1ZA==",
  "commit": {
    "author": {
      "name": "Tessa Thornton",
      "email": "tessathornton@gmail.com",
      "date": "2019-09-25T21:31:12Z"
    },
    "committer": {
      "name": "Wyatt Johnson",
      "email": "wyattjoh@gmail.com",
      "date": "2019-09-25T21:31:12Z"
    },
    "message": "[CORL-174] premod user (#2572)\n\n* add types for setting user premod\r\n\r\n* add types, fields, and mutations for user premod\r\n\r\n* enforce premoderation on users marked premod\r\n\r\n* add user premod to dropdown\r\n\r\n* update specs\r\n\r\n* fix tests\r\n\r\n* update premod workflow to match v4\r\n\r\n* allow user filtering by premod status\r\n\r\n* add premod user history to account actions drawer\r\n\r\n* update snaps\r\n\r\n* fix permissions on new premod fields\r\n\r\n* update strings\r\n\r\n* fix tests\r\n\r\n* clean up formatting and copy\r\n\r\n* fix: nullable fixes pre-migration",
    "tree": {
      "sha": "4267c08f68ffff5fa469bc35f1f249668896d392",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/4267c08f68ffff5fa469bc35f1f249668896d392"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/e61e62a23883b3308751541a8c662e4c8c5ec25d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/e61e62a23883b3308751541a8c662e4c8c5ec25d",
  "html_url": "https://github.com/coralproject/talk/commit/e61e62a23883b3308751541a8c662e4c8c5ec25d",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/e61e62a23883b3308751541a8c662e4c8c5ec25d/comments",
  "author": {
    "login": "tessalt",
    "id": 1789029,
    "node_id": "MDQ6VXNlcjE3ODkwMjk=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/1789029?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tessalt",
    "html_url": "https://github.com/tessalt",
    "followers_url": "https://api.github.com/users/tessalt/followers",
    "following_url": "https://api.github.com/users/tessalt/following{/other_user}",
    "gists_url": "https://api.github.com/users/tessalt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tessalt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tessalt/subscriptions",
    "organizations_url": "https://api.github.com/users/tessalt/orgs",
    "repos_url": "https://api.github.com/users/tessalt/repos",
    "events_url": "https://api.github.com/users/tessalt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tessalt/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "wyattjoh",
    "id": 633002,
    "node_id": "MDQ6VXNlcjYzMzAwMg==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/633002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wyattjoh",
    "html_url": "https://github.com/wyattjoh",
    "followers_url": "https://api.github.com/users/wyattjoh/followers",
    "following_url": "https://api.github.com/users/wyattjoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/wyattjoh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wyattjoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wyattjoh/subscriptions",
    "organizations_url": "https://api.github.com/users/wyattjoh/orgs",
    "repos_url": "https://api.github.com/users/wyattjoh/repos",
    "events_url": "https://api.github.com/users/wyattjoh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wyattjoh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a5c3e94751c1465c4411d036612836567d5805ea",
      "url": "https://api.github.com/repos/coralproject/talk/commits/a5c3e94751c1465c4411d036612836567d5805ea",
      "html_url": "https://github.com/coralproject/talk/commit/a5c3e94751c1465c4411d036612836567d5805ea"
    }
  ],
  "stats": {
    "total": 945,
    "additions": 916,
    "deletions": 29
  },
  "files": [
    {
      "sha": "68c0dc6ea50c5052b1e56ca3e244dcb73cdf2178",
      "filename": "src/core/client/admin/components/UserHistoryDrawer/AccountHistoryAction.tsx",
      "status": "modified",
      "additions": 9,
      "deletions": 2,
      "changes": 11,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/AccountHistoryAction.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/AccountHistoryAction.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserHistoryDrawer/AccountHistoryAction.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -1,14 +1,19 @@\n import React, { FunctionComponent } from \"react\";\n \n import BanAction, { BanActionProps } from \"./BanAction\";\n+import PremodAction, { PremodActionProps } from \"./PremodAction\";\n import SuspensionAction, { SuspensionActionProps } from \"./SuspensionAction\";\n import UsernameChangeAction, {\n   UsernameChangeActionProps,\n } from \"./UsernameChangeAction\";\n \n export interface HistoryActionProps {\n-  kind: \"username\" | \"suspension\" | \"ban\";\n-  action: UsernameChangeActionProps | SuspensionActionProps | BanActionProps;\n+  kind: \"username\" | \"suspension\" | \"ban\" | \"premod\";\n+  action:\n+    | UsernameChangeActionProps\n+    | SuspensionActionProps\n+    | BanActionProps\n+    | PremodActionProps;\n }\n \n const AccountHistoryAction: FunctionComponent<HistoryActionProps> = ({\n@@ -22,6 +27,8 @@ const AccountHistoryAction: FunctionComponent<HistoryActionProps> = ({\n       return <SuspensionAction {...action as SuspensionActionProps} />;\n     case \"ban\":\n       return <BanAction {...action as BanActionProps} />;\n+    case \"premod\":\n+      return <PremodAction {...action as PremodActionProps} />;\n     default:\n       return null;\n   }"
    },
    {
      "sha": "046fa800eab1c91ce7f05958c6c81b14f6754b02",
      "filename": "src/core/client/admin/components/UserHistoryDrawer/PremodAction.tsx",
      "status": "added",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/PremodAction.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/PremodAction.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserHistoryDrawer/PremodAction.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,19 @@\n+import { Localized } from \"fluent-react/compat\";\n+import React, { FunctionComponent } from \"react\";\n+\n+export interface PremodActionProps {\n+  action: \"created\" | \"removed\";\n+}\n+\n+const PremodAction: FunctionComponent<PremodActionProps> = ({ action }) =>\n+  action === \"created\" ? (\n+    <Localized id=\"moderate-user-drawer-account-history-premod-set\">\n+      <span>Set always premoderate</span>\n+    </Localized>\n+  ) : (\n+    <Localized id=\"moderate-user-drawer-account-history-premod-removed\">\n+      <span>Removed always premoderate</span>\n+    </Localized>\n+  );\n+\n+export default PremodAction;"
    },
    {
      "sha": "a3520dcf8b39a6a35279bef6e067267af46e5650",
      "filename": "src/core/client/admin/components/UserHistoryDrawer/UserDrawerAccountHistory.tsx",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/UserDrawerAccountHistory.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserHistoryDrawer/UserDrawerAccountHistory.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserHistoryDrawer/UserDrawerAccountHistory.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -107,6 +107,21 @@ const UserDrawerAccountHistory: FunctionComponent<Props> = ({ user }) => {\n       });\n     });\n \n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (user.status.premod) {\n+      // Merge in all the premod history items.\n+      user.status.premod.history.forEach(record => {\n+        history.push({\n+          kind: \"premod\",\n+          action: {\n+            action: record.active ? \"created\" : \"removed\",\n+          },\n+          date: new Date(record.createdAt),\n+          takenBy: record.createdBy ? record.createdBy.username : system,\n+        });\n+      });\n+    }\n+\n     user.status.username.history.forEach((record, i) => {\n       history.push({\n         kind: \"username\",\n@@ -190,6 +205,15 @@ const enhanced = withFragmentContainer<any>({\n             createdAt\n           }\n         }\n+        premod {\n+          history {\n+            active\n+            createdBy {\n+              username\n+            }\n+            createdAt\n+          }\n+        }\n         suspension {\n           history {\n             active"
    },
    {
      "sha": "a85052914a4b6954c6f70b4fc7d47246fbb011a6",
      "filename": "src/core/client/admin/components/UserStatus/PremodModal.css",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodModal.css",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodModal.css",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/PremodModal.css?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,3 @@\n+.card {\n+  max-width: 500px;\n+}\n\\ No newline at end of file"
    },
    {
      "sha": "830754cc54bd5accadd3f73218a2ecd35e805912",
      "filename": "src/core/client/admin/components/UserStatus/PremodModal.tsx",
      "status": "added",
      "additions": 79,
      "deletions": 0,
      "changes": 79,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodModal.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodModal.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/PremodModal.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,79 @@\n+import {\n+  Button,\n+  Card,\n+  CardCloseButton,\n+  Flex,\n+  HorizontalGutter,\n+  Modal,\n+  Typography,\n+} from \"coral-ui/components\";\n+import { Localized } from \"fluent-react/compat\";\n+import React, { FunctionComponent } from \"react\";\n+\n+import NotAvailable from \"coral-admin/components/NotAvailable\";\n+\n+import styles from \"./PremodModal.css\";\n+\n+interface Props {\n+  username: string | null;\n+  open: boolean;\n+  onClose: () => void;\n+  onConfirm: () => void;\n+}\n+\n+const PremodModal: FunctionComponent<Props> = ({\n+  open,\n+  onClose,\n+  onConfirm,\n+  username,\n+}) => {\n+  return (\n+    <Modal open={open} onClose={onClose} aria-labelledby=\"PremodModal-title\">\n+      {({ firstFocusableRef, lastFocusableRef }) => (\n+        <Card className={styles.card}>\n+          <CardCloseButton onClick={onClose} ref={firstFocusableRef} />\n+          <HorizontalGutter size=\"double\">\n+            <HorizontalGutter>\n+              <Localized\n+                id=\"community-premodModal-areYouSure\"\n+                strong={<strong />}\n+                $username={username || <NotAvailable />}\n+              >\n+                <Typography variant=\"header2\" id=\"PremodModal-title\">\n+                  Are you sure you want to always premoderate{\" \"}\n+                  <strong>{username || <NotAvailable />}</strong>?\n+                </Typography>\n+              </Localized>\n+              <Localized id=\"community-premodModal-consequence\">\n+                <Typography>\n+                  Note: Always premoderating this user will place all of their\n+                  comments in the Pre-Moderate queue.\n+                </Typography>\n+              </Localized>\n+            </HorizontalGutter>\n+            <Flex justifyContent=\"flex-end\" itemGutter>\n+              <Localized id=\"community-premodModal-cancel\">\n+                <Button variant=\"outlined\" onClick={onClose}>\n+                  Cancel\n+                </Button>\n+              </Localized>\n+\n+              <Localized id=\"community-premodModal-premodUser\">\n+                <Button\n+                  variant=\"filled\"\n+                  color=\"primary\"\n+                  onClick={onConfirm}\n+                  ref={lastFocusableRef}\n+                >\n+                  Yes, always premoderate user\n+                </Button>\n+              </Localized>\n+            </Flex>\n+          </HorizontalGutter>\n+        </Card>\n+      )}\n+    </Modal>\n+  );\n+};\n+\n+export default PremodModal;"
    },
    {
      "sha": "42b392dec51a0624686efcfc288f242164fb7855",
      "filename": "src/core/client/admin/components/UserStatus/PremodUserMutation.ts",
      "status": "added",
      "additions": 82,
      "deletions": 0,
      "changes": 82,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodUserMutation.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/PremodUserMutation.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/PremodUserMutation.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,82 @@\n+import { graphql } from \"react-relay\";\n+import { Environment } from \"relay-runtime\";\n+\n+import { PremodUserMutation as MutationTypes } from \"coral-admin/__generated__/PremodUserMutation.graphql\";\n+import { getViewer } from \"coral-framework/helpers\";\n+import {\n+  commitMutationPromiseNormalized,\n+  createMutation,\n+  lookup,\n+  MutationInput,\n+} from \"coral-framework/lib/relay\";\n+import { GQLUser, GQLUSER_STATUS } from \"coral-framework/schema\";\n+\n+let clientMutationId = 0;\n+\n+const PremodUserMutation = createMutation(\n+  \"premodUser\",\n+  (environment: Environment, input: MutationInput<MutationTypes>) => {\n+    const viewer = getViewer(environment)!;\n+    return commitMutationPromiseNormalized<MutationTypes>(environment, {\n+      mutation: graphql`\n+        mutation PremodUserMutation($input: PremodUserInput!) {\n+          premodUser(input: $input) {\n+            user {\n+              id\n+              status {\n+                current\n+                premod {\n+                  active\n+                  history {\n+                    active\n+                    createdAt\n+                    createdBy {\n+                      id\n+                      username\n+                    }\n+                  }\n+                }\n+              }\n+            }\n+            clientMutationId\n+          }\n+        }\n+      `,\n+      variables: {\n+        input: {\n+          ...input,\n+          clientMutationId: clientMutationId.toString(),\n+        },\n+      },\n+      optimisticResponse: {\n+        premodUser: {\n+          user: {\n+            id: input.userID,\n+            status: {\n+              current: lookup<GQLUser>(\n+                environment,\n+                input.userID\n+              )!.status.current.concat(GQLUSER_STATUS.PREMOD),\n+              premod: {\n+                active: true,\n+                history: [\n+                  {\n+                    active: true,\n+                    createdAt: new Date(),\n+                    createdBy: {\n+                      id: viewer.id,\n+                      username: viewer.username,\n+                    },\n+                  },\n+                ],\n+              },\n+            },\n+          },\n+          clientMutationId: (clientMutationId++).toString(),\n+        },\n+      },\n+    });\n+  }\n+);\n+\n+export default PremodUserMutation;"
    },
    {
      "sha": "02d1bbb5a3c34a819319e79367e619efa7ee8cc7",
      "filename": "src/core/client/admin/components/UserStatus/RemoveUserPremodMutation.ts",
      "status": "added",
      "additions": 82,
      "deletions": 0,
      "changes": 82,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/RemoveUserPremodMutation.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/RemoveUserPremodMutation.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/RemoveUserPremodMutation.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,82 @@\n+import { graphql } from \"react-relay\";\n+import { Environment } from \"relay-runtime\";\n+\n+import { RemoveUserPremodMutation as MutationTypes } from \"coral-admin/__generated__/RemoveUserPremodMutation.graphql\";\n+import { getViewer } from \"coral-framework/helpers\";\n+import {\n+  commitMutationPromiseNormalized,\n+  createMutation,\n+  lookup,\n+  MutationInput,\n+} from \"coral-framework/lib/relay\";\n+import { GQLUser, GQLUSER_STATUS } from \"coral-framework/schema\";\n+\n+let clientMutationId = 0;\n+\n+const RemoveUserPremodMutation = createMutation(\n+  \"removeUserPremod\",\n+  (environment: Environment, input: MutationInput<MutationTypes>) => {\n+    const viewer = getViewer(environment)!;\n+    return commitMutationPromiseNormalized<MutationTypes>(environment, {\n+      mutation: graphql`\n+        mutation RemoveUserPremodMutation($input: RemovePremodUserInput!) {\n+          removeUserPremod(input: $input) {\n+            user {\n+              id\n+              status {\n+                current\n+                premod {\n+                  active\n+                  history {\n+                    active\n+                    createdAt\n+                    createdBy {\n+                      id\n+                      username\n+                    }\n+                  }\n+                }\n+              }\n+            }\n+            clientMutationId\n+          }\n+        }\n+      `,\n+      variables: {\n+        input: {\n+          ...input,\n+          clientMutationId: clientMutationId.toString(),\n+        },\n+      },\n+      optimisticResponse: {\n+        removeUserPremod: {\n+          user: {\n+            id: input.userID,\n+            status: {\n+              current: lookup<GQLUser>(\n+                environment,\n+                input.userID\n+              )!.status.current.filter(s => s !== GQLUSER_STATUS.PREMOD),\n+              premod: {\n+                active: false,\n+                history: [\n+                  {\n+                    active: false,\n+                    createdAt: new Date(),\n+                    createdBy: {\n+                      id: viewer.id,\n+                      username: viewer.username,\n+                    },\n+                  },\n+                ],\n+              },\n+            },\n+          },\n+          clientMutationId: (clientMutationId++).toString(),\n+        },\n+      },\n+    });\n+  }\n+);\n+\n+export default RemoveUserPremodMutation;"
    },
    {
      "sha": "d80d68ff7cad6267102c099ed87dfad673627142",
      "filename": "src/core/client/admin/components/UserStatus/UserStatus.tsx",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatus.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatus.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/UserStatus.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -7,6 +7,7 @@ import { PropTypesOf } from \"coral-ui/types\";\n interface Props {\n   banned: boolean;\n   suspended: boolean;\n+  premod: boolean;\n }\n \n const render = (\n@@ -39,6 +40,15 @@ const UserStatus: FunctionComponent<Props> = props => {\n       </Localized>\n     );\n   }\n+  if (props.premod) {\n+    return render(\n+      \"warning\",\n+      // tslint:disable-next-line:jsx-wrap-multiline\n+      <Localized id=\"userStatus-premod\">\n+        <div>Always Premoderated</div>\n+      </Localized>\n+    );\n+  }\n   return render(\n     \"success\",\n     // tslint:disable-next-line:jsx-wrap-multiline"
    },
    {
      "sha": "bbbecd6bd712f4e8c4d1f52d0a2602519ccd1214",
      "filename": "src/core/client/admin/components/UserStatus/UserStatusChange.tsx",
      "status": "modified",
      "additions": 44,
      "deletions": 15,
      "changes": 59,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusChange.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusChange.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/UserStatusChange.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -18,8 +18,11 @@ interface Props {\n   onRemoveBan: () => void;\n   onSuspend: () => void;\n   onRemoveSuspension: () => void;\n+  onPremod: () => void;\n+  onRemovePremod: () => void;\n   banned: boolean;\n   suspended: boolean;\n+  premod: boolean;\n   children: React.ReactNode;\n   fullWidth?: boolean;\n }\n@@ -29,8 +32,11 @@ const UserStatusChange: FunctionComponent<Props> = ({\n   onRemoveBan,\n   onSuspend,\n   onRemoveSuspension,\n+  onPremod,\n+  onRemovePremod,\n   banned,\n   suspended,\n+  premod,\n   children,\n   fullWidth = true,\n }) => (\n@@ -42,55 +48,78 @@ const UserStatusChange: FunctionComponent<Props> = ({\n       body={({ toggleVisibility }) => (\n         <ClickOutside onClickOutside={toggleVisibility}>\n           <Dropdown>\n-            {!banned && (\n-              <Localized id=\"community-userStatus-banUser\">\n+            {banned ? (\n+              <Localized id=\"community-userStatus-removeUserBan\">\n+                <DropdownButton\n+                  className={styles.dropdownButton}\n+                  onClick={() => {\n+                    onRemoveBan();\n+                    toggleVisibility();\n+                  }}\n+                >\n+                  Remove ban\n+                </DropdownButton>\n+              </Localized>\n+            ) : (\n+              <Localized id=\"community-userStatus-ban\">\n                 <DropdownButton\n                   className={styles.dropdownButton}\n                   onClick={() => {\n                     onBan();\n                     toggleVisibility();\n                   }}\n                 >\n-                  Ban User\n+                  Ban\n                 </DropdownButton>\n               </Localized>\n             )}\n-            {banned && (\n-              <Localized id=\"community-userStatus-removeBan\">\n+            {suspended ? (\n+              <Localized id=\"community-userStatus-removeUserSuspension\">\n                 <DropdownButton\n                   className={styles.dropdownButton}\n                   onClick={() => {\n-                    onRemoveBan();\n+                    onRemoveSuspension();\n                     toggleVisibility();\n                   }}\n                 >\n-                  Remove Ban\n+                  Remove suspension\n                 </DropdownButton>\n               </Localized>\n-            )}\n-            {!suspended && (\n-              <Localized id=\"community-userStatus-suspendUser\">\n+            ) : (\n+              <Localized id=\"community-userStatus-suspend\">\n                 <DropdownButton\n                   className={styles.dropdownButton}\n                   onClick={() => {\n                     onSuspend();\n                     toggleVisibility();\n                   }}\n                 >\n-                  Suspend User\n+                  Suspend\n                 </DropdownButton>\n               </Localized>\n             )}\n-            {suspended && (\n-              <Localized id=\"community-userStatus-removeSuspension\">\n+            {premod ? (\n+              <Localized id=\"community-userStatus-removePremod\">\n                 <DropdownButton\n                   className={styles.dropdownButton}\n                   onClick={() => {\n-                    onRemoveSuspension();\n+                    onRemovePremod();\n+                    toggleVisibility();\n+                  }}\n+                >\n+                  Remove always pre-moderate\n+                </DropdownButton>\n+              </Localized>\n+            ) : (\n+              <Localized id=\"community-userStatus-premodUser\">\n+                <DropdownButton\n+                  className={styles.dropdownButton}\n+                  onClick={() => {\n+                    onPremod();\n                     toggleVisibility();\n                   }}\n                 >\n-                  Remove Suspension\n+                  Always pre-moderate\n                 </DropdownButton>\n               </Localized>\n             )}"
    },
    {
      "sha": "1dea6dd91208546eed6fa8dd409647a79af9e137",
      "filename": "src/core/client/admin/components/UserStatus/UserStatusChangeContainer.tsx",
      "status": "modified",
      "additions": 44,
      "deletions": 0,
      "changes": 44,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusChangeContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusChangeContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/UserStatusChangeContainer.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -12,7 +12,10 @@ import { GQLUSER_ROLE } from \"coral-framework/schema\";\n import ButtonPadding from \"../ButtonPadding\";\n import BanModal from \"./BanModal\";\n import BanUserMutation from \"./BanUserMutation\";\n+import PremodModal from \"./PremodModal\";\n+import PremodUserMutation from \"./PremodUserMutation\";\n import RemoveUserBanMutation from \"./RemoveUserBanMutation\";\n+import RemoveUserPremodMudtaion from \"./RemoveUserPremodMutation\";\n import RemoveUserSuspensionMutation from \"./RemoveUserSuspensionMutation\";\n import SuspendModal from \"./SuspendModal\";\n import SuspendUserMutation from \"./SuspendUserMutation\";\n@@ -31,6 +34,9 @@ const UserStatusChangeContainer: FunctionComponent<Props> = props => {\n   const suspendUser = useMutation(SuspendUserMutation);\n   const removeUserBan = useMutation(RemoveUserBanMutation);\n   const removeUserSuspension = useMutation(RemoveUserSuspensionMutation);\n+  const premodUser = useMutation(PremodUserMutation);\n+  const removeUserPremod = useMutation(RemoveUserPremodMudtaion);\n+  const [showPremod, setShowPremod] = useState<boolean>(false);\n   const [showBanned, setShowBanned] = useState<boolean>(false);\n   const [showSuspend, setShowSuspend] = useState<boolean>(false);\n   const [showSuspendSuccess, setShowSuspendSuccess] = useState<boolean>(false);\n@@ -59,6 +65,31 @@ const UserStatusChangeContainer: FunctionComponent<Props> = props => {\n     removeUserSuspension({ userID: user.id });\n   }, [user, removeUserSuspension]);\n \n+  const handlePremod = useCallback(() => {\n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (user.status.premod && user.status.premod.active) {\n+      return;\n+    }\n+    setShowPremod(true);\n+  }, [user, setShowPremod]);\n+\n+  const handlePremodConfirm = useCallback(() => {\n+    premodUser({ userID: user.id });\n+    setShowPremod(false);\n+  }, [premodUser, user, setShowPremod]);\n+\n+  const hidePremod = useCallback(() => {\n+    setShowPremod(false);\n+  }, [setShowPremod]);\n+\n+  const handleRemovePremod = useCallback(() => {\n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (!user.status.premod || !user.status.premod.active) {\n+      return;\n+    }\n+    removeUserPremod({ userID: user.id });\n+  }, [user, premodUser]);\n+\n   const handleSuspendModalClose = useCallback(() => {\n     setShowSuspend(false);\n     setShowSuspendSuccess(false);\n@@ -103,8 +134,12 @@ const UserStatusChangeContainer: FunctionComponent<Props> = props => {\n         onRemoveBan={handleRemoveBan}\n         onSuspend={handleSuspend}\n         onRemoveSuspension={handleRemoveSuspension}\n+        onPremod={handlePremod}\n+        onRemovePremod={handleRemovePremod}\n         banned={user.status.ban.active}\n         suspended={user.status.suspension.active}\n+        // FIXME: (wyattjoh) once migration has been performed, remove check\n+        premod={Boolean(user.status.premod && user.status.premod.active)}\n         fullWidth={fullWidth}\n       >\n         <UserStatusContainer user={user} />\n@@ -117,6 +152,12 @@ const UserStatusChangeContainer: FunctionComponent<Props> = props => {\n         organizationName={settings.organization.name}\n         onConfirm={handleSuspendConfirm}\n       />\n+      <PremodModal\n+        username={user.username}\n+        open={showPremod}\n+        onClose={hidePremod}\n+        onConfirm={handlePremodConfirm}\n+      />\n       <BanModal\n         username={user.username}\n         open={showBanned}\n@@ -140,6 +181,9 @@ const enhanced = withFragmentContainer<Props>({\n         suspension {\n           active\n         }\n+        premod {\n+          active\n+        }\n       }\n       ...UserStatusContainer_user\n     }"
    },
    {
      "sha": "09d003453ed4e0560b7732b366155733dceb513f",
      "filename": "src/core/client/admin/components/UserStatus/UserStatusContainer.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/components/UserStatus/UserStatusContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/UserStatus/UserStatusContainer.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -16,6 +16,7 @@ const UserStatusContainer: FunctionComponent<Props> = props => {\n     <UserStatus\n       banned={props.user.status.current.includes(GQLUSER_STATUS.BANNED)}\n       suspended={props.user.status.current.includes(GQLUSER_STATUS.SUSPENDED)}\n+      premod={props.user.status.current.includes(GQLUSER_STATUS.PREMOD)}\n     />\n   );\n };"
    },
    {
      "sha": "1a87c293b4537a24e601656329270a38b188bf9d",
      "filename": "src/core/client/admin/routes/Community/UserTableFilter.tsx",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/routes/Community/UserTableFilter.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/routes/Community/UserTableFilter.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Community/UserTableFilter.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -178,6 +178,11 @@ const UserTableFilter: FunctionComponent<Props> = props => (\n               <Localized id=\"userStatus-banned\">\n                 <Option value={GQLUSER_STATUS.BANNED}>Banned</Option>\n               </Localized>\n+              <Localized id=\"userStatus-premod\">\n+                <Option value={GQLUSER_STATUS.PREMOD}>\n+                  Always Premoderate\n+                </Option>\n+              </Localized>\n             </SelectField>\n           </Localized>\n         </Flex>"
    },
    {
      "sha": "179558b5743f419ace3d678a2bd05a18b5a19f09",
      "filename": "src/core/client/admin/test/community/__snapshots__/community.spec.tsx.snap",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/community/__snapshots__/community.spec.tsx.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/community/__snapshots__/community.spec.tsx.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/test/community/__snapshots__/community.spec.tsx.snap?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -166,6 +166,11 @@ exports[`renders community 1`] = `\n                 >\n                   Banned\n                 </option>\n+                <option\n+                  value=\"PREMOD\"\n+                >\n+                  Always pre-moderate\n+                </option>\n               </select>\n               <span\n                 aria-hidden={true}\n@@ -825,6 +830,11 @@ exports[`renders empty community 1`] = `\n                 >\n                   Banned\n                 </option>\n+                <option\n+                  value=\"PREMOD\"\n+                >\n+                  Always pre-moderate\n+                </option>\n               </select>\n               <span\n                 aria-hidden={true}"
    },
    {
      "sha": "42abd2498a4dd35ce6a0197af41eff799fb34cab",
      "filename": "src/core/client/admin/test/community/community.spec.tsx",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/community/community.spec.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/community/community.spec.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/test/community/community.spec.tsx?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -446,7 +446,7 @@ it(\"suspend user\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Suspend User\", { selector: \"button\" })\n+      .getByText(\"Suspend\", { selector: \"button\" })\n       .props.onClick();\n   });\n \n@@ -515,7 +515,7 @@ it(\"remove user suspension\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Remove Suspension\", { selector: \"button\" })\n+      .getByText(\"Remove suspension\", { selector: \"button\" })\n       .props.onClick();\n   });\n   expect(resolvers.Mutation!.removeUserSuspension!.called).toBe(true);\n@@ -566,7 +566,7 @@ it(\"suspend user with custom timeout\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Suspend User\", { selector: \"button\" })\n+      .getByText(\"Suspend\", { selector: \"button\" })\n       .props.onClick();\n   });\n \n@@ -632,7 +632,7 @@ it(\"suspend user with custom message\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Suspend User\", { selector: \"button\" })\n+      .getByText(\"Suspend\", { selector: \"button\" })\n       .props.onClick();\n   });\n \n@@ -704,7 +704,7 @@ it(\"ban user\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Ban User\", { selector: \"button\" })\n+      .getByText(\"Ban\", { selector: \"button\" })\n       .props.onClick();\n   });\n \n@@ -767,7 +767,7 @@ it(\"ban user with custom message\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Ban User\", { selector: \"button\" })\n+      .getByText(\"Ban\", { selector: \"button\" })\n       .props.onClick();\n   });\n \n@@ -853,7 +853,7 @@ it(\"remove user ban\", async () => {\n \n   TestRenderer.act(() => {\n     within(popup)\n-      .getByText(\"Remove Ban\", { selector: \"button\" })\n+      .getByText(\"Remove ban\", { selector: \"button\" })\n       .props.onClick();\n   });\n "
    },
    {
      "sha": "8df673d5fa5b566eca2012e2850accb3b6466d19",
      "filename": "src/core/client/admin/test/fixtures.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/fixtures.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/admin/test/fixtures.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/test/fixtures.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -321,6 +321,10 @@ export const baseUser = createFixture<GQLUser>({\n       active: false,\n       history: [],\n     },\n+    premod: {\n+      active: false,\n+      history: [],\n+    },\n   },\n });\n "
    },
    {
      "sha": "0874ef9c57a098801260654b3192f2823dc8b4bb",
      "filename": "src/core/client/stream/test/helpers/fixture.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/stream/test/helpers/fixture.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/stream/test/helpers/fixture.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/test/helpers/fixture.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -40,6 +40,10 @@ export function createUserStatus(banned: boolean = false): GQLUserStatus {\n     username: {\n       history: [],\n     },\n+    premod: {\n+      active: false,\n+      history: [],\n+    },\n   };\n }\n "
    },
    {
      "sha": "39988f4864bc9424445bc441527eb3f38043a11a",
      "filename": "src/core/client/test/helpers/fixture.ts",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/test/helpers/fixture.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/client/test/helpers/fixture.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/test/helpers/fixture.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -39,6 +39,10 @@ export function createUserStatus(banned: boolean = false) {\n       until: null,\n       history: [],\n     },\n+    premod: {\n+      active: false,\n+      history: [],\n+    },\n   };\n }\n \n@@ -143,6 +147,7 @@ export function createComment(author?: GQLUser) {\n           COMMENT_DETECTED_LINKS: 0,\n           COMMENT_DETECTED_BANNED_WORD: 0,\n           COMMENT_DETECTED_SUSPECT_WORD: 0,\n+          COMMENT_DETECTED_PREMOD_USER: 0,\n         },\n       },\n     },"
    },
    {
      "sha": "4405b25c673f520eecd283b7bcbfe2e0ab6c3598",
      "filename": "src/core/common/errors.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/common/errors.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/common/errors.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/common/errors.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -314,4 +314,6 @@ export enum ERROR_CODES {\n    * all non-admin users.\n    */\n   RAW_QUERY_NOT_AUTHORIZED = \"RAW_QUERY_NOT_AUTHORIZED\",\n+\n+  USER_ALREADY_PREMOD = \"USER_ALREADY_PREMOD\",\n }"
    },
    {
      "sha": "b60eddf5220114681aeaf5acf1c4713fe1e5b84f",
      "filename": "src/core/server/errors/index.ts",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/errors/index.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/errors/index.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/errors/index.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -593,6 +593,14 @@ export class UserAlreadySuspendedError extends CoralError {\n   }\n }\n \n+export class UserAlreadyPremoderated extends CoralError {\n+  constructor() {\n+    super({\n+      code: ERROR_CODES.USER_ALREADY_PREMOD,\n+    });\n+  }\n+}\n+\n export class UserAlreadyBannedError extends CoralError {\n   constructor() {\n     super({"
    },
    {
      "sha": "b990bbbf24b5663fe252a5e7050b6720184ea8dc",
      "filename": "src/core/server/errors/translations.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/errors/translations.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/errors/translations.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/errors/translations.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -54,4 +54,5 @@ export const ERROR_TRANSLATIONS: Record<ERROR_CODES, string> = {\n   USERNAME_UPDATED_WITHIN_WINDOW: \"error-usernameAlreadyUpdated\",\n   PERSISTED_QUERY_NOT_FOUND: \"error-persistedQueryNotFound\",\n   RAW_QUERY_NOT_AUTHORIZED: \"error-rawQueryNotAuthorized\",\n+  USER_ALREADY_PREMOD: \"error-userAlreadyPremod\",\n };"
    },
    {
      "sha": "0189ea50c09429e100219940fb33bebe75345dcc",
      "filename": "src/core/server/graph/tenant/loaders/Users.ts",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/loaders/Users.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/loaders/Users.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/loaders/Users.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -40,6 +40,7 @@ const statusFilter = (\n     case GQLUSER_STATUS.ACTIVE:\n       return {\n         \"status.ban.active\": false,\n+        \"status.premod.active\": false,\n         \"status.suspension.history\": {\n           $not: {\n             $elemMatch: {\n@@ -55,6 +56,8 @@ const statusFilter = (\n       };\n     case GQLUSER_STATUS.BANNED:\n       return { \"status.ban.active\": true };\n+    case GQLUSER_STATUS.PREMOD:\n+      return { \"status.premod.active\": true };\n     case GQLUSER_STATUS.SUSPENDED:\n       return {\n         \"status.suspension.history\": {"
    },
    {
      "sha": "9020bf2fccb2e8b9c53f62baacb95f5b3105e457",
      "filename": "src/core/server/graph/tenant/mutators/Users.ts",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/mutators/Users.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/mutators/Users.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/mutators/Users.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -8,8 +8,10 @@ import {\n   createToken,\n   deactivateToken,\n   ignore,\n+  premod,\n   removeBan,\n   removeIgnore,\n+  removePremod,\n   removeSuspension,\n   requestAccountDeletion,\n   requestCommentsDownload,\n@@ -38,6 +40,8 @@ import {\n   GQLDeleteUserAccountInput,\n   GQLIgnoreUserInput,\n   GQLInviteUsersInput,\n+  GQLPremodUserInput,\n+  GQLRemovePremodUserInput,\n   GQLRemoveUserBanInput,\n   GQLRemoveUserIgnoreInput,\n   GQLRemoveUserSuspensionInput,\n@@ -209,6 +213,8 @@ export const Users = (ctx: TenantContext) => ({\n       input.message,\n       ctx.now\n     ),\n+  premodUser: async (input: GQLPremodUserInput) =>\n+    premod(ctx.mongo, ctx.tenant, ctx.user!, input.userID, ctx.now),\n   suspend: async (input: GQLSuspendUserInput) =>\n     suspend(\n       ctx.mongo,\n@@ -224,6 +230,8 @@ export const Users = (ctx: TenantContext) => ({\n     removeBan(ctx.mongo, ctx.tenant, ctx.user!, input.userID, ctx.now),\n   removeSuspension: async (input: GQLRemoveUserSuspensionInput) =>\n     removeSuspension(ctx.mongo, ctx.tenant, ctx.user!, input.userID, ctx.now),\n+  removeUserPremod: async (input: GQLRemovePremodUserInput) =>\n+    removePremod(ctx.mongo, ctx.tenant, ctx.user!, input.userID, ctx.now),\n   ignore: async (input: GQLIgnoreUserInput) =>\n     ignore(ctx.mongo, ctx.tenant, ctx.user!, input.userID, ctx.now),\n   removeIgnore: async (input: GQLRemoveUserIgnoreInput) =>"
    },
    {
      "sha": "d5f23edd2132b7e81310e4865804e6c82e7fcd39",
      "filename": "src/core/server/graph/tenant/resolvers/Mutation.ts",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/Mutation.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/Mutation.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/resolvers/Mutation.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -181,6 +181,14 @@ export const Mutation: Required<GQLMutationTypeResolver<void>> = {\n     user: await ctx.mutators.Users.suspend(input),\n     clientMutationId: input.clientMutationId,\n   }),\n+  premodUser: async (source, { input }, ctx) => ({\n+    user: await ctx.mutators.Users.premodUser(input),\n+    clientMutationId: input.clientMutationId,\n+  }),\n+  removeUserPremod: async (source, { input }, ctx) => ({\n+    user: await ctx.mutators.Users.removeUserPremod(input),\n+    clientMutationId: input.clientMutationId,\n+  }),\n   removeUserSuspension: async (source, { input }, ctx) => ({\n     user: await ctx.mutators.Users.removeSuspension(input),\n     clientMutationId: input.clientMutationId,"
    },
    {
      "sha": "c2522a38b785aef3aedf90f8b55f01467c29ae63",
      "filename": "src/core/server/graph/tenant/resolvers/PremodStatus.ts",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/PremodStatus.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/PremodStatus.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/resolvers/PremodStatus.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,14 @@\n+import { GQLPremodStatusTypeResolver } from \"coral-server/graph/tenant/schema/__generated__/types\";\n+import * as user from \"coral-server/models/user\";\n+\n+export type PremodStatusInput = user.ConsolidatedPremodStatus & {\n+  userID: string;\n+};\n+\n+export const PremodStatus: Required<\n+  GQLPremodStatusTypeResolver<PremodStatusInput>\n+> = {\n+  active: ({ active }) => active,\n+  history: ({ history, userID }) =>\n+    history.map(status => ({ ...status, userID })),\n+};"
    },
    {
      "sha": "44d8557a97332a5c52fba79ef51dadd1702b53eb",
      "filename": "src/core/server/graph/tenant/resolvers/PremodStatusHistory.ts",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/PremodStatusHistory.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/PremodStatusHistory.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/resolvers/PremodStatusHistory.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,16 @@\n+import { GQLPremodStatusHistoryTypeResolver } from \"coral-server/graph/tenant/schema/__generated__/types\";\n+import * as user from \"coral-server/models/user\";\n+\n+export const PremodStatusHistory: Required<\n+  GQLPremodStatusHistoryTypeResolver<user.PremodStatusHistory>\n+> = {\n+  active: ({ active }) => active,\n+  createdBy: ({ createdBy }, input, ctx) => {\n+    if (createdBy) {\n+      return ctx.loaders.Users.user.load(createdBy);\n+    }\n+\n+    return null;\n+  },\n+  createdAt: ({ createdAt }) => createdAt,\n+};"
    },
    {
      "sha": "568d24a32211e8e50a30dd7162fd9f3bb428845d",
      "filename": "src/core/server/graph/tenant/resolvers/UserStatus.ts",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/UserStatus.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/UserStatus.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/resolvers/UserStatus.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -5,6 +5,7 @@ import {\n import * as user from \"coral-server/models/user\";\n \n import { BanStatusInput } from \"./BanStatus\";\n+import { PremodStatusInput } from \"./PremodStatus\";\n import { SuspensionStatusInput } from \"./SuspensionStatus\";\n import { UsernameStatusInput } from \"./UsernameStatus\";\n \n@@ -29,6 +30,12 @@ export const UserStatus: Required<\n       statuses.push(GQLUSER_STATUS.SUSPENDED);\n     }\n \n+    // If they are set to mandatory premod, then mark it.\n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (consolidatedStatus.premod && consolidatedStatus.premod.active) {\n+      statuses.push(GQLUSER_STATUS.PREMOD);\n+    }\n+\n     // If no other statuses were applied, then apply the active status.\n     if (statuses.length === 0) {\n       statuses.push(GQLUSER_STATUS.ACTIVE);\n@@ -48,4 +55,17 @@ export const UserStatus: Required<\n     ...user.consolidateUserSuspensionStatus(suspension),\n     userID,\n   }),\n+  // FIXME: (wyattjoh) once migration has been performed, return PremodStatusInput only\n+  premod: ({ premod, userID }): PremodStatusInput | null => {\n+    const status = user.consolidateUserPremodStatus(premod);\n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (!status) {\n+      return null;\n+    }\n+\n+    return {\n+      ...status,\n+      userID,\n+    };\n+  },\n };"
    },
    {
      "sha": "80f2e922e41b6d3b57b30440ec6bc35ba4f02e8d",
      "filename": "src/core/server/graph/tenant/resolvers/index.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/index.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/resolvers/index.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/resolvers/index.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -29,6 +29,8 @@ import { ModerationQueue } from \"./ModerationQueue\";\n import { ModerationQueues } from \"./ModerationQueues\";\n import { Mutation } from \"./Mutation\";\n import { OIDCAuthIntegration } from \"./OIDCAuthIntegration\";\n+import { PremodStatus } from \"./PremodStatus\";\n+import { PremodStatusHistory } from \"./PremodStatusHistory\";\n import { Profile } from \"./Profile\";\n import { Query } from \"./Query\";\n import { RecentCommentHistory } from \"./RecentCommentHistory\";\n@@ -72,6 +74,8 @@ const Resolvers: GQLResolver = {\n   ModerationQueues,\n   Mutation,\n   OIDCAuthIntegration,\n+  PremodStatus,\n+  PremodStatusHistory,\n   Profile,\n   Query,\n   RecentCommentHistory,"
    },
    {
      "sha": "8f6c089f0b171e45abcd948a8258aee0f430f7e3",
      "filename": "src/core/server/graph/tenant/schema/schema.graphql",
      "status": "modified",
      "additions": 116,
      "deletions": 1,
      "changes": 117,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/schema/schema.graphql",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/graph/tenant/schema/schema.graphql",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/schema/schema.graphql?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -141,6 +141,11 @@ enum COMMENT_FLAG_DETECTED_REASON {\n   recent history of rejected comments.\n   \"\"\"\n   COMMENT_DETECTED_RECENT_HISTORY\n+\n+  \"\"\"\n+  COMMENT_DETECTED_PREMOD_USER is used when a Comment author has been tagged as requiring premoderation\n+  \"\"\"\n+  COMMENT_DETECTED_PREMOD_USER\n }\n \n \"\"\"\n@@ -157,6 +162,7 @@ enum COMMENT_FLAG_REASON {\n   COMMENT_DETECTED_BANNED_WORD\n   COMMENT_DETECTED_SUSPECT_WORD\n   COMMENT_DETECTED_RECENT_HISTORY\n+  COMMENT_DETECTED_PREMOD_USER\n }\n \n \"\"\"\n@@ -191,6 +197,7 @@ type FlagReasonActionCounts {\n   COMMENT_DETECTED_BANNED_WORD: Int!\n   COMMENT_DETECTED_SUSPECT_WORD: Int!\n   COMMENT_DETECTED_RECENT_HISTORY: Int!\n+  COMMENT_DETECTED_PREMOD_USER: Int!\n }\n \n type Flag {\n@@ -1440,6 +1447,34 @@ type SuspensionStatus {\n   history: [SuspensionStatusHistory!]! @auth(roles: [ADMIN, MODERATOR])\n }\n \n+type PremodStatusHistory {\n+  \"\"\"\n+  active when true, indicates that the given user is premodded.\n+  \"\"\"\n+  active: Boolean!\n+  \"\"\"\n+  createdBy is the user that flagged the commenter as pre-mod\n+  \"\"\"\n+  createdBy: User!\n+\n+  \"\"\"\n+  createdAt is the time the user was set to pre-mod\n+  \"\"\"\n+  createdAt: Time!\n+}\n+\n+type PremodStatus {\n+  \"\"\"\n+  active when true, indicates that the given user is set to pre-mod.\n+  \"\"\"\n+  active: Boolean!\n+\n+  \"\"\"\n+  history is the list of all suspension events against a specific User.\n+  \"\"\"\n+  history: [PremodStatusHistory!]!\n+}\n+\n type UsernameHistory {\n   \"\"\"\n   username is the username that was assigned\n@@ -1503,6 +1538,13 @@ type UserStatus {\n   changes.\n   \"\"\"\n   suspension: SuspensionStatus!\n+\n+  \"\"\"\n+  premod stores the user premod status as well as the history of changes.\n+\n+  FIXME: (wyattjoh) once migration has been performed, make non-nullable\n+  \"\"\"\n+  premod: PremodStatus @auth(roles: [ADMIN, MODERATOR])\n }\n \n \"\"\"\n@@ -1524,6 +1566,11 @@ enum USER_STATUS {\n   SUSPENDED is used when a User is currently suspended.\n   \"\"\"\n   SUSPENDED\n+\n+  \"\"\"\n+  PREMOD is used when a User is currently set to require pre-moderation.\n+  \"\"\"\n+  PREMOD\n }\n \n enum DIGEST_FREQUENCY {\n@@ -4771,6 +4818,62 @@ type RemoveUserSuspensionPayload {\n   clientMutationId: String!\n }\n \n+##################\n+# premodUser\n+##################\n+\n+input PremodUserInput {\n+  \"\"\"\n+  userID is the ID of the User that should be premodded.\n+  \"\"\"\n+  userID: ID!\n+\n+  \"\"\"\n+  clientMutationId is required for Relay support.\n+  \"\"\"\n+  clientMutationId: String!\n+}\n+\n+type PremodUserPayload {\n+  \"\"\"\n+  user is the possibly modified User.\n+  \"\"\"\n+  user: User!\n+\n+  \"\"\"\n+  clientMutationId is required for Relay support.\n+  \"\"\"\n+  clientMutationId: String!\n+}\n+\n+##################\n+# removePremod\n+##################\n+\n+input RemovePremodUserInput {\n+  \"\"\"\n+  userID is the ID of the User that should be premodded.\n+  \"\"\"\n+  userID: ID!\n+\n+  \"\"\"\n+  clientMutationId is required for Relay support.\n+  \"\"\"\n+  clientMutationId: String!\n+}\n+\n+type RemovePremodUserPayload {\n+  \"\"\"\n+  user is the possibly modified User.\n+  \"\"\"\n+  user: User!\n+\n+  \"\"\"\n+  clientMutationId is required for Relay support.\n+  \"\"\"\n+  clientMutationId: String!\n+}\n+\n ##################\n # ignoreUser\n ##################\n@@ -5196,6 +5299,18 @@ type Mutation {\n   requestUserCommentsDownload(\n     input: RequestUserCommentsDownloadInput!\n   ): RequestUserCommentsDownloadPayload! @auth(roles: [ADMIN])\n+\n+  \"\"\"\n+  premodUser sets a user to mandatory premod\n+  \"\"\"\n+  premodUser(input: PremodUserInput!): PremodUserPayload!\n+    @auth(roles: [ADMIN, MODERATOR])\n+\n+  \"\"\"\n+  removeUserPremod removes a user from mandatory premod\n+  \"\"\"\n+  removeUserPremod(input: RemovePremodUserInput!): RemovePremodUserPayload!\n+    @auth(roles: [ADMIN, MODERATOR])\n }\n \n ##################\n@@ -5367,7 +5482,7 @@ type Subscription {\n   commentReleased returns when a Comment on a premoderated stream is approved\n   \"\"\"\n   commentReleased(storyID: ID!): CommentReleasedPayload!\n-  \n+\n   \"\"\"\n   commentReplyCreated returns when a Comment is posted in the ancestor chain of\n   comments."
    },
    {
      "sha": "7dd9099dad5e855b6ae8793c1e14549f98e12d73",
      "filename": "src/core/server/models/action/__snapshots__/comment.spec.ts.snap",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/models/action/__snapshots__/comment.spec.ts.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/models/action/__snapshots__/comment.spec.ts.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/action/__snapshots__/comment.spec.ts.snap?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -19,6 +19,7 @@ Object {\n     \"reasons\": Object {\n       \"COMMENT_DETECTED_BANNED_WORD\": 1,\n       \"COMMENT_DETECTED_LINKS\": 0,\n+      \"COMMENT_DETECTED_PREMOD_USER\": 0,\n       \"COMMENT_DETECTED_RECENT_HISTORY\": 0,\n       \"COMMENT_DETECTED_SPAM\": 0,\n       \"COMMENT_DETECTED_SUSPECT_WORD\": 0,"
    },
    {
      "sha": "ea25400e4b07574180b2efd65406202aa6cfb848",
      "filename": "src/core/server/models/user/user.ts",
      "status": "modified",
      "additions": 183,
      "deletions": 4,
      "changes": 187,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/models/user/user.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/models/user/user.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/user/user.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -14,13 +14,15 @@ import {\n   PasswordResetTokenExpired,\n   TokenNotFoundError,\n   UserAlreadyBannedError,\n+  UserAlreadyPremoderated,\n   UserAlreadySuspendedError,\n   UsernameAlreadySetError,\n   UserNotFoundError,\n } from \"coral-server/errors\";\n import {\n   GQLBanStatus,\n   GQLDIGEST_FREQUENCY,\n+  GQLPremodStatus,\n   GQLSuspensionStatus,\n   GQLTimeRange,\n   GQLUSER_ROLE,\n@@ -236,6 +238,42 @@ export interface UsernameStatus {\n   history: UsernameHistory[];\n }\n \n+/**\n+ * PremodStatusHistory is the history of premod status changes\n+ * against a specific User.\n+ */\n+export interface PremodStatusHistory {\n+  /**\n+   * active when true, indicates that the given user is premodded.\n+   */\n+  active: boolean;\n+  /**\n+   * createdBy is the ID for the User that premodded the User. If `null`, the\n+   * premod was created by the system.\n+   */\n+  createdBy?: string;\n+\n+  /**\n+   * createdAt is the time that the given premod status was set.\n+   */\n+  createdAt: Date;\n+}\n+\n+/**\n+ * PremodStatus is the status of whether a user is set to mandatory premod\n+ */\n+export interface PremodStatus {\n+  /**\n+   * active when true, indicates that the given user is set to mandatory premod.\n+   */\n+  active: boolean;\n+\n+  /**\n+   * history is a list of previous enable/disable of premod status\n+   */\n+  history: PremodStatusHistory[];\n+}\n+\n /**\n  * UserStatus stores the user status information regarding moderation state.\n  */\n@@ -255,6 +293,14 @@ export interface UserStatus {\n    * username stores the history of username changes for this user.\n    */\n   username: UsernameStatus;\n+\n+  /**\n+   * premod stores whether a user is set to mandatory premod and history of\n+   * premod status.\n+   *\n+   * FIXME: (wyattjoh) set defaults during migration\n+   */\n+  premod?: PremodStatus;\n }\n \n /**\n@@ -503,6 +549,7 @@ async function findOrCreateUserInput(\n       },\n       suspension: { history: [] },\n       ban: { active: false, history: [] },\n+      premod: { active: false, history: [] },\n     },\n     notifications: {\n       onReply: false,\n@@ -1358,6 +1405,130 @@ async function retrieveConnection(\n   return resolveConnection(query, input, user => user.createdAt);\n }\n \n+/**\n+ * premodUser will set a user to mandatory premod.\n+ *\n+ * @param mongo the mongo database handle\n+ * @param tenantID the Tenant's ID where the User exists\n+ * @param id the ID of the user being banned\n+ * @param createdBy the ID of the user premodding\n+ * @param now the current date\n+ */\n+export async function premodUser(\n+  mongo: Db,\n+  tenantID: string,\n+  id: string,\n+  createdBy: string,\n+  now = new Date()\n+) {\n+  // Create the new ban.\n+  const premodStatusHistory: PremodStatusHistory = {\n+    active: true,\n+    createdBy,\n+    createdAt: now,\n+  };\n+\n+  // Try to update the user if the user isn't already banned.\n+  const result = await collection(mongo).findOneAndUpdate(\n+    {\n+      id,\n+      tenantID,\n+      \"status.premod.active\": {\n+        $ne: true,\n+      },\n+    },\n+    {\n+      $set: {\n+        \"status.premod.active\": true,\n+      },\n+      $push: {\n+        \"status.premod.history\": premodStatusHistory,\n+      },\n+    },\n+    {\n+      // False to return the updated document instead of the original\n+      // document.\n+      returnOriginal: false,\n+    }\n+  );\n+  if (!result.value) {\n+    // Get the user so we can figure out why the ban operation failed.\n+    const user = await retrieveUser(mongo, tenantID, id);\n+    if (!user) {\n+      throw new UserNotFoundError(id);\n+    }\n+\n+    // Check to see if the user is already banned.\n+    const premod = consolidateUserPremodStatus(user.status.premod);\n+    // FIXME: (wyattjoh) once migration has been performed, remove check\n+    if (premod && premod.active) {\n+      throw new UserAlreadyPremoderated();\n+    }\n+\n+    throw new Error(\"an unexpected error occurred\");\n+  }\n+\n+  return result.value;\n+}\n+\n+/**\n+ * removeUserPremod will lift a user premod  requirement\n+ * @param mongo the mongo database handle\n+ * @param tenantID the Tenant's ID where the User exists\n+ * @param id the ID of the user having their ban lifted\n+ * @param modifiedBy the ID of the user lifting the premod\n+ * @param now the current date\n+ */\n+export async function removeUserPremod(\n+  mongo: Db,\n+  tenantID: string,\n+  id: string,\n+  createdBy: string,\n+  now = new Date()\n+) {\n+  // Create the new ban.\n+  const premod: PremodStatusHistory = {\n+    active: false,\n+    createdBy,\n+    createdAt: now,\n+  };\n+\n+  // Try to update the user if the user isn't already banned.\n+  const result = await collection(mongo).findOneAndUpdate(\n+    {\n+      id,\n+      tenantID,\n+      \"status.premod.active\": true,\n+    },\n+    {\n+      $set: {\n+        \"status.premod.active\": false,\n+      },\n+      $push: {\n+        \"status.premod.history\": premod,\n+      },\n+    },\n+    {\n+      // False to return the updated document instead of the original\n+      // document.\n+      returnOriginal: false,\n+    }\n+  );\n+\n+  if (!result.value) {\n+    // Get the user so we can figure out why the ban operation failed.\n+    const user = await retrieveUser(mongo, tenantID, id);\n+    if (!user) {\n+      throw new UserNotFoundError(id);\n+    }\n+\n+    // The user wasn't banned already, so nothing needs to be done!\n+    return user;\n+  }\n+\n+  return result.value;\n+}\n+\n /**\n  * banUser will ban a specific user from interacting with the site.\n  *\n@@ -1651,18 +1822,23 @@ export type ConsolidatedBanStatus = Omit<GQLBanStatus, \"history\"> &\n export type ConsolidatedUsernameStatus = Omit<GQLUsernameStatus, \"history\"> &\n   Pick<UsernameStatus, \"history\">;\n \n+export type ConsolidatedPremodStatus = Omit<GQLPremodStatus, \"history\"> &\n+  Pick<PremodStatus, \"history\">;\n+\n export function consolidateUsernameStatus(\n   username: User[\"status\"][\"username\"]\n-): ConsolidatedUsernameStatus {\n+) {\n   return username;\n }\n \n-export function consolidateUserBanStatus(\n-  ban: User[\"status\"][\"ban\"]\n-): ConsolidatedBanStatus {\n+export function consolidateUserBanStatus(ban: User[\"status\"][\"ban\"]) {\n   return ban;\n }\n \n+export function consolidateUserPremodStatus(premod: User[\"status\"][\"premod\"]) {\n+  return premod;\n+}\n+\n export type ConsolidatedSuspensionStatus = Omit<\n   GQLSuspensionStatus,\n   \"history\"\n@@ -1697,6 +1873,8 @@ export function consolidateUserSuspensionStatus(\n export interface ConsolidatedUserStatus {\n   suspension: ConsolidatedSuspensionStatus;\n   ban: ConsolidatedBanStatus;\n+  // FIXME: (wyattjoh) once migration has been performed, make required\n+  premod?: ConsolidatedPremodStatus;\n }\n \n export function consolidateUserStatus(\n@@ -1707,6 +1885,7 @@ export function consolidateUserStatus(\n   return {\n     suspension: consolidateUserSuspensionStatus(status.suspension, now),\n     ban: consolidateUserBanStatus(status.ban),\n+    premod: consolidateUserPremodStatus(status.premod),\n   };\n }\n "
    },
    {
      "sha": "96e8f958ef2e126c9b6ebc7ca584e045980aee0e",
      "filename": "src/core/server/services/comments/pipeline/phases/index.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/comments/pipeline/phases/index.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/comments/pipeline/phases/index.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/comments/pipeline/phases/index.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -5,6 +5,7 @@ import { commentLength } from \"./commentLength\";\n import { detectLinks } from \"./detectLinks\";\n import { linkify } from \"./linkify\";\n import { preModerate } from \"./preModerate\";\n+import { premodUser } from \"./preModerateUser\";\n import { purify } from \"./purify\";\n import { recentCommentHistory } from \"./recentCommentHistory\";\n import { spam } from \"./spam\";\n@@ -29,4 +30,5 @@ export const moderationPhases: IntermediateModerationPhase[] = [\n   spam,\n   detectLinks,\n   preModerate,\n+  premodUser,\n ];"
    },
    {
      "sha": "c375d5d86d90c922d2840dcacd2523e7e066ca06",
      "filename": "src/core/server/services/comments/pipeline/phases/preModerateUser.ts",
      "status": "added",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/comments/pipeline/phases/preModerateUser.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/comments/pipeline/phases/preModerateUser.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/comments/pipeline/phases/preModerateUser.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -0,0 +1,17 @@\n+import { GQLCOMMENT_STATUS } from \"coral-server/graph/tenant/schema/__generated__/types\";\n+import {\n+  IntermediateModerationPhase,\n+  IntermediatePhaseResult,\n+} from \"coral-server/services/comments/pipeline\";\n+\n+// If a given user is set to always premod, set to premod.\n+export const premodUser: IntermediateModerationPhase = ({\n+  author,\n+}): IntermediatePhaseResult | void => {\n+  // FIXME: (wyattjoh) once migration has been performed, remove check\n+  if (author.status.premod && author.status.premod.active) {\n+    return {\n+      status: GQLCOMMENT_STATUS.PREMOD,\n+    };\n+  }\n+};"
    },
    {
      "sha": "7e6497cd2157ca99fe4d23a52fef95d67aee0ca8",
      "filename": "src/core/server/services/users/index.ts",
      "status": "modified",
      "additions": 64,
      "deletions": 0,
      "changes": 64,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/users/index.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/core/server/services/users/index.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/users/index.ts?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -17,6 +17,7 @@ import {\n   PasswordIncorrect,\n   TokenNotFoundError,\n   UserAlreadyBannedError,\n+  UserAlreadyPremoderated,\n   UserAlreadySuspendedError,\n   UserCannotBeIgnoredError,\n   UsernameAlreadySetError,\n@@ -33,6 +34,7 @@ import {\n   banUser,\n   clearDeletionDate,\n   consolidateUserBanStatus,\n+  consolidateUserPremodStatus,\n   consolidateUserSuspensionStatus,\n   createUser,\n   createUserToken,\n@@ -41,9 +43,11 @@ import {\n   FindOrCreateUserInput,\n   ignoreUser,\n   NotificationSettingsInput,\n+  premodUser,\n   removeActiveUserSuspensions,\n   removeUserBan,\n   removeUserIgnore,\n+  removeUserPremod,\n   retrieveUser,\n   retrieveUserWithEmail,\n   scheduleDeletionDate,\n@@ -791,6 +795,66 @@ export async function ban(\n   return user;\n }\n \n+/**\n+ * premod will premod a specific user.\n+ *\n+ * @param mongo mongo database to interact with\n+ * @param tenant Tenant where the User will be banned on\n+ * @param moderator the User that is banning the User\n+ * @param userID the ID of the User being banned\n+ * @param now the current time that the ban took effect\n+ */\n+export async function premod(\n+  mongo: Db,\n+  tenant: Tenant,\n+  moderator: User,\n+  userID: string,\n+  now = new Date()\n+) {\n+  // Get the user being banned to check to see if the user already has an\n+  // existing ban.\n+  const targetUser = await retrieveUser(mongo, tenant.id, userID);\n+  if (!targetUser) {\n+    throw new UserNotFoundError(userID);\n+  }\n+\n+  // Check to see if the User is currently banned.\n+  const premodStatus = consolidateUserPremodStatus(targetUser.status.premod);\n+  // FIXME: (wyattjoh) once migration has been performed, remove check\n+  if (premodStatus && premodStatus.active) {\n+    throw new UserAlreadyPremoderated();\n+  }\n+\n+  // Ban the user.\n+  return premodUser(mongo, tenant.id, userID, moderator.id, now);\n+}\n+\n+export async function removePremod(\n+  mongo: Db,\n+  tenant: Tenant,\n+  moderator: User,\n+  userID: string,\n+  now = new Date()\n+) {\n+  // Get the user being suspended to check to see if the user already has an\n+  // existing suspension.\n+  const targetUser = await retrieveUser(mongo, tenant.id, userID);\n+  if (!targetUser) {\n+    throw new UserNotFoundError(userID);\n+  }\n+\n+  // Check to see if the User is currently suspended.\n+  const premodStatus = consolidateUserPremodStatus(targetUser.status.premod);\n+  // FIXME: (wyattjoh) once migration has been performed, remove check\n+  if (!premodStatus || !premodStatus.active) {\n+    // The user is not premodded currently, just return the user because we\n+    // don't have to do anything.\n+    return targetUser;\n+  }\n+\n+  // For each of the suspensions, remove it.\n+  return removeUserPremod(mongo, tenant.id, userID, moderator.id, now);\n+}\n /**\n  * suspend will suspend a give user from interacting with Coral.\n  *"
    },
    {
      "sha": "043e9ade47d8d8cfaeb548c9d12034342a7ad80a",
      "filename": "src/locales/en-US/admin.ftl",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/coralproject/talk/blob/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/locales/en-US/admin.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/e61e62a23883b3308751541a8c662e4c8c5ec25d/src/locales/en-US/admin.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/en-US/admin.ftl?ref=e61e62a23883b3308751541a8c662e4c8c5ec25d",
      "patch": "@@ -22,6 +22,7 @@ role-plural-commenter = Commenters\n userStatus-active = Active\n userStatus-banned = Banned\n userStatus-suspended = Suspended\n+userStatus-premod = Always pre-moderate\n \n ## Navigation\n navigation-moderate = Moderate\n@@ -486,6 +487,9 @@ moderate-user-drawer-username-change = Username change\n moderate-user-drawer-username-change-new = New:\n moderate-user-drawer-username-change-old = Old:\n \n+moderate-user-drawer-account-history-premod-set = Always pre-moderate\n+moderate-user-drawer-account-history-premod-removed = Removed pre-moderate\n+\n moderate-user-drawer-suspension =\n   Suspension, { $value } { $unit ->\n     [second] { $value ->\n@@ -614,12 +618,18 @@ community-userStatus-popover =\n   .description = A dropdown to change the user status\n \n community-userStatus-banUser = Ban User\n+community-userStatus-ban = Ban \n community-userStatus-removeBan = Remove Ban\n+community-userStatus-removeUserBan = Remove ban\n community-userStatus-suspendUser = Suspend User\n+community-userStatus-suspend = Suspend \n community-userStatus-removeSuspension = Remove Suspension\n+community-userStatus-removeUserSuspension = Remove suspension\n community-userStatus-unknown = Unknown\n community-userStatus-changeButton =\n   .aria-label = Change user status\n+community-userStatus-premodUser = Always pre-moderate\n+community-userStatus-removePremod = Remove pre-moderate \n \n community-banModal-areYouSure = Are you sure you want to ban <strong>{ $username }</strong>?\n community-banModal-consequence =\n@@ -652,6 +662,13 @@ community-suspendModal-success =\n community-suspendModal-success-close = Close\n community-suspendModal-selectDuration = Select suspension length\n \n+community-premodModal-areYouSure = \n+  Are you sure you want to always pre-moderate <strong>{ $username }</strong>?\n+community-premodModal-consequence =\n+  All their comments will go to the Pending queue until you remove this status.\n+community-premodModal-cancel = Cancel\n+community-premodModal-premodUser = Yes, always pre-moderate \n+\n community-invite-inviteMember = Invite members to your organization\n community-invite-emailAddressLabel = Email address:\n community-invite-inviteMore = Invite more"
    }
  ]
}
