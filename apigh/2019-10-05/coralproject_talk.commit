{
  "sha": "918ba1086719282ddda04593abe5e1404182d0ac",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6OTE4YmExMDg2NzE5MjgyZGRkYTA0NTkzYWJlNWUxNDA0MTgyZDBhYw==",
  "commit": {
    "author": {
      "name": "Wyatt Johnson",
      "email": "wyattjoh@gmail.com",
      "date": "2019-10-04T20:22:31Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2019-10-04T20:22:31Z"
    },
    "message": "[CORL-681] Configurable Staff Badges (#2620)\n\n* feat: added configurable staff badge\r\n\r\n* fix: removed ambigous styles",
    "tree": {
      "sha": "8abf7c99f7962d05fbe5e00afd66311bb2c473ab",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/8abf7c99f7962d05fbe5e00afd66311bb2c473ab"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/918ba1086719282ddda04593abe5e1404182d0ac",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdl6oHCRBK7hj4Ov3rIwAAdHIIAD78zHNVh9ARfoCBBzqkc9kh\nPWupqHv+qwLp2x9kTiQTvR8bItyEAUCmu1HdYTJyNY5VumPCsSpqC1GCxkkP4ado\nU4D9sXbsZ3QAA9MLzs7KneH4Eriyql024Em+l6uWSlqH/1F2WlCe08BpYL0bfJYr\nVOspHoesyZv03Q1LgMpC0FaJ3ERckyiSXCo1ZVB6cvq6evBm9yDdixHzET48Rh6J\nrLrJJ/lIF669REoDQlFQWUQ9NEfQMyqjIEbHsjgYMa+zKwrz6W7Ghw8CgaYGkqXg\nrCPcT5hB00IxMKLM1jrSeUgh98qcyvw5f5h9QCQNEnoVL7QVHwg7M10uc4bRwK0=\n=/1A7\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 8abf7c99f7962d05fbe5e00afd66311bb2c473ab\nparent e7ab0b27f986e7749f26ddaf386bf330a2c0b8ec\nauthor Wyatt Johnson <wyattjoh@gmail.com> 1570220551 +0000\ncommitter GitHub <noreply@github.com> 1570220551 +0000\n\n[CORL-681] Configurable Staff Badges (#2620)\n\n* feat: added configurable staff badge\r\n\r\n* fix: removed ambigous styles\r\n"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/918ba1086719282ddda04593abe5e1404182d0ac",
  "html_url": "https://github.com/coralproject/talk/commit/918ba1086719282ddda04593abe5e1404182d0ac",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/918ba1086719282ddda04593abe5e1404182d0ac/comments",
  "author": {
    "login": "wyattjoh",
    "id": 633002,
    "node_id": "MDQ6VXNlcjYzMzAwMg==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/633002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wyattjoh",
    "html_url": "https://github.com/wyattjoh",
    "followers_url": "https://api.github.com/users/wyattjoh/followers",
    "following_url": "https://api.github.com/users/wyattjoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/wyattjoh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wyattjoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wyattjoh/subscriptions",
    "organizations_url": "https://api.github.com/users/wyattjoh/orgs",
    "repos_url": "https://api.github.com/users/wyattjoh/repos",
    "events_url": "https://api.github.com/users/wyattjoh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wyattjoh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e7ab0b27f986e7749f26ddaf386bf330a2c0b8ec",
      "url": "https://api.github.com/repos/coralproject/talk/commits/e7ab0b27f986e7749f26ddaf386bf330a2c0b8ec",
      "html_url": "https://github.com/coralproject/talk/commit/e7ab0b27f986e7749f26ddaf386bf330a2c0b8ec"
    }
  ],
  "stats": {
    "total": 472,
    "additions": 428,
    "deletions": 44
  },
  "files": [
    {
      "sha": "30315cc29c16acde1429ab8868101982704a998e",
      "filename": "src/core/client/admin/routes/Configure/sections/General/GeneralConfig.tsx",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/GeneralConfig.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/GeneralConfig.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Configure/sections/General/GeneralConfig.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -11,6 +11,7 @@ import GuidelinesConfigContainer from \"./GuidelinesConfigContainer\";\n import LocaleConfigContainer from \"./LocaleConfigContainer\";\n import ReactionConfigContainer from \"./ReactionConfigContainer\";\n import SitewideCommentingConfigContainer from \"./SitewideCommentingConfigContainer\";\n+import StaffConfigContainer from \"./StaffConfigContainer\";\n \n interface Props {\n   disabled: boolean;\n@@ -19,6 +20,7 @@ interface Props {\n     PropTypesOf<typeof CommentEditingConfigContainer>[\"settings\"] &\n     PropTypesOf<typeof ClosedStreamMessageConfigContainer>[\"settings\"] &\n     PropTypesOf<typeof ReactionConfigContainer>[\"settings\"] &\n+    PropTypesOf<typeof StaffConfigContainer>[\"settings\"] &\n     PropTypesOf<typeof ClosingCommentStreamsConfigContainer>[\"settings\"] &\n     PropTypesOf<typeof SitewideCommentingConfigContainer>[\"settings\"] &\n     PropTypesOf<typeof LocaleConfigContainer>[\"settings\"];\n@@ -71,6 +73,11 @@ const General: FunctionComponent<Props> = ({\n       settings={settings}\n       onInitValues={onInitValues}\n     />\n+    <StaffConfigContainer\n+      disabled={disabled}\n+      settings={settings}\n+      onInitValues={onInitValues}\n+    />\n   </HorizontalGutter>\n );\n "
    },
    {
      "sha": "833b97bd6be028bf91821e595b746ad3dec4f7c2",
      "filename": "src/core/client/admin/routes/Configure/sections/General/GeneralConfigContainer.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/GeneralConfigContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/GeneralConfigContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Configure/sections/General/GeneralConfigContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -53,6 +53,7 @@ const enhanced = withFragmentContainer<Props>({\n       ...ClosingCommentStreamsConfigContainer_settings\n       ...SitewideCommentingConfigContainer_settings\n       ...ReactionConfigContainer_settings\n+      ...StaffConfigContainer_settings\n     }\n   `,\n })(GeneralConfigContainer);"
    },
    {
      "sha": "c597ee7a66caeeb0f46dd0e79abca8ea50b2a261",
      "filename": "src/core/client/admin/routes/Configure/sections/General/StaffConfig.css",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfig.css",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfig.css",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Configure/sections/General/StaffConfig.css?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1,3 @@\n+.textInput {\n+  min-width: 300px;\n+}"
    },
    {
      "sha": "c2bb77268625b45e53494677f57561af1687b4d3",
      "filename": "src/core/client/admin/routes/Configure/sections/General/StaffConfig.tsx",
      "status": "added",
      "additions": 78,
      "deletions": 0,
      "changes": 78,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfig.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfig.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Configure/sections/General/StaffConfig.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1,78 @@\n+import { Localized } from \"fluent-react/compat\";\n+import React, { FunctionComponent } from \"react\";\n+import { Field } from \"react-final-form\";\n+\n+import { StaffConfigContainer_settings as SettingsData } from \"coral-admin/__generated__/StaffConfigContainer_settings.graphql\";\n+import { required } from \"coral-framework/lib/validation\";\n+import {\n+  FieldSet,\n+  Flex,\n+  FormField,\n+  HorizontalGutter,\n+  InputLabel,\n+  Tag,\n+  TextField,\n+  Typography,\n+} from \"coral-ui/components\";\n+\n+import Header from \"../../Header\";\n+import SectionContent from \"../../SectionContent\";\n+import ValidationMessage from \"../../ValidationMessage\";\n+\n+import styles from \"./StaffConfig.css\";\n+\n+interface Props {\n+  disabled: boolean;\n+  settings: SettingsData;\n+}\n+\n+const StaffConfig: FunctionComponent<Props> = ({ disabled, settings }) => (\n+  <HorizontalGutter size=\"oneAndAHalf\" container={<FieldSet />}>\n+    <Localized id=\"configure-general-staff-title\">\n+      <Header container=\"legend\">Staff member badge</Header>\n+    </Localized>\n+    <SectionContent>\n+      <Localized id=\"configure-general-staff-explanation\">\n+        <Typography variant=\"bodyShort\">\n+          Show a custom badge for staff members of your organization. This badge\n+          appears on the comment stream and in the admin interface.\n+        </Typography>\n+      </Localized>\n+      <HorizontalGutter size=\"double\">\n+        <FormField>\n+          <Field name=\"staff.label\" validate={required}>\n+            {({ input, meta }) => (\n+              <Flex itemGutter=\"double\">\n+                <HorizontalGutter>\n+                  <Localized id=\"configure-general-staff-label\">\n+                    <InputLabel>Badge text</InputLabel>\n+                  </Localized>\n+                  <Localized id=\"configure-general-staff-input\">\n+                    <TextField\n+                      className={styles.textInput}\n+                      id={input.name}\n+                      type=\"text\"\n+                      fullWidth\n+                      placeholder=\"E.g. Staff\"\n+                      disabled={disabled}\n+                      {...input}\n+                    />\n+                  </Localized>\n+                  <ValidationMessage fullWidth meta={meta} />\n+                </HorizontalGutter>\n+                <HorizontalGutter>\n+                  <Localized id=\"configure-general-staff-preview\">\n+                    <Typography variant=\"heading3\">Preview</Typography>\n+                  </Localized>\n+                  {input.value && <Tag>{input.value}</Tag>}\n+                </HorizontalGutter>\n+              </Flex>\n+            )}\n+          </Field>\n+        </FormField>\n+      </HorizontalGutter>\n+    </SectionContent>\n+  </HorizontalGutter>\n+);\n+\n+export default StaffConfig;"
    },
    {
      "sha": "48383d597ef6c7ff117899f4a189fea72ac7e170",
      "filename": "src/core/client/admin/routes/Configure/sections/General/StaffConfigContainer.tsx",
      "status": "added",
      "additions": 37,
      "deletions": 0,
      "changes": 37,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfigContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/routes/Configure/sections/General/StaffConfigContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/routes/Configure/sections/General/StaffConfigContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1,37 @@\n+import React from \"react\";\n+import { graphql } from \"react-relay\";\n+\n+import { StaffConfigContainer_settings as SettingsData } from \"coral-admin/__generated__/StaffConfigContainer_settings.graphql\";\n+import { withFragmentContainer } from \"coral-framework/lib/relay\";\n+\n+import StaffConfig from \"./StaffConfig\";\n+\n+interface Props {\n+  settings: SettingsData;\n+  onInitValues: (values: SettingsData) => void;\n+  disabled: boolean;\n+}\n+\n+class StaffConfigContainer extends React.Component<Props> {\n+  constructor(props: Props) {\n+    super(props);\n+    props.onInitValues(props.settings);\n+  }\n+\n+  public render() {\n+    const { disabled, settings } = this.props;\n+    return <StaffConfig settings={settings} disabled={disabled} />;\n+  }\n+}\n+\n+const enhanced = withFragmentContainer<Props>({\n+  settings: graphql`\n+    fragment StaffConfigContainer_settings on Settings {\n+      staff {\n+        label\n+      }\n+    }\n+  `,\n+})(StaffConfigContainer);\n+\n+export default enhanced;"
    },
    {
      "sha": "f2df78efff55ed7495a49252d31982cd89ea7758",
      "filename": "src/core/client/admin/test/configure/__snapshots__/general.spec.tsx.snap",
      "status": "modified",
      "additions": 70,
      "deletions": 0,
      "changes": 70,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/test/configure/__snapshots__/general.spec.tsx.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/test/configure/__snapshots__/general.spec.tsx.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/test/configure/__snapshots__/general.spec.tsx.snap?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -1063,6 +1063,76 @@ each other's comments.\n               </div>\n             </div>\n           </fieldset>\n+          <fieldset\n+            className=\"FieldSet-root Box-root HorizontalGutter-root HorizontalGutter-oneAndAHalf\"\n+          >\n+            <legend\n+              className=\"Box-root Typography-root Typography-heading3 Typography-colorTextPrimary Header-root\"\n+            >\n+              Staff member badge\n+            </legend>\n+            <div\n+              className=\"Box-root HorizontalGutter-root SectionContent-sectionContent HorizontalGutter-double\"\n+            >\n+              <p\n+                className=\"Box-root Typography-root Typography-bodyShort Typography-colorTextPrimary\"\n+              >\n+                Show a custom badge for staff members of your organization. This badge\n+appears on the comment stream and in the admin interface.\n+              </p>\n+              <div\n+                className=\"Box-root HorizontalGutter-root HorizontalGutter-double\"\n+              >\n+                <div\n+                  className=\"Box-root HorizontalGutter-root FormField-root HorizontalGutter-half\"\n+                >\n+                  <div\n+                    className=\"Box-root Flex-root Flex-flex Flex-doubleItemGutter gutter\"\n+                  >\n+                    <div\n+                      className=\"Box-root HorizontalGutter-root HorizontalGutter-full\"\n+                    >\n+                      <label\n+                        className=\"Box-root Typography-root Typography-inputLabel Typography-colorTextPrimary InputLabel-root\"\n+                      >\n+                        Badge text\n+                      </label>\n+                      <div\n+                        className=\"TextField-root TextField-fullWidth StaffConfig-textInput\"\n+                      >\n+                        <input\n+                          className=\"TextField-input TextField-colorRegular\"\n+                          disabled={false}\n+                          id=\"staff.label\"\n+                          name=\"staff.label\"\n+                          onBlur={[Function]}\n+                          onChange={[Function]}\n+                          onFocus={[Function]}\n+                          placeholder=\"E.g. Staff\"\n+                          type=\"text\"\n+                          value=\"Staff\"\n+                        />\n+                      </div>\n+                    </div>\n+                    <div\n+                      className=\"Box-root HorizontalGutter-root HorizontalGutter-full\"\n+                    >\n+                      <h1\n+                        className=\"Box-root Typography-root Typography-heading3 Typography-colorTextPrimary\"\n+                      >\n+                        Preview\n+                      </h1>\n+                      <span\n+                        className=\"Tag-root Tag-colorGrey Tag-uppercase\"\n+                      >\n+                        Staff\n+                      </span>\n+                    </div>\n+                  </div>\n+                </div>\n+              </div>\n+            </div>\n+          </fieldset>\n         </div>\n       </div>\n     </div>"
    },
    {
      "sha": "34ea69a56b1fbb5d5bf3faa70f6a64e30f4ff37c",
      "filename": "src/core/client/admin/test/fixtures.ts",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/test/fixtures.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/admin/test/fixtures.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/test/fixtures.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -50,6 +50,9 @@ export const settings = createFixture<GQLSettings>({\n     timeout: 604800,\n     message: \"Comments are closed on this story.\",\n   },\n+  staff: {\n+    label: \"Staff\",\n+  },\n   reaction: {\n     label: \"Reaction\",\n     labelActive: \"reacted\","
    },
    {
      "sha": "15984a9d34ed34a419c68a498e472f709138b2ff",
      "filename": "src/core/client/stream/tabs/Comments/Comment/CommentContainer.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/CommentContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/CommentContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Comment/CommentContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -253,6 +253,7 @@ export class CommentContainer extends Component<Props, State> {\n                     <UserTagsContainer\n                       className={CLASSES.comment.topBar.userTag}\n                       comment={comment}\n+                      settings={settings}\n                     />\n                     <UserBadgesContainer\n                       className={CLASSES.comment.topBar.userBadge}\n@@ -445,6 +446,7 @@ const enhanced = withSetCommentIDMutation(\n           ...ReactionButtonContainer_settings\n           ...ReplyCommentFormContainer_settings\n           ...EditCommentFormContainer_settings\n+          ...UserTagsContainer_settings\n         }\n       `,\n     })(CommentContainer)"
    },
    {
      "sha": "304232ce3a6e44cd54f7c74871669273dfa37d3a",
      "filename": "src/core/client/stream/tabs/Comments/Comment/UserTagsContainer.tsx",
      "status": "modified",
      "additions": 17,
      "deletions": 12,
      "changes": 29,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/UserTagsContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/UserTagsContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Comment/UserTagsContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -1,27 +1,25 @@\n-import { Localized } from \"fluent-react/compat\";\n import React, { FunctionComponent } from \"react\";\n import { graphql } from \"react-relay\";\n \n import withFragmentContainer from \"coral-framework/lib/relay/withFragmentContainer\";\n-import { UserTagsContainer_comment as CommentData } from \"coral-stream/__generated__/UserTagsContainer_comment.graphql\";\n+import { UserTagsContainer_comment } from \"coral-stream/__generated__/UserTagsContainer_comment.graphql\";\n+import { UserTagsContainer_settings } from \"coral-stream/__generated__/UserTagsContainer_settings.graphql\";\n import { Tag } from \"coral-ui/components\";\n \n interface Props {\n-  comment: CommentData;\n+  comment: UserTagsContainer_comment;\n+  settings: UserTagsContainer_settings;\n   className?: string;\n }\n \n-const UserTagsContainer: FunctionComponent<Props> = props => {\n-  const { comment } = props;\n+const UserTagsContainer: FunctionComponent<Props> = ({\n+  settings,\n+  comment,\n+  className,\n+}) => {\n   const staffTag = comment.tags.find(t => t.code === \"STAFF\");\n   return (\n-    <>\n-      {staffTag && (\n-        <Localized id=\"comments-staffTag\">\n-          <Tag className={props.className}>Staff</Tag>\n-        </Localized>\n-      )}\n-    </>\n+    <>{staffTag && <Tag className={className}>{settings.staff.label}</Tag>}</>\n   );\n };\n \n@@ -33,6 +31,13 @@ const enhanced = withFragmentContainer<Props>({\n       }\n     }\n   `,\n+  settings: graphql`\n+    fragment UserTagsContainer_settings on Settings {\n+      staff {\n+        label\n+      }\n+    }\n+  `,\n })(UserTagsContainer);\n \n export default enhanced;"
    },
    {
      "sha": "934f9ca29a5b342030444d59763e70d178645ac5",
      "filename": "src/core/client/stream/tabs/Comments/Comment/__snapshots__/CommentContainer.spec.tsx.snap",
      "status": "modified",
      "additions": 49,
      "deletions": 0,
      "changes": 49,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/__snapshots__/CommentContainer.spec.tsx.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Comment/__snapshots__/CommentContainer.spec.tsx.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Comment/__snapshots__/CommentContainer.spec.tsx.snap?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -143,6 +143,13 @@ exports[`hide reply button 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -326,6 +333,13 @@ exports[`renders body only 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -509,6 +523,13 @@ exports[`renders disabled reply when commenting has been disabled 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": true,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -692,6 +713,13 @@ exports[`renders disabled reply when story is closed 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -887,6 +915,13 @@ exports[`renders in reply to 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -1074,6 +1109,13 @@ exports[`renders username and body 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\"\n@@ -1272,6 +1314,13 @@ exports[`shows conversation link 1`] = `\n                 \"tags\": Array [],\n               }\n             }\n+            settings={\n+              Object {\n+                \"disableCommenting\": Object {\n+                  \"enabled\": false,\n+                },\n+              }\n+            }\n           />\n           <Relay(AuthorBadgesContainer)\n             className=\"coral coral-userBadge coral-comment-userBadge\""
    },
    {
      "sha": "192ce0820a306fa70b323364a4a8b293241efe7c",
      "filename": "src/core/client/stream/tabs/Comments/PermalinkView/ConversationThreadContainer.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/PermalinkView/ConversationThreadContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/PermalinkView/ConversationThreadContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/PermalinkView/ConversationThreadContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -100,6 +100,7 @@ class ConversationThreadContainer extends React.Component<\n                   <UserTagsContainer\n                     className={CLASSES.conversationThread.rootParent.userTag}\n                     comment={rootParent}\n+                    settings={settings}\n                   />\n                 }\n               />\n@@ -192,6 +193,7 @@ const enhanced = withContext(ctx => ({\n           fragment ConversationThreadContainer_settings on Settings {\n             ...CommentContainer_settings\n             ...LocalReplyListContainer_settings\n+            ...UserTagsContainer_settings\n           }\n         `,\n         comment: graphql`"
    },
    {
      "sha": "4eef96309edf65c2c516a6d695d9b01340179ec9",
      "filename": "src/core/client/stream/tabs/Comments/Stream/FeaturedComments/FeaturedCommentContainer.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Stream/FeaturedComments/FeaturedCommentContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/tabs/Comments/Stream/FeaturedComments/FeaturedCommentContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Stream/FeaturedComments/FeaturedCommentContainer.tsx?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -71,6 +71,7 @@ const FeaturedCommentContainer: FunctionComponent<Props> = props => {\n           <UserTagsContainer\n             className={CLASSES.featuredComment.authorBar.userTag}\n             comment={comment}\n+            settings={settings}\n           />\n         </Box>\n         <Box ml={2} clone>\n@@ -174,6 +175,7 @@ const enhanced = withSetCommentIDMutation(\n     settings: graphql`\n       fragment FeaturedCommentContainer_settings on Settings {\n         ...ReactionButtonContainer_settings\n+        ...UserTagsContainer_settings\n       }\n     `,\n   })(FeaturedCommentContainer)"
    },
    {
      "sha": "9ad509e7b72eb8eb715c0ac3535c4b920b4acd76",
      "filename": "src/core/client/stream/test/fixtures.ts",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/test/fixtures.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/client/stream/test/fixtures.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/test/fixtures.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -88,6 +88,9 @@ export const settings = createFixture<GQLSettings>({\n       },\n     },\n   },\n+  staff: {\n+    label: \"Staff\",\n+  },\n   reaction: {\n     icon: \"thumb_up\",\n     label: \"Respect\","
    },
    {
      "sha": "464ca249365351bcfbcd52e57a9ebf875f6308f1",
      "filename": "src/core/server/graph/tenant/schema/schema.graphql",
      "status": "modified",
      "additions": 38,
      "deletions": 2,
      "changes": 40,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/graph/tenant/schema/schema.graphql",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/graph/tenant/schema/schema.graphql",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/tenant/schema/schema.graphql?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -1085,16 +1085,29 @@ type CommenterAccountFeatures {\n   changeUsername when true, non-sso user may change username every 14 days\n   \"\"\"\n   changeUsername: Boolean!\n+\n   \"\"\"\n   downloadComments when true, user may download their comment history\n   \"\"\"\n   downloadComments: Boolean!\n+\n   \"\"\"\n   deleteAccount when true, non-sso user may permanently delete their account\n   \"\"\"\n   deleteAccount: Boolean!\n }\n \n+\"\"\"\n+StaffConfiguration specifies the configuration for the staff badges assigned to\n+users with any role above COMMENTER.\n+\"\"\"\n+type StaffConfiguration {\n+  \"\"\"\n+  label is the string used when displaying the STAFF badge to users.\n+  \"\"\"\n+  label: String!\n+}\n+\n \"\"\"\n Settings stores the global settings for a given Tenant.\n \"\"\"\n@@ -1210,6 +1223,12 @@ type Settings {\n   \"\"\"\n   reaction: ReactionConfiguration!\n \n+  \"\"\"\n+  staff specifies the configuration for the staff badges assigned to users with\n+  any role above COMMENTER.\n+  \"\"\"\n+  staff: StaffConfiguration!\n+\n   \"\"\"\n   accountFeatures stores the configuration for commenter account features.\n   \"\"\"\n@@ -3280,8 +3299,8 @@ input StoryConfigurationInput {\n }\n \n \"\"\"\n-ReactionConfigurationInput stores the configuration for reactions used across this\n-Tenant.\n+ReactionConfigurationInput stores the configuration for reactions used across\n+this Tenant.\n \"\"\"\n input ReactionConfigurationInput {\n   \"\"\"\n@@ -3318,6 +3337,17 @@ input ReactionConfigurationInput {\n   color: String\n }\n \n+\"\"\"\n+StaffConfigurationInput specifies the configuration for the staff badges\n+assigned to users with any role above COMMENTER.\n+\"\"\"\n+input StaffConfigurationInput {\n+  \"\"\"\n+  label is the string used when displaying the STAFF badge to users.\n+  \"\"\"\n+  label: String\n+}\n+\n \"\"\"\n CommenterAccountFeatures stores the configuration for commenter account features.\n \"\"\"\n@@ -3435,6 +3465,12 @@ input SettingsInput {\n   \"\"\"\n   reaction: ReactionConfigurationInput\n \n+  \"\"\"\n+  staff specifies the configuration for the staff badges assigned to users with\n+  any role above COMMENTER.\n+  \"\"\"\n+  staff: StaffConfigurationInput\n+\n   \"\"\"\n   accountFeatures specifies the configuration for accounts.\n   \"\"\""
    },
    {
      "sha": "72790dcf28fdfc460cd0ce45a6aee1fe4e75c06d",
      "filename": "src/core/server/index.ts",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/index.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/index.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/index.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -158,7 +158,10 @@ class Server {\n     );\n \n     // Create the migration manager.\n-    this.migrationManager = new MigrationManager(this.tenantCache);\n+    this.migrationManager = new MigrationManager({\n+      tenantCache: this.tenantCache,\n+      i18n: this.i18n,\n+    });\n \n     // Load and upsert the persisted queries.\n     this.persistedQueryCache = new PersistedQueryCache({ mongo: this.mongo });\n@@ -198,6 +201,7 @@ class Server {\n     // Run migrations if there is already a Tenant installed.\n     if (await isInstalled(this.tenantCache)) {\n       await this.migrationManager.executePendingMigrations(this.mongo);\n+      await this.tenantCache.primeAll();\n     } else {\n       logger.info(\"no tenants are installed, skipping running migrations\");\n     }"
    },
    {
      "sha": "1bf00df737f85341fc4088265cbdc8c4831ea787",
      "filename": "src/core/server/locales/da/common.ftl",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/da/common.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/da/common.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/locales/da/common.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1 @@\n+staff-label = Personale"
    },
    {
      "sha": "70c8e964d470825b1b7191d0327d6d964496fe1a",
      "filename": "src/core/server/locales/en-US/common.ftl",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/en-US/common.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/en-US/common.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/locales/en-US/common.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -11,3 +11,5 @@ comment-count =\n     [one] Comment\n     *[other] Comments\n   }</span>\n+\n+staff-label = Staff"
    },
    {
      "sha": "bb91c17ff6f074148c5d07fcc5f164e64807f2d5",
      "filename": "src/core/server/locales/es/common.ftl",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/es/common.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/es/common.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/locales/es/common.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1 @@\n+staff-label = Miembro del equipo"
    },
    {
      "sha": "566f11f7ffad00ce40e659cf321a6378f71584c7",
      "filename": "src/core/server/locales/nl-NL/common.ftl",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/nl-NL/common.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/nl-NL/common.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/locales/nl-NL/common.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1 @@\n+staff-label = Staf"
    },
    {
      "sha": "27a3cf8b737dca9ecd7b29b81fba53392a2aeb1b",
      "filename": "src/core/server/locales/pt-BR/common.ftl",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/pt-BR/common.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/locales/pt-BR/common.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/locales/pt-BR/common.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -4,3 +4,4 @@ disableCommentingDefaultMessage = Comentários foram fechados nessa história.\n reaction-labelRespect = Respeitar\n reaction-labelActiveRespected = Respeitado\n reaction-sortLabelMostRespected = Respeitados\n+staff-label = Staff"
    },
    {
      "sha": "402c4e2d96ef9e8840d8f1b1cdc154a634820ac1",
      "filename": "src/core/server/models/settings.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/settings.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/settings.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/settings.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -94,6 +94,7 @@ export type Settings = GlobalModerationSettings &\n     | \"wordList\"\n     | \"integrations\"\n     | \"reaction\"\n+    | \"staff\"\n     | \"editCommentWindowLength\"\n     | \"customCSSURL\"\n     | \"communityGuidelines\""
    },
    {
      "sha": "be5a758814c81155344e2f41b747749e93d4b70a",
      "filename": "src/core/server/models/tenant/helpers.ts",
      "status": "modified",
      "additions": 10,
      "deletions": 1,
      "changes": 11,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/tenant/helpers.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/tenant/helpers.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/tenant/helpers.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -1,7 +1,10 @@\n import crypto from \"crypto\";\n import { FluentBundle } from \"fluent/compat\";\n \n-import { GQLReactionConfiguration } from \"coral-server/graph/tenant/schema/__generated__/types\";\n+import {\n+  GQLReactionConfiguration,\n+  GQLStaffConfiguration,\n+} from \"coral-server/graph/tenant/schema/__generated__/types\";\n import { translate } from \"coral-server/services/i18n\";\n \n export const getDefaultReactionConfiguration = (\n@@ -19,6 +22,12 @@ export const getDefaultReactionConfiguration = (\n   icon: \"thumb_up\",\n });\n \n+export const getDefaultStaffConfiguration = (\n+  bundle: FluentBundle\n+): GQLStaffConfiguration => ({\n+  label: translate(bundle, \"Staff\", \"staff-label\"),\n+});\n+\n export function generateSSOKey() {\n   // Generate a new key. We generate a key of minimum length 32 up to 37 bytes,\n   // as 16 was the minimum length recommended."
    },
    {
      "sha": "5972367d45d6abc234aedcae1ee51d380aae37b9",
      "filename": "src/core/server/models/tenant/tenant.ts",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/tenant/tenant.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/models/tenant/tenant.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/tenant/tenant.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -13,7 +13,11 @@ import { Settings } from \"coral-server/models/settings\";\n import { I18n } from \"coral-server/services/i18n\";\n import { tenants as collection } from \"coral-server/services/mongodb/collections\";\n \n-import { generateSSOKey, getDefaultReactionConfiguration } from \"./helpers\";\n+import {\n+  generateSSOKey,\n+  getDefaultReactionConfiguration,\n+  getDefaultStaffConfiguration,\n+} from \"./helpers\";\n \n /**\n  * TenantResource references a given resource that should be owned by a specific\n@@ -64,6 +68,9 @@ export async function createTenant(\n   input: CreateTenantInput,\n   now = new Date()\n ) {\n+  // Get the tenant's bundle.\n+  const bundle = i18n.getBundle(input.locale);\n+\n   const defaults: Sub<Tenant, CreateTenantInput> = {\n     // Create a new ID.\n     id: uuid.v4(),\n@@ -168,7 +175,8 @@ export async function createTenant(\n         doNotStore: true,\n       },\n     },\n-    reaction: getDefaultReactionConfiguration(i18n.getBundle(input.locale)),\n+    reaction: getDefaultReactionConfiguration(bundle),\n+    staff: getDefaultStaffConfiguration(bundle),\n     stories: {\n       scraping: {\n         enabled: true,"
    },
    {
      "sha": "726324f5f5b094db7db32a36c7f0e0903d881579",
      "filename": "src/core/server/services/migrate/manager.ts",
      "status": "modified",
      "additions": 12,
      "deletions": 5,
      "changes": 17,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/manager.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/manager.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/migrate/manager.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -12,6 +12,7 @@ import {\n   retrieveAllMigrationRecords,\n   startMigration,\n } from \"coral-server/models/migration\";\n+import { I18n } from \"coral-server/services/i18n\";\n import TenantCache from \"coral-server/services/tenant/cache\";\n \n import {\n@@ -23,16 +24,21 @@ import Migration from \"./migration\";\n // Extract the id from the filename with this regex.\n const fileNamePattern = /^(\\d+)_([\\S_]+)\\.[tj]s$/;\n \n+export interface ManagerOptions {\n+  tenantCache: TenantCache;\n+  i18n: I18n;\n+}\n+\n export default class Manager {\n   private clientID: string;\n   private migrations: Migration[];\n-  private tenants: TenantCache;\n+  private tenantCache: TenantCache;\n   private ran: boolean = false;\n \n-  constructor(tenants: TenantCache) {\n+  constructor({ tenantCache, i18n }: ManagerOptions) {\n     this.clientID = uuid.v4();\n     this.migrations = [];\n-    this.tenants = tenants;\n+    this.tenantCache = tenantCache;\n \n     const fileNames = fs.readdirSync(path.join(__dirname, \"migrations\"));\n     for (const fileName of fileNames) {\n@@ -60,9 +66,10 @@ export default class Manager {\n         throw new Error(\"fileName format is invalid\");\n       }\n       const id = parseInt(matches[1], 10);\n+      const name = matches[2];\n \n       // Create the migration instance.\n-      const migration = new m.default(id, matches[2]);\n+      const migration = new m.default({ id, name, i18n });\n \n       // Insert the migration into the migrations array.\n       if (!(migration instanceof Migration)) {\n@@ -179,7 +186,7 @@ export default class Manager {\n \n       if (migration.up) {\n         // The migration provides an up method, we should run this per Tenant.\n-        for await (const tenant of this.tenants) {\n+        for await (const tenant of this.tenantCache) {\n           log = log.child({ tenantID: tenant.id }, true);\n \n           const migrationStartTime = now();"
    },
    {
      "sha": "8858861d068d11bead14d6195d0b9d7ca66a2f1e",
      "filename": "src/core/server/services/migrate/migration.ts",
      "status": "modified",
      "additions": 12,
      "deletions": 3,
      "changes": 15,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/migration.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/migration.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/migrate/migration.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -2,6 +2,7 @@ import Logger from \"bunyan\";\n import { Db } from \"mongodb\";\n \n import logger from \"coral-server/logger\";\n+import { I18n } from \"coral-server/services/i18n\";\n \n interface Migration {\n   indexes?(mongo: Db): Promise<void>;\n@@ -10,18 +11,26 @@ interface Migration {\n   down?(mongo: Db, tenantID: string): Promise<void>;\n }\n \n+export interface MigrationOptions {\n+  id: number;\n+  name: string;\n+  i18n: I18n;\n+}\n+\n abstract class Migration {\n   public readonly name: string;\n   public readonly id: number;\n   public readonly logger: Logger;\n+  public readonly i18n: I18n;\n \n-  constructor(version: number, name: string) {\n-    this.id = version;\n+  constructor({ id, name, i18n }: MigrationOptions) {\n+    this.id = id;\n     this.name = name;\n+    this.i18n = i18n;\n     this.logger = logger.child(\n       {\n         migrationName: this.name,\n-        migrationVersion: this.id,\n+        migrationID: this.id,\n       },\n       true\n     );"
    },
    {
      "sha": "fd3b2566436af230c6d84ea13d5fe5b713206f96",
      "filename": "src/core/server/services/migrate/migrations/1570118392071_staff.ts",
      "status": "added",
      "additions": 38,
      "deletions": 0,
      "changes": 38,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/migrations/1570118392071_staff.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/core/server/services/migrate/migrations/1570118392071_staff.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/migrate/migrations/1570118392071_staff.ts?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -0,0 +1,38 @@\n+import { Db } from \"mongodb\";\n+\n+import { getDefaultStaffConfiguration } from \"coral-server/models/tenant\";\n+import Migration from \"coral-server/services/migrate/migration\";\n+import collections from \"coral-server/services/mongodb/collections\";\n+\n+import { MigrationError } from \"../error\";\n+\n+export default class extends Migration {\n+  private async getTenant(mongo: Db, id: string) {\n+    const tenant = await collections.tenants(mongo).findOne({ id });\n+    if (!tenant) {\n+      throw new MigrationError(id, \"tenant not found\", \"tenants\", [id]);\n+    }\n+\n+    return tenant;\n+  }\n+\n+  public async test(mongo: Db, id: string) {\n+    const tenant = await this.getTenant(mongo, id);\n+    if (!tenant.staff) {\n+      throw new MigrationError(id, \"staff not set\", \"tenants\", [id]);\n+    }\n+  }\n+\n+  public async up(mongo: Db, id: string) {\n+    const tenant = await this.getTenant(mongo, id);\n+    const bundle = this.i18n.getBundle(tenant.locale);\n+    await collections.tenants(mongo).updateOne(\n+      { id, staff: null },\n+      {\n+        $set: {\n+          staff: getDefaultStaffConfiguration(bundle),\n+        },\n+      }\n+    );\n+  }\n+}"
    },
    {
      "sha": "4f3379e6ca03f7aca229046a1af220b836893a7e",
      "filename": "src/locales/da/stream.ftl",
      "status": "modified",
      "additions": 11,
      "deletions": 12,
      "changes": 23,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/da/stream.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/da/stream.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/da/stream.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -114,8 +114,8 @@ comments-userPopover-ignore = Ignorere\n \n comments-userIgnorePopover-ignoreUser = Ignorerer {$username}?\n comments-userIgnorePopover-description =\n-  Når du ignorerer en kommentator, vil alle kommentarer, \n-  de skrev på webstedet, være skjult for dig. Du kan fortryde \n+  Når du ignorerer en kommentator, vil alle kommentarer,\n+  de skrev på webstedet, være skjult for dig. Du kan fortryde\n   dette senere fra Min profil.\n comments-userIgnorePopover-ignore = Ignorerer\n comments-userIgnorePopover-cancel = Annuller\n@@ -136,7 +136,6 @@ comments-rejectedTombstone =\n   Du har afvist denne kommentar. <TextLink>Gå til moderation for at gennemgå denne beslutning.</TextLink>\n \n comments-featuredTag = Fremhævet\n-comments-staffTag = Personale\n \n ### Featured Comments\n comments-featured-gotoConversation = Gå til samtale\n@@ -196,7 +195,7 @@ comments-reportPopover-submit = Indsend\n comments-reportPopover-thankYou = Mange tak\n comments-reportPopover-receivedMessage =\n   Vi har modtaget din besked.\n-  Rapporteringer fra medlemmer som dig, \n+  Rapporteringer fra medlemmer som dig,\n   hjælper til at holde en god tone.\n \n comments-reportPopover-dismiss = Luk\n@@ -228,17 +227,17 @@ configure-liveUpdates-description =\n \n configure-messageBox-title = Aktivér meddelelsesboks til denne stream\n configure-messageBox-description =\n-  Tilføj en besked øverst i kommentarfeltet for dine læsere. Brug dette til at stille et emne, \n-  stille et spørgsmål eller offentliggøre meddelelser vedrørende denne historie. \n+  Tilføj en besked øverst i kommentarfeltet for dine læsere. Brug dette til at stille et emne,\n+  stille et spørgsmål eller offentliggøre meddelelser vedrørende denne historie.\n configure-messageBox-preview = Forhåndsvisning\n configure-messageBox-selectAnIcon = Vælg et ikon\n configure-messageBox-noIcon = Intet ikon\n configure-messageBox-writeAMessage = Skriv en besked\n \n configure-closeStream-title = Luk kommentarer\n configure-closeStream-description =\n-  Kommentarerne er i øjeblikket åbne. \n-  Ved at lukke kommentarerne kan der ikke indsendes nye kommentarer, \n+  Kommentarerne er i øjeblikket åbne.\n+  Ved at lukke kommentarerne kan der ikke indsendes nye kommentarer,\n   og alle tidligere indsendte kommentarer vises stadig.\n configure-closeStream-closeStream = Luk kommentarer\n \n@@ -251,8 +250,8 @@ configure-openStream-openStream = Åbn kommentarer\n comments-tombstone-ignore = Denne kommentar er skjult, fordi du ignorerede {$username}\n \n suspendInfo-heading = Din konto er midlertidigt suspenderet for at kommentere.\n-suspendInfo-info = \n-  I overensstemmelse med fællesskabsretningslinjerne for { $organization} \n-  er din konto midlertidigt suspenderet. Mens du er suspenderet, \n-  kan du ikke kommentere, respektere eller rapportere kommentarer. \n+suspendInfo-info =\n+  I overensstemmelse med fællesskabsretningslinjerne for { $organization}\n+  er din konto midlertidigt suspenderet. Mens du er suspenderet,\n+  kan du ikke kommentere, respektere eller rapportere kommentarer.\n   Gå igen med til samtalen på { $until }."
    },
    {
      "sha": "0e1c2a94570a3bf6217f0ddee728c42a245c004e",
      "filename": "src/locales/en-US/admin.ftl",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/en-US/admin.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/en-US/admin.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/en-US/admin.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -541,10 +541,10 @@ moderate-user-drawer-recent-history-tooltip-button =\n   .aria-label = Toggle recent comment history tooltip\n moderate-user-drawer-recent-history-tooltip-submitted = Submitted\n \n-moderate-user-drawer-notes-field = \n+moderate-user-drawer-notes-field =\n   .placeholder = Leave a note...\n moderate-user-drawer-notes-button = Add note\n-moderatorNote-left-by = Left by: \n+moderatorNote-left-by = Left by:\n moderatorNote-delete = Delete\n \n ## Create Username\n@@ -780,6 +780,15 @@ configure-general-reactions-sort-input =\n configure-general-reactions-preview = Preview\n configure-general-reaction-sortMenu-sortBy = Sort by\n \n+configure-general-staff-title = Staff member badge\n+configure-general-staff-explanation =\n+  Show a custom badge for staff members of your organization. This badge\n+  appears on the comment stream and in the admin interface.\n+configure-general-staff-label = Badge text\n+configure-general-staff-input =\n+  .placeholder = E.g. Staff\n+configure-general-staff-preview = Preview\n+\n configure-account-features-title = Commenter account management features\n configure-account-features-explanation =\n   You can enable and disable certain features for your commenters to use"
    },
    {
      "sha": "9156281d05b13e33eccd4aa1c417636d8e71fae6",
      "filename": "src/locales/en-US/stream.ftl",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/en-US/stream.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/en-US/stream.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/en-US/stream.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -157,7 +157,6 @@ comments-rejectedTombstone =\n   You have rejected this comment. <TextLink>Go to Moderate to review this decision.</TextLink>\n \n comments-featuredTag = Featured\n-comments-staffTag = Staff\n \n ### Account Deletion Stream\n "
    },
    {
      "sha": "b6773dd11156c6c64f255c3d9cae9266e06fb3c7",
      "filename": "src/locales/es/stream.ftl",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/es/stream.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/es/stream.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/es/stream.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -135,7 +135,6 @@ comments-rejectedTombstone =\n   Has rechazado este comentario.<TextLink>Vaya a moderación para revisar esta decisión.</TextLink>\n \n comments-featuredTag = Resaltado\n-comments-staffTag = Miembro del equipo\n \n ### Featured Comments\n comments-featured-gotoConversation = Ir a conversación"
    },
    {
      "sha": "9fd1e41b92b6ffc1c7e467529077389865f225fb",
      "filename": "src/locales/nl-NL/stream.ftl",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/nl-NL/stream.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/nl-NL/stream.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/nl-NL/stream.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -135,7 +135,6 @@ comments-rejectedTombstone =\n   U heeft deze reactie afgewezen. <TextLink>Ga naar modereren om dit besluit te herzien.</TextLink>\n \n comments-featuredTag = Uitgelicht\n-comments-staffTag = Staf\n \n ### Featured Comments\n comments-featured-gotoConversation = Ga naar het gesprek"
    },
    {
      "sha": "ed06b0cc243d60560440613b1b3220bde3934ebd",
      "filename": "src/locales/pt-BR/stream.ftl",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/pt-BR/stream.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/918ba1086719282ddda04593abe5e1404182d0ac/src/locales/pt-BR/stream.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/pt-BR/stream.ftl?ref=918ba1086719282ddda04593abe5e1404182d0ac",
      "patch": "@@ -149,7 +149,6 @@ comments-rejectedTombstone =\n   Você rejeitou este comentário. <TextLink> Vá para Moderados para rever esta decisão. </TextLink>\n \n comments-featuredTag = Destaques\n-comments-staffTag = Staff\n \n ### Account Deletion Stream\n "
    }
  ]
}
