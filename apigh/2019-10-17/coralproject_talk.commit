{
  "sha": "d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6ZDE2OWQzZGQ1MTNhOGY4NDU1ZmQ2NDI5NWUzMmQ1MmYwYWIxZGNiNA==",
  "commit": {
    "author": {
      "name": "Wyatt Johnson",
      "email": "wyattjoh@gmail.com",
      "date": "2019-10-16T22:52:33Z"
    },
    "committer": {
      "name": "Kim Gardner",
      "email": "kgardnr@gmail.com",
      "date": "2019-10-16T22:52:33Z"
    },
    "message": "fix: allow unknown fields (#2640)",
    "tree": {
      "sha": "631742affc78657c8e6e3d64c25dcf55a24703d2",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/631742affc78657c8e6e3d64c25dcf55a24703d2"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
  "html_url": "https://github.com/coralproject/talk/commit/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4/comments",
  "author": {
    "login": "wyattjoh",
    "id": 633002,
    "node_id": "MDQ6VXNlcjYzMzAwMg==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/633002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wyattjoh",
    "html_url": "https://github.com/wyattjoh",
    "followers_url": "https://api.github.com/users/wyattjoh/followers",
    "following_url": "https://api.github.com/users/wyattjoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/wyattjoh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wyattjoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wyattjoh/subscriptions",
    "organizations_url": "https://api.github.com/users/wyattjoh/orgs",
    "repos_url": "https://api.github.com/users/wyattjoh/repos",
    "events_url": "https://api.github.com/users/wyattjoh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wyattjoh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "kgardnr",
    "id": 1077300,
    "node_id": "MDQ6VXNlcjEwNzczMDA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1077300?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kgardnr",
    "html_url": "https://github.com/kgardnr",
    "followers_url": "https://api.github.com/users/kgardnr/followers",
    "following_url": "https://api.github.com/users/kgardnr/following{/other_user}",
    "gists_url": "https://api.github.com/users/kgardnr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kgardnr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kgardnr/subscriptions",
    "organizations_url": "https://api.github.com/users/kgardnr/orgs",
    "repos_url": "https://api.github.com/users/kgardnr/repos",
    "events_url": "https://api.github.com/users/kgardnr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kgardnr/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b38a4f117be82bd6f9e8f0a7e68185ae24c607f6",
      "url": "https://api.github.com/repos/coralproject/talk/commits/b38a4f117be82bd6f9e8f0a7e68185ae24c607f6",
      "html_url": "https://github.com/coralproject/talk/commit/b38a4f117be82bd6f9e8f0a7e68185ae24c607f6"
    }
  ],
  "stats": {
    "total": 23,
    "additions": 22,
    "deletions": 1
  },
  "files": [
    {
      "sha": "94b01eca9da9f1bade38f5a2825dca530bcc164f",
      "filename": "src/core/server/app/middleware/passport/strategies/verifiers/sso.spec.ts",
      "status": "modified",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/coralproject/talk/blob/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4/src/core/server/app/middleware/passport/strategies/verifiers/sso.spec.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4/src/core/server/app/middleware/passport/strategies/verifiers/sso.spec.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/app/middleware/passport/strategies/verifiers/sso.spec.ts?ref=d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
      "patch": "@@ -1,5 +1,6 @@\n import {\n   isSSOToken,\n+  SSOTokenSchema,\n   SSOUserProfileSchema,\n } from \"coral-server/app/middleware/passport/strategies/verifiers/sso\";\n import { validate } from \"coral-server/app/request/body\";\n@@ -51,4 +52,24 @@ describe(\"SSOUserProfileSchema\", () => {\n     expect(validate(SSOUserProfileSchema, profile)).toEqual(profile);\n     expect(isSSOToken({ user: profile })).toEqual(true);\n   });\n+\n+  it(\"allows unknown claims\", async () => {\n+    const extra = {\n+      preferred_username: \"username\",\n+    };\n+    const base = {\n+      user: {\n+        id: \"id\",\n+        email: \"email\",\n+        username: \"username\",\n+      },\n+    };\n+    const token = {\n+      ...extra,\n+      ...base,\n+    };\n+\n+    expect(validate(SSOTokenSchema, token)).toEqual(base);\n+    expect(isSSOToken(token)).toEqual(true);\n+  });\n });"
    },
    {
      "sha": "0bb292139446c2a6e1a064e85df4a119a4d30125",
      "filename": "src/core/server/app/middleware/passport/strategies/verifiers/sso.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4/src/core/server/app/middleware/passport/strategies/verifiers/sso.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/d169d3dd513a8f8455fd64295e32d52f0ab1dcb4/src/core/server/app/middleware/passport/strategies/verifiers/sso.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/app/middleware/passport/strategies/verifiers/sso.ts?ref=d169d3dd513a8f8455fd64295e32d52f0ab1dcb4",
      "patch": "@@ -49,7 +49,7 @@ export interface SSOToken {\n }\n \n export function isSSOToken(token: SSOToken | object): token is SSOToken {\n-  const { error } = Joi.validate(token, SSOTokenSchema);\n+  const { error } = Joi.validate(token, SSOTokenSchema, { allowUnknown: true });\n   return isNil(error);\n }\n "
    }
  ]
}
