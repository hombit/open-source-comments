{
  "sha": "0f456330c5755c1faac3e7846204be3cad2bb73d",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6MGY0NTYzMzBjNTc1NWMxZmFhYzNlNzg0NjIwNGJlM2NhZDJiYjczZA==",
  "commit": {
    "author": {
      "name": "Nick Funk",
      "email": "nick.funk@outlook.com",
      "date": "2019-12-20T23:46:25Z"
    },
    "committer": {
      "name": "Wyatt Johnson",
      "email": "wyattjoh@gmail.com",
      "date": "2019-12-20T23:46:24Z"
    },
    "message": "[CORL-827/828] Scrub downloaded comments of html tags, rename archive (#2767)\n\n* Prefix comment download filename with \"coral\"\r\n\r\nCORL-827\r\n\r\n* Scrub html tags from downloaded comment data\r\n\r\nCORL-828\r\n\r\nCo-authored-by: Kim Gardner <kgardnr@gmail.com>\r\nCo-authored-by: Wyatt Johnson <accounts+github@wyattjoh.ca>",
    "tree": {
      "sha": "766f4f33109e663b156b441e0ca4887292489d05",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/766f4f33109e663b156b441e0ca4887292489d05"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/0f456330c5755c1faac3e7846204be3cad2bb73d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/0f456330c5755c1faac3e7846204be3cad2bb73d",
  "html_url": "https://github.com/coralproject/talk/commit/0f456330c5755c1faac3e7846204be3cad2bb73d",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/0f456330c5755c1faac3e7846204be3cad2bb73d/comments",
  "author": {
    "login": "nick-funk",
    "id": 5751504,
    "node_id": "MDQ6VXNlcjU3NTE1MDQ=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/5751504?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nick-funk",
    "html_url": "https://github.com/nick-funk",
    "followers_url": "https://api.github.com/users/nick-funk/followers",
    "following_url": "https://api.github.com/users/nick-funk/following{/other_user}",
    "gists_url": "https://api.github.com/users/nick-funk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nick-funk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nick-funk/subscriptions",
    "organizations_url": "https://api.github.com/users/nick-funk/orgs",
    "repos_url": "https://api.github.com/users/nick-funk/repos",
    "events_url": "https://api.github.com/users/nick-funk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nick-funk/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "wyattjoh",
    "id": 633002,
    "node_id": "MDQ6VXNlcjYzMzAwMg==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/633002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wyattjoh",
    "html_url": "https://github.com/wyattjoh",
    "followers_url": "https://api.github.com/users/wyattjoh/followers",
    "following_url": "https://api.github.com/users/wyattjoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/wyattjoh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wyattjoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wyattjoh/subscriptions",
    "organizations_url": "https://api.github.com/users/wyattjoh/orgs",
    "repos_url": "https://api.github.com/users/wyattjoh/repos",
    "events_url": "https://api.github.com/users/wyattjoh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wyattjoh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9d050e8b512fcfb4a3f9a6b02b957de4e391cb61",
      "url": "https://api.github.com/repos/coralproject/talk/commits/9d050e8b512fcfb4a3f9a6b02b957de4e391cb61",
      "html_url": "https://github.com/coralproject/talk/commit/9d050e8b512fcfb4a3f9a6b02b957de4e391cb61"
    }
  ],
  "stats": {
    "total": 5,
    "additions": 3,
    "deletions": 2
  },
  "files": [
    {
      "sha": "f95713f0fbdec70f096f8785cedfc6c97a5a3df0",
      "filename": "src/core/server/services/users/download/download.ts",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/coralproject/talk/blob/0f456330c5755c1faac3e7846204be3cad2bb73d/src/core/server/services/users/download/download.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/0f456330c5755c1faac3e7846204be3cad2bb73d/src/core/server/services/users/download/download.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/users/download/download.ts?ref=0f456330c5755c1faac3e7846204be3cad2bb73d",
      "patch": "@@ -2,6 +2,7 @@ import archiver from \"archiver\";\n import stringify from \"csv-stringify\";\n import DataLoader from \"dataloader\";\n import { Response } from \"express\";\n+import htmlToText from \"html-to-text\";\n import { kebabCase } from \"lodash\";\n import { Db } from \"mongodb\";\n \n@@ -52,7 +53,7 @@ export async function sendUserDownload(\n   let commentBatch: Array<Readonly<Comment>> = [];\n \n   // Generate the filename of the file that the user will download.\n-  const filename = `talk-${kebabCase(user.username)}-${kebabCase(\n+  const filename = `coral-${kebabCase(user.username)}-${kebabCase(\n     formatter.format(latestContentDate)\n   )}.zip`;\n \n@@ -107,7 +108,7 @@ export async function sendUserDownload(\n       const urlBuilder = new URL(storyURL);\n       urlBuilder.searchParams.set(\"commentID\", commentID);\n       const commentURL = urlBuilder.href;\n-      const body = revision.body;\n+      const body = htmlToText.fromString(revision.body);\n \n       csv.write([commentID, createdAt, storyURL, commentURL, body]);\n     }"
    }
  ]
}
