{
  "sha": "9a6606dd305f4f32ed464838fb4d85ac4788f259",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo5YTY2MDZkZDMwNWY0ZjMyZWQ0NjQ4MzhmYjRkODVhYzQ3ODhmMjU5",
  "commit": {
    "author": {
      "name": "Vinoth Kannan",
      "email": "svkn.87@gmail.com",
      "date": "2020-01-04T13:26:52Z"
    },
    "committer": {
      "name": "Vinoth Kannan",
      "email": "svkn.87@gmail.com",
      "date": "2020-01-04T13:26:52Z"
    },
    "message": "DEV: Add option to keep quoted content in post excerpt.",
    "tree": {
      "sha": "5bdd02b19dc33b235dc5abb355c4af14c3754b10",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/5bdd02b19dc33b235dc5abb355c4af14c3754b10"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/9a6606dd305f4f32ed464838fb4d85ac4788f259",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/9a6606dd305f4f32ed464838fb4d85ac4788f259",
  "html_url": "https://github.com/discourse/discourse/commit/9a6606dd305f4f32ed464838fb4d85ac4788f259",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/9a6606dd305f4f32ed464838fb4d85ac4788f259/comments",
  "author": {
    "login": "vinothkannans",
    "id": 9372109,
    "node_id": "MDQ6VXNlcjkzNzIxMDk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/9372109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vinothkannans",
    "html_url": "https://github.com/vinothkannans",
    "followers_url": "https://api.github.com/users/vinothkannans/followers",
    "following_url": "https://api.github.com/users/vinothkannans/following{/other_user}",
    "gists_url": "https://api.github.com/users/vinothkannans/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vinothkannans/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vinothkannans/subscriptions",
    "organizations_url": "https://api.github.com/users/vinothkannans/orgs",
    "repos_url": "https://api.github.com/users/vinothkannans/repos",
    "events_url": "https://api.github.com/users/vinothkannans/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vinothkannans/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vinothkannans",
    "id": 9372109,
    "node_id": "MDQ6VXNlcjkzNzIxMDk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/9372109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vinothkannans",
    "html_url": "https://github.com/vinothkannans",
    "followers_url": "https://api.github.com/users/vinothkannans/followers",
    "following_url": "https://api.github.com/users/vinothkannans/following{/other_user}",
    "gists_url": "https://api.github.com/users/vinothkannans/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vinothkannans/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vinothkannans/subscriptions",
    "organizations_url": "https://api.github.com/users/vinothkannans/orgs",
    "repos_url": "https://api.github.com/users/vinothkannans/repos",
    "events_url": "https://api.github.com/users/vinothkannans/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vinothkannans/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7dbde18f025dfa03103dbc75a647d28ed8752e02",
      "url": "https://api.github.com/repos/discourse/discourse/commits/7dbde18f025dfa03103dbc75a647d28ed8752e02",
      "html_url": "https://github.com/discourse/discourse/commit/7dbde18f025dfa03103dbc75a647d28ed8752e02"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 18,
    "deletions": 2
  },
  "files": [
    {
      "sha": "9f11c1f45f8313fc8bd298ded36bb280fc870492",
      "filename": "lib/excerpt_parser.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/9a6606dd305f4f32ed464838fb4d85ac4788f259/lib/excerpt_parser.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/9a6606dd305f4f32ed464838fb4d85ac4788f259/lib/excerpt_parser.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/excerpt_parser.rb?ref=9a6606dd305f4f32ed464838fb4d85ac4788f259",
      "patch": "@@ -19,6 +19,7 @@ def initialize(length, options = nil)\n     @keep_emoji_images = options[:keep_emoji_images] == true\n     @keep_onebox_source = options[:keep_onebox_source] == true\n     @keep_onebox_body = options[:keep_onebox_body] == true\n+    @keep_quotes = options[:keep_quotes] == true\n     @remap_emoji = options[:remap_emoji] == true\n     @start_excerpt = false\n     @in_details_depth = 0\n@@ -100,8 +101,10 @@ def start_element(name, attributes = [])\n         @in_quote = true\n       end\n \n-      if @keep_onebox_body && attributes['class'].include?('quote') && attributes['data-topic'].present?\n-        @in_quote = false\n+      if attributes['class'].include?('quote')\n+        if @keep_quotes || (@keep_onebox_body && attributes['data-topic'].present?)\n+          @in_quote = false\n+        end\n       end\n \n     when 'article'"
    },
    {
      "sha": "8f0654bab5f85baa8bd08776d79c2fafefe68816",
      "filename": "spec/components/excerpt_parser_spec.rb",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/discourse/discourse/blob/9a6606dd305f4f32ed464838fb4d85ac4788f259/spec/components/excerpt_parser_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/9a6606dd305f4f32ed464838fb4d85ac4788f259/spec/components/excerpt_parser_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/excerpt_parser_spec.rb?ref=9a6606dd305f4f32ed464838fb4d85ac4788f259",
      "patch": "@@ -81,4 +81,17 @@\n       HTML\n     end\n   end\n+\n+  describe \"keep_quotes parameter\" do\n+    it \"should keep the quoted content in html\" do\n+      html = <<~HTML.strip\n+        <aside class=\"quote\">\n+          <blockquote>\n+            This is a quoted text.\n+          </blockquote>\n+        </aside>\n+      HTML\n+      expect(ExcerptParser.get_excerpt(html, 100, keep_quotes: true)).to eq(\"This is a quoted text.\")\n+    end\n+  end\n end"
    }
  ]
}
