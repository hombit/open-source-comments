{
  "sha": "78bb9dd1537b29c731cf3992424cf12190c8adee",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjc4YmI5ZGQxNTM3YjI5YzczMWNmMzk5MjQyNGNmMTIxOTBjOGFkZWU=",
  "commit": {
    "author": {
      "name": "Pavel Mineev",
      "email": "pavel@mineev.me",
      "date": "2020-01-05T15:48:10Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2020-01-07T09:57:34Z"
    },
    "message": "Add auto-changing theme for development\n\nTheme is changing follows to OS settings.",
    "tree": {
      "sha": "62f398bb7654f5885ef97224b176bf00fc8ff236",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/62f398bb7654f5885ef97224b176bf00fc8ff236"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/78bb9dd1537b29c731cf3992424cf12190c8adee",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/78bb9dd1537b29c731cf3992424cf12190c8adee",
  "html_url": "https://github.com/umputun/remark/commit/78bb9dd1537b29c731cf3992424cf12190c8adee",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/78bb9dd1537b29c731cf3992424cf12190c8adee/comments",
  "author": {
    "login": "akellbl4",
    "id": 2330682,
    "node_id": "MDQ6VXNlcjIzMzA2ODI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/2330682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/akellbl4",
    "html_url": "https://github.com/akellbl4",
    "followers_url": "https://api.github.com/users/akellbl4/followers",
    "following_url": "https://api.github.com/users/akellbl4/following{/other_user}",
    "gists_url": "https://api.github.com/users/akellbl4/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/akellbl4/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/akellbl4/subscriptions",
    "organizations_url": "https://api.github.com/users/akellbl4/orgs",
    "repos_url": "https://api.github.com/users/akellbl4/repos",
    "events_url": "https://api.github.com/users/akellbl4/events{/privacy}",
    "received_events_url": "https://api.github.com/users/akellbl4/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c660d2a5229f8fd7959f9dab6b084d1c86cba7de",
      "url": "https://api.github.com/repos/umputun/remark/commits/c660d2a5229f8fd7959f9dab6b084d1c86cba7de",
      "html_url": "https://github.com/umputun/remark/commit/c660d2a5229f8fd7959f9dab6b084d1c86cba7de"
    }
  ],
  "stats": {
    "total": 77,
    "additions": 51,
    "deletions": 26
  },
  "files": [
    {
      "sha": "1950b09c701ef410b00a78bb2486e525fba3eb3b",
      "filename": "frontend/index.ejs",
      "status": "modified",
      "additions": 51,
      "deletions": 26,
      "changes": 77,
      "blob_url": "https://github.com/umputun/remark/blob/78bb9dd1537b29c731cf3992424cf12190c8adee/frontend/index.ejs",
      "raw_url": "https://github.com/umputun/remark/raw/78bb9dd1537b29c731cf3992424cf12190c8adee/frontend/index.ejs",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/index.ejs?ref=78bb9dd1537b29c731cf3992424cf12190c8adee",
      "patch": "@@ -10,6 +10,13 @@\n         padding: 0;\n         margin: 0;\n         font-family: -system-ui, sans-serif;\n+        color: #333;\n+        background: #fff;\n+      }\n+\n+      a {\n+        color: #0aa;\n+        text-decoration: none;\n       }\n \n       .container {\n@@ -22,10 +29,6 @@\n         color: #ddd;\n       }\n \n-      .document_theme_dark a {\n-        color: #5e5eff;\n-      }\n-\n       .widgets {\n         display: flex;\n         flex-wrap: nowrap;\n@@ -59,22 +62,6 @@\n         }\n       }\n     </style>\n-\n-    <script>\n-      function toggleTheme() {\n-        var body = document.querySelector('body');\n-\n-        if (body.classList.contains('document_theme_dark')) {\n-          body.classList.add('document_theme_light');\n-          body.classList.remove('document_theme_dark');\n-          window.REMARK42.changeTheme('light');\n-        } else {\n-          body.classList.add('document_theme_dark');\n-          body.classList.remove('document_theme_light');\n-          window.REMARK42.changeTheme('dark');\n-        }\n-      }\n-    </script>\n   </head>\n   <body>\n     <div class=\"container\">\n@@ -93,26 +80,64 @@\n           <div class=\"widget__frame widget__counter-frame\">Comments count: <span class=\"remark42__counter\"></span></div>\n         </div>\n       </div>\n-      <p><button onclick=\"toggleTheme()\">Toggle theme</button></p>\n+      <p><button id=\"toggle-theme\">Toggle theme</button></p>\n       <div id=\"remark42\"></div>\n     </div>\n \n     <script>\n+      var body = document.querySelector('body');\n+      var theme = 'light';\n+\n+      if ('matchMedia' in window) {\n+        var mq = window.matchMedia('(prefers-color-scheme: dark)');\n+\n+        if (mq.matches) {\n+          body.classList.add('document_theme_dark');\n+        }\n+\n+        function getTheme() {\n+          return mq.matches ? 'dark' : 'light';\n+        }\n+\n+        theme = getTheme();\n+\n+        mq.addListener(function() {\n+          REMARK42.changeTheme(getTheme());\n+        });\n+      }\n+\n+      document.getElementById('toggle-theme').addEventListener('click', function(e) {\n+        e.preventDefault();\n+\n+        if (body.classList.contains('document_theme_dark')) {\n+          body.classList.add('document_theme_light');\n+          body.classList.remove('document_theme_dark');\n+          window.REMARK42.changeTheme('light');\n+          return;\n+        }\n+\n+        body.classList.add('document_theme_dark');\n+        body.classList.remove('document_theme_light');\n+        window.REMARK42.changeTheme('dark');\n+      });\n+\n       var remark_config = {\n         site_id: 'remark',\n         host: window.location.origin,\n         url: 'https://remark42.com/demo/',\n-        components: ['embed', 'counter']\n+        components: ['embed', 'counter'],\n+        theme: theme\n       };\n \n-      (function(c) {\n+      (function(c, d) {\n         for (var i = 0; i < c.length; i++) {\n-          var d = document,\n-            s = d.createElement('script');\n+          var s = d.createElement('script');\n+\n           s.src = remark_config.host + '/web/' + c[i] + '.js';\n+\n           (d.head || d.body).appendChild(s);\n         }\n-      })(remark_config.components || ['embed']);\n+      })(remark_config.components || ['embed'], document);\n     </script>\n     <noscript>\n       Please enable JavaScript to view the comments powered by Remark."
    }
  ]
}
