{
  "sha": "531016f99b164f327ab1b57ef6e521b7c1fd3def",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo1MzEwMTZmOTliMTY0ZjMyN2FiMWI1N2VmNmU1MjFiN2MxZmQzZGVm",
  "commit": {
    "author": {
      "name": "Jarek Radosz",
      "email": "jradosz@gmail.com",
      "date": "2020-01-09T16:08:55Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-01-09T16:08:55Z"
    },
    "message": "DEV: Add missing indexes to user_profiles (#8691)\n\n* DEV: Update model annotations\r\n* DEV: Add missing indexes to user_profiles\r\n\r\nThe columns were changed in https://github.com/discourse/discourse/commit/24347ace10ad54f7f3bbc687bc7bc37734f558e4#diff-baa5914c0c7cddf3c8b5cd9139e0d091",
    "tree": {
      "sha": "a02548eed1e5d681773f9a71762f46a954896672",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/a02548eed1e5d681773f9a71762f46a954896672"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/531016f99b164f327ab1b57ef6e521b7c1fd3def",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeF1AXCRBK7hj4Ov3rIwAAdHIIADc8USivOTGK3XGxhRUkKEgQ\nyqOTH17gpvxQpiXYAqZYylg+LxPj5NsF4hcjFzOO6boLqt/sW21Rlc7TeQ8hrifq\nKca0r3mK7kmMi7dOGgCMuCx4jc7O3G6ueW+Eb2IbJ3SMQY9eDD89Ad0r+1FTC+TQ\nXQoJYhKATJSDGdAZs01wZBitBJtOQj0qs5H9Wy8bQVEvfMyK2754t5AA0EjiQTKG\nf+xxjR2t8dj0YZC+5az09fsrV2WrCS9t5u4lR59F2sK3Kp1IoOzj2MyU97CvNVlN\nvLB6QO7/GFbT+PVqN4DKgfYrWbr8YWH5Fdoieog203B5IYkj0X6+yQtP82zzjY4=\n=fnt+\n-----END PGP SIGNATURE-----\n",
      "payload": "tree a02548eed1e5d681773f9a71762f46a954896672\nparent 2a06f6709912991d0468cbec0db1d4f006a28481\nauthor Jarek Radosz <jradosz@gmail.com> 1578586135 +0100\ncommitter GitHub <noreply@github.com> 1578586135 +0100\n\nDEV: Add missing indexes to user_profiles (#8691)\n\n* DEV: Update model annotations\r\n* DEV: Add missing indexes to user_profiles\r\n\r\nThe columns were changed in https://github.com/discourse/discourse/commit/24347ace10ad54f7f3bbc687bc7bc37734f558e4#diff-baa5914c0c7cddf3c8b5cd9139e0d091"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/531016f99b164f327ab1b57ef6e521b7c1fd3def",
  "html_url": "https://github.com/discourse/discourse/commit/531016f99b164f327ab1b57ef6e521b7c1fd3def",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/531016f99b164f327ab1b57ef6e521b7c1fd3def/comments",
  "author": {
    "login": "CvX",
    "id": 66961,
    "node_id": "MDQ6VXNlcjY2OTYx",
    "avatar_url": "https://avatars1.githubusercontent.com/u/66961?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/CvX",
    "html_url": "https://github.com/CvX",
    "followers_url": "https://api.github.com/users/CvX/followers",
    "following_url": "https://api.github.com/users/CvX/following{/other_user}",
    "gists_url": "https://api.github.com/users/CvX/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/CvX/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/CvX/subscriptions",
    "organizations_url": "https://api.github.com/users/CvX/orgs",
    "repos_url": "https://api.github.com/users/CvX/repos",
    "events_url": "https://api.github.com/users/CvX/events{/privacy}",
    "received_events_url": "https://api.github.com/users/CvX/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2a06f6709912991d0468cbec0db1d4f006a28481",
      "url": "https://api.github.com/repos/discourse/discourse/commits/2a06f6709912991d0468cbec0db1d4f006a28481",
      "html_url": "https://github.com/discourse/discourse/commit/2a06f6709912991d0468cbec0db1d4f006a28481"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 19,
    "deletions": 5
  },
  "files": [
    {
      "sha": "bba98cd9b49102dc28eedfa02b52e714b56feae4",
      "filename": "app/models/user_custom_field.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_custom_field.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_custom_field.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/user_custom_field.rb?ref=531016f99b164f327ab1b57ef6e521b7c1fd3def",
      "patch": "@@ -17,5 +17,7 @@ class UserCustomField < ActiveRecord::Base\n #\n # Indexes\n #\n-#  index_user_custom_fields_on_user_id_and_name  (user_id,name)\n+#  idx_user_custom_fields_last_reminded_at          (name,user_id) UNIQUE WHERE ((name)::text = 'last_reminded_at'::text)\n+#  idx_user_custom_fields_remind_assigns_frequency  (name,user_id) UNIQUE WHERE ((name)::text = 'remind_assigns_frequency'::text)\n+#  index_user_custom_fields_on_user_id_and_name     (user_id,name)\n #"
    },
    {
      "sha": "ad2701e70d4828b0624f9ca957b2660b55268f20",
      "filename": "app/models/user_profile.rb",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_profile.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_profile.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/user_profile.rb?ref=531016f99b164f327ab1b57ef6e521b7c1fd3def",
      "patch": "@@ -171,10 +171,10 @@ def self.remove_featured_topic_from_all_profiles(topic)\n #\n # Indexes\n #\n-#  index_user_profiles_on_bio_cooked_version      (bio_cooked_version)\n-#  index_user_profiles_on_card_background         (card_background)\n-#  index_user_profiles_on_granted_title_badge_id  (granted_title_badge_id)\n-#  index_user_profiles_on_profile_background      (profile_background)\n+#  index_user_profiles_on_bio_cooked_version            (bio_cooked_version)\n+#  index_user_profiles_on_card_background_upload_id     (card_background_upload_id)\n+#  index_user_profiles_on_granted_title_badge_id        (granted_title_badge_id)\n+#  index_user_profiles_on_profile_background_upload_id  (profile_background_upload_id)\n #\n # Foreign Keys\n #"
    },
    {
      "sha": "cda2c1513abcc7d41ac6d058b37415b54c936c73",
      "filename": "app/models/user_stat.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_stat.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/531016f99b164f327ab1b57ef6e521b7c1fd3def/app/models/user_stat.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/user_stat.rb?ref=531016f99b164f327ab1b57ef6e521b7c1fd3def",
      "patch": "@@ -224,4 +224,5 @@ def trigger_badges\n #  flags_disagreed          :integer          default(0), not null\n #  flags_ignored            :integer          default(0), not null\n #  first_unread_at          :datetime         not null\n+#  distinct_badge_count     :integer          default(0), not null\n #"
    },
    {
      "sha": "861a78a9889359d10ed9e491ca537c3748d86b01",
      "filename": "db/migrate/20200109130028_update_user_profiles_indexes.rb",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/discourse/discourse/blob/531016f99b164f327ab1b57ef6e521b7c1fd3def/db/migrate/20200109130028_update_user_profiles_indexes.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/531016f99b164f327ab1b57ef6e521b7c1fd3def/db/migrate/20200109130028_update_user_profiles_indexes.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/db/migrate/20200109130028_update_user_profiles_indexes.rb?ref=531016f99b164f327ab1b57ef6e521b7c1fd3def",
      "patch": "@@ -0,0 +1,11 @@\n+# frozen_string_literal: true\n+\n+class UpdateUserProfilesIndexes < ActiveRecord::Migration[6.0]\n+  def change\n+    remove_index :user_profiles, :card_background\n+    add_index :user_profiles, :card_background_upload_id\n+\n+    remove_index :user_profiles, :profile_background\n+    add_index :user_profiles, :profile_background_upload_id\n+  end\n+end"
    }
  ]
}
