{
  "sha": "17be0036520db8cbbd39fe320fef6ea752b29aa2",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjE3YmUwMDM2NTIwZGI4Y2JiZDM5ZmUzMjBmZWY2ZWE3NTJiMjlhYTI=",
  "commit": {
    "author": {
      "name": "Konstantin Krivlenia",
      "email": "krivlenia@gmail.com",
      "date": "2020-01-14T00:26:32Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2020-01-14T00:26:32Z"
    },
    "message": "#378 Emoji suggestions (#546)\n\n* #378 add emoji suggestion\r\n\r\n* #378 use lazy load for nodeEmoji\r\n\r\n* #378 apply remark styles only for light theme\r\n\r\n* #378 add dark theme\r\n\r\n* #378 fix test\r\n\r\n* #378 use permanent class names\r\n\r\n*  #378 flip if else for readability",
    "tree": {
      "sha": "1fe5a1a9f3e1ea491fb8d867643b2c9acd10fdc7",
      "url": "https://api.github.com/repos/umputun/remark/git/trees/1fe5a1a9f3e1ea491fb8d867643b2c9acd10fdc7"
    },
    "url": "https://api.github.com/repos/umputun/remark/git/commits/17be0036520db8cbbd39fe320fef6ea752b29aa2",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark/commits/17be0036520db8cbbd39fe320fef6ea752b29aa2",
  "html_url": "https://github.com/umputun/remark/commit/17be0036520db8cbbd39fe320fef6ea752b29aa2",
  "comments_url": "https://api.github.com/repos/umputun/remark/commits/17be0036520db8cbbd39fe320fef6ea752b29aa2/comments",
  "author": {
    "login": "Mavrin",
    "id": 1193817,
    "node_id": "MDQ6VXNlcjExOTM4MTc=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/1193817?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Mavrin",
    "html_url": "https://github.com/Mavrin",
    "followers_url": "https://api.github.com/users/Mavrin/followers",
    "following_url": "https://api.github.com/users/Mavrin/following{/other_user}",
    "gists_url": "https://api.github.com/users/Mavrin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Mavrin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Mavrin/subscriptions",
    "organizations_url": "https://api.github.com/users/Mavrin/orgs",
    "repos_url": "https://api.github.com/users/Mavrin/repos",
    "events_url": "https://api.github.com/users/Mavrin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Mavrin/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3c12fde0f87ff5454c8de63b0801a975ffaf59d4",
      "url": "https://api.github.com/repos/umputun/remark/commits/3c12fde0f87ff5454c8de63b0801a975ffaf59d4",
      "html_url": "https://github.com/umputun/remark/commit/3c12fde0f87ff5454c8de63b0801a975ffaf59d4"
    }
  ],
  "stats": {
    "total": 343,
    "additions": 304,
    "deletions": 39
  },
  "files": [
    {
      "sha": "4c49bd78f1d08f2bc09fa0bd8191ed38b7dce5e3",
      "filename": "frontend/.gitignore",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/.gitignore",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/.gitignore",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/.gitignore?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -0,0 +1 @@\n+.env"
    },
    {
      "sha": "237c2152066b25ca6557d09083ab2f26766c7f96",
      "filename": "frontend/app/@types/module.css.d.ts",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/@types/module.css.d.ts",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/@types/module.css.d.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/@types/module.css.d.ts?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -0,0 +1,7 @@\n+declare module '*.module.pcss' {\n+  interface ClassNames {\n+    [className: string]: string;\n+  }\n+  const classNames: ClassNames;\n+  export = classNames;\n+}"
    },
    {
      "sha": "4eb7357e23697aef48beee1664afd1e3c3dac364",
      "filename": "frontend/app/@types/preact/index.d.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/@types/preact/index.d.ts",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/@types/preact/index.d.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/@types/preact/index.d.ts?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -19,6 +19,10 @@ declare module 'preact/src/jsx' {\n       'md-link': any;\n       'md-unordered-list': any;\n       'md-ordered-list': any;\n+      'text-expander': {\n+        ref: any;\n+        children: any;\n+      };\n     }\n   }\n }"
    },
    {
      "sha": "76f1bc79618ba4e59767e2466cae15e6d2dbe39c",
      "filename": "frontend/app/common/static_store.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/common/static_store.ts",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/common/static_store.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/common/static_store.ts?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -29,6 +29,7 @@ export const StaticStore: StaticStoreType = {\n     simple_view: false,\n     anon_vote: false,\n     email_notifications: false,\n+    emoji_enabled: false,\n   },\n   query: querySettings as QuerySettingsType,\n };"
    },
    {
      "sha": "a159e7dea6892fc7b73b1c78296393bc022ed2e3",
      "filename": "frontend/app/common/types.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/common/types.ts",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/common/types.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/common/types.ts?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -115,6 +115,7 @@ export interface Config {\n   simple_view: boolean;\n   anon_vote: boolean;\n   email_notifications: boolean;\n+  emoji_enabled: boolean;\n }\n \n export interface RemarkConfig {"
    },
    {
      "sha": "0fb4a736c8f939581f83d0161e66825c2af9f751",
      "filename": "frontend/app/components/comment-form/comment-form.tsx",
      "status": "modified",
      "additions": 21,
      "deletions": 19,
      "changes": 40,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/comment-form.tsx",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/comment-form.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/components/comment-form/comment-form.tsx?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -15,6 +15,7 @@ import { SubscribeByRSS } from './__subscribe-by-rss';\n \n import MarkdownToolbar from './markdown-toolbar';\n import TextareaAutosize from './textarea-autosize';\n+import { TextExpander } from './text-expander';\n \n let textareaId = 0;\n \n@@ -144,7 +145,7 @@ export class CommentForm extends Component<Props, State> {\n   }\n \n   send(e: Event) {\n-    const text = this.state.text;\n+    const text = this.textAreaRef.current ? this.textAreaRef.current.getValue() : this.state.text;\n     const props = this.props;\n \n     if (e) e.preventDefault();\n@@ -156,7 +157,7 @@ export class CommentForm extends Component<Props, State> {\n       this.setState({ preview: null, text: '' });\n     }\n \n-    this.setState({ isDisabled: true, isErrorShown: false });\n+    this.setState({ isDisabled: true, isErrorShown: false, text });\n \n     props\n       .onSubmit(text, pageTitle || document.title)\n@@ -172,11 +173,11 @@ export class CommentForm extends Component<Props, State> {\n   }\n \n   getPreview() {\n-    const text = this.state.text;\n+    const text = this.textAreaRef.current ? this.textAreaRef.current.getValue() : this.state.text;\n \n     if (!text || !text.trim()) return;\n \n-    this.setState({ isErrorShown: false, errorMessage: null });\n+    this.setState({ isErrorShown: false, errorMessage: null, text });\n \n     this.props\n       .getPreview(text)\n@@ -369,21 +370,22 @@ export class CommentForm extends Component<Props, State> {\n           </div>\n         )}\n         <div className=\"comment-form__field-wrapper\">\n-          <TextareaAutosize\n-            id={this.textareaId}\n-            onPaste={this.onPaste}\n-            ref={this.textAreaRef}\n-            className=\"comment-form__field\"\n-            placeholder=\"Your comment here\"\n-            value={text}\n-            maxLength={maxLength}\n-            onInput={this.onInput}\n-            onKeyDown={this.onKeyDown}\n-            disabled={isDisabled}\n-            autofocus={!!props.autofocus}\n-            spellcheck={true}\n-          />\n-\n+          <TextExpander>\n+            <TextareaAutosize\n+              id={this.textareaId}\n+              onPaste={this.onPaste}\n+              ref={this.textAreaRef}\n+              className=\"comment-form__field\"\n+              placeholder=\"Your comment here\"\n+              value={text}\n+              maxLength={maxLength}\n+              onInput={this.onInput}\n+              onKeyDown={this.onKeyDown}\n+              disabled={isDisabled}\n+              autofocus={!!props.autofocus}\n+              spellcheck={true}\n+            />\n+          </TextExpander>\n           {charactersLeft < 100 && <span className=\"comment-form__counter\">{charactersLeft}</span>}\n         </div>\n "
    },
    {
      "sha": "9f0d5d3bd44c50cfce2c790fb42ca84a6bbd5870",
      "filename": "frontend/app/components/comment-form/text-expander.module.pcss",
      "status": "added",
      "additions": 61,
      "deletions": 0,
      "changes": 61,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/text-expander.module.pcss",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/text-expander.module.pcss",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/components/comment-form/text-expander.module.pcss?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -0,0 +1,61 @@\n+.suggester {\n+  position: absolute;\n+  top: 0;\n+  left: 0;\n+  z-index: 30;\n+  min-width: 180px;\n+  padding: 0;\n+  margin: 24px 0 0;\n+  list-style: none;\n+  cursor: pointer;\n+  background: #fff;\n+  border: 1px solid #dfe2e5;\n+  border-radius: 3px;\n+  box-shadow: 0 1px 5px rgba(27, 31, 35, 0.15);\n+}\n+\n+.suggesterDark {\n+  background: #22201c;\n+  color: #ddd;\n+  border: 1px solid #333;\n+}\n+\n+.suggesterItem {\n+  display: block;\n+  padding: 4px 8px;\n+  font-size: 14px;\n+  font-weight: 600;\n+  border-bottom: 1px solid #dfe2e5;\n+}\n+\n+\n+\n+.suggesterItemDark {\n+  border-bottom: 1px solid #333;\n+}\n+\n+.suggesterItem:hover,\n+.suggesterItem[aria-selected='true'] {\n+  color: #fff;\n+  text-decoration: none;\n+  background-color: rgba(37, 156, 154, 0.6);\n+}\n+\n+.suggesterItem:first-child {\n+  border-top-left-radius: 3px;\n+  border-top-right-radius: 3px;\n+}\n+.suggesterItem:last-child {\n+  border-bottom-left-radius: 3px;\n+  border-bottom-right-radius: 3px;\n+  border-bottom: none;\n+}\n+\n+.emojiResult {\n+  margin-right: 0;\n+  display: inline-block;\n+  line-height: 20px;\n+  font-size: 20px;\n+  height: 20px;\n+  vertical-align: middle;\n+}"
    },
    {
      "sha": "0b4fe0898ae90ace356f4ca53ff9628eb52d6314",
      "filename": "frontend/app/components/comment-form/text-expander.tsx",
      "status": "added",
      "additions": 98,
      "deletions": 0,
      "changes": 98,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/text-expander.tsx",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/text-expander.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/components/comment-form/text-expander.tsx?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -0,0 +1,98 @@\n+/** @jsx createElement */\n+import { createElement, Fragment, render, FunctionalComponent } from 'preact';\n+import { StaticStore } from '@app/common/static_store';\n+import { useEffect, useRef } from 'preact/hooks';\n+import '@github/text-expander-element';\n+import styles from './text-expander.module.pcss';\n+import cx from 'classnames';\n+import { Theme } from '@app/common/types';\n+import useTheme from '@app/hooks/useTheme';\n+\n+type Emoji = {\n+  key: string;\n+  emoji: string;\n+};\n+\n+function SuggestionList({ items, theme }: { items: Array<Emoji>; theme: Theme }) {\n+  const isDarkTheme = theme === `dark`;\n+  const suggesterClass = cx(styles.suggester, { [styles.suggesterDark]: isDarkTheme });\n+  const suggesterItemClass = cx(styles.suggesterItem, { [styles.suggesterItemDark]: isDarkTheme });\n+  return (\n+    <ul className={suggesterClass}>\n+      {items.map(({ key, emoji }: Emoji) => {\n+        return (\n+          // eslint-disable-next-line jsx-a11y/role-has-required-aria-props\n+          <li role=\"option\" className={suggesterItemClass} data-value={key}>\n+            <span className={styles.emojiResult}>{emoji}</span> {key}\n+          </li>\n+        );\n+      })}\n+    </ul>\n+  );\n+}\n+\n+function searchEmoji(key: string, text: string, theme: Theme) {\n+  return import(/* webpackChunkName: \"node-emoji\" */ `node-emoji`)\n+    .then(nodeEmoji => {\n+      if (key === ':') {\n+        const emojiList = nodeEmoji.search(text);\n+        if (emojiList.length === 0) {\n+          return Promise.resolve({ matched: false });\n+        }\n+        const fragment = document.createDocumentFragment();\n+        render(<SuggestionList theme={theme} items={emojiList.slice(0, 5)} />, fragment);\n+        return Promise.resolve({ matched: true, fragment: fragment.firstChild });\n+      }\n+      return Promise.resolve({ matched: false });\n+    })\n+    .catch(() => Promise.resolve({ matched: false }));\n+}\n+\n+type ChangeListerEvent = Event & {\n+  detail: {\n+    key: string;\n+    text: string;\n+    provide(value: Promise<{ matched: boolean }>): void;\n+  };\n+};\n+\n+type ValueListerEvent = Event & {\n+  detail: {\n+    key: string;\n+    value: string;\n+    item: HTMLLIElement;\n+  };\n+};\n+\n+export const TextExpander: FunctionalComponent = ({ children }) => {\n+  const expanderRef = useRef<HTMLElement>();\n+  const theme = useTheme();\n+  useEffect(() => {\n+    if (expanderRef.current) {\n+      const expander = expanderRef.current;\n+      expander.setAttribute(`keys`, ':');\n+      const textExpanderChangeLister: EventListener = (event: Event) => {\n+        const { provide, key, text } = (event as ChangeListerEvent).detail;\n+        provide(searchEmoji(key, text, theme));\n+      };\n+      const textExpanderValueListener = (event: Event) => {\n+        const { key, item } = (event as ValueListerEvent).detail;\n+        if (key === ':') {\n+          (event as ValueListerEvent).detail.value = `:${item.dataset.value}:`;\n+        }\n+      };\n+      expander.addEventListener('text-expander-change', textExpanderChangeLister);\n+      expander.addEventListener('text-expander-value', textExpanderValueListener);\n+      return () => {\n+        expander.removeEventListener('text-expander-change', textExpanderChangeLister);\n+        expander.removeEventListener('text-expander-value', textExpanderValueListener);\n+      };\n+    }\n+    return () => {};\n+  }, [theme]);\n+  if (StaticStore.config.emoji_enabled) {\n+    return <text-expander ref={expanderRef}>{children}</text-expander>;\n+  }\n+\n+  return <Fragment>{children}</Fragment>;\n+};"
    },
    {
      "sha": "ff1a06ec3bbcb4675f4fc7eda9a1f551d4846480",
      "filename": "frontend/app/components/comment-form/textarea-autosize.tsx",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/textarea-autosize.tsx",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/components/comment-form/textarea-autosize.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/components/comment-form/textarea-autosize.tsx?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -58,7 +58,9 @@ export default class TextareaAutosize extends Component<Props> {\n   onRef(node: HTMLTextAreaElement) {\n     this.textareaRef = node;\n   }\n-\n+  getValue() {\n+    return this.textareaRef ? this.textareaRef.value : '';\n+  }\n   autoResize() {\n     if (this.textareaRef) {\n       this.textareaRef.style.height = '';"
    },
    {
      "sha": "22e7baa4beef7493867ff97c58e9d48948bb80a4",
      "filename": "frontend/app/testUtils/index.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/testUtils/index.ts",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/app/testUtils/index.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/app/testUtils/index.ts?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -24,5 +24,6 @@ beforeEach(() => {\n     simple_view: false,\n     anon_vote: false,\n     email_notifications: false,\n+    emoji_enabled: true,\n   };\n });"
    },
    {
      "sha": "e28caa1b0522ee5f0c1cc4a62203e55031a7abda",
      "filename": "frontend/jest.config.js",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/jest.config.js",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/jest.config.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/jest.config.js?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -8,6 +8,7 @@ module.exports = {\n   testRegex: '(\\\\.|/)(test|spec)\\\\.(j|t)s(x?)$',\n   moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],\n   moduleNameMapper: {\n+    '\\\\.module.pcss': `identity-obj-proxy`,\n     '\\\\.scss$': '<rootDir>/app/testUtils/mockStyles.js',\n     '@app/(.*)': '<rootDir>/app/$1',\n     '^react$': 'preact/compat',"
    },
    {
      "sha": "7534f3a9a83b720e05e47e80ec04c104408c705a",
      "filename": "frontend/package-lock.json",
      "status": "modified",
      "additions": 62,
      "deletions": 0,
      "changes": 62,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/package-lock.json",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/package-lock.json",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/package-lock.json?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -1137,11 +1137,24 @@\n         \"minimist\": \"^1.2.0\"\n       }\n     },\n+    \"@github/combobox-nav\": {\n+      \"version\": \"1.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@github/combobox-nav/-/combobox-nav-1.0.1.tgz\",\n+      \"integrity\": \"sha512-5I/jWX/ymlZ0zIbBLZVkZXE80cYqwnNRkFOw3DrwklEqHouTyNWrXUn9z2kAQL4aSKEYqLbyZbTyCB59TYcJjg==\"\n+    },\n     \"@github/markdown-toolbar-element\": {\n       \"version\": \"1.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/@github/markdown-toolbar-element/-/markdown-toolbar-element-1.1.0.tgz\",\n       \"integrity\": \"sha512-QBTFBSsfreBiS0h//3NL0D7qC5rsU2M9kwahKQWna01cbVMmgismW/PZlaizub+0Q3Yw2VBYAr08xJp/v0BiQQ==\"\n     },\n+    \"@github/text-expander-element\": {\n+      \"version\": \"1.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@github/text-expander-element/-/text-expander-element-1.0.1.tgz\",\n+      \"integrity\": \"sha512-QAOvzcQ6mA/k9P2NSk+1pjLeL5XD86qZlQY4U13uVe4Pitb6xh08hFgUgZpDUeUkm0z3bphMFN/czuP/58/6zg==\",\n+      \"requires\": {\n+        \"@github/combobox-nav\": \"^1.0.0\"\n+      }\n+    },\n     \"@jest/console\": {\n       \"version\": \"24.7.1\",\n       \"resolved\": \"https://registry.npmjs.org/@jest/console/-/console-24.7.1.tgz\",\n@@ -1758,6 +1771,11 @@\n         \"@types/node\": \"*\"\n       }\n     },\n+    \"@types/classnames\": {\n+      \"version\": \"2.2.9\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/classnames/-/classnames-2.2.9.tgz\",\n+      \"integrity\": \"sha512-MNl+rT5UmZeilaPxAVs6YaPC2m6aA8rofviZbhbxpPpl61uKodfdQVsBtgJGTqGizEf02oW3tsVe7FYB8kK14A==\"\n+    },\n     \"@types/core-js\": {\n       \"version\": \"2.5.2\",\n       \"resolved\": \"https://registry.npmjs.org/@types/core-js/-/core-js-2.5.2.tgz\",\n@@ -1867,6 +1885,11 @@\n       \"integrity\": \"sha512-JNbGaHFCLwgHn/iCckiGSOZ1XYHsKFwREtzPwSGCVld1SGhOlmZw2D4ZI94HQCrBHbADzW9m4LER/8olJTRGHA==\",\n       \"dev\": true\n     },\n+    \"@types/node-emoji\": {\n+      \"version\": \"1.8.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/node-emoji/-/node-emoji-1.8.1.tgz\",\n+      \"integrity\": \"sha512-0fRfA90FWm6KJfw6P9QGyo0HDTCmthZ7cWaBQndITlaWLTZ6njRyKwrwpzpg+n6kBXBIGKeUHEQuBx7bphGJkA==\"\n+    },\n     \"@types/normalize-package-data\": {\n       \"version\": \"2.4.0\",\n       \"resolved\": \"https://registry.npmjs.org/@types/normalize-package-data/-/normalize-package-data-2.4.0.tgz\",\n@@ -3579,6 +3602,11 @@\n         }\n       }\n     },\n+    \"classnames\": {\n+      \"version\": \"2.2.6\",\n+      \"resolved\": \"https://registry.npmjs.org/classnames/-/classnames-2.2.6.tgz\",\n+      \"integrity\": \"sha512-JR/iSQOSt+LQIWwrwEzJ9uk0xfN3mTVYMwt1Ir5mUcSN6pU+V4zQFFaJsclJbPuAUQH+yfWef6tm7l1quW3C8Q==\"\n+    },\n     \"clean-css\": {\n       \"version\": \"4.2.1\",\n       \"resolved\": \"https://registry.npmjs.org/clean-css/-/clean-css-4.2.1.tgz\",\n@@ -4698,6 +4726,12 @@\n         \"domelementtype\": \"1\"\n       }\n     },\n+    \"dotenv\": {\n+      \"version\": \"8.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/dotenv/-/dotenv-8.2.0.tgz\",\n+      \"integrity\": \"sha512-8sJ78ElpbDJBHNeBzUbUVLsqKdccaa/BXF1uPTw3GrvQTBgrQrtObr2mUrE38vzYd8cEv+m/JBfDLioYcfXoaw==\",\n+      \"dev\": true\n+    },\n     \"duplexer\": {\n       \"version\": \"0.1.1\",\n       \"resolved\": \"https://registry.npmjs.org/duplexer/-/duplexer-0.1.1.tgz\",\n@@ -6771,6 +6805,12 @@\n         \"har-schema\": \"^2.0.0\"\n       }\n     },\n+    \"harmony-reflect\": {\n+      \"version\": \"1.6.1\",\n+      \"resolved\": \"https://registry.npmjs.org/harmony-reflect/-/harmony-reflect-1.6.1.tgz\",\n+      \"integrity\": \"sha512-WJTeyp0JzGtHcuMsi7rw2VwtkvLa+JyfEKJCFyfcS0+CDkjQ5lHPu7zEhFZP+PDSRrEgXa5Ah0l1MbgbE41XjA==\",\n+      \"dev\": true\n+    },\n     \"has\": {\n       \"version\": \"1.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/has/-/has-1.0.3.tgz\",\n@@ -7249,6 +7289,15 @@\n         \"postcss\": \"^7.0.14\"\n       }\n     },\n+    \"identity-obj-proxy\": {\n+      \"version\": \"3.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/identity-obj-proxy/-/identity-obj-proxy-3.0.0.tgz\",\n+      \"integrity\": \"sha1-lNK9qWCERT7zb7xarsN+D3nx/BQ=\",\n+      \"dev\": true,\n+      \"requires\": {\n+        \"harmony-reflect\": \"^1.4.6\"\n+      }\n+    },\n     \"ieee754\": {\n       \"version\": \"1.1.13\",\n       \"resolved\": \"https://registry.npmjs.org/ieee754/-/ieee754-1.1.13.tgz\",\n@@ -10182,6 +10231,11 @@\n       \"integrity\": \"sha1-7dFMgk4sycHgsKG0K7UhBRakJDg=\",\n       \"dev\": true\n     },\n+    \"lodash.toarray\": {\n+      \"version\": \"4.4.0\",\n+      \"resolved\": \"https://registry.npmjs.org/lodash.toarray/-/lodash.toarray-4.4.0.tgz\",\n+      \"integrity\": \"sha1-JMS/zWsvuji/0FlNsRedjptlZWE=\"\n+    },\n     \"lodash.unescape\": {\n       \"version\": \"4.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/lodash.unescape/-/lodash.unescape-4.0.1.tgz\",\n@@ -10731,6 +10785,14 @@\n         \"lower-case\": \"^1.1.1\"\n       }\n     },\n+    \"node-emoji\": {\n+      \"version\": \"1.10.0\",\n+      \"resolved\": \"https://registry.npmjs.org/node-emoji/-/node-emoji-1.10.0.tgz\",\n+      \"integrity\": \"sha512-Yt3384If5H6BYGVHiHwTL+99OzJKHhgp82S8/dktEK73T26BazdgZ4JZh92xSVtGNJvz9UbXdNAc5hcrXV42vw==\",\n+      \"requires\": {\n+        \"lodash.toarray\": \"^4.4.0\"\n+      }\n+    },\n     \"node-fetch\": {\n       \"version\": \"2.6.0\",\n       \"resolved\": \"https://registry.npmjs.org/node-fetch/-/node-fetch-2.6.0.tgz\","
    },
    {
      "sha": "0d97884f55b8bc27b3fc0111cfeb355ab456774e",
      "filename": "frontend/package.json",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/package.json",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/package.json",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/package.json?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -51,6 +51,7 @@\n     \"copy-webpack-plugin\": \"^5.1.1\",\n     \"css-loader\": \"^3.2.0\",\n     \"document-register-element\": \"^1.14.3\",\n+    \"dotenv\": \"^8.2.0\",\n     \"enzyme\": \"^3.10.0\",\n     \"enzyme-adapter-preact-pure\": \"^2.1.0\",\n     \"es-check\": \"^5.1.0\",\n@@ -63,6 +64,7 @@\n     \"file-loader\": \"^4.2.0\",\n     \"html-webpack-plugin\": \"^3.2.0\",\n     \"husky\": \"^3.0.9\",\n+    \"identity-obj-proxy\": \"^3.0.0\",\n     \"jest\": \"^24.9.0\",\n     \"jest-enzyme\": \"^7.1.1\",\n     \"jest-extended\": \"^0.11.2\",\n@@ -94,11 +96,16 @@\n   },\n   \"dependencies\": {\n     \"@github/markdown-toolbar-element\": \"^1.1.0\",\n+    \"@github/text-expander-element\": \"^1.0.1\",\n+    \"@types/classnames\": \"^2.2.9\",\n+    \"@types/node-emoji\": \"^1.8.1\",\n     \"@webcomponents/custom-elements\": \"^1.3.0\",\n     \"bem-react-helper\": \"^1.1.2\",\n+    \"classnames\": \"^2.2.6\",\n     \"core-js\": \"^3.2.1\",\n     \"focus-visible\": \"^5.0.2\",\n     \"intersection-observer\": \"^0.7.0\",\n+    \"node-emoji\": \"^1.10.0\",\n     \"preact\": \"^10.0.1\",\n     \"react-redux\": \"^7.1.1\",\n     \"redux\": \"^4.0.4\","
    },
    {
      "sha": "bf592d4c5688f1baab17fcca70e69109750086d0",
      "filename": "frontend/webpack.config.js",
      "status": "modified",
      "additions": 36,
      "deletions": 19,
      "changes": 55,
      "blob_url": "https://github.com/umputun/remark/blob/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/webpack.config.js",
      "raw_url": "https://github.com/umputun/remark/raw/17be0036520db8cbbd39fe320fef6ea752b29aa2/frontend/webpack.config.js",
      "contents_url": "https://api.github.com/repos/umputun/remark/contents/frontend/webpack.config.js?ref=17be0036520db8cbbd39fe320fef6ea752b29aa2",
      "patch": "@@ -1,5 +1,5 @@\n /* eslint-disable no-console */\n-\n+require('dotenv').config();\n const path = require('path');\n \n const webpack = require('webpack');\n@@ -27,7 +27,7 @@ console.log(`REMARK_ENV = ${remarkUrl}`);\n  * so we have to exclude from ignore these modules\n  */\n function getExcluded() {\n-  const modules = ['@github/markdown-toolbar-element'];\n+  const modules = ['@github/markdown-toolbar-element', '@github/text-expander-element', '@github/combobox-nav'];\n   const exclude = new RegExp(`node_modules\\\\/(?!(${modules.map(m => m.replace(/\\//g, '\\\\/')).join('|')})\\\\/).*`);\n \n   return {\n@@ -38,24 +38,23 @@ function getExcluded() {\n // console.log(getExcluded())\n // process.exit(1)\n \n-const commonStyleLoaders = [\n-  'css-loader',\n-  {\n-    loader: 'postcss-loader',\n-    options: {\n-      plugins: [\n-        require('postcss-for'),\n-        require('postcss-simple-vars'),\n-        require('postcss-nested'),\n-        require('postcss-calc'),\n-        require('autoprefixer')({ overrideBrowserslist: ['> 1%'] }),\n-        require('postcss-url')({ url: 'inline', maxSize: 5 }),\n-        require('postcss-wrap')({ selector: `#${NODE_ID}` }),\n-        require('postcss-csso'),\n-      ],\n-    },\n+const postCssLoader = wrap => ({\n+  loader: 'postcss-loader',\n+  options: {\n+    plugins: [\n+      require('postcss-for'),\n+      require('postcss-simple-vars'),\n+      require('postcss-nested'),\n+      require('postcss-calc'),\n+      require('autoprefixer')({ overrideBrowserslist: ['> 1%'] }),\n+      require('postcss-url')({ url: 'inline', maxSize: 5 }),\n+      wrap ? require('postcss-wrap')({ selector: `#${NODE_ID}` }) : false,\n+      require('postcss-csso'),\n+    ].filter(plugin => plugin),\n   },\n-];\n+});\n+\n+const commonStyleLoaders = ['css-loader', postCssLoader(true)];\n \n const babelConfigPath = path.resolve(__dirname, './.babelrc.js');\n \n@@ -104,6 +103,24 @@ module.exports = () => ({\n           ...commonStyleLoaders,\n         ],\n       },\n+      {\n+        test: /\\.module\\.pcss$/,\n+        use: [\n+          {\n+            loader: MiniCssExtractPlugin.loader,\n+          },\n+          {\n+            loader: 'css-loader',\n+            options: {\n+              modules: {\n+                mode: `local`,\n+                localIdentName: `${NODE_ID}__[name]__[local]`,\n+              },\n+            },\n+          },\n+          postCssLoader(false),\n+        ],\n+      },\n       {\n         test: /\\.(png|jpg|jpeg|gif|svg)$/,\n         use: {"
    }
  ]
}
