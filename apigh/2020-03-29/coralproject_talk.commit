{
  "sha": "5db096942aeaa134e70b8a203350c062eb17104e",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6NWRiMDk2OTQyYWVhYTEzNGU3MGI4YTIwMzM1MGMwNjJlYjE3MTA0ZQ==",
  "commit": {
    "author": {
      "name": "Tessa Thornton",
      "email": "tessathornton@gmail.com",
      "date": "2020-03-27T18:09:42Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-03-27T18:09:42Z"
    },
    "message": "remove 'mailto:' prefix from links (#2914)\n\nCo-authored-by: Kim Gardner <kgardnr@gmail.com>",
    "tree": {
      "sha": "45b860dd9673d5067edf36a91aa87ff97ff51dab",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/45b860dd9673d5067edf36a91aa87ff97ff51dab"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/5db096942aeaa134e70b8a203350c062eb17104e",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJefkFmCRBK7hj4Ov3rIwAAdHIIAF5r/IqlNbUwIeYvRwp1RLkd\ngIwWkxwfmZEQ0B311SBquAU8OcXl4TUetzGXrV5uHTx/LSXqI3SI4UZOe4KwaF/P\ntQzejRf4DHgI3xyIANQFjnKRQ3HrExAR1zoVFQiWydCBlToCyZz+r2LY/AY1BSIj\nJqWttfKr+AiwLIDgTu4EQ3weaIbV3VEuUY1fX2H6ra0psH5WBrcaqDxI+hJ0pc1g\nyqqinSnoxKbUGx8/jhUHGwdYg93vXothekw18Oerph+tHXfG2sKa0Df2A9amkFn1\n9Z1ROdIQDPluMvex7t8WfCqrcrhwdOSXBPkECKcjiymZRBgM1+/QhNne+dqm3BA=\n=JCVA\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 45b860dd9673d5067edf36a91aa87ff97ff51dab\nparent 4645ed4cd7ab89140ce324b865dd22a1b3f73e60\nauthor Tessa Thornton <tessathornton@gmail.com> 1585332582 -0400\ncommitter GitHub <noreply@github.com> 1585332582 -0400\n\nremove 'mailto:' prefix from links (#2914)\n\nCo-authored-by: Kim Gardner <kgardnr@gmail.com>"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/5db096942aeaa134e70b8a203350c062eb17104e",
  "html_url": "https://github.com/coralproject/talk/commit/5db096942aeaa134e70b8a203350c062eb17104e",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/5db096942aeaa134e70b8a203350c062eb17104e/comments",
  "author": {
    "login": "tessalt",
    "id": 1789029,
    "node_id": "MDQ6VXNlcjE3ODkwMjk=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/1789029?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tessalt",
    "html_url": "https://github.com/tessalt",
    "followers_url": "https://api.github.com/users/tessalt/followers",
    "following_url": "https://api.github.com/users/tessalt/following{/other_user}",
    "gists_url": "https://api.github.com/users/tessalt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tessalt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tessalt/subscriptions",
    "organizations_url": "https://api.github.com/users/tessalt/orgs",
    "repos_url": "https://api.github.com/users/tessalt/repos",
    "events_url": "https://api.github.com/users/tessalt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tessalt/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4645ed4cd7ab89140ce324b865dd22a1b3f73e60",
      "url": "https://api.github.com/repos/coralproject/talk/commits/4645ed4cd7ab89140ce324b865dd22a1b3f73e60",
      "html_url": "https://github.com/coralproject/talk/commit/4645ed4cd7ab89140ce324b865dd22a1b3f73e60"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 15,
    "deletions": 4
  },
  "files": [
    {
      "sha": "657199578c76388ac9b84a0db1bc25432efcf42e",
      "filename": "src/core/common/utils/__snapshots__/purify.spec.ts.snap",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/__snapshots__/purify.spec.ts.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/__snapshots__/purify.spec.ts.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/common/utils/__snapshots__/purify.spec.ts.snap?ref=5db096942aeaa134e70b8a203350c062eb17104e",
      "patch": "@@ -2,7 +2,7 @@\n \n exports[`allows anchor links 1`] = `\n Object {\n-  \"body\": \"<a href=\\\\\"test\\\\\" target=\\\\\"_blank\\\\\" rel=\\\\\"noopener noreferrer\\\\\">test</a>\",\n+  \"body\": \"<a href=\\\\\"http://test.com\\\\\" target=\\\\\"_blank\\\\\" rel=\\\\\"noopener noreferrer\\\\\">http://test.com</a>\",\n   \"linkCount\": 1,\n }\n `;"
    },
    {
      "sha": "df113cee7b0cd55fa9b1f68c3a5fc161d70caa8a",
      "filename": "src/core/common/utils/purify.spec.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/coralproject/talk/blob/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/purify.spec.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/purify.spec.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/common/utils/purify.spec.ts?ref=5db096942aeaa134e70b8a203350c062eb17104e",
      "patch": "@@ -26,7 +26,10 @@ it(\"sanitizes out attributes not allowed\", () => {\n \n it(\"allows anchor links\", () => {\n   expect(\n-    sanitizeCommentBody(DOMPurify, '<a href=\"test\">This is a link</a>')\n+    sanitizeCommentBody(\n+      DOMPurify,\n+      '<a href=\"http://test.com\">This is a link</a>'\n+    )\n   ).toMatchSnapshot();\n });\n "
    },
    {
      "sha": "897062ae1cbd7b148cdecf6d6930c112e3c0fcae",
      "filename": "src/core/common/utils/purify.ts",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/coralproject/talk/blob/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/purify.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/5db096942aeaa134e70b8a203350c062eb17104e/src/core/common/utils/purify.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/common/utils/purify.ts?ref=5db096942aeaa134e70b8a203350c062eb17104e",
      "patch": "@@ -1,6 +1,7 @@\n import createDOMPurify from \"dompurify\";\n \n type DOMPurify = ReturnType<typeof createDOMPurify>;\n+const MAILTO_PROTOCOL = \"mailto:\";\n \n export function createPurify(window: Window, returnDOM = true) {\n   // Initializing JSDOM and DOMPurify\n@@ -26,8 +27,15 @@ export function createPurify(window: Window, returnDOM = true) {\n       node.setAttribute(\"rel\", \"noopener noreferrer\");\n \n       // Ensure that all the links have the same link as they do text.\n-      const href = node.getAttribute(\"href\");\n-      if (node.textContent !== href) {\n+      let href = node.getAttribute(\"href\");\n+      if (href) {\n+        if (node.textContent !== href) {\n+          // remove \"mailto:\" prefix from link text\n+          const url = new URL(href);\n+          if (url.protocol === MAILTO_PROTOCOL) {\n+            href = href.replace(url.protocol, \"\");\n+          }\n+        }\n         node.textContent = href;\n       }\n     } else {"
    }
  ]
}
