{
  "sha": "739d5b6611c474af97517f0fa71820d4598eb150",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6NzM5ZDViNjYxMWM0NzRhZjk3NTE3ZjBmYTcxODIwZDQ1OThlYjE1MA==",
  "commit": {
    "author": {
      "name": "Vinh",
      "email": "vinh@vinh.tech",
      "date": "2020-05-04T15:53:37Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-05-04T15:53:37Z"
    },
    "message": "fix: always show details on moderation card (#2946)",
    "tree": {
      "sha": "974ab2f6f01472ea6f371d3c6392d75f18aeca61",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/974ab2f6f01472ea6f371d3c6392d75f18aeca61"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/739d5b6611c474af97517f0fa71820d4598eb150",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJesDqBCRBK7hj4Ov3rIwAAdHIIADvIoTm8dSB+CErEl4ksHzQZ\nWc3/1Xd5fKlhwMW6IbCnrK0WbCobK9iuSUar251Pm/wntS8v3ofGwSLS8v/cnNQZ\nlN7fKN6buKhjrhTPVW3CwdCuMDhfQlba5lKOzIeReemmLb3MBJE+Y74r0+8XbtnL\nAk8NK0HnCBA+Bywc//6HtREpzlI/YIsebhsxn/CAHhBEp0Ju5ssU5zzu1977vXjq\nr0BKlF5zaPbrJVjCf3YLfOBVHlDzXeu/l//FGR1zcFjC7yxFtDDzqOos3NaH7tyu\n+uZ3vjQ0Gz9G5a3X6NRwgqY2yqws1uw71QuvNWVE93xuYoyxWo97u70fC6tmbCk=\n=1HwB\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 974ab2f6f01472ea6f371d3c6392d75f18aeca61\nparent 192c3486af1c18ea8620b5e8cfe61607196ac78f\nauthor Vinh <vinh@vinh.tech> 1588607617 +0200\ncommitter GitHub <noreply@github.com> 1588607617 -0400\n\nfix: always show details on moderation card (#2946)\n\n"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/739d5b6611c474af97517f0fa71820d4598eb150",
  "html_url": "https://github.com/coralproject/talk/commit/739d5b6611c474af97517f0fa71820d4598eb150",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/739d5b6611c474af97517f0fa71820d4598eb150/comments",
  "author": {
    "login": "cvle",
    "id": 14221600,
    "node_id": "MDQ6VXNlcjE0MjIxNjAw",
    "avatar_url": "https://avatars2.githubusercontent.com/u/14221600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cvle",
    "html_url": "https://github.com/cvle",
    "followers_url": "https://api.github.com/users/cvle/followers",
    "following_url": "https://api.github.com/users/cvle/following{/other_user}",
    "gists_url": "https://api.github.com/users/cvle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cvle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cvle/subscriptions",
    "organizations_url": "https://api.github.com/users/cvle/orgs",
    "repos_url": "https://api.github.com/users/cvle/repos",
    "events_url": "https://api.github.com/users/cvle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cvle/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "192c3486af1c18ea8620b5e8cfe61607196ac78f",
      "url": "https://api.github.com/repos/coralproject/talk/commits/192c3486af1c18ea8620b5e8cfe61607196ac78f",
      "html_url": "https://github.com/coralproject/talk/commit/192c3486af1c18ea8620b5e8cfe61607196ac78f"
    }
  ],
  "stats": {
    "total": 162,
    "additions": 65,
    "deletions": 97
  },
  "files": [
    {
      "sha": "eb66ba735491416bcb4067b5e1c8d2b387ee680b",
      "filename": "src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "status": "modified",
      "additions": 0,
      "deletions": 16,
      "changes": 16,
      "blob_url": "https://github.com/coralproject/talk/blob/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx?ref=739d5b6611c474af97517f0fa71820d4598eb150",
      "patch": "@@ -13,9 +13,6 @@ it(\"renders all markers\", () => {\n   const props: PropTypesOf<typeof MarkersContainerN> = {\n     comment: {\n       status: \"PREMOD\",\n-      editing: {\n-        edited: false,\n-      },\n       revision: {\n         actionCounts: {\n           flag: {\n@@ -33,11 +30,6 @@ it(\"renders all markers\", () => {\n             },\n           },\n         },\n-        metadata: {\n-          perspective: {\n-            score: 0,\n-          },\n-        },\n       },\n     },\n     settings: {\n@@ -58,9 +50,6 @@ it(\"renders some markers\", () => {\n   const props: PropTypesOf<typeof MarkersContainerN> = {\n     comment: {\n       status: \"PREMOD\",\n-      editing: {\n-        edited: false,\n-      },\n       revision: {\n         actionCounts: {\n           flag: {\n@@ -78,11 +67,6 @@ it(\"renders some markers\", () => {\n             },\n           },\n         },\n-        metadata: {\n-          perspective: {\n-            score: 1,\n-          },\n-        },\n       },\n     },\n     settings: {"
    },
    {
      "sha": "83b26ec3c0050d3df13a77088598d689ff7d7065",
      "filename": "src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "status": "modified",
      "additions": 5,
      "deletions": 31,
      "changes": 36,
      "blob_url": "https://github.com/coralproject/talk/blob/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx?ref=739d5b6611c474af97517f0fa71820d4598eb150",
      "patch": "@@ -17,14 +17,6 @@ interface MarkersContainerProps {\n   settings: MarkersContainer_settings;\n }\n \n-function hasDetails(c: MarkersContainer_comment) {\n-  return c.revision\n-    ? c.revision.actionCounts.flag.reasons.COMMENT_REPORTED_OFFENSIVE +\n-        c.revision.actionCounts.flag.reasons.COMMENT_REPORTED_SPAM >\n-        0 || c.revision.metadata.perspective\n-    : false;\n-}\n-\n let keyCounter = 0;\n const markers: Array<(\n   c: MarkersContainer_comment\n@@ -135,25 +127,15 @@ export const MarkersContainer: React.FunctionComponent<MarkersContainerProps> =\n     () => markers.map((cb) => cb(props.comment)).filter((m) => m),\n     [markers, props.comment]\n   );\n-  const doesHaveDetails = useMemo(() => hasDetails(props.comment), [\n-    props.comment,\n-  ]);\n-  if (elements.length === 0 && !doesHaveDetails) {\n-    return null;\n-  }\n \n   return (\n     <Markers\n       details={\n-        doesHaveDetails || props.comment.editing.edited ? (\n-          <ModerateCardDetailsContainer\n-            hasDetails={!!doesHaveDetails}\n-            hasRevisions={props.comment.editing.edited}\n-            onUsernameClick={props.onUsernameClick}\n-            comment={props.comment}\n-            settings={props.settings}\n-          />\n-        ) : null\n+        <ModerateCardDetailsContainer\n+          onUsernameClick={props.onUsernameClick}\n+          comment={props.comment}\n+          settings={props.settings}\n+        />\n       }\n     >\n       {elements}\n@@ -166,9 +148,6 @@ const enhanced = withFragmentContainer<MarkersContainerProps>({\n     fragment MarkersContainer_comment on Comment {\n       ...ModerateCardDetailsContainer_comment\n       status\n-      editing {\n-        edited\n-      }\n       revision {\n         actionCounts {\n           flag {\n@@ -186,11 +165,6 @@ const enhanced = withFragmentContainer<MarkersContainerProps>({\n             }\n           }\n         }\n-        metadata {\n-          perspective {\n-            score\n-          }\n-        }\n       }\n     }\n   `,"
    },
    {
      "sha": "22988a49fe48d80e250eb7c614c3ed128a094fc2",
      "filename": "src/core/client/admin/components/ModerateCard/ModerateCardDetailsContainer.tsx",
      "status": "modified",
      "additions": 60,
      "deletions": 30,
      "changes": 90,
      "blob_url": "https://github.com/coralproject/talk/blob/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/ModerateCardDetailsContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/ModerateCardDetailsContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/ModerateCardDetailsContainer.tsx?ref=739d5b6611c474af97517f0fa71820d4598eb150",
      "patch": "@@ -1,5 +1,10 @@\n import { Localized } from \"@fluent/react/compat\";\n-import React, { FunctionComponent, useCallback, useState } from \"react\";\n+import React, {\n+  FunctionComponent,\n+  useCallback,\n+  useMemo,\n+  useState,\n+} from \"react\";\n import { graphql } from \"react-relay\";\n \n import { withFragmentContainer } from \"coral-framework/lib/relay\";\n@@ -11,8 +16,8 @@ import {\n   TabBar,\n } from \"coral-ui/components/v2\";\n \n-import { ModerateCardDetailsContainer_comment as CommentData } from \"coral-admin/__generated__/ModerateCardDetailsContainer_comment.graphql\";\n-import { ModerateCardDetailsContainer_settings as SettingsData } from \"coral-admin/__generated__/ModerateCardDetailsContainer_settings.graphql\";\n+import { ModerateCardDetailsContainer_comment } from \"coral-admin/__generated__/ModerateCardDetailsContainer_comment.graphql\";\n+import { ModerateCardDetailsContainer_settings } from \"coral-admin/__generated__/ModerateCardDetailsContainer_settings.graphql\";\n \n import CommentRevisionContainer from \"./CommentRevisionContainer\";\n import FlagDetailsContainer from \"./FlagDetailsContainer\";\n@@ -21,43 +26,46 @@ import LinkDetailsContainer from \"./LinkDetailsContainer\";\n import styles from \"./ModerateCardDetailsContainer.css\";\n \n interface Props {\n-  comment: CommentData;\n-  settings: SettingsData;\n+  comment: ModerateCardDetailsContainer_comment;\n+  settings: ModerateCardDetailsContainer_settings;\n   onUsernameClick: (id?: string) => void;\n-  hasDetails: boolean;\n-  hasRevisions: boolean;\n }\n \n-type DetailsTabs = \"DETAILS\" | \"HISTORY\";\n+type DetailsTabs = \"INFO\" | \"HISTORY\";\n+\n+function hasFlagDetails(c: ModerateCardDetailsContainer_comment) {\n+  return c.revision\n+    ? c.revision.actionCounts.flag.reasons.COMMENT_REPORTED_OFFENSIVE +\n+        c.revision.actionCounts.flag.reasons.COMMENT_REPORTED_SPAM >\n+        0 || c.revision.metadata.perspective\n+    : false;\n+}\n \n const ModerateCardDetailsContainer: FunctionComponent<Props> = ({\n   comment,\n   onUsernameClick,\n   settings,\n-  hasDetails,\n-  hasRevisions,\n }) => {\n-  const [activeTab, setActiveTab] = useState<DetailsTabs>(\n-    hasDetails ? \"DETAILS\" : \"HISTORY\"\n-  );\n+  const [activeTab, setActiveTab] = useState<DetailsTabs>(\"INFO\");\n \n   const onTabClick = useCallback((id) => setActiveTab(id as DetailsTabs), [\n     setActiveTab,\n   ]);\n \n+  const doesHaveFlagDetails = useMemo(() => hasFlagDetails(comment), [comment]);\n+  const hasRevisions = comment.editing.edited;\n+\n   return (\n     <HorizontalGutter>\n       <TabBar variant=\"default\" activeTab={activeTab} onTabClick={onTabClick}>\n-        {hasDetails && (\n-          <Tab tabID=\"DETAILS\" classes={styles}>\n-            <Flex alignItems=\"center\" itemGutter>\n-              <Icon size=\"md\">list</Icon>\n-              <Localized id=\"moderateCardDetails-tab-info\">\n-                <span>Info</span>\n-              </Localized>\n-            </Flex>\n-          </Tab>\n-        )}\n+        <Tab tabID=\"INFO\" classes={styles}>\n+          <Flex alignItems=\"center\" itemGutter>\n+            <Icon size=\"md\">list</Icon>\n+            <Localized id=\"moderateCardDetails-tab-info\">\n+              <span>Info</span>\n+            </Localized>\n+          </Flex>\n+        </Tab>\n         {hasRevisions && (\n           <Tab tabID=\"HISTORY\" classes={styles}>\n             <Flex alignItems=\"center\" itemGutter>\n@@ -69,15 +77,19 @@ const ModerateCardDetailsContainer: FunctionComponent<Props> = ({\n           </Tab>\n         )}\n       </TabBar>\n-      {activeTab === \"DETAILS\" && (\n+      {activeTab === \"INFO\" && (\n         <>\n           <LinkDetailsContainer comment={comment} settings={settings} />\n-          <hr />\n-          <FlagDetailsContainer\n-            comment={comment}\n-            settings={settings}\n-            onUsernameClick={onUsernameClick}\n-          />\n+          {doesHaveFlagDetails && (\n+            <>\n+              <hr />\n+              <FlagDetailsContainer\n+                comment={comment}\n+                settings={settings}\n+                onUsernameClick={onUsernameClick}\n+              />\n+            </>\n+          )}\n         </>\n       )}\n       {activeTab === \"HISTORY\" && (\n@@ -90,6 +102,24 @@ const ModerateCardDetailsContainer: FunctionComponent<Props> = ({\n const enhanced = withFragmentContainer<Props>({\n   comment: graphql`\n     fragment ModerateCardDetailsContainer_comment on Comment {\n+      editing {\n+        edited\n+      }\n+      revision {\n+        actionCounts {\n+          flag {\n+            reasons {\n+              COMMENT_REPORTED_OFFENSIVE\n+              COMMENT_REPORTED_SPAM\n+            }\n+          }\n+        }\n+        metadata {\n+          perspective {\n+            score\n+          }\n+        }\n+      }\n       ...FlagDetailsContainer_comment\n       ...CommentRevisionContainer_comment\n       ...LinkDetailsContainer_comment"
    },
    {
      "sha": "6558e155a59a96e9b067be5a9bce5160dbeb5f4f",
      "filename": "src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "status": "modified",
      "additions": 0,
      "deletions": 20,
      "changes": 20,
      "blob_url": "https://github.com/coralproject/talk/blob/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/739d5b6611c474af97517f0fa71820d4598eb150/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap?ref=739d5b6611c474af97517f0fa71820d4598eb150",
      "patch": "@@ -6,9 +6,6 @@ exports[`renders all markers 1`] = `\n     <Relay(ModerateCardDetailsContainer)\n       comment={\n         Object {\n-          \"editing\": Object {\n-            \"edited\": false,\n-          },\n           \"revision\": Object {\n             \"actionCounts\": Object {\n               \"flag\": Object {\n@@ -26,17 +23,10 @@ exports[`renders all markers 1`] = `\n                 },\n               },\n             },\n-            \"metadata\": Object {\n-              \"perspective\": Object {\n-                \"score\": 0,\n-              },\n-            },\n           },\n           \"status\": \"PREMOD\",\n         }\n       }\n-      hasDetails={true}\n-      hasRevisions={false}\n       onUsernameClick={[Function]}\n       settings={\n         Object {\n@@ -161,9 +151,6 @@ exports[`renders some markers 1`] = `\n     <Relay(ModerateCardDetailsContainer)\n       comment={\n         Object {\n-          \"editing\": Object {\n-            \"edited\": false,\n-          },\n           \"revision\": Object {\n             \"actionCounts\": Object {\n               \"flag\": Object {\n@@ -181,17 +168,10 @@ exports[`renders some markers 1`] = `\n                 },\n               },\n             },\n-            \"metadata\": Object {\n-              \"perspective\": Object {\n-                \"score\": 1,\n-              },\n-            },\n           },\n           \"status\": \"PREMOD\",\n         }\n       }\n-      hasDetails={true}\n-      hasRevisions={false}\n       onUsernameClick={[Function]}\n       settings={\n         Object {"
    }
  ]
}
