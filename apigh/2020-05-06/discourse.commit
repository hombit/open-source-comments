{
  "sha": "6c968b794510bfad1385bcb625eacef47b46cb25",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo2Yzk2OGI3OTQ1MTBiZmFkMTM4NWJjYjYyNWVhY2VmNDdiNDZjYjI1",
  "commit": {
    "author": {
      "name": "Kyle E. Mitchell",
      "email": "kyle@kemitchell.com",
      "date": "2020-05-06T16:51:45Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-05-06T16:51:45Z"
    },
    "message": "Add script for compiling copyright deposits (#9646)\n\n* Add script for compiling copyright deposits\r\n\r\n* git mv copyright-deposit script/",
    "tree": {
      "sha": "7453d7fa33eea7404e83ed10513e55b53c115a48",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/7453d7fa33eea7404e83ed10513e55b53c115a48"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/6c968b794510bfad1385bcb625eacef47b46cb25",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJesushCRBK7hj4Ov3rIwAAdHIIAEwznS2fLA6Z3zDz7hZ7DYBJ\nmQ0d6zRC9WxKY27wvdzIgY5oarcSy17YtiSDsph2IY4IBE25d3gIFnFQyvbLI54u\nvf/ZPsU4X7KUSxFaAy0cwfnVhx2xXoPUQVyPPFlzhuitECniJCl3uqL1OHz8omNK\nkQbYKSbm5miSOr8mwrpf09x0NFE2HBR7fWVz2kazGBDiGzbf4yw+QzE59m8VqGeX\npNoEavR3kLBJPzEqrM7j8NaewxhmklCHB6UQhcfnOvlYY15xDPF7TWDA55PJeoyW\nazPcyvPNLyyKxSLASc8zk0vF/0v1HUSnzrsXJQtVFnjz73WW+oXFd5rjbFHttCE=\n=p143\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 7453d7fa33eea7404e83ed10513e55b53c115a48\nparent 666823d4b7cf7bee4c1c81c1df1d1db944620f7f\nauthor Kyle E. Mitchell <kyle@kemitchell.com> 1588783905 -0700\ncommitter GitHub <noreply@github.com> 1588783905 -0400\n\nAdd script for compiling copyright deposits (#9646)\n\n* Add script for compiling copyright deposits\r\n\r\n* git mv copyright-deposit script/"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/6c968b794510bfad1385bcb625eacef47b46cb25",
  "html_url": "https://github.com/discourse/discourse/commit/6c968b794510bfad1385bcb625eacef47b46cb25",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/6c968b794510bfad1385bcb625eacef47b46cb25/comments",
  "author": {
    "login": "kemitchell",
    "id": 205760,
    "node_id": "MDQ6VXNlcjIwNTc2MA==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/205760?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kemitchell",
    "html_url": "https://github.com/kemitchell",
    "followers_url": "https://api.github.com/users/kemitchell/followers",
    "following_url": "https://api.github.com/users/kemitchell/following{/other_user}",
    "gists_url": "https://api.github.com/users/kemitchell/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kemitchell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kemitchell/subscriptions",
    "organizations_url": "https://api.github.com/users/kemitchell/orgs",
    "repos_url": "https://api.github.com/users/kemitchell/repos",
    "events_url": "https://api.github.com/users/kemitchell/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kemitchell/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "666823d4b7cf7bee4c1c81c1df1d1db944620f7f",
      "url": "https://api.github.com/repos/discourse/discourse/commits/666823d4b7cf7bee4c1c81c1df1d1db944620f7f",
      "html_url": "https://github.com/discourse/discourse/commit/666823d4b7cf7bee4c1c81c1df1d1db944620f7f"
    }
  ],
  "stats": {
    "total": 69,
    "additions": 68,
    "deletions": 1
  },
  "files": [
    {
      "sha": "2ef99613b67f03ebd4121c8122f7a2252b71a035",
      "filename": ".gitignore",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/6c968b794510bfad1385bcb625eacef47b46cb25/.gitignore",
      "raw_url": "https://github.com/discourse/discourse/raw/6c968b794510bfad1385bcb625eacef47b46cb25/.gitignore",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/.gitignore?ref=6c968b794510bfad1385bcb625eacef47b46cb25",
      "patch": "@@ -137,4 +137,7 @@ node_modules\n openapi/*\n \n # ember-cli generated\n-dist\n\\ No newline at end of file\n+dist\n+\n+# Copyright Deposits\n+copyright"
    },
    {
      "sha": "2c3318045fbe5a2e2f37892f0908ce6e071c911f",
      "filename": "script/copyright-deposit",
      "status": "added",
      "additions": 64,
      "deletions": 0,
      "changes": 64,
      "blob_url": "https://github.com/discourse/discourse/blob/6c968b794510bfad1385bcb625eacef47b46cb25/script/copyright-deposit",
      "raw_url": "https://github.com/discourse/discourse/raw/6c968b794510bfad1385bcb625eacef47b46cb25/script/copyright-deposit",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/script/copyright-deposit?ref=6c968b794510bfad1385bcb625eacef47b46cb25",
      "patch": "@@ -0,0 +1,64 @@\n+#!/bin/bash\n+set -e\n+mkdir -p copyright\n+\n+tmp=$(mktemp -d)\n+function cleanup () {\n+  rm -rf \"$tmp\"\n+}\n+trap cleanup EXIT\n+\n+# Docs\n+echo \"Compiling documentation deposit...\"\n+docs=\"$tmp/docs\"\n+mkdir -p \"$docs\"\n+\n+# ./README.md\n+echo \"README.md\"\n+PDF_FLAGS=\"--pdf-engine=xelatex\"\n+pandoc $PDF_FLAGS -o \"$tmp/docs/00000.pdf\" README.md\n+\n+# ./docs\n+counter=0\n+for md in docs/*.md; do\n+  echo \"$md\"\n+  counter=$((counter+1))\n+  printf -v padded \"%05d\" $counter\n+  pandoc $PDF_FLAGS -o \"$docs/$padded.pdf\" \"$md\"\n+done\n+\n+pdftk $docs/*.pdf cat output copyright/documentation-deposit.pdf\n+echo \"copyright/documentation-deposit.pdf\"\n+\n+# Code\n+echo \"Compiling code deposit...\"\n+code=\"$tmp/code\"\n+mkdir -p \"$code\"\n+files=$(git ls-files app script | grep -E \"\\\\.(js|rb)$\")\n+sample=15\n+first=$(head -n \"$sample\" <<< \"$files\")\n+last=$(tail -n \"$sample\" <<< \"$files\")\n+\n+unoconv --listener &\n+\n+function process_code () {\n+  echo \"$1\"\n+  counter=$((counter+1))\n+  printf -v padded \"%05d\" $counter\n+  printf \"%s\\\\n\\\\n\" \"$1\" > \"$code/$padded.txt\"\n+  cat \"$1\" >> \"$code/$padded.txt\"\n+  unoconv -o \"$code/$padded.pdf\" \"$code/$padded.txt\"\n+}\n+\n+counter=0\n+while IFS= read -r file; do\n+  process_code \"$file\"\n+done <<< \"$first\"\n+while IFS= read -r file; do\n+  process_code \"$file\"\n+done <<< \"$last\"\n+\n+pdftk $code/*.pdf cat output $code/code.pdf\n+# first 25 pages and last 25 pages\n+pdftk $code/code.pdf cat 1-25 r25-end output copyright/code-deposit.pdf\n+echo \"copyright/code-deposit.pdf\""
    }
  ]
}
