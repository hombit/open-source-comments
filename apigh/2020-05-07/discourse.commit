{
  "sha": "2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODoyZmY4YjRmNWQ5ZGQ3MmE1NWQ3ZWJkYzIzYTM3NThkZDVlYzQ2ODJk",
  "commit": {
    "author": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2020-05-07T10:44:39Z"
    },
    "committer": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2020-05-07T10:44:39Z"
    },
    "message": "Revert \"DEV: upgrade to Rails 6.0.3\"\n\nThis was causing issues during multisite:migrate\n\nhttps://meta.discourse.org/t/multisite-migrate-broken-since-rails-6-0-3-update/150691\n\nThis reverts commit 136a5456534c7e468b8052f865ce970a3bf375e9.",
    "tree": {
      "sha": "3bd9efd4cbb4b2feaa3e742b1c65083028adf876",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/3bd9efd4cbb4b2feaa3e742b1c65083028adf876"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
    "comment_count": 1,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEHsYLdRGl7BC5CQY1RpBMGLHT9DQFAl6z5pwACgkQRpBMGLHT\n9DQSNw/8Cpp72mscocRYNzGTQWuoKiNmRymVwhLQ9mPRJLJOJTJ/Tt8dySpFPyxf\ngpIPye4MFxC/hqq7tbdNR1zp7MqWdFXpI844y2xkZrdrZ+3qyA/Uri0UUAOX/+Ri\n+LzWOPOg6JY4PrTa5F4504ISwj+csDFP1SisVOoX0lAGcWnBOkFwz7nrna1EWOL4\nTpFLuAUUtHUMM/xiC+N/96BoLvRKrtj2nXDC85/JFM8/5j3TiC2cAqUxr40PCykE\n6E83NTYNnc180LtP1X/zcAKH/LP+GiH//7efsqdoptwjOllJaxv0CQW6J27DtI1r\nBPDu7g574sfJaUFLeqzv5Xc8zpG4iWr64+nCSYPVLXlkbCuX+d1DgF0zqNaQbKnl\nPs7CFBFvzbmvPr1qYKjl0L3vm4a4taBsp5GApOE3iHL239KtE5RYLXabGSgJ6UVh\n6GNee/hgu9BDaLuLstrs3WKGZ+EnVwv/czqnq4s/s9mumIKYOmMweQ3CrZ99qsgV\n+RYMhKVybLOYi5zYX+kAzSTBD9wbldLoVHnMVUCue5Znos+fnqAgqHsiLy7kxREC\nsOY2hYKI2ZdYW9yoiXUzgDZSbkl4OQqy6rfWP9ybfdi+RzyFwKOPhO0LVGRNEybh\nvTaDp9gM4YDbdbwTqsSbgJRjV9vY4MVB8hGK+TFBbe5ozaAetbA=\n=BpT2\n-----END PGP SIGNATURE-----",
      "payload": "tree 3bd9efd4cbb4b2feaa3e742b1c65083028adf876\nparent 87b1d435d2a0ccaf401c933a8f4788248a0a402e\nauthor David Taylor <david@taylorhq.com> 1588848279 +0100\ncommitter David Taylor <david@taylorhq.com> 1588848279 +0100\n\nRevert \"DEV: upgrade to Rails 6.0.3\"\n\nThis was causing issues during multisite:migrate\n\nhttps://meta.discourse.org/t/multisite-migrate-broken-since-rails-6-0-3-update/150691\n\nThis reverts commit 136a5456534c7e468b8052f865ce970a3bf375e9.\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
  "html_url": "https://github.com/discourse/discourse/commit/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/comments",
  "author": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "87b1d435d2a0ccaf401c933a8f4788248a0a402e",
      "url": "https://api.github.com/repos/discourse/discourse/commits/87b1d435d2a0ccaf401c933a8f4788248a0a402e",
      "html_url": "https://github.com/discourse/discourse/commit/87b1d435d2a0ccaf401c933a8f4788248a0a402e"
    }
  ],
  "stats": {
    "total": 83,
    "additions": 41,
    "deletions": 42
  },
  "files": [
    {
      "sha": "039acc6a2ad08c96590b0e133640a8ac06fd39b2",
      "filename": "Gemfile",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/discourse/discourse/blob/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/Gemfile",
      "raw_url": "https://github.com/discourse/discourse/raw/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/Gemfile",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/Gemfile?ref=2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
      "patch": "@@ -18,13 +18,13 @@ else\n   # this allows us to include the bits of rails we use without pieces we do not.\n   #\n   # To issue a rails update bump the version number here\n-  gem 'actionmailer', '6.0.3'\n-  gem 'actionpack', '6.0.3'\n-  gem 'actionview', '6.0.3'\n-  gem 'activemodel', '6.0.3'\n-  gem 'activerecord', '6.0.3'\n-  gem 'activesupport', '6.0.3'\n-  gem 'railties', '6.0.3'\n+  gem 'actionmailer', '6.0.2.2'\n+  gem 'actionpack', '6.0.2.2'\n+  gem 'actionview', '6.0.2.2'\n+  gem 'activemodel', '6.0.2.2'\n+  gem 'activerecord', '6.0.2.2'\n+  gem 'activesupport', '6.0.2.2'\n+  gem 'railties', '6.0.2.2'\n   gem 'sprockets-rails'\n end\n "
    },
    {
      "sha": "6d97e8a504ec1b750708c00711ba5ebde9fa58e4",
      "filename": "Gemfile.lock",
      "status": "modified",
      "additions": 29,
      "deletions": 29,
      "changes": 58,
      "blob_url": "https://github.com/discourse/discourse/blob/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/Gemfile.lock",
      "raw_url": "https://github.com/discourse/discourse/raw/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/Gemfile.lock",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/Gemfile.lock?ref=2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
      "patch": "@@ -1,21 +1,21 @@\n GEM\n   remote: https://rubygems.org/\n   specs:\n-    actionmailer (6.0.3)\n-      actionpack (= 6.0.3)\n-      actionview (= 6.0.3)\n-      activejob (= 6.0.3)\n+    actionmailer (6.0.2.2)\n+      actionpack (= 6.0.2.2)\n+      actionview (= 6.0.2.2)\n+      activejob (= 6.0.2.2)\n       mail (~> 2.5, >= 2.5.4)\n       rails-dom-testing (~> 2.0)\n-    actionpack (6.0.3)\n-      actionview (= 6.0.3)\n-      activesupport (= 6.0.3)\n+    actionpack (6.0.2.2)\n+      actionview (= 6.0.2.2)\n+      activesupport (= 6.0.2.2)\n       rack (~> 2.0, >= 2.0.8)\n       rack-test (>= 0.6.3)\n       rails-dom-testing (~> 2.0)\n       rails-html-sanitizer (~> 1.0, >= 1.2.0)\n-    actionview (6.0.3)\n-      activesupport (= 6.0.3)\n+    actionview (6.0.2.2)\n+      activesupport (= 6.0.2.2)\n       builder (~> 3.1)\n       erubi (~> 1.4)\n       rails-dom-testing (~> 2.0)\n@@ -24,20 +24,20 @@ GEM\n       actionview (>= 6.0.a)\n     active_model_serializers (0.8.4)\n       activemodel (>= 3.0)\n-    activejob (6.0.3)\n-      activesupport (= 6.0.3)\n+    activejob (6.0.2.2)\n+      activesupport (= 6.0.2.2)\n       globalid (>= 0.3.6)\n-    activemodel (6.0.3)\n-      activesupport (= 6.0.3)\n-    activerecord (6.0.3)\n-      activemodel (= 6.0.3)\n-      activesupport (= 6.0.3)\n-    activesupport (6.0.3)\n+    activemodel (6.0.2.2)\n+      activesupport (= 6.0.2.2)\n+    activerecord (6.0.2.2)\n+      activemodel (= 6.0.2.2)\n+      activesupport (= 6.0.2.2)\n+    activesupport (6.0.2.2)\n       concurrent-ruby (~> 1.0, >= 1.0.2)\n       i18n (>= 0.7, < 2)\n       minitest (~> 5.1)\n       tzinfo (~> 1.1)\n-      zeitwerk (~> 2.2, >= 2.2.2)\n+      zeitwerk (~> 2.2)\n     addressable (2.7.0)\n       public_suffix (>= 2.0.2, < 5.0)\n     annotate (3.1.1)\n@@ -184,7 +184,7 @@ GEM\n       mini_mime (>= 0.1.1)\n     maxminddb (0.1.22)\n     memory_profiler (0.9.14)\n-    message_bus (3.2.0)\n+    message_bus (3.1.0)\n       rack (>= 1.1.3)\n     method_source (1.0.0)\n     mini_mime (1.0.2)\n@@ -281,9 +281,9 @@ GEM\n     rails_multisite (2.1.1)\n       activerecord (> 5.0, < 7)\n       railties (> 5.0, < 7)\n-    railties (6.0.3)\n-      actionpack (= 6.0.3)\n-      activesupport (= 6.0.3)\n+    railties (6.0.2.2)\n+      actionpack (= 6.0.2.2)\n+      activesupport (= 6.0.2.2)\n       method_source\n       rake (>= 0.8.7)\n       thor (>= 0.20.3, < 2.0)\n@@ -428,14 +428,14 @@ PLATFORMS\n   ruby\n \n DEPENDENCIES\n-  actionmailer (= 6.0.3)\n-  actionpack (= 6.0.3)\n-  actionview (= 6.0.3)\n+  actionmailer (= 6.0.2.2)\n+  actionpack (= 6.0.2.2)\n+  actionview (= 6.0.2.2)\n   actionview_precompiler\n   active_model_serializers (~> 0.8.3)\n-  activemodel (= 6.0.3)\n-  activerecord (= 6.0.3)\n-  activesupport (= 6.0.3)\n+  activemodel (= 6.0.2.2)\n+  activerecord (= 6.0.2.2)\n+  activesupport (= 6.0.2.2)\n   addressable\n   annotate\n   aws-sdk-s3\n@@ -512,7 +512,7 @@ DEPENDENCIES\n   rack-mini-profiler\n   rack-protection\n   rails_multisite\n-  railties (= 6.0.3)\n+  railties (= 6.0.2.2)\n   rake\n   rb-fsevent\n   rb-inotify (~> 0.9)"
    },
    {
      "sha": "b2649ad17f9cb594a05609f2583fe485183d00ad",
      "filename": "config/application.rb",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/config/application.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/config/application.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/config/application.rb?ref=2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
      "patch": "@@ -91,11 +91,6 @@ def config.database_configuration\n       end\n     end\n \n-    # we skip it cause we configure it in the initializer\n-    # the railstie for message_bus would insert it in the\n-    # wrong position\n-    config.skip_message_bus_middleware = true\n-\n     # Disable so this is only run manually\n     # we may want to change this later on\n     # issue is image_optim crashes on missing dependencies"
    },
    {
      "sha": "2647fd039a4bc124d63b3df827ca6890316f218e",
      "filename": "config/initializers/200-first_middlewares.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/config/initializers/200-first_middlewares.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d/config/initializers/200-first_middlewares.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/config/initializers/200-first_middlewares.rb?ref=2ff8b4f5d9dd72a55d7ebdc23a3758dd5ec4682d",
      "patch": "@@ -6,8 +6,12 @@\n #\n # We aren't manipulating the middleware stack directly because of\n # https://github.com/rails/rails/pull/27936\n+session_operations = Rails::Configuration::MiddlewareStackProxy.new([\n+   [:delete, MessageBus::Rack::Middleware],\n+   [:unshift, MessageBus::Rack::Middleware],\n+])\n \n-Rails.configuration.middleware.unshift(MessageBus::Rack::Middleware)\n+Rails.configuration.middleware = Rails.configuration.middleware + session_operations\n \n # no reason to track this in development, that is 300+ redis calls saved per\n # page view (we serve all assets out of thin in development)"
    }
  ]
}
